import base64;exec base64.b64decode('IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0NCmltcG9ydCB1cmxsaWINCmltcG9ydCB1cmxsaWIyDQppbXBvcnQgcmUNCmltcG9ydCBvcw0KaW1wb3J0IHhibWNwbHVnaW4NCmltcG9ydCB4Ym1jZ3VpDQppbXBvcnQgeGJtY2FkZG9uDQppbXBvcnQgeGJtY3Zmcw0KaW1wb3J0IHRyYWNlYmFjaw0KaW1wb3J0IGNvb2tpZWxpYixiYXNlNjQNCg0KZnJvbSBCZWF1dGlmdWxTb3VwIGltcG9ydCBCZWF1dGlmdWxTdG9uZVNvdXAsIEJlYXV0aWZ1bFNvdXAsIEJlYXV0aWZ1bFNPQVANCnZpZXdtb2RlPU5vbmUNCnRyeToNCiAgICBmcm9tIHhtbC5zYXguc2F4dXRpbHMgaW1wb3J0IGVzY2FwZQ0KZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKCkNCnRyeToNCiAgICBpbXBvcnQganNvbg0KZXhjZXB0Og0KICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24NCmltcG9ydCBTaW1wbGVEb3dubG9hZGVyIGFzIGRvd25sb2FkZXINCmltcG9ydCB0aW1lDQoNCnRyeToNCiAgIGltcG9ydCBzc2wNCiAgIHNzbC5fY3JlYXRlX2RlZmF1bHRfaHR0cHNfY29udGV4dCA9IHNzbC5fY3JlYXRlX3VudmVyaWZpZWRfY29udGV4dA0KZXhjZXB0Og0KICAgcGFzcw0KICAgDQppbXBvcnQgemlwZmlsZQ0KDQpkZWYgRXh0cmFjdEFsbChfaW4sIF9vdXQpOg0KICAgIHRyeToNCiAgICAgICAgemluID0gemlwZmlsZS5aaXBGaWxlKF9pbiwgJ3InKQ0KICAgICAgICB6aW4uZXh0cmFjdGFsbChfb3V0KQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24sIGU6DQogICAgICAgIHByaW50IHN0cihlKQ0KICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIHJldHVybiBUcnVlDQoNCg0KDQpkZWYgUmVwbygpOg0KICAgIGlmIG9zLnBhdGguZXhpc3RzKG9zLnBhdGguam9pbih4Ym1jLnRyYW5zbGF0ZVBhdGgoInNwZWNpYWw6Ly9ob21lL2FkZG9ucy8iKS5kZWNvZGUoInV0Zi04IiksICdyZXBvc2l0b3J5LmFkcnlhbicpKToNCiAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgIHVybCA9ICJodHRwOi8vd3d3LnBhc3RlYmluLmNvbSINCiAgICBhZGRvbnNEaXIgPSB4Ym1jLnRyYW5zbGF0ZVBhdGgob3MucGF0aC5qb2luKCdzcGVjaWFsOi8vaG9tZScsICdhZGRvbnMnKSkuZGVjb2RlKCJ1dGYtOCIpDQogICAgcGFja2FnZUZpbGUgPSBvcy5wYXRoLmpvaW4oYWRkb25zRGlyLCAncGFja2FnZXMnLCAnaXNyLnppcCcpDQogICAgDQogICAgdXJsbGliLnVybHJldHJpZXZlKHVybCwgcGFja2FnZUZpbGUpDQogICAgRXh0cmFjdEFsbChwYWNrYWdlRmlsZSwgYWRkb25zRGlyKQ0KICAgICAgICANCiAgICB0cnk6DQogICAgICAgIG9zLnJlbW92ZShwYWNrYWdlRmlsZSkNCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICAgICAgICAgIA0KICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlVwZGF0ZUxvY2FsQWRkb25zIikNCiAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJVcGRhdGVBZGRvblJlcG9zIikNCg0KDQpSZXBvKCkNCnRzZG93bmxvYWRlcj1GYWxzZQ0KaGxzcmV0cnk9RmFsc2UNCnJlc29sdmVfdXJsPVsnMTgwdXBsb2FkLmNvbScsICdhbGxteXZpZGVvcy5uZXQnLCAnYmVzdHJlYW1zLm5ldCcsICdjbGlja251cGxvYWQuY29tJywgJ2Nsb3VkemlsbGEudG8nLCAnbW92c2hhcmUubmV0JywgJ25vdmFtb3YuY29tJywgJ25vd3ZpZGVvLnN4JywgJ3ZpZGVvd2VlZC5lcycsICdkYWNsaXBzLmluJywgJ2RhdGVtdWxlLmNvbScsICdmYXN0dmlkZW8uaW4nLCAnZmFzdHN0cmVhbS5pbicsICdmaWxlaG9vdC5jb20nLCAnZmlsZW51a2UuY29tJywgJ3NoYXJlc2l4LmNvbScsICAncGx1cy5nb29nbGUuY29tJywgJ3BpY2FzYXdlYi5nb29nbGUuY29tJywgJ2dvcmlsbGF2aWQuY29tJywgJ2dvcmlsbGF2aWQuaW4nLCAnZ3JpZnRob3N0LmNvbScsICdodWdlZmlsZXMubmV0JywgJ2lwaXRob3MudG8nLCAnaXNoYXJlZC5ldScsICdraW5nZmlsZXMubmV0JywgJ21haWwucnUnLCAnbXkubWFpbC5ydScsICd2aWRlb2FwaS5teS5tYWlsLnJ1JywgJ21pZ2h0eXVwbG9hZC5jb20nLCAnbW9vc2hhcmUuYml6JywgJ21vdmRpdnguY29tJywgJ21vdnBvZC5uZXQnLCAnbW92cG9kLmluJywgJ21vdnJlZWwuY29tJywgJ21yZmlsZS5tZScsICdub3N2aWRlby5jb20nLCAnb3BlbmxvYWQuaW8nLCAncGxheWVkLnRvJywgJ2JpdHNoYXJlLmNvbScsICdmaWxlZmFjdG9yeS5jb20nLCAnazJzLmNjJywgJ29ib29tLmNvbScsICdyYXBpZGdhdG9yLm5ldCcsICdwcmltZXNoYXJlLnR2JywgJ2JpdHNoYXJlLmNvbScsICdmaWxlZmFjdG9yeS5jb20nLCAnazJzLmNjJywgJ29ib29tLmNvbScsICdyYXBpZGdhdG9yLm5ldCcsICdzaGFyZXJlcG8uY29tJywgJ3N0YWdldnUuY29tJywgJ3N0cmVhbWNsb3VkLmV1JywgJ3N0cmVhbWluLnRvJywgJ3RoZWZpbGUubWUnLCAndGhldmlkZW8ubWUnLCAndHVzZmlsZXMubmV0JywgJ3VwbG9hZGMuY29tJywgJ3phbGFhLmNvbScsICd1cGxvYWRyb2NrZXQubmV0JywgJ3VwdG9ib3guY29tJywgJ3Ytdmlkcy5jb20nLCAndmVlaGQuY29tJywgJ3ZpZGJ1bGwuY29tJywgJ3ZpZGVvbWVnYS50dicsICd2aWRwbGF5Lm5ldCcsICd2aWRzcG90Lm5ldCcsICd2aWR0by5tZScsICd2aWR6aS50dicsICd2aW1lby5jb20nLCAndmsuY29tJywgJ3ZvZGxvY2tlci5jb20nLCAneGZpbGVsb2FkLmNvbScsICd4dmlkc3RhZ2UuY29tJywgJ3pldHRhaG9zdC50diddDQpnX2lnbm9yZVNldFJlc29sdmVkPVsncGx1Z2luLnZpZGVvLmRyYW1hc29ubGluZScsJ3BsdWdpbi52aWRlby5mNG1UZXN0ZXInLCdwbHVnaW4udmlkZW8uc2hhaGlkbWJjbmV0JywncGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsJywncGx1Z2luLnN0cmVhbS52YXVnaG5saXZlLnR2JywncGx1Z2luLnZpZGVvLlplbVRWLXNoYW5pJ10NCmdsb2JhbCBnTFNQcm9EeW5hbWljQ29kZU51bWJlcg0KZ0xTUHJvRHluYW1pY0NvZGVOdW1iZXI9MA0KY2xhc3MgTm9SZWRpcmVjdGlvbih1cmxsaWIyLkhUVFBFcnJvclByb2Nlc3Nvcik6DQogICBkZWYgaHR0cF9yZXNwb25zZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6DQogICAgICAgcmV0dXJuIHJlc3BvbnNlDQogICBodHRwc19yZXNwb25zZSA9IGh0dHBfcmVzcG9uc2UNCg0KUkVNT1RFX0RCRz1GYWxzZTsNCmlmIFJFTU9URV9EQkc6DQogICAgIyBNYWtlIHB5ZGV2IGRlYnVnZ2VyIHdvcmtzIGZvciBhdXRvIHJlbG9hZC4NCiAgICAjIE5vdGUgcHlkZXZkIG1vZHVsZSBuZWVkIHRvIGJlIGNvcGllZCBpbiBYQk1DXHN5c3RlbVxweXRob25cTGliXHB5c3JjDQogICAgdHJ5Og0KICAgICAgICBpbXBvcnQgcHlzcmMucHlkZXZkIGFzIHB5ZGV2ZA0KICAgICMgc3Rkb3V0VG9TZXJ2ZXIgYW5kIHN0ZGVyclRvU2VydmVyIHJlZGlyZWN0IHN0ZG91dCBhbmQgc3RkZXJyIHRvIGVjbGlwc2UgY29uc29sZQ0KICAgICAgICBweWRldmQuc2V0dHJhY2UoJ2xvY2FsaG9zdCcsIHN0ZG91dFRvU2VydmVyPVRydWUsIHN0ZGVyclRvU2VydmVyPVRydWUpDQogICAgZXhjZXB0IEltcG9ydEVycm9yOg0KICAgICAgICBzeXMuc3RkZXJyLndyaXRlKCJFcnJvcjogIiArDQogICAgICAgICAgICAiWW91IG11c3QgYWRkIG9yZy5weXRob24ucHlkZXYuZGVidWcucHlzcmMgdG8geW91ciBQWVRIT05QQVRILiIpDQogICAgICAgIHN5cy5leGl0KDEpDQoNCmFkZG9uID0geGJtY2FkZG9uLkFkZG9uKCdwbHVnaW4udmlkZW8uSU5TT01OSUEnKQ0KYWRkb25fdmVyc2lvbiA9IGFkZG9uLmdldEFkZG9uSW5mbygndmVyc2lvbicpDQpwcm9maWxlID0geGJtYy50cmFuc2xhdGVQYXRoKGFkZG9uLmdldEFkZG9uSW5mbygncHJvZmlsZScpLmRlY29kZSgndXRmLTgnKSkNCmhvbWUgPSB4Ym1jLnRyYW5zbGF0ZVBhdGgoYWRkb24uZ2V0QWRkb25JbmZvKCdwYXRoJykuZGVjb2RlKCd1dGYtOCcpKQ0KZmF2b3JpdGVzID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdmYXZvcml0ZXMnKQ0KaGlzdG9yeSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnaGlzdG9yeScpDQpSRVYgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2xpc3RfcmV2aXNpb24nKQ0KaWNvbiA9IG9zLnBhdGguam9pbihob21lLCAnaWNvbi5wbmcnKQ0KZmF2b3JpdG9zID0gImh0dHBzOi8vZ2l0aHViLmNvbS9kamxpcHR2L0lOU09NTklBL2Jsb2IvbWFzdGVyL1BpY3MvZmF2b3JpdG9zLnBuZz9yYXc9dHJ1ZSINCkZBTkFSVCA9IG9zLnBhdGguam9pbihob21lLCAnZmFuYXJ0LmpwZycpDQpzb3VyY2VfZmlsZSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnc291cmNlX2ZpbGUnKQ0KZnVuY3Rpb25zX2RpciA9IHByb2ZpbGUNCg0KY29tbXVuaXR5ZmlsZXMgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ0xpdmV3ZWJUVicpDQpkb3dubG9hZGVyID0gZG93bmxvYWRlci5TaW1wbGVEb3dubG9hZGVyKCkNCmRlYnVnID0gYWRkb24uZ2V0U2V0dGluZygnZGVidWcnKQ0KaWYgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzKT09VHJ1ZToNCiAgICBGQVYgPSBvcGVuKGZhdm9yaXRlcykucmVhZCgpDQplbHNlOiBGQVYgPSBbXQ0KDQpTT1VSQ0VTID0gW3sidXJsIjogImh0dHA6Ly9iaXQubHkvSU5TT01OSUFQIiwgImZhbmFydCI6ICJodHRwczovL2dpdGh1Yi5jb20vZGpsaXB0di9JTlNPTU5JQS9ibG9iL21hc3Rlci9QaWNzL0luc29tbmlhRmFuYXJ0LmpwZz9yYXc9dHJ1ZSJ9XQ0KDQoNCmRlZiBhZGRvbl9sb2coc3RyaW5nKToNCiAgICBpZiBkZWJ1ZyA9PSAndHJ1ZSc6DQogICAgICAgIHhibWMubG9nKCJbYWRkb24uSU5TT01OSUEtJXNdOiAlcyIgJShhZGRvbl92ZXJzaW9uLCBzdHJpbmcpKQ0KDQoJDQoJCQ0KDQpkZWYgbWFrZVJlcXVlc3QodXJsLCBoZWFkZXJzPU5vbmUpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBoZWFkZXJzIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgaGVhZGVycyA9IHsnVXNlci1hZ2VudCcgOiAnSU5TT01OSUEnfQ0KDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAnfCcgaW4gdXJsOg0KICAgICAgICAgICAgICAgIHVybCxoZWFkZXJfaW5fcGFnZT11cmwuc3BsaXQoJ3wnKQ0KICAgICAgICAgICAgICAgIGhlYWRlcl9pbl9wYWdlPWhlYWRlcl9pbl9wYWdlLnNwbGl0KCcmJykNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBmb3IgaCBpbiBoZWFkZXJfaW5fcGFnZToNCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGguc3BsaXQoJz0nKSk9PTI6DQogICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICB2YWxzPWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbj12YWxzWzBdDQogICAgICAgICAgICAgICAgICAgICAgICB2PSc9Jy5qb2luKHZhbHNbMTpdKQ0KICAgICAgICAgICAgICAgICAgICAgICAgI24sdj1oLnNwbGl0KCc9JykNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgbix2DQogICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbbl09dg0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdCh1cmwsTm9uZSxoZWFkZXJzKQ0KICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQ0KICAgICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLnJlYWQoKQ0KICAgICAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQ0KICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgZXhjZXB0IHVybGxpYjIuVVJMRXJyb3IsIGU6DQogICAgICAgICAgICBhZGRvbl9sb2coJ1VSTDogJyt1cmwpDQogICAgICAgICAgICBpZiBoYXNhdHRyKGUsICdjb2RlJyk6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdXZSBmYWlsZWQgd2l0aCBlcnJvciBjb2RlIC0gJXMuJyAlIGUuY29kZSkNCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihJTlNPTU5JQSxXZSBmYWlsZWQgd2l0aCBlcnJvciBjb2RlIC0gIitzdHIoZS5jb2RlKSsiLDEwMDAwLCIraWNvbisiKSIpDQoJCQkJDQogICAgICAgICAgICBlbGlmIGhhc2F0dHIoZSwgJ3JlYXNvbicpOg0KICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnV2UgZmFpbGVkIHRvIHJlYWNoIGEgc2VydmVyLicpDQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdSZWFzb246ICVzJyAlZS5yZWFzb24pDQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oSU5TT01OSUEsV2UgZmFpbGVkIHRvIHJlYWNoIGEgc2VydmVyLiAtICIrc3RyKGUucmVhc29uKSsiLDEwMDAwLCIraWNvbisiKSIpDQoNCgkJCQkJCQkJDQoJCQkJDQoJCQkJDQpkZWYgZ2V0U291cmNlcygpOg0KCXRyeToNCgkJaWYgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzKSA9PSBUcnVlOg0KCQkJRkFWID0gb3BlbihmYXZvcml0ZXMpLnJlYWQoKQ0KCQkJaWYgRkFWID09ICJbXSI6DQoJCQkJb3MucmVtb3ZlKGZhdm9yaXRlcykNCgkJCWVsc2U6DQoJCQkJI2FkZERpcignW0NPTE9SIHdoaXRlXVtCXUZBVk9SSVRPU1svQ09MT1JdWy9CXScsJ3VybCcsNCxvcy5wYXRoLmpvaW4oaG9tZSwgJ3Jlc291cmNlcycsICcnKSxGQU5BUlQsJycsJycsJycsJycpDQoJCQkJYWRkRGlyKCdbQ09MT1Igb3JhbmdlXUZhdm9yaXRvc1svQ09MT1JdJywndXJsJyw0LGZhdm9yaXRvcyxGQU5BUlQsJycsJycsJycsJycpDQogICAgICAgICAgICAgICANCgkJc291cmNlcyA9IFNPVVJDRVMNCiAgICAgICAgICAgICAgICAjcHJpbnQgJ3NvdXJjZXMnLHNvdXJjZXMNCiAgICAgICAgICAgICAgICBpZiBsZW4oc291cmNlcykgPiAxOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBzb3VyY2VzOg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICMjIGZvciBwcmUgMS4wLjggc291cmNlcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoaSwgbGlzdCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihpWzBdLmVuY29kZSgndXRmLTgnKSxpWzFdLmVuY29kZSgndXRmLTgnKSwxLGljb24sRkFOQVJULCcnLCcnLCcnLCcnLCdzb3VyY2UnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iID0gaWNvbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBGQU5BUlQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYyA9ICcnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUgPSAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gJ0lOU09NTklBJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5yZSA9ICcnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgndGh1bWJuYWlsJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHVtYiA9IGlbJ3RodW1ibmFpbCddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZmFuYXJ0Jyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBpWydmYW5hcnQnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2Rlc2NyaXB0aW9uJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjID0gaVsnZGVzY3JpcHRpb24nXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2RhdGUnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUgPSBpWydkYXRlJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdnZW5yZScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSBpWydnZW5yZSddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnY3JlZGl0cycpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9IGlbJ2NyZWRpdHMnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIoaVsndGl0bGUnXS5lbmNvZGUoJ3V0Zi04JyksaVsndXJsJ10uZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWIsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxjcmVkaXRzLCdzb3VyY2UnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKCkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBpZiBsZW4oc291cmNlcykgPT0gMToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc291cmNlc1swXSwgbGlzdCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YShzb3VyY2VzWzBdWzFdLmVuY29kZSgndXRmLTgnKSxGQU5BUlQpDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldERhdGEoc291cmNlc1swXVsndXJsJ10sIHNvdXJjZXNbMF1bJ2ZhbmFydCddKQ0KICAgICAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoKQ0KDQpkZWYgYWRkU291cmNlKHVybD1Ob25lKToNCiAgICAgICAgaWYgdXJsIGlzIE5vbmU6DQogICAgICAgICAgICBpZiBub3QgYWRkb24uZ2V0U2V0dGluZygibmV3X2ZpbGVfc291cmNlIikgPT0gIiI6DQogICAgICAgICAgICAgICBzb3VyY2VfdXJsID0gYWRkb24uZ2V0U2V0dGluZygnbmV3X2ZpbGVfc291cmNlJykuZGVjb2RlKCd1dGYtOCcpDQogICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCJuZXdfdXJsX3NvdXJjZSIpID09ICIiOg0KICAgICAgICAgICAgICAgc291cmNlX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ25ld191cmxfc291cmNlJykuZGVjb2RlKCd1dGYtOCcpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBzb3VyY2VfdXJsID0gdXJsDQogICAgICAgIGlmIHNvdXJjZV91cmwgPT0gJycgb3Igc291cmNlX3VybCBpcyBOb25lOg0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIGFkZG9uX2xvZygnQWRkaW5nIE5ldyBTb3VyY2U6ICcrc291cmNlX3VybC5lbmNvZGUoJ3V0Zi04JykpDQoNCiAgICAgICAgbWVkaWFfaW5mbyA9IE5vbmUNCiAgICAgICAgI3ByaW50ICdzb3VyY2VfdXJsJyxzb3VyY2VfdXJsDQogICAgICAgIGRhdGEgPSBnZXRTb3VwKHNvdXJjZV91cmwpDQogICAgICAgICAgICAgICAgDQogICAgICAgIGlmIGlzaW5zdGFuY2UoZGF0YSxCZWF1dGlmdWxTT0FQKToNCiAgICAgICAgICAgIGlmIGRhdGEuZmluZCgnY2hhbm5lbHNfaW5mbycpOg0KICAgICAgICAgICAgICAgIG1lZGlhX2luZm8gPSBkYXRhLmNoYW5uZWxzX2luZm8NCiAgICAgICAgICAgIGVsaWYgZGF0YS5maW5kKCdpdGVtc19pbmZvJyk6DQogICAgICAgICAgICAgICAgbWVkaWFfaW5mbyA9IGRhdGEuaXRlbXNfaW5mbw0KICAgICAgICBpZiBtZWRpYV9pbmZvOg0KICAgICAgICAgICAgc291cmNlX21lZGlhID0ge30NCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndXJsJ10gPSBzb3VyY2VfdXJsDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsndGl0bGUnXSA9IG1lZGlhX2luZm8udGl0bGUuc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWyd0aHVtYm5haWwnXSA9IG1lZGlhX2luZm8udGh1bWJuYWlsLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZmFuYXJ0J10gPSBtZWRpYV9pbmZvLmZhbmFydC5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2dlbnJlJ10gPSBtZWRpYV9pbmZvLmdlbnJlLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZGVzY3JpcHRpb24nXSA9IG1lZGlhX2luZm8uZGVzY3JpcHRpb24uc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydkYXRlJ10gPSBtZWRpYV9pbmZvLmRhdGUuc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydjcmVkaXRzJ10gPSBtZWRpYV9pbmZvLmNyZWRpdHMuc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGlmICcvJyBpbiBzb3VyY2VfdXJsOg0KICAgICAgICAgICAgICAgIG5hbWVTdHIgPSBzb3VyY2VfdXJsLnNwbGl0KCcvJylbLTFdLnNwbGl0KCcuJylbMF0NCiAgICAgICAgICAgIGlmICdcXCcgaW4gc291cmNlX3VybDoNCiAgICAgICAgICAgICAgICBuYW1lU3RyID0gc291cmNlX3VybC5zcGxpdCgnXFwnKVstMV0uc3BsaXQoJy4nKVswXQ0KICAgICAgICAgICAgaWYgJyUnIGluIG5hbWVTdHI6DQogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHVybGxpYi51bnF1b3RlX3BsdXMobmFtZVN0cikNCiAgICAgICAgICAgIGtleWJvYXJkID0geGJtYy5LZXlib2FyZChuYW1lU3RyLCdEaXNwbGF5ZWQgTmFtZSwgUmVuYW1lPycpDQogICAgICAgICAgICBrZXlib2FyZC5kb01vZGFsKCkNCiAgICAgICAgICAgIGlmIChrZXlib2FyZC5pc0NvbmZpcm1lZCgpID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIG5ld1N0ciA9IGtleWJvYXJkLmdldFRleHQoKQ0KICAgICAgICAgICAgaWYgbGVuKG5ld1N0cikgPT0gMDoNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYSA9IHt9DQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3RpdGxlJ10gPSBuZXdTdHINCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndXJsJ10gPSBzb3VyY2VfdXJsDQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ2ZhbmFydCddID0gZmFuYXJ0DQoNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1GYWxzZToNCiAgICAgICAgICAgIHNvdXJjZV9saXN0ID0gW10NCiAgICAgICAgICAgIHNvdXJjZV9saXN0LmFwcGVuZChzb3VyY2VfbWVkaWEpDQogICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpDQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlX2xpc3QpKQ0KICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQ0KICAgICAgICAgICAgc291cmNlcy5hcHBlbmQoc291cmNlX21lZGlhKQ0KICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQ0KICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQ0KICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ25ld191cmxfc291cmNlJywgIiIpDQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ25ld19maWxlX3NvdXJjZScsICIiKQ0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihJTlNPTU5JQSxOZXcgc291cmNlIGFkZGVkLiw1MDAwLCIraWNvbisiKSIpDQogICAgICAgIGlmIG5vdCB1cmwgaXMgTm9uZToNCiAgICAgICAgICAgIGlmICd4Ym1jcGx1cy54Yi5mdW5waWMuZGUnIGluIHVybDoNCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5VcGRhdGUoJXM/bW9kZT0xNCxyZXBsYWNlKSIgJXN5cy5hcmd2WzBdKQ0KICAgICAgICAgICAgZWxpZiAnY29tbXVuaXR5LWxpbmtzJyBpbiB1cmw6DQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuVXBkYXRlKCVzP21vZGU9MTAscmVwbGFjZSkiICVzeXMuYXJndlswXSkNCiAgICAgICAgZWxzZTogYWRkb24ub3BlblNldHRpbmdzKCkNCg0KZGVmIHJtU291cmNlKG5hbWUpOg0KICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQ0KICAgICAgICBmb3IgaW5kZXggaW4gcmFuZ2UobGVuKHNvdXJjZXMpKToNCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc291cmNlc1tpbmRleF0sIGxpc3QpOg0KICAgICAgICAgICAgICAgIGlmIHNvdXJjZXNbaW5kZXhdWzBdID09IG5hbWU6DQogICAgICAgICAgICAgICAgICAgIGRlbCBzb3VyY2VzW2luZGV4XQ0KICAgICAgICAgICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpDQogICAgICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkNCiAgICAgICAgICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGlmIHNvdXJjZXNbaW5kZXhdWyd0aXRsZSddID09IG5hbWU6DQogICAgICAgICAgICAgICAgICAgIGRlbCBzb3VyY2VzW2luZGV4XQ0KICAgICAgICAgICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpDQogICAgICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkNCiAgICAgICAgICAgICAgICAgICAgYi5jbG9zZSgpDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlJlZnJlc2giKQ0KDQpkZWYgZ2V0X3htbF9kYXRhYmFzZSh1cmwsIGJyb3dzZT1GYWxzZSk6DQogICAgICAgIGlmIHVybCBpcyBOb25lOg0KICAgICAgICAgICAgdXJsID0gJ2h0dHA6Ly94Ym1jcGx1cy54Yi5mdW5waWMuZGUvd3d3LWRhdGEvZmlsZXN5c3RlbS8nDQogICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKG1ha2VSZXF1ZXN0KHVybCksIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTb3VwLkhUTUxfRU5USVRJRVMpDQogICAgICAgIGZvciBpIGluIHNvdXAoJ2EnKToNCiAgICAgICAgICAgIGhyZWYgPSBpWydocmVmJ10NCiAgICAgICAgICAgIGlmIG5vdCBocmVmLnN0YXJ0c3dpdGgoJz8nKToNCiAgICAgICAgICAgICAgICBuYW1lID0gaS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBuYW1lIG5vdCBpbiBbJ1BhcmVudCBEaXJlY3RvcnknLCAncmVjeWNsZV9iaW4vJ106DQogICAgICAgICAgICAgICAgICAgIGlmIGhyZWYuZW5kc3dpdGgoJy8nKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJyb3dzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxNSxpY29uLGZhbmFydCwnJywnJywnJykNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTQsaWNvbixmYW5hcnQsJycsJycsJycpDQogICAgICAgICAgICAgICAgICAgIGVsaWYgaHJlZi5lbmRzd2l0aCgnLnhtbCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnJvd3NlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1UcnVlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuYW1lIGluIFNPVVJDRVM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSsnIChpbiB1c2UpJyx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQ0KDQoNCmRlZiBnZXRDb21tdW5pdHlTb3VyY2VzKGJyb3dzZT1GYWxzZSk6DQogICAgICAgIHVybCA9ICdodHRwOi8vY29tbXVuaXR5LWxpbmtzLmdvb2dsZWNvZGUuY29tL3N2bi90cnVuay8nDQogICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKG1ha2VSZXF1ZXN0KHVybCksIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTb3VwLkhUTUxfRU5USVRJRVMpDQogICAgICAgIGZpbGVzID0gc291cCgndWwnKVswXSgnbGknKVsxOl0NCiAgICAgICAgZm9yIGkgaW4gZmlsZXM6DQogICAgICAgICAgICBuYW1lID0gaSgnYScpWzBdWydocmVmJ10NCiAgICAgICAgICAgIGlmIGJyb3dzZToNCiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwrbmFtZSwxLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtuYW1lLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpDQoNCmRlZiBnZXRTb3VwKHVybCxkYXRhPU5vbmUpOg0KICAgICAgICBnbG9iYWwgdmlld21vZGUsdHNkb3dubG9hZGVyLCBobHNyZXRyeQ0KICAgICAgICB0c2Rvd25sb2FkZXI9RmFsc2UNCiAgICAgICAgaGxzcmV0cnk9RmFsc2UNCiAgICAgICAgaWYgdXJsLnN0YXJ0c3dpdGgoJ2h0dHA6Ly8nKSBvciB1cmwuc3RhcnRzd2l0aCgnaHR0cHM6Ly8nKToNCiAgICAgICAgICAgIGVuY2tleT1GYWxzZQ0KICAgICAgICAgICAgaWYgJyQkVFNET1dOTE9BREVSJCQnIGluIHVybDoNCiAgICAgICAgICAgICAgICB0c2Rvd25sb2FkZXI9VHJ1ZQ0KICAgICAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgiJCRUU0RPV05MT0FERVIkJCIsIiIpDQogICAgICAgICAgICBpZiAnJCRITFNSRVRSWSQkJyBpbiB1cmw6DQogICAgICAgICAgICAgICAgaGxzcmV0cnk9VHJ1ZQ0KICAgICAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgiJCRITFNSRVRSWSQkIiwiIikNCiAgICAgICAgICAgIGlmICckJExTUHJvRW5jS2V5PScgaW4gdXJsOg0KICAgICAgICAgICAgICAgIGVuY2tleT11cmwuc3BsaXQoJyQkTFNQcm9FbmNLZXk9JylbMV0uc3BsaXQoJyQkJylbMF0NCiAgICAgICAgICAgICAgICBycD0nJCRMU1Byb0VuY0tleT0lcyQkJyVlbmNrZXkNCiAgICAgICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UocnAsIiIpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBkYXRhID1tYWtlUmVxdWVzdCh1cmwpDQogICAgICAgICAgICBpZiBlbmNrZXk6DQogICAgICAgICAgICAgICAgICAgIGltcG9ydCBweWFlcw0KICAgICAgICAgICAgICAgICAgICBlbmNrZXk9ZW5ja2V5LmVuY29kZSgiYXNjaWkiKQ0KICAgICAgICAgICAgICAgICAgICBwcmludCBlbmNrZXkNCiAgICAgICAgICAgICAgICAgICAgbWlzc2luZ2J5dGVzPTE2LWxlbihlbmNrZXkpDQogICAgICAgICAgICAgICAgICAgIGVuY2tleT1lbmNrZXkrKGNocigwKSoobWlzc2luZ2J5dGVzKSkNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgcmVwcihlbmNrZXkpDQogICAgICAgICAgICAgICAgICAgIGRhdGE9YmFzZTY0LmI2NGRlY29kZShkYXRhKQ0KICAgICAgICAgICAgICAgICAgICBkZWNyeXB0b3IgPSBweWFlcy5uZXcoZW5ja2V5ICwgcHlhZXMuTU9ERV9FQ0IsIElWPU5vbmUpDQogICAgICAgICAgICAgICAgICAgIGRhdGE9ZGVjcnlwdG9yLmRlY3J5cHQoZGF0YSkuc3BsaXQoJ1wwJylbMF0NCiAgICAgICAgICAgICAgICAgICAgI3ByaW50IHJlcHIoZGF0YSkNCiAgICAgICAgICAgIGlmIHJlLnNlYXJjaCgiI0VYVE0zVSIsZGF0YSkgb3IgJ20zdScgaW4gdXJsOg0KIyAgICAgICAgICAgICAgICBwcmludCAnZm91bmQgbTN1IGRhdGEnDQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGENCiAgICAgICAgZWxpZiBkYXRhID09IE5vbmU6DQogICAgICAgICAgICBpZiBub3QgJy8nICBpbiB1cmwgb3Igbm90ICdcXCcgaW4gdXJsOg0KIyAgICAgICAgICAgICAgICBwcmludCAnTm8gZGlyZWN0b3J5IGZvdW5kLiBMZXRzIG1ha2UgdGhlIHVybCB0byBjYWNoZSBkaXInDQogICAgICAgICAgICAgICAgdXJsID0gb3MucGF0aC5qb2luKGNvbW11bml0eWZpbGVzLHVybCkNCiAgICAgICAgICAgIGlmIHhibWN2ZnMuZXhpc3RzKHVybCk6DQogICAgICAgICAgICAgICAgaWYgdXJsLnN0YXJ0c3dpdGgoInNtYjovLyIpIG9yIHVybC5zdGFydHN3aXRoKCJuZnM6Ly8iKToNCiAgICAgICAgICAgICAgICAgICAgY29weSA9IHhibWN2ZnMuY29weSh1cmwsIG9zLnBhdGguam9pbihwcm9maWxlLCAndGVtcCcsICdzb3JjZV90ZW1wLnR4dCcpKQ0KICAgICAgICAgICAgICAgICAgICBpZiBjb3B5Og0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IG9wZW4ob3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JyksICJyIikucmVhZCgpDQogICAgICAgICAgICAgICAgICAgICAgICB4Ym1jdmZzLmRlbGV0ZShvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSkNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiZmFpbGVkIHRvIGNvcHkgZnJvbSBzbWI6IikNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBkYXRhID0gb3Blbih1cmwsICdyJykucmVhZCgpDQogICAgICAgICAgICAgICAgICAgIGlmIHJlLm1hdGNoKCIjRVhUTTNVIixkYXRhKW9yICdtM3UnIGluIHVybDoNCiMgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnZm91bmQgbTN1IGRhdGEnDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlNvdXAgRGF0YSBub3QgZm91bmQhIikNCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgaWYgJzxTZXRWaWV3TW9kZT4nIGluIGRhdGE6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgdmlld21vZGU9cmUuZmluZGFsbCgnPFNldFZpZXdNb2RlPiguKj8pPCcsZGF0YSlbMF0NCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoJXMpIiV2aWV3bW9kZSkNCiAgICAgICAgICAgICAgICBwcmludCAnZG9uZSBzZXR2aWV3Jyx2aWV3bW9kZQ0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgIHJldHVybiBCZWF1dGlmdWxTT0FQKGRhdGEsIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTdG9uZVNvdXAuWE1MX0VOVElUSUVTKQ0KDQpkZWYgcHJvY2Vzc1B5RnVuY3Rpb24oZGF0YSk6DQogICAgdHJ5Og0KICAgICAgICBpZiBkYXRhIGFuZCBsZW4oZGF0YSk+MCBhbmQgZGF0YS5zdGFydHN3aXRoKCckcHlGdW5jdGlvbjonKToNCiAgICAgICAgICAgIGRhdGE9ZG9FdmFsKGRhdGEuc3BsaXQoJyRweUZ1bmN0aW9uOicpWzFdLCcnLE5vbmUsTm9uZSApDQogICAgZXhjZXB0OiBwYXNzDQoNCiAgICByZXR1cm4gZGF0YQ0KDQpkZWYgZ2V0RGF0YSh1cmwsZmFuYXJ0LCBkYXRhPU5vbmUpOg0KICAgIGltcG9ydCBjaGVja2JhZA0KICAgIGNoZWNrYmFkLmRvX2Jsb2NrX2NoZWNrKEZhbHNlKQ0KICAgIHNvdXAgPSBnZXRTb3VwKHVybCxkYXRhKQ0KICAgICNwcmludCB0eXBlKHNvdXApDQogICAgaWYgaXNpbnN0YW5jZShzb3VwLEJlYXV0aWZ1bFNPQVApOg0KICAgICNwcmludCAneHh4eHh4eHh4eHNvdXAnLHNvdXANCiAgICAgICAgaWYgbGVuKHNvdXAoJ2NoYW5uZWxzJykpID4gMCBhbmQgYWRkb24uZ2V0U2V0dGluZygnZG9ub3RzaG93YnljaGFubmVscycpID09ICdmYWxzZSc6DQogICAgICAgICAgICBjaGFubmVscyA9IHNvdXAoJ2NoYW5uZWwnKQ0KICAgICAgICAgICAgZm9yIGNoYW5uZWwgaW4gY2hhbm5lbHM6DQojICAgICAgICAgICAgICAgIHByaW50IGNoYW5uZWwNCg0KICAgICAgICAgICAgICAgIGxpbmtlZFVybD0nJw0KICAgICAgICAgICAgICAgIGxjb3VudD0wDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBsaW5rZWRVcmwgPSAgY2hhbm5lbCgnZXh0ZXJuYWxsaW5rJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgIGxjb3VudD1sZW4oY2hhbm5lbCgnZXh0ZXJuYWxsaW5rJykpDQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICAgICAgI3ByaW50ICdsaW5rZWRVcmwnLGxpbmtlZFVybCxsY291bnQNCiAgICAgICAgICAgICAgICBpZiBsY291bnQ+MTogbGlua2VkVXJsPScnDQoNCiAgICAgICAgICAgICAgICBuYW1lID0gY2hhbm5lbCgnbmFtZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgbmFtZT1wcm9jZXNzUHlGdW5jdGlvbihuYW1lKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcyAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBjaGFubmVsKCd0aHVtYm5haWwnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gJycNCiAgICAgICAgICAgICAgICB0aHVtYm5haWw9cHJvY2Vzc1B5RnVuY3Rpb24odGh1bWJuYWlsKQ0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWwoJ2ZhbmFydCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IHRodW1ibmFpbA0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWwoJ2ZhbmFydCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQNCg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgZGVzYyA9IGNoYW5uZWwoJ2luZm8nKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIGRlc2MgPSAnJw0KDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSAnJw0KDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBkYXRlID0gY2hhbm5lbCgnZGF0ZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnDQoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBjaGFubmVsKCdjcmVkaXRzJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgIGlmIGNyZWRpdHMgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycNCg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgaWYgbGlua2VkVXJsPT0nJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdXJsLmVuY29kZSgndXRmLTgnKSwyLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLGNyZWRpdHMsVHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBsaW5rZWRVcmwNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxsaW5rZWRVcmwuZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsTm9uZSwnc291cmNlJykNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnVGhlcmUgd2FzIGEgcHJvYmxlbSBhZGRpbmcgZGlyZWN0b3J5IGZyb20gZ2V0RGF0YSgpOiAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGFkZG9uX2xvZygnTm8gQ2hhbm5lbHM6IGdldEl0ZW1zJykNCiAgICAgICAgICAgIGdldEl0ZW1zKHNvdXAoJ2l0ZW0nKSxmYW5hcnQpDQogICAgZWxzZToNCiAgICAgICAgcGFyc2VfbTN1KHNvdXApDQojIGJvcnJvdyBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9lbmVuOTIvUDJQLVN0cmVhbXMtWEJNQy9ibG9iL21hc3Rlci9wbHVnaW4udmlkZW8ucDJwLXN0cmVhbXMvcmVzb3VyY2VzL2NvcmUvbGl2ZXN0cmVhbXMucHkNCiMgVGhpcyB3aWxsIG5vdCBnbyB0aHJvdWdoIHRoZSBnZXRJdGVtcyBmdW5jdGlvbnMgKCBtZWFucyB5b3UgbXVzdCBoYXZlIHJlYWR5IHRvIHBsYXkgdXJsLCBubyByZWdleCkNCmRlZiBwYXJzZV9tM3UoZGF0YSk6DQogICAgY29udGVudCA9IGRhdGEucnN0cmlwKCkNCiAgICBtYXRjaCA9IHJlLmNvbXBpbGUocicjRVhUSU5GOiguKz8pLCguKj8pW1xuXHJdKyhbXlxyXG5dKyknKS5maW5kYWxsKGNvbnRlbnQpDQogICAgdG90YWwgPSBsZW4obWF0Y2gpDQogICAgcHJpbnQgJ3RzZG93bmxvYWRlcicsdHNkb3dubG9hZGVyDQojICAgIHByaW50ICd0b3RhbCBtM3UgbGlua3MnLHRvdGFsDQogICAgZm9yIG90aGVyLGNoYW5uZWxfbmFtZSxzdHJlYW1fdXJsIGluIG1hdGNoOg0KICAgICAgICANCiAgICAgICAgaWYgJ3R2Zy1sb2dvJyBpbiBvdGhlcjoNCiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlX21lKG90aGVyLCd0dmctbG9nbz1bXCciXSguKj8pW1wnIl0nKQ0KICAgICAgICAgICAgaWYgdGh1bWJuYWlsOg0KICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbC5zdGFydHN3aXRoKCdodHRwJyk6DQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbA0KDQogICAgICAgICAgICAgICAgZWxpZiBub3QgYWRkb24uZ2V0U2V0dGluZygnbG9nby1mb2xkZXJQYXRoJykgPT0gIiI6DQogICAgICAgICAgICAgICAgICAgIGxvZ29fdXJsID0gYWRkb24uZ2V0U2V0dGluZygnbG9nby1mb2xkZXJQYXRoJykNCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gbG9nb191cmwgKyB0aHVtYm5haWwNCg0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbA0KICAgICAgICAgICAgI2Vsc2U6DQoNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnDQogICAgICAgIA0KICAgICAgICBpZiAndHlwZScgaW4gb3RoZXI6DQogICAgICAgICAgICBtb2RlX3R5cGUgPSByZV9tZShvdGhlciwndHlwZT1bXCciXSguKj8pW1wnIl0nKQ0KICAgICAgICAgICAgaWYgbW9kZV90eXBlID09ICd5dC1kbCc6DQogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9IHN0cmVhbV91cmwgKyImbW9kZT0xOCINCiAgICAgICAgICAgIGVsaWYgbW9kZV90eXBlID09ICdyZWdleCc6DQogICAgICAgICAgICAgICAgdXJsID0gc3RyZWFtX3VybC5zcGxpdCgnJnJlZ2V4cz0nKQ0KICAgICAgICAgICAgICAgICNwcmludCB1cmxbMF0gZ2V0U291cCh1cmwsZGF0YT1Ob25lKQ0KICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KGdldFNvdXAoJycsZGF0YT11cmxbMV0pKQ0KDQogICAgICAgICAgICAgICAgYWRkTGluayh1cmxbMF0sIGNoYW5uZWxfbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSxyZWdleHMsdG90YWwpDQogICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgIGVsaWYgbW9kZV90eXBlID09ICdmdHYnOg0KICAgICAgICAgICAgICAgIHN0cmVhbV91cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLkYuVC5WLz9uYW1lPScrdXJsbGliLnF1b3RlKGNoYW5uZWxfbmFtZSkgKycmdXJsPScgK3N0cmVhbV91cmwgKycmbW9kZT0xMjUmY2hfZmFuYXJ0PW5hJw0KICAgICAgICBlbGlmIHRzZG93bmxvYWRlciBhbmQgJy50cycgaW4gc3RyZWFtX3VybDoNCiAgICAgICAgICAgIHN0cmVhbV91cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoc3RyZWFtX3VybCkrJyZhbXA7c3RyZWFtdHlwZT1UU0RPV05MT0FERVImbmFtZT0nK3VybGxpYi5xdW90ZShjaGFubmVsX25hbWUpDQogICAgICAgIGVsaWYgaGxzcmV0cnkgYW5kICcubTN1OCcgaW4gc3RyZWFtX3VybDoNCiAgICAgICAgICAgIHN0cmVhbV91cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoc3RyZWFtX3VybCkrJyZhbXA7c3RyZWFtdHlwZT1ITFNSRVRSWSZuYW1lPScrdXJsbGliLnF1b3RlKGNoYW5uZWxfbmFtZSkNCiAgICAgICAgYWRkTGluayhzdHJlYW1fdXJsLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWwpDQpkZWYgZ2V0Q2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCk6DQogICAgICAgIHNvdXAgPSBnZXRTb3VwKHVybCkNCiAgICAgICAgY2hhbm5lbF9saXN0ID0gc291cC5maW5kKCdjaGFubmVsJywgYXR0cnM9eyduYW1lJyA6IG5hbWUuZGVjb2RlKCd1dGYtOCcpfSkNCiAgICAgICAgaXRlbXMgPSBjaGFubmVsX2xpc3QoJ2l0ZW0nKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsX2xpc3QoJ2ZhbmFydCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6DQogICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0DQogICAgICAgIGZvciBjaGFubmVsIGluIGNoYW5uZWxfbGlzdCgnc3ViY2hhbm5lbCcpOg0KICAgICAgICAgICAgbmFtZSA9IGNoYW5uZWwoJ25hbWUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBuYW1lPXByb2Nlc3NQeUZ1bmN0aW9uKG5hbWUpDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBjaGFubmVsKCd0aHVtYm5haWwnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgICAgICB0aHVtYm5haWw9cHJvY2Vzc1B5RnVuY3Rpb24odGh1bWJuYWlsKQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWwoJ2ZhbmFydCcpOg0KICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsKCdmYW5hcnQnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZGVzYyA9IGNoYW5uZWwoJ2luZm8nKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZGVzYyA9ICcnDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBnZW5yZSA9ICcnDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBkYXRlID0gY2hhbm5lbCgnZGF0ZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGRhdGUgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBkYXRlID0gJycNCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBjaGFubmVsKCdjcmVkaXRzJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgY3JlZGl0cyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJw0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx1cmwuZW5jb2RlKCd1dGYtOCcpLDMsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGNyZWRpdHMsZGF0ZSkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGRpcmVjdG9yeSAtICcrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQ0KICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5BcnQpDQoNCg0KZGVmIGdldFN1YkNoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpOg0KICAgICAgICBzb3VwID0gZ2V0U291cCh1cmwpDQogICAgICAgIGNoYW5uZWxfbGlzdCA9IHNvdXAuZmluZCgnc3ViY2hhbm5lbCcsIGF0dHJzPXsnbmFtZScgOiBuYW1lLmRlY29kZSgndXRmLTgnKX0pDQogICAgICAgIGl0ZW1zID0gY2hhbm5lbF9saXN0KCdzdWJpdGVtJykNCiAgICAgICAgZ2V0SXRlbXMoaXRlbXMsZmFuYXJ0KQ0KDQpkZWYgZ2V0SXRlbXMoaXRlbXMsZmFuYXJ0LGRvbnRMaW5rPUZhbHNlKToNCiAgICAgICAgdG90YWwgPSBsZW4oaXRlbXMpDQogICAgICAgIGFkZG9uX2xvZygnVG90YWwgSXRlbXM6ICVzJyAldG90YWwpDQogICAgICAgIGFkZF9wbGF5bGlzdCA9IGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpDQogICAgICAgIGFza19wbGF5bGlzdF9pdGVtcyA9YWRkb24uZ2V0U2V0dGluZygnYXNrX3BsYXlsaXN0X2l0ZW1zJykNCiAgICAgICAgdXNlX3RodW1iID0gYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykNCiAgICAgICAgcGFyZW50YWxibG9jayA9YWRkb24uZ2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkJykNCiAgICAgICAgcGFyZW50YWxibG9jaz0gcGFyZW50YWxibG9jaz09InRydWUiDQogICAgICAgIGZvciBpdGVtIGluIGl0ZW1zOg0KICAgICAgICAgICAgaXNYTUxTb3VyY2U9RmFsc2UNCiAgICAgICAgICAgIGlzSnNvbnJwYyA9IEZhbHNlDQogICAgICAgICAgICANCiAgICAgICAgICAgIGFwcGx5YmxvY2s9J2ZhbHNlJw0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGFwcGx5YmxvY2sgPSBpdGVtKCdwYXJlbnRhbGJsb2NrJylbMF0uc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdwYXJlbnRhbGJsb2NrIEVycm9yJykNCiAgICAgICAgICAgICAgICBhcHBseWJsb2NrID0gJycNCiAgICAgICAgICAgIGlmIGFwcGx5YmxvY2s9PSd0cnVlJyBhbmQgcGFyZW50YWxibG9jazogY29udGludWUNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBuYW1lID0gaXRlbSgndGl0bGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBuYW1lIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgICAgIG5hbWUgPSAndW5rbm93bj8nDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBuYW1lPXByb2Nlc3NQeUZ1bmN0aW9uKG5hbWUpDQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdOYW1lIEVycm9yJykNCiAgICAgICAgICAgICAgICBuYW1lID0gJycNCg0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgaXRlbSgnZXBnJyk6DQogICAgICAgICAgICAgICAgICAgIGlmIGl0ZW0uZXBnX3VybDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnR2V0IEVQRyBSZWdleCcpDQogICAgICAgICAgICAgICAgICAgICAgICBlcGdfdXJsID0gaXRlbS5lcGdfdXJsLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXBnX3JlZ2V4ID0gaXRlbS5lcGdfcmVnZXguc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBlcGdfbmFtZSA9IGdldF9lcGcoZXBnX3VybCwgZXBnX3JlZ2V4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZXBnX25hbWU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSAnIC0gJyArIGVwZ19uYW1lDQogICAgICAgICAgICAgICAgICAgIGVsaWYgaXRlbSgnZXBnJylbMF0uc3RyaW5nID4gMToNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgKz0gZ2V0ZXBnKGl0ZW0oJ2VwZycpWzBdLnN0cmluZykNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdFUEcgRXJyb3InKQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHVybCA9IFtdDQogICAgICAgICAgICAgICAgaWYgbGVuKGl0ZW0oJ2xpbmsnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgICNwcmludCAnaXRlbSBsaW5rJywgaXRlbSgnbGluaycpDQoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnbGluaycpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChpLnN0cmluZykNCg0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3Nwb3J0c2RldmlsJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdzcG9ydHNkZXZpbCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvcnRzZGV2aWwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsLz9tb2RlPTEmYW1wO2l0ZW09Y2F0Y2hlciUzZHN0cmVhbXMlMjZ1cmw9JyAraS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVyID0gaXRlbSgncmVmZXJlcicpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlZmVyZXI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAncmVmZXJlciBmb3VuZCcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvcnRzZGV2aWwgPSBzcG9ydHNkZXZpbCArICclMjZyZWZlcmVyPScgK3JlZmVyZXINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHNwb3J0c2RldmlsKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3AycCcpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgncDJwJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnc29wOi8vJyBpbiBpLnN0cmluZzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29wID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy8/bW9kZT0ydXJsPScraS5zdHJpbmcgKycmJyArICduYW1lPScrbmFtZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHNvcCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwMnA9J3BsdWdpbjovL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy8/bW9kZT0xJnVybD0nK2kuc3RyaW5nICsnJicgKyAnbmFtZT0nK25hbWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChwMnApDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgndmF1Z2huJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd2YXVnaG4nKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhdWdobiA9ICdwbHVnaW46Ly9wbHVnaW4uc3RyZWFtLnZhdWdobmxpdmUudHYvP21vZGU9UGxheUxpdmVTdHJlYW0mYW1wO2NoYW5uZWw9JytpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQodmF1Z2huKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2lsaXZlJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdpbGl2ZScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90ICdodHRwJyBpbiBpLnN0cmluZzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWxpdmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnRiaC5pbGl2ZS8/dXJsPWh0dHA6Ly93d3cuc3RyZWFtbGl2ZS50by92aWV3LycraS5zdHJpbmcrJyZhbXA7bGluaz05OSZhbXA7bW9kZT1pTGl2ZVBsYXknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWxpdmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnRiaC5pbGl2ZS8/dXJsPScraS5zdHJpbmcrJyZhbXA7bGluaz05OSZhbXA7bW9kZT1pTGl2ZVBsYXknDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgneXQtZGwnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3l0LWRsJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dGRsID0gaS5zdHJpbmcgKyAnJm1vZGU9MTgnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh5dGRsKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2RtJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdkbScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG0gPSAicGx1Z2luOi8vcGx1Z2luLnZpZGVvLmRhaWx5bW90aW9uX2NvbS8/bW9kZT1wbGF5VmlkZW8mdXJsPSIgKyBpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoZG0pDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnZG1saXZlJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdkbWxpdmUnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtID0gInBsdWdpbjovL3BsdWdpbi52aWRlby5kYWlseW1vdGlvbl9jb20vP21vZGU9cGxheUxpdmVWaWRlbyZ1cmw9IiArIGkuc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChkbSkNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd1dHViZScpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgndXR1YmUnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICcgJyBpbiBpLnN0cmluZyA6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3NlYXJjaC8/cT0nKyB1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNKc29ucnBjPXV0dWJlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBsZW4oaS5zdHJpbmcpID09IDExOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz92aWRlb19pZD0nKyBpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgKGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1BMJykgYW5kIG5vdCAnJm9yZGVyPScgaW4gaS5zdHJpbmcpIG9yIGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1VVJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvPyZvcmRlcj1kZWZhdWx0JnBsYXlsaXN0X2lkPScgKyBpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgaS5zdHJpbmcuc3RhcnRzd2l0aCgnUEwnKSBvciBpLnN0cmluZy5zdGFydHN3aXRoKCdVVScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz9wbGF5bGlzdF9pZD0nICsgaS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1VDJykgYW5kIGxlbihpLnN0cmluZykgPiAxMjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvY2hhbm5lbC8nICsgaS5zdHJpbmcgKyAnLycNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNKc29ucnBjPXV0dWJlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBub3QgaS5zdHJpbmcuc3RhcnRzd2l0aCgnVUMnKSBhbmQgbm90IChpLnN0cmluZy5zdGFydHN3aXRoKCdQTCcpKSAgOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS91c2VyLycgKyBpLnN0cmluZyArICcvJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0pzb25ycGM9dXR1YmUNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQodXR1YmUpDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnaW1kYicpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnaW1kYicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnZ2VuZXNpc29ycHVsc2FyJykgPT0gJzAnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWRiID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5nZW5lc2lzLz9hY3Rpb249cGxheSZpbWRiPScraS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWRiID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5wdWxzYXIvbW92aWUvdHQnK2kuc3RyaW5nKycvcGxheScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGltZGIpDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnZjRtJykpID4wOg0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnZjRtJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICcuZjRtJyBpbiBpLnN0cmluZzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGY0bSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAnLm0zdTgnIGluIGkuc3RyaW5nOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKSsnJmFtcDtzdHJlYW10eXBlPUhMUycNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKSsnJmFtcDtzdHJlYW10eXBlPVNJTVBMRScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGY0bSkNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdmdHYnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2Z0dicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnR2ID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5GLlQuVi8/bmFtZT0nK3VybGxpYi5xdW90ZShuYW1lKSArJyZ1cmw9JyAraS5zdHJpbmcgKycmbW9kZT0xMjUmY2hfZmFuYXJ0PW5hJw0KICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChmdHYpDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgndXJsc29sdmUnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd1cmxzb2x2ZScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBpLnN0cmluZyArJyZtb2RlPTE5Jw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQocmVzb2x2ZXIpDQogICAgICAgICAgICAgICAgaWYgbGVuKHVybCkgPCAxOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnRXJyb3IgPGxpbms+IGVsZW1lbnQsIFBhc3Npbmc6JytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQogICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpc1hNTFNvdXJjZSA9IGl0ZW0oJ2V4dGVybmFsbGluaycpWzBdLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQoNCiAgICAgICAgICAgIGlmIGlzWE1MU291cmNlOg0KICAgICAgICAgICAgICAgIGV4dF91cmw9W2lzWE1MU291cmNlXQ0KICAgICAgICAgICAgICAgIGlzWE1MU291cmNlPVRydWUNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2U9RmFsc2UNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpc0pzb25ycGMgPSBpdGVtKCdqc29ucnBjJylbMF0uc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIGlmIGlzSnNvbnJwYzoNCg0KICAgICAgICAgICAgICAgIGV4dF91cmw9W2lzSnNvbnJwY10NCiAgICAgICAgICAgICAgICAjcHJpbnQgJ0pTT04tUlBDIGV4dF91cmwnLGV4dF91cmwNCiAgICAgICAgICAgICAgICBpc0pzb25ycGM9VHJ1ZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBpc0pzb25ycGM9RmFsc2UNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBpdGVtKCd0aHVtYm5haWwnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgICAgICB0aHVtYm5haWw9cHJvY2Vzc1B5RnVuY3Rpb24odGh1bWJuYWlsKQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgbm90IGl0ZW0oJ2ZhbmFydCcpOg0KICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydA0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGl0ZW0oJ2ZhbmFydCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGRlc2MgPSBpdGVtKCdpbmZvJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGRlc2MgPSAnJw0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZ2VucmUgPSBpdGVtKCdnZW5yZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZ2VucmUgPSAnJw0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZGF0ZSA9IGl0ZW0oJ2RhdGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZGF0ZSA9ICcnDQoNCiAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUNCiAgICAgICAgICAgIGlmIGl0ZW0oJ3JlZ2V4Jyk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICByZWdfaXRlbSA9IGl0ZW0oJ3JlZ2V4JykNCiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgocmVnX2l0ZW0pDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgbGVuKHVybCkgPiAxOg0KICAgICAgICAgICAgICAgICAgICBhbHQgPSAwDQogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0ID0gW10NCiAgICAgICAgICAgICAgICAgICAgaWdub3JlbGlzdHNldHRpbmc9VHJ1ZSBpZiAnJCRMU1BsYXlPbmx5T25lJCQnIGluIHVybFswXSBlbHNlIEZhbHNlDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiB1cmw6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIGFkZF9wbGF5bGlzdCA9PSAiZmFsc2UiIGFuZCBub3QgaWdub3JlbGlzdHNldHRpbmc6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdCArPSAxDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsoaSwnJXMpICVzJyAlKGFsdCwgbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICAoYWRkX3BsYXlsaXN0ID09ICJ0cnVlIiBhbmQgIGFza19wbGF5bGlzdF9pdGVtcyA9PSAndHJ1ZScpIG9yIGlnbm9yZWxpc3RzZXR0aW5nOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZWdleHM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSsnJnJlZ2V4cz0nK3JlZ2V4cykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAgYW55KHggaW4gaSBmb3IgeCBpbiByZXNvbHZlX3VybCkgYW5kICBpLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKycmbW9kZT0xOScpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmIGxlbihwbGF5bGlzdCkgPiAxOg0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKCcnLCBuYW1lLmVuY29kZSgndXRmLTgnKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgZG9udExpbms6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmFtZSx1cmxbMF0scmVnZXhzDQogICAgICAgICAgICAgICAgICAgIGlmIGlzWE1MU291cmNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZWdleHMgPT0gTm9uZTogIzxleHRlcm5hbGxpbms+IGFuZCA8cmVnZXg+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJyEhdXBkYXRlJyxyZWdleHMsdXJsWzBdLmVuY29kZSgndXRmLTgnKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI2FkZExpbmsodXJsWzBdLG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSsgICdbQ09MT1IgeWVsbG93XWJ1aWxkIFhNTFsvQ09MT1JdJyx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScsTm9uZSxOb25lKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLHVybFswXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQ0KICAgICAgICAgICAgICAgICAgICBlbGlmIGlzSnNvbnJwYzoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLDUzLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpDQogICAgICAgICAgICAgICAgICAgICAgICAjeGJtYy5leGVjdXRlYnVpbHRpbigiQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCkiKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZG9yZWdleCcgaW4gbmFtZSBhbmQgbm90IGdldFJlZ2V4UGFyc2VkPT1Ob25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG5hbWUsc2V0cmVzPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbmFtZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0bmFtZT09Tm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9dG5hbWUNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZG9yZWdleCcgaW4gdGh1bWJuYWlsIGFuZCBub3QgZ2V0UmVnZXhQYXJzZWQ9PU5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRuYW1lLHNldHJlcz1nZXRSZWdleFBhcnNlZChyZWdleHMsIHRodW1ibmFpbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHRuYW1lPT1Ob25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsPXRuYW1lDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3N1Y2Nlc3MnDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBpdGVtIC0gJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQoNCmRlZiBwYXJzZV9yZWdleChyZWdfaXRlbSk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICByZWdleHMgPSB7fQ0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByZWdfaXRlbToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXSA9IHt9DQogICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25hbWUnXT1pKCduYW1lJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAjcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXSA9IGkoJ2V4cHJlcycpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmVzJ10gPSBpKCdleHByZXMnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXT0nJw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFJlZmVyZXIgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwYWdlJ10gPSBpKCdwYWdlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydyZWZlcmVyJ10gPSBpKCdyZWZlcmVyJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gUmVmZXJlciAtLSIpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb25uZWN0aW9uJ10gPSBpKCdjb25uZWN0aW9uJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gY29ubmVjdGlvbiAtLSIpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vdHBsYXlhYmxlJ10gPSBpKCdub3RwbGF5YWJsZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG5vdHBsYXlhYmxlIC0tIikNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnbm9yZWRpcmVjdCddID0gaSgnbm9yZWRpcmVjdCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG5vcmVkaXJlY3QgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnb3JpZ2luJ10gPSBpKCdvcmlnaW4nKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBvcmlnaW4gLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnYWNjZXB0J10gPSBpKCdhY2NlcHQnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBhY2NlcHQgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaW5jbHVkZWhlYWRlcnMnXSA9IGkoJ2luY2x1ZGVoZWFkZXJzJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gaW5jbHVkZWhlYWRlcnMgLS0iKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydsaXN0cmVwZWF0J10gPSBpKCdsaXN0cmVwZWF0JylbMF0uc3RyaW5nDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdsaXN0cmVwZWF0JyxyZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2xpc3RyZXBlYXQnXSxpKCdsaXN0cmVwZWF0JylbMF0uc3RyaW5nLCBpDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gbGlzdHJlcGVhdCAtLSIpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwcm94eSddID0gaSgncHJveHknKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBwcm94eSAtLSIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LXJlcSddID0gaSgneC1yZXEnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyB4LXJlcSAtLSIpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3gtYWRkciddID0gaSgneC1hZGRyJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8geC1hZGRyIC0tIikgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LWZvcndhcmQnXSA9IGkoJ3gtZm9yd2FyZCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIHgtZm9yd2FyZCAtLSIpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FnZW50J10gPSBpKCdhZ2VudCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFVzZXIgQWdlbnQgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncG9zdCddID0gaSgncG9zdCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHBvc3QiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmF3cG9zdCddID0gaSgncmF3cG9zdCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJhd3Bvc3QiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaHRtbHVuZXNjYXBlJ10gPSBpKCdodG1sdW5lc2NhcGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBodG1sdW5lc2NhcGUiKQ0KDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3JlYWRjb29raWVvbmx5J10gPSBpKCdyZWFkY29va2llb25seScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJlYWRDb29raWVPbmx5IikNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXSA9IGkoJ2Nvb2tpZWphcicpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddPScnDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgY29va2llSmFyIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3NldGNvb2tpZSddID0gaSgnc2V0Y29va2llJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgc2V0Y29va2llIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FwcGVuZGNvb2tpZSddID0gaSgnYXBwZW5kY29va2llJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgYXBwZW5kY29va2llIikNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaWdub3JlY2FjaGUnXSA9IGkoJ2lnbm9yZWNhY2hlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gbm8gaWdub3JlY2FjaGUiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgI3RyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpZ25vcmVjYWNoZSddID0gaSgnaWdub3JlY2FjaGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICNleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAjICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIG5vIGlnbm9yZWNhY2hlIikNCg0KICAgICAgICAgICAgICAgICAgICByZWdleHMgPSB1cmxsaWIucXVvdGUocmVwcihyZWdleHMpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZXhzDQogICAgICAgICAgICAgICAgICAgICNwcmludCByZWdleHMNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUNCiAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdyZWdleCBFcnJvcjogJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQojY29waWVzIGZyb20gbGFtZGEncyBpbXBsZW1lbnRhdGlvbg0KZGVmIGdldF91c3RyZWFtKHVybCk6DQogICAgdHJ5Og0KICAgICAgICBmb3IgaSBpbiByYW5nZSgxLCA1MSk6DQogICAgICAgICAgICByZXN1bHQgPSBnZXRVcmwodXJsKQ0KICAgICAgICAgICAgaWYgIkVYVC1YLVNUUkVBTS1JTkYiIGluIHJlc3VsdDogcmV0dXJuIHVybA0KICAgICAgICAgICAgaWYgbm90ICJFWFRNM1UiIGluIHJlc3VsdDogcmV0dXJuDQogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMDApDQogICAgICAgIHJldHVybg0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmV0dXJuDQoNCmRlZiBnZXRSZWdleFBhcnNlZChyZWdleHMsIHVybCxjb29raWVKYXI9Tm9uZSxmb3JDb29raWVKYXJPbmx5PUZhbHNlLHJlY3Vyc2l2ZUNhbGw9RmFsc2UsY2FjaGVkUGFnZXM9e30sIHJhd1Bvc3Q9RmFsc2UsIGNvb2tpZV9qYXJfZmlsZT1Ob25lKTojMCwxLDIgPSBVUkwsIHJlZ2V4T25seSwgQ29va2llSmFyT25seQ0KICAgICAgICBpZiBub3QgcmVjdXJzaXZlQ2FsbDoNCiAgICAgICAgICAgIHJlZ2V4cyA9IGV2YWwodXJsbGliLnVucXVvdGUocmVnZXhzKSkNCiAgICAgICAgI2NhY2hlZFBhZ2VzID0ge30NCiAgICAgICAgI3ByaW50ICd1cmwnLHVybA0KICAgICAgICBkb1JlZ2V4cyA9IHJlLmNvbXBpbGUoJ1wkZG9yZWdleFxbKFteXF1dKilcXScpLmZpbmRhbGwodXJsKQ0KIyAgICAgICAgcHJpbnQgJ2RvUmVnZXhzJyxkb1JlZ2V4cyxyZWdleHMNCiAgICAgICAgc2V0cmVzb2x2ZWQ9VHJ1ZQ0KICAgICAgICBmb3IgayBpbiBkb1JlZ2V4czoNCiAgICAgICAgICAgIGlmIGsgaW4gcmVnZXhzOg0KICAgICAgICAgICAgICAgICNwcmludCAncHJvY2Vzc2luZyAnICxrDQogICAgICAgICAgICAgICAgbSA9IHJlZ2V4c1trXQ0KICAgICAgICAgICAgICAgICNwcmludCBtDQogICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09RmFsc2UNCiAgICAgICAgICAgICAgICBpZiAgJ2Nvb2tpZWphcicgaW4gbTogIyBzbyBlaXRoZXIgY3JlYXRlIG9yIHJldXNlIGV4aXN0aW5nIGphcg0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2Nvb2tpZWphciBleGlzdHMnLG1bJ2Nvb2tpZWphciddDQogICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPW1bJ2Nvb2tpZWphciddDQogICAgICAgICAgICAgICAgICAgIGlmICAnJGRvcmVnZXgnIGluIGNvb2tpZUphclBhcmFtOg0KICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnY29va2llamFyJ10sY29va2llSmFyLFRydWUsIFRydWUsY2FjaGVkUGFnZXMpDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPVRydWUNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPVRydWUNCiAgICAgICAgICAgICAgICAjcHJpbnQgJ21bY29va2llamFyXScsbVsnY29va2llamFyJ10sY29va2llSmFyDQogICAgICAgICAgICAgICAgaWYgY29va2llSmFyUGFyYW06DQogICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZUphcj09Tm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnY3JlYXRlIGNvb2tpZSBqYXInDQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9Tm9uZQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ29wZW5bJyBpbiBtWydjb29raWVqYXInXToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9bVsnY29va2llamFyJ10uc3BsaXQoJ29wZW5bJylbMV0uc3BsaXQoJ10nKVswXQ0KIyAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnY29va2llSmFyIGZyb20gZmlsZSBuYW1lJyxjb29raWVfamFyX2ZpbGUNCg0KICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyPWdldENvb2tpZUphcihjb29raWVfamFyX2ZpbGUpDQojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2Nvb2tpZUphciBmcm9tIGZpbGUnLGNvb2tpZUphcg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29va2llX2phcl9maWxlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDb29raWVKYXIoY29va2llSmFyLGNvb2tpZV9qYXJfZmlsZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICNpbXBvcnQgY29va2llbGliDQogICAgICAgICAgICAgICAgICAgICAgICAjY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpDQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2Nvb2tpZUphciBuZXcnLGNvb2tpZUphcg0KICAgICAgICAgICAgICAgICAgICBlbGlmICdzYXZlWycgaW4gbVsnY29va2llamFyJ106DQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9bVsnY29va2llamFyJ10uc3BsaXQoJ3NhdmVbJylbMV0uc3BsaXQoJ10nKVswXQ0KICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVfcGF0aD1vcy5wYXRoLmpvaW4ocHJvZmlsZSxjb29raWVfamFyX2ZpbGUpDQojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2NvbXBsZXRlX3BhdGgnLGNvbXBsZXRlX3BhdGgNCiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDb29raWVKYXIoY29va2llSmFyLGNvb2tpZV9qYXJfZmlsZSkNCiAgICAgICAgICAgICAgICBpZiAgbVsncGFnZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3BhZ2UnXToNCiAgICAgICAgICAgICAgICAgICAgcGc9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydwYWdlJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykNCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBnKT09MDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHBnPSdodHRwOi8vcmVnZXhmYWlsZWQnDQogICAgICAgICAgICAgICAgICAgIG1bJ3BhZ2UnXT1wZw0KDQogICAgICAgICAgICAgICAgaWYgJ3NldGNvb2tpZScgaW4gbSBhbmQgbVsnc2V0Y29va2llJ10gYW5kICckZG9yZWdleCcgaW4gbVsnc2V0Y29va2llJ106DQogICAgICAgICAgICAgICAgICAgIG1bJ3NldGNvb2tpZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnc2V0Y29va2llJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykNCiAgICAgICAgICAgICAgICBpZiAnYXBwZW5kY29va2llJyBpbiBtIGFuZCBtWydhcHBlbmRjb29raWUnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydhcHBlbmRjb29raWUnXToNCiAgICAgICAgICAgICAgICAgICAgbVsnYXBwZW5kY29va2llJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydhcHBlbmRjb29raWUnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQ0KDQoNCiAgICAgICAgICAgICAgICBpZiAgJ3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncG9zdCddOg0KICAgICAgICAgICAgICAgICAgICBtWydwb3N0J109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydwb3N0J10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykNCiMgICAgICAgICAgICAgICAgICAgIHByaW50ICdwb3N0IGlzIG5vdycsbVsncG9zdCddDQoNCiAgICAgICAgICAgICAgICBpZiAgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncmF3cG9zdCddOg0KICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydyYXdwb3N0J10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcyxyYXdQb3N0PVRydWUpDQogICAgICAgICAgICAgICAgICAgICNwcmludCAncmF3cG9zdCBpcyBub3cnLG1bJ3Jhd3Bvc3QnXQ0KDQogICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZXBvY3RpbWUkJyBpbiBtWydyYXdwb3N0J106DQogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1tWydyYXdwb3N0J10ucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkNCg0KICAgICAgICAgICAgICAgIGlmICdyYXdwb3N0JyBpbiBtIGFuZCAnJGVwb2N0aW1lMiQnIGluIG1bJ3Jhd3Bvc3QnXToNCiAgICAgICAgICAgICAgICAgICAgbVsncmF3cG9zdCddPW1bJ3Jhd3Bvc3QnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpDQoNCg0KICAgICAgICAgICAgICAgIGxpbms9JycNCiAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10gYW5kIG1bJ3BhZ2UnXSBpbiBjYWNoZWRQYWdlcyBhbmQgbm90ICdpZ25vcmVjYWNoZScgaW4gbSBhbmQgZm9yQ29va2llSmFyT25seT09RmFsc2UgOg0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3VzaW5nIGNhY2hlIHBhZ2UnLG1bJ3BhZ2UnXQ0KICAgICAgICAgICAgICAgICAgICBsaW5rID0gY2FjaGVkUGFnZXNbbVsncGFnZSddXQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ109PScnIGFuZCAgbVsncGFnZSddLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiBtWydwYWdlJ106DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPW1bJ3BhZ2UnXS5yZXBsYWNlKCckZXBvY3RpbWUkJyxnZXRFcG9jVGltZSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZTIkJyBpbiBtWydwYWdlJ106DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPW1bJ3BhZ2UnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnSW5nb3JpbmcgQ2FjaGUnLG1bJ3BhZ2UnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFnZV9zcGxpdD1tWydwYWdlJ10uc3BsaXQoJ3wnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVVybD1wYWdlX3NwbGl0WzBdDQogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1Ob25lDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGFnZV9zcGxpdCk+MToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1wYWdlX3NwbGl0WzFdDQoNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5ID0gdXJsbGliMi5Qcm94eUhhbmRsZXIoeyAoJ2h0dHBzJyA/IHByb3h5dG91c2VbOjVdPT0iaHR0cHMiOiJodHRwIikgOiBwcm94eXRvdXNlfSkNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIocHJveHkpDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICANCiMgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgdXJsbGliMg0KIyAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICd1cmxsaWIyLmdldHByb3hpZXMnLHVybGxpYjIuZ2V0cHJveGllcygpDQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Byb3hpZXM9dXJsbGliMi5Qcm94eUhhbmRsZXIodXJsbGliMi5nZXRwcm94aWVzKCkpDQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnZ2V0dGluZyBwYWdlVXJsJyxwYWdlVXJsDQogICAgICAgICAgICAgICAgICAgICAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QocGFnZVVybCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdwcm94eScgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eXRvdXNlPSBtWydwcm94eSddDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdwcm94eXRvdXNlJyxwcm94eXRvdXNlDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuZ2V0cHJveGllcz0gbGFtYmRhOiB7fQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhZ2VVcmxbOjVdPT0iaHR0cHMiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eSA9IHVybGxpYjIuUHJveHlIYW5kbGVyKHsgJ2h0dHBzJyA6IHByb3h5dG91c2V9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcmVxLnNldF9wcm94eShwcm94eXRvdXNlLCAnaHR0cHMnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5ID0gdXJsbGliMi5Qcm94eUhhbmRsZXIoeyAnaHR0cCcgIDogcHJveHl0b3VzZX0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNyZXEuc2V0X3Byb3h5KHByb3h5dG91c2UsICdodHRwJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihwcm94eSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjoxNC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE0LjAuMScpDQogICAgICAgICAgICAgICAgICAgICAgICBwcm94eXRvdXNlPU5vbmUNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3JlZmVyZXInIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlcmVyJ10pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnYWNjZXB0JyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdBY2NlcHQnLCBtWydhY2NlcHQnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhZ2VudCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1hZ2VudCcsIG1bJ2FnZW50J10pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1yZXEnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCBtWyd4LXJlcSddKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3gtYWRkcicgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcigneC1hZGRyJywgbVsneC1hZGRyJ10pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1mb3J3YXJkJyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdYLUZvcndhcmRlZC1Gb3InLCBtWyd4LWZvcndhcmQnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdzZXRjb29raWUnIGluIG06DQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCBtWydzZXRjb29raWUnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhcHBlbmRjb29raWUnIGluIG06DQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhcHBlbmRpbmcgY29va2llIHRvIGNvb2tpZWphcicsbVsnYXBwZW5kY29va2llJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzdG9BcGVuZD1tWydhcHBlbmRjb29raWUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZXN0b0FwZW5kPWNvb2tpZXN0b0FwZW5kLnNwbGl0KCc7JykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaCBpbiBjb29raWVzdG9BcGVuZDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbix2PWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3LG49IG4uc3BsaXQoJzonKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjayA9IGNvb2tpZWxpYi5Db29raWUodmVyc2lvbj0wLCBuYW1lPW4sIHZhbHVlPXYsIHBvcnQ9Tm9uZSwgcG9ydF9zcGVjaWZpZWQ9RmFsc2UsIGRvbWFpbj13LCBkb21haW5fc3BlY2lmaWVkPUZhbHNlLCBkb21haW5faW5pdGlhbF9kb3Q9RmFsc2UsIHBhdGg9Jy8nLCBwYXRoX3NwZWNpZmllZD1UcnVlLCBzZWN1cmU9RmFsc2UsIGV4cGlyZXM9Tm9uZSwgZGlzY2FyZD1UcnVlLCBjb21tZW50PU5vbmUsIGNvbW1lbnRfdXJsPU5vbmUsIHJlc3Q9eydIdHRwT25seSc6IE5vbmV9LCByZmMyMTA5PUZhbHNlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXIuc2V0X2Nvb2tpZShjaykNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdvcmlnaW4nIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ09yaWdpbicsIG1bJ29yaWdpbiddKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGVhZGVyX2luX3BhZ2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9aGVhZGVyX2luX3BhZ2Uuc3BsaXQoJyYnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBoIGluIGhlYWRlcl9pbl9wYWdlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBoLnNwbGl0KCc9Jyk9PTI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxzPWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbj12YWxzWzBdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2PSc9Jy5qb2luKHZhbHNbMTpdKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjbix2PWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcihuLHYpDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjb29raWVKYXI9PU5vbmU6DQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdjb29raWVKYXJWYWwnLGNvb2tpZUphcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdub3JlZGlyZWN0Jywnbm9yZWRpcmVjdCcgaW4gbQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdub3JlZGlyZWN0JyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlcixOb1JlZGlyZWN0aW9uLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpDQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmICdub3JlZGlyZWN0JyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKE5vUmVkaXJlY3Rpb24sIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnY29ubmVjdGlvbicgaW4gbToNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uY29ubmVjdGlvbi8vLy8vLy4nLG1bJ2Nvbm5lY3Rpb24nXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20ga2VlcGFsaXZlIGltcG9ydCBIVFRQSGFuZGxlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlZXBhbGl2ZV9oYW5kbGVyID0gSFRUUEhhbmRsZXIoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGtlZXBhbGl2ZV9oYW5kbGVyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnYWZ0ZXIgY29va2llIGphcicNCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9Tm9uZQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAncG9zdCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YT1tWydwb3N0J10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjaWYgJyRMaXZlU3RyZWFtUmVjYXB0Y2hhJyBpbiBwb3N0RGF0YToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgIChjYXB0Y2hhX2NoYWxsZW5nZSxjYXRwY2hhX3dvcmQsaWRmaWVsZCk9cHJvY2Vzc1JlY2FwdGNoYShtWydwYWdlJ10sY29va2llSmFyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAgICAgICAgcG9zdERhdGE9cG9zdERhdGEucmVwbGFjZSgnJExpdmVTdHJlYW1SZWNhcHRjaGEnLCdtYW51YWxfcmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZDonK2NhcHRjaGFfY2hhbGxlbmdlKycscmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkOicrY2F0cGNoYV93b3JkKycsaWQ6JytpZGZpZWxkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0cG9zdD1wb3N0RGF0YS5zcGxpdCgnLCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9e30NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgcCBpbiBzcGxpdHBvc3Q6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG49cC5zcGxpdCgnOicpWzBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2PXAuc3BsaXQoJzonKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdFtuXT12DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCA9IHVybGxpYi51cmxlbmNvZGUocG9zdCkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdD1tWydyYXdwb3N0J10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjaWYgJyRMaXZlU3RyZWFtUmVjYXB0Y2hhJyBpbiBwb3N0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICAgKGNhcHRjaGFfY2hhbGxlbmdlLGNhdHBjaGFfd29yZCxpZGZpZWxkKT1wcm9jZXNzUmVjYXB0Y2hhKG1bJ3BhZ2UnXSxjb29raWVKYXIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAgICBpZiBjYXB0Y2hhX2NoYWxsZW5nZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgICAgIHBvc3Q9cG9zdC5yZXBsYWNlKCckTGl2ZVN0cmVhbVJlY2FwdGNoYScsJyZtYW51YWxfcmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZD0nK2NhcHRjaGFfY2hhbGxlbmdlKycmcmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkPScrY2F0cGNoYV93b3JkKycmaWQ9JytpZGZpZWxkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbGluaz0nJw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBvc3Q6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSxwb3N0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZXNwb25zZS5pbmZvKCkuZ2V0KCdDb250ZW50LUVuY29kaW5nJykgPT0gJ2d6aXAnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIFN0cmluZ0lPIGltcG9ydCBTdHJpbmdJTw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgZ3ppcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWYgPSBTdHJpbmdJTyggcmVzcG9uc2UucmVhZCgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gZ3ppcC5HemlwRmlsZShmaWxlb2JqPWJ1ZikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluayA9IGYucmVhZCgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1yZXNwb25zZS5yZWFkKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Byb3h5JyBpbiBtIGFuZCBub3QgY3VycmVudF9wcm94aWVzIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuaW5zdGFsbF9vcGVuZXIodXJsbGliMi5idWlsZF9vcGVuZXIoY3VycmVudF9wcm94aWVzKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rPWphdmFzY3JpcHRVbkVzY2FwZShsaW5rKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCByZXByKGxpbmspDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsgVGhpcyBqdXN0IHByaW50IHdob2xlIHdlYnBhZ2UgaW4gTE9HDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2luY2x1ZGVoZWFkZXJzJyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjbGluays9c3RyKHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdTZXQtQ29va2llJykpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsrPSckJEhFQURFUlNfU1RBUlQkJDonDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBiIGluIHJlc3BvbnNlLmhlYWRlcnM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rKz0gYisnOicrcmVzcG9uc2UuaGVhZGVycy5nZXQoYikrJ1xuJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rKz0nJCRIRUFERVJTX0VORCQkOicNCiAgICAjICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgbGluaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZyhsaW5rKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZyhjb29raWVKYXIgKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRQYWdlc1ttWydwYWdlJ11dID0gbGluaw0KICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnc3RvcmUgbGluayBmb3InLG1bJ3BhZ2UnXSxmb3JDb29raWVKYXJPbmx5DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvckNvb2tpZUphck9ubHk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZw0KICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ10uc3RhcnRzd2l0aCgnaHR0cCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbVsncGFnZSddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsncGFnZSddLnNwbGl0KCckcHlGdW5jdGlvbjonKVsxXSwnJyxjb29raWVKYXIsbSApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZm9yQ29va2llSmFyT25seToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms9dmFsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1qYXZhc2NyaXB0VW5Fc2NhcGUobGluaykNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1tWydwYWdlJ10NCiAgICAgICAgICAgICAgICBpZiAnJHB5RnVuY3Rpb246cGxheW1lZGlhKCcgaW4gbVsnZXhwcmVzJ10gb3IgJ0FjdGl2YXRlV2luZG93JyAgaW4gbVsnZXhwcmVzJ10gb3IgJ1J1blBsdWdpbicgIGluIG1bJ2V4cHJlcyddICBvciAnJFBMQVlFUlBST1hZJD0nIGluIHVybCAgb3IgIGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKToNCiAgICAgICAgICAgICAgICAgICAgc2V0cmVzb2x2ZWQ9RmFsc2UNCiAgICAgICAgICAgICAgICBpZiAgJyRkb3JlZ2V4JyBpbiBtWydleHByZXMnXToNCiAgICAgICAgICAgICAgICAgICAgbVsnZXhwcmVzJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydleHByZXMnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQ0KICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgbm90IG1bJ2V4cHJlcyddPT0nJzoNCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdkb2luZyBpdCAnLG1bJ2V4cHJlcyddDQogICAgICAgICAgICAgICAgICAgIGlmICckTGl2ZVN0cmVhbUNhcHRjaGEnIGluIG1bJ2V4cHJlcyddOg0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWFza0NhcHRjaGEobSxsaW5rLGNvb2tpZUphcikNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAndXJsIGFuZCB2YWwnLHVybCx2YWwNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQ0KDQogICAgICAgICAgICAgICAgICAgIGVsaWYgbVsnZXhwcmVzJ10uc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jykgb3IgJyMkcHlGdW5jdGlvbicgaW4gbVsnZXhwcmVzJ106DQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2V4cGVlZWVlZWVlZWVlZWVlZWVlZWUnLG1bJ2V4cHJlcyddDQogICAgICAgICAgICAgICAgICAgICAgICB2YWw9JycNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1bJ2V4cHJlcyddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsnZXhwcmVzJ10uc3BsaXQoJyRweUZ1bmN0aW9uOicpWzFdLGxpbmssY29va2llSmFyLG0pDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWxGdW5jdGlvbihtWydleHByZXMnXSxsaW5rLGNvb2tpZUphcixtKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ0FjdGl2YXRlV2luZG93JyBpbiBtWydleHByZXMnXSBvciAnUnVuUGx1Z2luJyBpbiBtWydleHByZXMnXSAgOiByZXR1cm4gJycsRmFsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvckNvb2tpZUphck9ubHk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2xpc3RyZXBlYXQnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdHJlcGVhdD1tWydsaXN0cmVwZWF0J10gICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3JldD1yZS5maW5kYWxsKG1bJ2V4cHJlcyddLGxpbmspDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdyZXQnLHZhbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsaXN0cmVwZWF0LGV2YWwodmFsKSwgbSxyZWdleHMsY29va2llSmFyDQojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3VybCBrIHZhbCcsdXJsLGssdmFsDQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3JlcHInLHJlcHIodmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UodSIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbC5kZWNvZGUoInV0Zi04IikpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnbGlzdHJlcGVhdCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0cmVwZWF0PW1bJ2xpc3RyZXBlYXQnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnbGlzdHJlcGVhdCcsbVsnZXhwcmVzJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgbVsnZXhwcmVzJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2FhYWEnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQ9cmUuZmluZGFsbChtWydleHByZXMnXSxsaW5rKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAncmV0JyxyZXQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGlzdHJlcGVhdCxyZXQsIG0scmVnZXhzLGNvb2tpZUphcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD0nJw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGxpbms9PScnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnbGluaycsbGluaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZyA9IHJlLmNvbXBpbGUobVsnZXhwcmVzJ10pLnNlYXJjaChsaW5rKSAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1yZWcuZ3JvdXAoMSkuc3RyaXAoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpDQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ3BhZ2UnXT09Jycgb3IgbVsncGFnZSddPT1Ob25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1tWydleHByZXMnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmF3UG9zdDoNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Jhd3Bvc3QnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXVybGxpYi5xdW90ZV9wbHVzKHZhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdodG1sdW5lc2NhcGUnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ZhbD11cmxsaWIudW5xdW90ZV9wbHVzKHZhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgSFRNTFBhcnNlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1IVE1MUGFyc2VyLkhUTUxQYXJzZXIoKS51bmVzY2FwZSh2YWwpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCB2YWwpDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsLmRlY29kZSgidXRmLTgiKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAndXInLHVybA0KICAgICAgICAgICAgICAgICAgICAgICAgI3JldHVybiB2YWwNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsJycpDQogICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiB1cmw6DQogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpDQogICAgICAgIGlmICckZXBvY3RpbWUyJCcgaW4gdXJsOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpDQoNCiAgICAgICAgaWYgJyRHVUlEJCcgaW4gdXJsOg0KICAgICAgICAgICAgaW1wb3J0IHV1aWQNCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJEdVSUQkJyxzdHIodXVpZC51dWlkMSgpKS51cHBlcigpKQ0KICAgICAgICBpZiAnJGdldF9jb29raWVzJCcgaW4gdXJsOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZ2V0X2Nvb2tpZXMkJyxnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcikpDQoNCiAgICAgICAgaWYgcmVjdXJzaXZlQ2FsbDogcmV0dXJuIHVybA0KICAgICAgICAjcHJpbnQgJ2ZpbmFsIHVybCcscmVwcih1cmwpDQogICAgICAgIGlmIHVybD09IiI6DQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiB1cmwsc2V0cmVzb2x2ZWQNCmRlZiBnZXRtZDUodCk6DQogICAgaW1wb3J0IGhhc2hsaWINCiAgICBoPWhhc2hsaWIubWQ1KCkNCiAgICBoLnVwZGF0ZSh0KQ0KICAgIHJldHVybiBoLmhleGRpZ2VzdCgpDQoNCmRlZiBkZWNyeXB0X3ZhdWdobmxpdmUoZW5jcnlwdGVkKToNCiAgICByZXRWYWw9IiINCiMgICAgcHJpbnQgJ2VuYycsZW5jcnlwdGVkDQogICAgI2ZvciB2YWwgaW4gZW5jcnlwdGVkLnNwbGl0KCc6Jyk6DQogICAgIyAgICByZXRWYWwrPWNocihpbnQodmFsLnJlcGxhY2UoIjBtMCIsIiIpKSkNCiAgICAjcmV0dXJuIHJldFZhbA0KDQpkZWYgcGxheW1lZGlhKG1lZGlhX3VybCk6DQogICAgdHJ5Og0KICAgICAgICBpbXBvcnQgIEN1c3RvbVBsYXllcg0KICAgICAgICBwbGF5ZXIgPSBDdXN0b21QbGF5ZXIuTXlYQk1DUGxheWVyKCkNCiAgICAgICAgbGlzdGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKCBsYWJlbCA9IHN0cihuYW1lKSwgaWNvbkltYWdlID0gIkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZSA9IHhibWMuZ2V0SW5mb0ltYWdlKCAiTGlzdEl0ZW0uVGh1bWIiICksIHBhdGg9bWVkaWFfdXJsICkNCiAgICAgICAgcGxheWVyLnBsYXkoIG1lZGlhX3VybCxsaXN0aXRlbSkNCiAgICAgICAgeGJtYy5zbGVlcCgxMDAwKQ0KICAgICAgICB3aGlsZSBwbGF5ZXIuaXNfYWN0aXZlOg0KICAgICAgICAgICAgeGJtYy5zbGVlcCgyMDApDQogICAgZXhjZXB0Og0KICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKCkNCiAgICByZXR1cm4gJycNCg0KZGVmIGtvZGlKc29uUmVxdWVzdChwYXJhbXMpOg0KICAgIGRhdGEgPSBqc29uLmR1bXBzKHBhcmFtcykNCiAgICByZXF1ZXN0ID0geGJtYy5leGVjdXRlSlNPTlJQQyhkYXRhKQ0KDQogICAgdHJ5Og0KICAgICAgICByZXNwb25zZSA9IGpzb24ubG9hZHMocmVxdWVzdCkNCiAgICBleGNlcHQgVW5pY29kZURlY29kZUVycm9yOg0KICAgICAgICByZXNwb25zZSA9IGpzb24ubG9hZHMocmVxdWVzdC5kZWNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQ0KDQogICAgdHJ5Og0KICAgICAgICBpZiAncmVzdWx0JyBpbiByZXNwb25zZToNCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsncmVzdWx0J10NCiAgICAgICAgcmV0dXJuIE5vbmUNCiAgICBleGNlcHQgS2V5RXJyb3I6DQogICAgICAgIGxvZ2dlci53YXJuKCJbJXNdICVzIiAlIChwYXJhbXNbJ21ldGhvZCddLCByZXNwb25zZVsnZXJyb3InXVsnbWVzc2FnZSddKSkNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KDQpkZWYgc2V0S29kaVByb3h5KHByb3h5c2V0dGluZ3M9Tm9uZSk6DQoNCiAgICBpZiBwcm94eXNldHRpbmdzPT1Ob25lOg0KIyAgICAgICAgcHJpbnQgJ3Byb3h5IHNldCB0byBub3RoaW5nJw0KICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay51c2VodHRwcHJveHkiLCAidmFsdWUiOmZhbHNlfSwgImlkIjoxfScpDQogICAgZWxzZToNCiAgICAgICAgDQogICAgICAgIHBzPXByb3h5c2V0dGluZ3Muc3BsaXQoJzonKQ0KICAgICAgICBwcm94eVVSTD1wc1swXQ0KICAgICAgICBwcm94eVBvcnQ9cHNbMV0NCiAgICAgICAgcHJveHlUeXBlPXBzWzJdDQogICAgICAgIHByb3h5VXNlcm5hbWU9Tm9uZQ0KICAgICAgICBwcm94eVBhc3N3b3JkPU5vbmUNCiAgICAgICAgDQogICAgICAgIGlmIGxlbihwcyk+MyBhbmQgJ0AnIGluIHBzWzNdOiAjamFpcm94ICMjI3Byb3h5c2V0dGluZ3MNCiAgICAgICAgICAgIHByb3h5VXNlcm5hbWU9cHNbM10uc3BsaXQoJ0AnKVswXSAjamFpcm94ICMjI3BzWzNdDQogICAgICAgICAgICBwcm94eVBhc3N3b3JkPXBzWzNdLnNwbGl0KCdAJylbMV0gI2phaXJveCAjIyNwcm94eXNldHRpbmdzLnNwbGl0KCdAJylbLTFdDQoNCiMgICAgICAgIHByaW50ICdwcm94eSBzZXQgdG8nLCBwcm94eVR5cGUsIHByb3h5VVJMLHByb3h5UG9ydA0KICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay51c2VodHRwcHJveHkiLCAidmFsdWUiOnRydWV9LCAiaWQiOjF9JykNCiAgICAgICAgeGJtYy5leGVjdXRlSlNPTlJQQygneyJqc29ucnBjIjoiMi4wIiwgIm1ldGhvZCI6IlNldHRpbmdzLlNldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5dHlwZSIsICJ2YWx1ZSI6JyArIHN0cihwcm94eVR5cGUpICsnfSwgImlkIjoxfScpDQogICAgICAgIHhibWMuZXhlY3V0ZUpTT05SUEMoJ3sianNvbnJwYyI6IjIuMCIsICJtZXRob2QiOiJTZXR0aW5ncy5TZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXNlcnZlciIsICJ2YWx1ZSI6IicgKyBzdHIocHJveHlVUkwpICsnIn0sICJpZCI6MX0nKQ0KICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwb3J0IiwgInZhbHVlIjonICsgc3RyKHByb3h5UG9ydCkgKyd9LCAiaWQiOjF9JykNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBub3QgcHJveHlVc2VybmFtZT09Tm9uZToNCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZUpTT05SUEMoJ3sianNvbnJwYyI6IjIuMCIsICJtZXRob2QiOiJTZXR0aW5ncy5TZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXVzZXJuYW1lIiwgInZhbHVlIjoiJyArIHN0cihwcm94eVVzZXJuYW1lKSArJyJ9LCAiaWQiOjF9JykNCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZUpTT05SUEMoJ3sianNvbnJwYyI6IjIuMCIsICJtZXRob2QiOiJTZXR0aW5ncy5TZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXBhc3N3b3JkIiwgInZhbHVlIjoiJyArIHN0cihwcm94eVBhc3N3b3JkKSArJyJ9LCAiaWQiOjF9JykNCg0KICAgICAgICANCmRlZiBnZXRDb25maWd1cmVkUHJveHkoKToNCiAgICBwcm94eUFjdGl2ZSA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsudXNlaHR0cHByb3h5In0sICdpZCc6IDF9KVsndmFsdWUnXQ0KIyAgICBwcmludCAncHJveHlBY3RpdmUnLHByb3h5QWN0aXZlDQogICAgcHJveHlUeXBlID0ga29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHl0eXBlIn0sICdpZCc6IDF9KVsndmFsdWUnXQ0KDQogICAgaWYgcHJveHlBY3RpdmU6ICMgUFJPWFlfSFRUUA0KICAgICAgICBwcm94eVVSTCA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5c2VydmVyIn0sICdpZCc6IDF9KVsndmFsdWUnXQ0KICAgICAgICBwcm94eVBvcnQgPSB1bmljb2RlKGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5cG9ydCJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10pDQogICAgICAgIHByb3h5VXNlcm5hbWUgPSBrb2RpSnNvblJlcXVlc3Qoeydqc29ucnBjJzogJzIuMCcsICJtZXRob2QiOiJTZXR0aW5ncy5HZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXVzZXJuYW1lIn0sICdpZCc6IDF9KVsndmFsdWUnXQ0KICAgICAgICBwcm94eVBhc3N3b3JkID0ga29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwYXNzd29yZCJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10NCg0KICAgICAgICBpZiBwcm94eVVzZXJuYW1lIGFuZCBwcm94eVBhc3N3b3JkIGFuZCBwcm94eVVSTCBhbmQgcHJveHlQb3J0Og0KICAgICAgICAgICAgcmV0dXJuIHByb3h5VVJMICsgJzonICsgc3RyKHByb3h5UG9ydCkrJzonK3N0cihwcm94eVR5cGUpICsgJzonICsgcHJveHlVc2VybmFtZSArICdAJyArIHByb3h5UGFzc3dvcmQNCiAgICAgICAgZWxpZiBwcm94eVVSTCBhbmQgcHJveHlQb3J0Og0KICAgICAgICAgICAgcmV0dXJuIHByb3h5VVJMICsgJzonICsgc3RyKHByb3h5UG9ydCkrJzonK3N0cihwcm94eVR5cGUpDQogICAgZWxzZToNCiAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgDQpkZWYgcGxheW1lZGlhd2l0aHByb3h5KG1lZGlhX3VybCwgbmFtZSwgaWNvbkltYWdlLHByb3h5aXAscG9ydCwgcHJveHl1c2VyPU5vbmUsIHByb3h5cGFzcz1Ob25lKTogI2phaXJveA0KDQogICAgaWYgbWVkaWFfdXJsPT1Ob25lIG9yIG1lZGlhX3VybD09Jyc6DQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKElOU09NTklBLFVuYWJsZSB0byBwbGF5IGVtcHR5IFVybCw1MDAwLCIraWNvbisiKSIpDQogICAgICAgIHJldHVybg0KICAgIHByb2dyZXNzID0geGJtY2d1aS5EaWFsb2dQcm9ncmVzcygpDQogICAgcHJvZ3Jlc3MuY3JlYXRlKCdQcm9ncmVzcycsICdQbGF5aW5nIHdpdGggY3VzdG9tIHByb3h5JykNCiAgICBwcm9ncmVzcy51cGRhdGUoIDEwLCAiIiwgInNldHRpbmcgcHJveHkuLiIsICIiICkNCiAgICBwcm94eXNldD1GYWxzZQ0KICAgIGV4aXN0aW5nX3Byb3h5PScnDQogICAgI3ByaW50ICdwbGF5bWVkaWF3aXRocHJveHknDQogICAgdHJ5Og0KICAgICAgICANCiAgICAgICAgZXhpc3RpbmdfcHJveHk9Z2V0Q29uZmlndXJlZFByb3h5KCkNCiAgICAgICAgcHJpbnQgJ2V4aXN0aW5nX3Byb3h5JyxleGlzdGluZ19wcm94eQ0KICAgICAgICAjcmVhZCBhbmQgc2V0IGhlcmUNCiAgICAgICAgI2phaXJveA0KICAgICAgICBpZiBub3QgcHJveHl1c2VyID09IE5vbmU6DQogICAgICAgICAgICBzZXRLb2RpUHJveHkoIHByb3h5aXAgKyAnOicgKyBwb3J0ICsgJzowOicgKyBwcm94eXVzZXIgKyAnQCcgKyBwcm94eXBhc3MpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBzZXRLb2RpUHJveHkoIHByb3h5aXAgKyAnOicgKyBwb3J0ICsgJzowJykNCg0KICAgICAgICBwcmludCAncHJveHkgc2V0dGluZyBjb21wbGV0ZSBwbGF5aW5nJyxtZWRpYV91cmwNCiAgICAgICAgcHJveHlzZXQ9VHJ1ZQ0KICAgICAgICBwcm9ncmVzcy51cGRhdGUoIDgwLCAiIiwgInNldHRpbmcgcHJveHkgY29tcGxldGUsIG5vdyBwbGF5aW5nIiwgIiIgKQ0KICAgICAgICANCg0KICAgICAgICBpbXBvcnQgIEN1c3RvbVBsYXllcg0KICAgICAgICBwbGF5ZXIgPSBDdXN0b21QbGF5ZXIuTXlYQk1DUGxheWVyKCkNCiAgICAgICAgcGxheWVyLnBkaWFsb2d1ZT09cHJvZ3Jlc3MNCiAgICAgICAgbGlzdGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKCBsYWJlbCA9IHN0cihuYW1lKSwgaWNvbkltYWdlID0gaWNvbkltYWdlLCB0aHVtYm5haWxJbWFnZSA9IHhibWMuZ2V0SW5mb0ltYWdlKCAiTGlzdEl0ZW0uVGh1bWIiICksIHBhdGg9bWVkaWFfdXJsICkNCiAgICAgICAgcGxheWVyLnBsYXkoIG1lZGlhX3VybCxsaXN0aXRlbSkNCiAgICAgICAgeGJtYy5zbGVlcCgxMDAwKQ0KICAgICAgICAjd2hpbGUgcGxheWVyLmlzX2FjdGl2ZToNCiAgICAgICAgIyAgICB4Ym1jLnNsZWVwKDIwMCkNCiAgICAgICAgaW1wb3J0IHRpbWUNCiAgICAgICAgYmVmb3Jlc3RhcnQ9dGltZS50aW1lKCkNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgd2hpbGUgcGxheWVyLmlzX2FjdGl2ZToNCiAgICAgICAgICAgICAgICB4Ym1jLnNsZWVwKDEwMDApICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIHBsYXllci51cmxwbGF5ZWQ9PUZhbHNlIGFuZCB0aW1lLnRpbWUoKS1iZWZvcmVzdGFydD4xMjoNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2ZhaWxlZCEhIScNCiAgICAgICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oSU5TT01OSUEsVW5hYmxlIHRvIHBsYXkgY2hlY2sgcHJveHksNTAwMCwiK2ljb24rIikiKQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgICN4Ym1jLnNsZWVwKDEwMDApDQogICAgICAgIGV4Y2VwdDogcGFzcw0KDQogICAgICAgIHByb2dyZXNzLmNsb3NlKCkNCiAgICAgICAgcHJvZ3Jlc3M9Tm9uZQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpDQogICAgaWYgcHJvZ3Jlc3M6DQogICAgICAgIHByb2dyZXNzLmNsb3NlKCkNCiAgICBpZiBwcm94eXNldDoNCiAgICAgICAgcHJpbnQgJ25vdyByZXNldHRpbmcgdGhlIHByb3h5IGJhY2snDQogICAgICAgIHNldEtvZGlQcm94eShleGlzdGluZ19wcm94eSkNCiAgICAgICAgcHJpbnQgJ3Jlc2V0IGhlcmUnDQogICAgcmV0dXJuICcnDQoNCg0KZGVmIGdldF9zYXdfcnRtcChwYWdlX3ZhbHVlLCByZWZlcmVyPU5vbmUpOg0KICAgIGlmIHJlZmVyZXI6DQogICAgICAgIHJlZmVyZXI9WygnUmVmZXJlcicscmVmZXJlcildDQogICAgaWYgcGFnZV92YWx1ZS5zdGFydHN3aXRoKCJodHRwIik6DQogICAgICAgIHBhZ2VfdXJsPXBhZ2VfdmFsdWUNCiAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdmFsdWUsaGVhZGVycz1yZWZlcmVyKQ0KDQogICAgc3RyX3BhdHRlcm49IihldmFsXChmdW5jdGlvblwocCxhLGMsayxlLCg/OnJ8ZCkuKikiDQoNCiAgICByZWdfcmVzPXJlLmNvbXBpbGUoc3RyX3BhdHRlcm4pLmZpbmRhbGwocGFnZV92YWx1ZSkNCiAgICByPSIiDQogICAgaWYgcmVnX3JlcyBhbmQgbGVuKHJlZ19yZXMpPjA6DQogICAgICAgIGZvciB2IGluIHJlZ19yZXM6DQogICAgICAgICAgICByMT1nZXRfdW5wYWNrZWQodikNCiAgICAgICAgICAgIHIyPXJlX21lKHIxLCdcJyguKj8pXCcnKQ0KICAgICAgICAgICAgaWYgJ3VuZXNjYXBlJyBpbiByMToNCiAgICAgICAgICAgICAgICByMT11cmxsaWIudW5xdW90ZShyMikNCiAgICAgICAgICAgIHIrPXIxKydcbicNCiMgICAgICAgIHByaW50ICdmaW5hbCB2YWx1ZSBpcyAnLHINCg0KICAgICAgICBwYWdlX3VybD1yZV9tZShyLCdzcmM9IiguKj8pIicpDQoNCiAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdXJsLGhlYWRlcnM9cmVmZXJlcikNCg0KICAgICNwcmludCBwYWdlX3ZhbHVlDQoNCiAgICBydG1wPXJlX21lKHBhZ2VfdmFsdWUsJ3N0cmVhbWVyXCcuKj9cJyguKj8pXCdcKScpDQogICAgcGxheXBhdGg9cmVfbWUocGFnZV92YWx1ZSwnZmlsZVwnLFxzXCcoLio/KVwnJykNCg0KDQogICAgcmV0dXJuIHJ0bXArJyBwbGF5cGF0aD0nK3BsYXlwYXRoICsnIHBhZ2VVcmw9JytwYWdlX3VybA0KDQpkZWYgZ2V0X2xldG9uX3J0bXAocGFnZV92YWx1ZSwgcmVmZXJlcj1Ob25lKToNCiAgICBpZiByZWZlcmVyOg0KICAgICAgICByZWZlcmVyPVsoJ1JlZmVyZXInLHJlZmVyZXIpXQ0KICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOg0KICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSxoZWFkZXJzPXJlZmVyZXIpDQogICAgc3RyX3BhdHRlcm49InZhciBhID0gKC4qPyk7XHMqdmFyIGIgPSAoLio/KTtccyp2YXIgYyA9ICguKj8pO1xzKnZhciBkID0gKC4qPyk7XHMqdmFyIGYgPSAoLio/KTtccyp2YXIgdl9wYXJ0ID0gJyguKj8pJzsiDQogICAgcmVnX3Jlcz1yZS5jb21waWxlKHN0cl9wYXR0ZXJuKS5maW5kYWxsKHBhZ2VfdmFsdWUpWzBdDQoNCiAgICBhLGIsYyxkLGYsdj0ocmVnX3JlcykNCiAgICBmPWludChmKQ0KICAgIGE9aW50KGEpL2YNCiAgICBiPWludChiKS9mDQogICAgYz1pbnQoYykvZg0KICAgIGQ9aW50KGQpL2YNCg0KICAgIHJldD0gJ3J0bXA6Ly8nICsgc3RyKGEpICsgJy4nICsgc3RyKGIpICsgJy4nICsgc3RyKGMpICsgJy4nICsgc3RyKGQpICsgdjsNCiAgICByZXR1cm4gcmV0DQoNCmRlZiBjcmVhdGVNM3VGb3JEYXNoKHVybCx1c2VyYWdlbnQ9Tm9uZSk6DQogICAgc3RyPScjRVhUTTNVJw0KICAgIHN0cis9J1xuI0VYVC1YLVNUUkVBTS1JTkY6UFJPR1JBTS1JRD0xLEJBTkRXSURUSD0zNjE4MTYnDQogICAgc3RyKz0nXG4nK3VybCsnJmJ5dGVzPTAtMjAwMDAwJyMrJ3xVc2VyLUFnZW50PScrdXNlcmFnZW50DQogICAgc291cmNlX2ZpbGUgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3Rlc3RmaWxlLm0zdScpDQogICAgc3RyKz0nXG4nDQogICAgU2F2ZVRvRmlsZShzb3VyY2VfZmlsZSxzdHIpDQogICAgI3JldHVybiAnQzovVXNlcnMvc2hhbmkvRG93bmxvYWRzL3Rlc3QubTN1OCcNCiAgICByZXR1cm4gc291cmNlX2ZpbGUNCg0KZGVmIFNhdmVUb0ZpbGUoZmlsZV9uYW1lLHBhZ2VfZGF0YSxhcHBlbmQ9RmFsc2UpOg0KICAgIGlmIGFwcGVuZDoNCiAgICAgICAgZiA9IG9wZW4oZmlsZV9uYW1lLCAnYScpDQogICAgICAgIGYud3JpdGUocGFnZV9kYXRhKQ0KICAgICAgICBmLmNsb3NlKCkNCiAgICBlbHNlOg0KICAgICAgICBmPW9wZW4oZmlsZV9uYW1lLCd3YicpDQogICAgICAgIGYud3JpdGUocGFnZV9kYXRhKQ0KICAgICAgICBmLmNsb3NlKCkNCiAgICAgICAgcmV0dXJuICcnDQoNCmRlZiBMb2FkRmlsZShmaWxlX25hbWUpOg0KICAgIGY9b3BlbihmaWxlX25hbWUsJ3JiJykNCiAgICBkPWYucmVhZCgpDQogICAgZi5jbG9zZSgpDQogICAgcmV0dXJuIGQNCg0KZGVmIGdldF9wYWNrZWRfaXBob25ldHZfdXJsKHBhZ2VfZGF0YSk6DQogICAgaW1wb3J0IHJlLGJhc2U2NCx1cmxsaWI7DQogICAgcz1wYWdlX2RhdGENCiAgICB3aGlsZSAnZ2VoKCcgaW4gczoNCiAgICAgICAgaWYgcy5zdGFydHN3aXRoKCdsb2woJyk6IHM9c1s1Oi0xXQ0KIyAgICAgICBwcmludCAncyBpcyAnLHMNCiAgICAgICAgcz1yZS5jb21waWxlKCciKC4qPykiJykuZmluZGFsbChzKVswXTsNCiAgICAgICAgcz0gIGJhc2U2NC5iNjRkZWNvZGUocyk7DQogICAgICAgIHM9dXJsbGliLnVucXVvdGUocyk7DQogICAgcHJpbnQgcw0KICAgIHJldHVybiBzDQoNCmRlZiBnZXRfZmVycmFyaV91cmwocGFnZV9kYXRhKToNCiMgICAgcHJpbnQgJ2dldF9kYWdfdXJsMicscGFnZV9kYXRhDQogICAgcGFnZV9kYXRhMj1nZXRVcmwocGFnZV9kYXRhKTsNCiAgICBwYXR0PScoaHR0cC4qKScNCiAgICBpbXBvcnQgdXVpZA0KICAgIHBsYXliYWNrPXN0cih1dWlkLnV1aWQxKCkpLnVwcGVyKCkNCiAgICBsaW5rcz1yZS5jb21waWxlKHBhdHQpLmZpbmRhbGwocGFnZV9kYXRhMikNCiAgICBoZWFkZXJzPVsoJ1gtUGxheWJhY2stU2Vzc2lvbi1JZCcscGxheWJhY2spXQ0KICAgIGZvciBsIGluIGxpbmtzOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgcGFnZV9kYXRhdGVtcD1nZXRVcmwobCxoZWFkZXJzPWhlYWRlcnMpOw0KDQogICAgICAgIGV4Y2VwdDogcGFzcw0KDQogICAgcmV0dXJuIHBhZ2VfZGF0YSsnfCZYLVBsYXliYWNrLVNlc3Npb24tSWQ9JytwbGF5YmFjaw0KDQoNCmRlZiBnZXRfZGFnX3VybChwYWdlX2RhdGEpOg0KIyAgICBwcmludCAnZ2V0X2RhZ191cmwnLHBhZ2VfZGF0YQ0KICAgIGlmIHBhZ2VfZGF0YS5zdGFydHN3aXRoKCdodHRwOi8vZGFnLnRvdGFsLXN0cmVhbS5uZXQnKToNCiAgICAgICAgaGVhZGVycz1bKCdVc2VyLUFnZW50JywnVmVyaXNtby1CbGFja1VJXygyLjQuNy41LjguMC4zNCknKV0NCiAgICAgICAgcGFnZV9kYXRhPWdldFVybChwYWdlX2RhdGEsaGVhZGVycz1oZWFkZXJzKTsNCg0KICAgIGlmICcxMjcuMC4wLjEnIGluIHBhZ2VfZGF0YToNCiAgICAgICAgcmV0dXJuIHJldmlzdF9kYWcocGFnZV9kYXRhKQ0KICAgIGVsaWYgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICE9ICcnOg0KICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICcmdmVyX3Q9KFteJl0rKSYnKSArICc/d21zQXV0aFNpZ249JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSArICc9PS9tcDQ6JyArIHJlX21lKHBhZ2VfZGF0YSwgJ1xcP3k9KFteJl0rKSYnKQ0KICAgIGVsc2U6DQogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJ2hyZWY9IihbXiJdKykiW14iXSskJykNCiAgICAgICAgaWYgbGVuKGZpbmFsX3VybCk9PTA6DQogICAgICAgICAgICBmaW5hbF91cmw9cGFnZV9kYXRhDQogICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJyAnLCAnJTIwJykNCiAgICByZXR1cm4gZmluYWxfdXJsDQoNCmRlZiByZV9tZShkYXRhLCByZV9wYXR0ZW4pOg0KICAgIG1hdGNoID0gJycNCiAgICBtID0gcmUuc2VhcmNoKHJlX3BhdHRlbiwgZGF0YSkNCiAgICBpZiBtICE9IE5vbmU6DQogICAgICAgIG1hdGNoID0gbS5ncm91cCgxKQ0KICAgIGVsc2U6DQogICAgICAgIG1hdGNoID0gJycNCiAgICByZXR1cm4gbWF0Y2gNCg0KZGVmIHJldmlzdF9kYWcocGFnZV9kYXRhKToNCiAgICBmaW5hbF91cmwgPSAnJw0KICAgIGlmICcxMjcuMC4wLjEnIGluIHBhZ2VfZGF0YToNCiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnIGxpdmU9dHJ1ZSB0aW1lb3V0PTE1IHBsYXlwYXRoPScgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbYS16QS1aMC05LV9cXC5AXSspJykNCg0KICAgIGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3Rva2VuPShbXiZdKykmJykgIT0gJyc6DQogICAgICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybCArICc/dG9rZW49JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3Rva2VuPShbXiZdKykmJykNCiAgICBlbGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSAhPSAnJzoNCiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnP3dtc0F1dGhTaWduPScgKyByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgKyAnPT0vbXA0OicgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbXiZdKykmJykNCiAgICBlbHNlOg0KICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICdIUkVGPSIoW14iXSspIicpDQoNCiAgICBpZiAnZGFnMS5hc3gnIGluIGZpbmFsX3VybDoNCiAgICAgICAgcmV0dXJuIGdldF9kYWdfdXJsKGZpbmFsX3VybCkNCg0KICAgIGlmICdkZXZpbmxpdmVmcy5mcGxpdmUubmV0JyBub3QgaW4gZmluYWxfdXJsOg0KICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgnZGV2aW5saXZlJywgJ2ZsaXZlJykNCiAgICBpZiAncGVybWxpdmVmcy5mcGxpdmUubmV0JyBub3QgaW4gZmluYWxfdXJsOg0KICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgncGVybWxpdmUnLCAnZmxpdmUnKQ0KICAgIHJldHVybiBmaW5hbF91cmwNCg0KDQpkZWYgZ2V0X3Vud2lzZSggc3RyX2V2YWwpOg0KICAgIHBhZ2VfdmFsdWU9IiINCiAgICB0cnk6DQogICAgICAgIHNzPSJ3LGkscyxlPSgiK3N0cl9ldmFsKycpJw0KICAgICAgICBleGVjIChzcykNCiAgICAgICAgcGFnZV92YWx1ZT11bndpc2VfZnVuYyh3LGkscyxlKQ0KICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpDQogICAgI3ByaW50ICd1bnBhY2tlZCcscGFnZV92YWx1ZQ0KICAgIHJldHVybiBwYWdlX3ZhbHVlDQoNCmRlZiB1bndpc2VfZnVuYyggdywgaSwgcywgZSk6DQogICAgbElsbCA9IDA7DQogICAgbGwxSSA9IDA7DQogICAgSWwxbCA9IDA7DQogICAgbGwxbCA9IFtdOw0KICAgIGwxbEkgPSBbXTsNCiAgICB3aGlsZSBUcnVlOg0KICAgICAgICBpZiAobElsbCA8IDUpOg0KICAgICAgICAgICAgbDFsSS5hcHBlbmQod1tsSWxsXSkNCiAgICAgICAgZWxpZiAobElsbCA8IGxlbih3KSk6DQogICAgICAgICAgICBsbDFsLmFwcGVuZCh3W2xJbGxdKTsNCiAgICAgICAgbElsbCs9MTsNCiAgICAgICAgaWYgKGxsMUkgPCA1KToNCiAgICAgICAgICAgIGwxbEkuYXBwZW5kKGlbbGwxSV0pDQogICAgICAgIGVsaWYgKGxsMUkgPCBsZW4oaSkpOg0KICAgICAgICAgICAgbGwxbC5hcHBlbmQoaVtsbDFJXSkNCiAgICAgICAgbGwxSSs9MTsNCiAgICAgICAgaWYgKElsMWwgPCA1KToNCiAgICAgICAgICAgIGwxbEkuYXBwZW5kKHNbSWwxbF0pDQogICAgICAgIGVsaWYgKElsMWwgPCBsZW4ocykpOg0KICAgICAgICAgICAgbGwxbC5hcHBlbmQoc1tJbDFsXSk7DQogICAgICAgIElsMWwrPTE7DQogICAgICAgIGlmIChsZW4odykgKyBsZW4oaSkgKyBsZW4ocykgKyBsZW4oZSkgPT0gbGVuKGxsMWwpICsgbGVuKGwxbEkpICsgbGVuKGUpKToNCiAgICAgICAgICAgIGJyZWFrOw0KDQogICAgbEkxbCA9ICcnLmpvaW4obGwxbCkjLmpvaW4oJycpOw0KICAgIEkxbEkgPSAnJy5qb2luKGwxbEkpIy5qb2luKCcnKTsNCiAgICBsbDFJID0gMDsNCiAgICBsMWxsID0gW107DQogICAgZm9yIGxJbGwgaW4gcmFuZ2UoMCxsZW4obGwxbCksMik6DQogICAgICAgICNwcmludCAnYXJyYXkgaScsbElsbCxsZW4obGwxbCkNCiAgICAgICAgbGwxMSA9IC0xOw0KICAgICAgICBpZiAoIG9yZChJMWxJW2xsMUldKSAlIDIpOg0KICAgICAgICAgICAgbGwxMSA9IDE7DQogICAgICAgICNwcmludCAndmFsIGlzICcsIGxJMWxbbElsbDogbElsbCsyXQ0KICAgICAgICBsMWxsLmFwcGVuZChjaHIoICAgIGludChsSTFsW2xJbGw6IGxJbGwrMl0sIDM2KSAtIGxsMTEpKTsNCiAgICAgICAgbGwxSSs9MTsNCiAgICAgICAgaWYgKGxsMUkgPj0gbGVuKGwxbEkpKToNCiAgICAgICAgICAgIGxsMUkgPSAwOw0KICAgIHJldD0nJy5qb2luKGwxbGwpDQogICAgaWYgJ2V2YWwoZnVuY3Rpb24odyxpLHMsZSknIGluIHJldDoNCiMgICAgICAgIHByaW50ICdTVElMTCBHT2luZycNCiAgICAgICAgcmV0PXJlLmNvbXBpbGUoJ2V2YWxcKGZ1bmN0aW9uXCh3LGkscyxlXCkuKn1cKCguKj8pXCknKS5maW5kYWxsKHJldClbMF0NCiAgICAgICAgcmV0dXJuIGdldF91bndpc2UocmV0KQ0KICAgIGVsc2U6DQojICAgICAgICBwcmludCAnRklOSVNIRUQnDQogICAgICAgIHJldHVybiByZXQNCg0KZGVmIGdldF91bnBhY2tlZCggcGFnZV92YWx1ZSwgcmVnZXhfZm9yX3RleHQ9JycsIGl0ZXJhdGlvbnM9MSwgdG90YWxfaXRlcmF0aW9uPTEpOg0KICAgIHRyeToNCiAgICAgICAgcmVnX2RhdGE9Tm9uZQ0KICAgICAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToNCiAgICAgICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlKQ0KIyAgICAgICAgcHJpbnQgJ3BhZ2VfdmFsdWUnLHBhZ2VfdmFsdWUNCiAgICAgICAgaWYgcmVnZXhfZm9yX3RleHQgYW5kIGxlbihyZWdleF9mb3JfdGV4dCk+MDoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBwYWdlX3ZhbHVlPXJlLmNvbXBpbGUocmVnZXhfZm9yX3RleHQpLmZpbmRhbGwocGFnZV92YWx1ZSlbMF0gI2dldCB0aGUganMgdmFyaWFibGUNCiAgICAgICAgICAgIGV4Y2VwdDogcmV0dXJuICdOT1RQQUNLRUQnDQoNCiAgICAgICAgcGFnZV92YWx1ZT11bnBhY2socGFnZV92YWx1ZSxpdGVyYXRpb25zLHRvdGFsX2l0ZXJhdGlvbikNCiAgICBleGNlcHQ6DQogICAgICAgIHBhZ2VfdmFsdWU9J1VOUEFDS0VERkFJTEVEJw0KICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkNCiMgICAgcHJpbnQgJ3VucGFja2VkJyxwYWdlX3ZhbHVlDQogICAgaWYgJ3NhdjFsaXZlLnR2JyBpbiBwYWdlX3ZhbHVlOg0KICAgICAgICBwYWdlX3ZhbHVlPXBhZ2VfdmFsdWUucmVwbGFjZSgnc2F2MWxpdmUudHYnLCdzYXdsaXZlLnR2JykgI3F1aWNrIGZpeCBzb21lIGJ1ZyBzb21ld2hlcmUNCiMgICAgICAgIHByaW50ICdzYXYxIHVucGFja2VkJyxwYWdlX3ZhbHVlDQogICAgcmV0dXJuIHBhZ2VfdmFsdWUNCg0KZGVmIHVucGFjayhzSmF2YXNjcmlwdCxpdGVyYXRpb249MSwgdG90YWxpdGVyYXRpb25zPTIgICk6DQojICAgIHByaW50ICdpdGVyYXRpb24nLGl0ZXJhdGlvbg0KICAgIGlmIHNKYXZhc2NyaXB0LnN0YXJ0c3dpdGgoJ3ZhciBfMHhjYjhhPScpOg0KICAgICAgICBhU3BsaXQ9c0phdmFzY3JpcHQuc3BsaXQoJ3ZhciBfMHhjYjhhPScpDQogICAgICAgIHNzPSJteWFycmF5PSIrYVNwbGl0WzFdLnNwbGl0KCJldmFsKCIpWzBdDQogICAgICAgIGV4ZWMoc3MpDQogICAgICAgIGExPTYyDQogICAgICAgIGMxPWludChhU3BsaXRbMV0uc3BsaXQoIiw2MiwiKVsxXS5zcGxpdCgnLCcpWzBdKQ0KICAgICAgICBwMT1teWFycmF5WzBdDQogICAgICAgIGsxPW15YXJyYXlbM10NCiAgICAgICAgd2l0aCBvcGVuKCd0ZW1wIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOg0KICAgICAgICAgICAgZmlsZXdyaXRlci53cml0ZShzdHIoazEpKQ0KICAgICAgICAjYWE9MS8wDQogICAgZWxzZToNCg0KICAgICAgICBpZiAicm4gcH0oJyIgaW4gc0phdmFzY3JpcHQ6DQogICAgICAgICAgICBhU3BsaXQgPSBzSmF2YXNjcmlwdC5zcGxpdCgicm4gcH0oJyIpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBhU3BsaXQgPSBzSmF2YXNjcmlwdC5zcGxpdCgicm4gQX0oJyIpDQojICAgICAgICBwcmludCBhU3BsaXQNCg0KICAgICAgICBwMSxhMSxjMSxrMT0oJycsJzAnLCcwJywnJykNCg0KICAgICAgICBzcz0icDEsYTEsYzEsazE9KCciK2FTcGxpdFsxXS5zcGxpdCgiLnNwbGkiKVswXSsnKScNCiAgICAgICAgZXhlYyhzcykNCiAgICBrMT1rMS5zcGxpdCgnfCcpDQogICAgYVNwbGl0ID0gYVNwbGl0WzFdLnNwbGl0KCIpKSciKQ0KIyAgICBwcmludCAnIHAgYXJyYXkgaXMgJyxsZW4oYVNwbGl0KQ0KIyAgIHByaW50IGxlbihhU3BsaXQgKQ0KDQogICAgI3A9c3RyKGFTcGxpdFswXSsnKSknKSMucmVwbGFjZSgiXFwiLCIiKSMucmVwbGFjZSgnXFxcXCcsJ1xcJykNCg0KICAgICNwcmludCBhU3BsaXRbMV0NCiAgICAjYVNwbGl0ID0gYVNwbGl0WzFdLnNwbGl0KCIsIikNCiAgICAjcHJpbnQgYVNwbGl0WzBdDQogICAgI2EgPSBpbnQoYVNwbGl0WzFdKQ0KICAgICNjID0gaW50KGFTcGxpdFsyXSkNCiAgICAjayA9IGFTcGxpdFszXS5zcGxpdCgiLiIpWzBdLnJlcGxhY2UoIiciLCAnJykuc3BsaXQoJ3wnKQ0KICAgICNhPWludChhKQ0KICAgICNjPWludChjKQ0KDQogICAgI3A9cC5yZXBsYWNlKCdcXCcsICcnKQ0KIyAgICBwcmludCAncCB2YWwgaXMgJyxwWzA6MTAwXSwnLi4uLi4uLi4uLi4uJyxwWy0xMDA6XSxsZW4ocCkNCiMgICAgcHJpbnQgJ3AxIHZhbCBpcyAnLHAxWzA6MTAwXSwnLi4uLi4uLi4uLi4uJyxwMVstMTAwOl0sbGVuKHAxKQ0KDQogICAgI3ByaW50IGEsYTENCiAgICAjcHJpbnQgYyxhMQ0KICAgICNwcmludCAnayB2YWwgaXMgJyxrWy0xMDpdLGxlbihrKQ0KIyAgICBwcmludCAnazEgdmFsIGlzICcsazFbLTEwOl0sbGVuKGsxKQ0KICAgIGUgPSAnJw0KICAgIGQgPSAnJyMzMjgyMw0KDQogICAgI3NVbnBhY2tlZCA9IHN0cihfX3VucGFjayhwLCBhLCBjLCBrLCBlLCBkKSkNCiAgICBzVW5wYWNrZWQxID0gc3RyKF9fdW5wYWNrKHAxLCBhMSwgYzEsIGsxLCBlLCBkLGl0ZXJhdGlvbikpDQoNCiAgICAjcHJpbnQgc1VucGFja2VkWzoyMDBdKycuLi4uJytzVW5wYWNrZWRbLTEwMDpdLCBsZW4oc1VucGFja2VkKQ0KIyAgICBwcmludCBzVW5wYWNrZWQxWzoyMDBdKycuLi4uJytzVW5wYWNrZWQxWy0xMDA6XSwgbGVuKHNVbnBhY2tlZDEpDQoNCiAgICAjZXhlYygnc1VucGFja2VkMT0iJytzVW5wYWNrZWQxKyciJykNCiAgICBpZiBpdGVyYXRpb24+PXRvdGFsaXRlcmF0aW9uczoNCiMgICAgICAgIHByaW50ICdmaW5hbCByZXMnLHNVbnBhY2tlZDFbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZDFbLTEwMDpdLCBsZW4oc1VucGFja2VkMSkNCiAgICAgICAgcmV0dXJuIHNVbnBhY2tlZDEjLnJlcGxhY2UoJ1xcXFwnLCAnXFwnKQ0KICAgIGVsc2U6DQojICAgICAgICBwcmludCAnZmluYWwgcmVzIGZvciB0aGlzIGl0ZXJhdGlvbiBpcycsaXRlcmF0aW9uDQogICAgICAgIHJldHVybiB1bnBhY2soc1VucGFja2VkMSxpdGVyYXRpb24rMSkjLnJlcGxhY2UoJ1xcJywgJycpLGl0ZXJhdGlvbikjLnJlcGxhY2UoJ1xcJywgJycpOyN1bnBhY2soc1VucGFja2VkLnJlcGxhY2UoJ1xcJywgJycpKQ0KDQpkZWYgX191bnBhY2socCwgYSwgYywgaywgZSwgZCwgaXRlcmF0aW9uLHY9MSk6DQoNCiAgICAjd2l0aCBvcGVuKCdiZWZvcmUgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6DQogICAgIyAgICBmaWxld3JpdGVyLndyaXRlKHN0cihwKSkNCiAgICB3aGlsZSAoYyA+PSAxKToNCiAgICAgICAgYyA9IGMgLTENCiAgICAgICAgaWYgKGtbY10pOg0KICAgICAgICAgICAgYWE9c3RyKF9faXRvYU5ldyhjLCBhKSkNCiAgICAgICAgICAgIGlmIHY9PTE6DQogICAgICAgICAgICAgICAgcD1yZS5zdWIoJ1xcYicgKyBhYSArJ1xcYicsIGtbY10sIHApIyBUSElTIElTIEJsb29keSBzbG93IQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwPWZpbmRBbmRSZXBsYWNlV29yZChwLGFhLGtbY10pDQoNCiAgICAgICAgICAgICNwPWZpbmRBbmRSZXBsYWNlV29yZChwLGFhLGtbY10pDQoNCg0KICAgICN3aXRoIG9wZW4oJ2FmdGVyIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOg0KICAgICMgICAgZmlsZXdyaXRlci53cml0ZShzdHIocCkpDQogICAgcmV0dXJuIHANCg0KIw0KI2Z1bmN0aW9uIGVxdWFsYXZlbnQgdG8gcmUuc3ViKCdcXGInICsgYWEgKydcXGInLCBrW2NdLCBwKQ0KZGVmIGZpbmRBbmRSZXBsYWNlV29yZChzb3VyY2Vfc3RyLCB3b3JkX3RvX2ZpbmQscmVwbGFjZV93aXRoKToNCiAgICBzcGxpdHM9Tm9uZQ0KICAgIHNwbGl0cz1zb3VyY2Vfc3RyLnNwbGl0KHdvcmRfdG9fZmluZCkNCiAgICBpZiBsZW4oc3BsaXRzKT4xOg0KICAgICAgICBuZXdfc3RyaW5nPVtdDQogICAgICAgIGN1cnJlbnRfaW5kZXg9MA0KICAgICAgICBmb3IgY3VycmVudF9zcGxpdCBpbiBzcGxpdHM6DQogICAgICAgICAgICAjcHJpbnQgJ2hlcmUnLGkNCiAgICAgICAgICAgIG5ld19zdHJpbmcuYXBwZW5kKGN1cnJlbnRfc3BsaXQpDQogICAgICAgICAgICB2YWw9d29yZF90b19maW5kI2J5IGRlZmF1bHQgYXNzdW1lIGl0IHdhcyB3cm9uZyB0byBzcGxpdA0KDQogICAgICAgICAgICAjaWYgaXRzIGZpcnN0IG9uZSBhbmQgaXRlbSBpcyBibGFuayB0aGVuIGNoZWNrIG5leHQgaXRlbSBpcyB2YWxpZCBvciBub3QNCiAgICAgICAgICAgIGlmIGN1cnJlbnRfaW5kZXg9PWxlbihzcGxpdHMpLTE6DQogICAgICAgICAgICAgICAgdmFsPScnICMgbGFzdCBvbmUgbm90aGluZyB0byBhcHBlbmQgbm9ybWFsbHkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgaWYgbGVuKGN1cnJlbnRfc3BsaXQpPT0wOiAjaWYgYmxhbmsgY2hlY2sgbmV4dCBvbmUgd2l0aCBjdXJyZW50IHNwbGl0IHZhbHVlDQogICAgICAgICAgICAgICAgICAgIGlmICggbGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT09MCBhbmQgd29yZF90b19maW5kWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgb3IgKGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk+MCAgYW5kIHNwbGl0c1tjdXJyZW50X2luZGV4KzFdWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJyk6IyBmaXJzdCBqdXN0IGp1c3QgY2hlY2sgbmV4dA0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlcGxhY2Vfd2l0aA0KICAgICAgICAgICAgICAgICNub3QgYmxhbmssIHRoZW4gY2hlY2sgY3VycmVudCBlbmR2YWx1ZSBhbmQgbmV4dCBmaXJzdCB2YWx1ZQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGlmIChzcGxpdHNbY3VycmVudF9pbmRleF1bLTFdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgYW5kICgoIGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk9PTAgYW5kIHdvcmRfdG9fZmluZFswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpIG9yIChsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPjAgIGFuZCBzcGxpdHNbY3VycmVudF9pbmRleCsxXVswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpKTojIGZpcnN0IGp1c3QganVzdCBjaGVjayBuZXh0DQogICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVwbGFjZV93aXRoDQoNCiAgICAgICAgICAgIG5ld19zdHJpbmcuYXBwZW5kKHZhbCkNCiAgICAgICAgICAgIGN1cnJlbnRfaW5kZXgrPTENCiAgICAgICAgI2FhYWE9MS8wDQogICAgICAgIHNvdXJjZV9zdHI9Jycuam9pbihuZXdfc3RyaW5nKQ0KICAgIHJldHVybiBzb3VyY2Vfc3RyDQoNCmRlZiBfX2l0b2EobnVtLCByYWRpeCk6DQojICAgIHByaW50ICdudW0gcmVkJyxudW0sIHJhZGl4DQogICAgcmVzdWx0ID0gIiINCiAgICBpZiBudW09PTA6IHJldHVybiAnMCcNCiAgICB3aGlsZSBudW0gPiAwOg0KICAgICAgICByZXN1bHQgPSAiMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6IltudW0gJSByYWRpeF0gKyByZXN1bHQNCiAgICAgICAgbnVtIC89IHJhZGl4DQogICAgcmV0dXJuIHJlc3VsdA0KDQpkZWYgX19pdG9hTmV3KGNjLCBhKToNCiAgICBhYT0iIiBpZiBjYyA8IGEgZWxzZSBfX2l0b2FOZXcoaW50KGNjIC8gYSksYSkNCiAgICBjYyA9IChjYyAlIGEpDQogICAgYmI9Y2hyKGNjICsgMjkpIGlmIGNjPiAzNSBlbHNlIHN0cihfX2l0b2EoY2MsMzYpKQ0KICAgIHJldHVybiBhYStiYg0KDQoNCmRlZiBnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcik6DQogICAgdHJ5Og0KICAgICAgICBjb29raWVTdHJpbmc9IiINCiAgICAgICAgZm9yIGluZGV4LCBjb29raWUgaW4gZW51bWVyYXRlKGNvb2tpZUphcik6DQogICAgICAgICAgICBjb29raWVTdHJpbmcrPWNvb2tpZS5uYW1lICsgIj0iICsgY29va2llLnZhbHVlICsiOyINCiAgICBleGNlcHQ6IHBhc3MNCiAgICAjcHJpbnQgJ2Nvb2tpZVN0cmluZycsY29va2llU3RyaW5nDQogICAgcmV0dXJuIGNvb2tpZVN0cmluZw0KDQoNCmRlZiBzYXZlQ29va2llSmFyKGNvb2tpZUphcixDT09LSUVGSUxFKToNCiAgICB0cnk6DQogICAgICAgIGNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsQ09PS0lFRklMRSkNCiAgICAgICAgY29va2llSmFyLnNhdmUoY29tcGxldGVfcGF0aCxpZ25vcmVfZGlzY2FyZD1UcnVlKQ0KICAgIGV4Y2VwdDogcGFzcw0KDQpkZWYgZ2V0Q29va2llSmFyKENPT0tJRUZJTEUpOg0KDQogICAgY29va2llSmFyPU5vbmUNCiAgICBpZiBDT09LSUVGSUxFOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLENPT0tJRUZJTEUpDQogICAgICAgICAgICBjb29raWVKYXIgPSBjb29raWVsaWIuTFdQQ29va2llSmFyKCkNCiAgICAgICAgICAgIGNvb2tpZUphci5sb2FkKGNvbXBsZXRlX3BhdGgsaWdub3JlX2Rpc2NhcmQ9VHJ1ZSkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgY29va2llSmFyPU5vbmUNCg0KICAgIGlmIG5vdCBjb29raWVKYXI6DQogICAgICAgIGNvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQ0KDQogICAgcmV0dXJuIGNvb2tpZUphcg0KDQpkZWYgZG9FdmFsKGZ1bl9jYWxsLHBhZ2VfZGF0YSxDb29raWVfSmFyLG0pOg0KICAgIHJldF92YWw9JycNCiAgICAjcHJpbnQgZnVuX2NhbGwNCiAgICBpZiBmdW5jdGlvbnNfZGlyIG5vdCBpbiBzeXMucGF0aDoNCiAgICAgICAgc3lzLnBhdGguYXBwZW5kKGZ1bmN0aW9uc19kaXIpDQoNCiMgICAgcHJpbnQgZnVuX2NhbGwNCiAgICB0cnk6DQogICAgICAgIHB5X2ZpbGU9J2ltcG9ydCAnK2Z1bl9jYWxsLnNwbGl0KCcuJylbMF0NCiMgICAgICAgIHByaW50IHB5X2ZpbGUsc3lzLnBhdGgNCiAgICAgICAgZXhlYyggcHlfZmlsZSkNCiMgICAgICAgIHByaW50ICdkb25lJw0KICAgIGV4Y2VwdDoNCiAgICAgICAgI3ByaW50ICdlcnJvciBpbiBpbXBvcnQnDQogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3Rkb3V0KQ0KIyAgICBwcmludCAncmV0X3ZhbD0nK2Z1bl9jYWxsDQogICAgZXhlYyAoJ3JldF92YWw9JytmdW5fY2FsbCkNCiMgICAgcHJpbnQgcmV0X3ZhbA0KICAgICNleGVjKCdyZXRfdmFsPTErMScpDQogICAgdHJ5Og0KICAgICAgICByZXR1cm4gc3RyKHJldF92YWwpDQogICAgZXhjZXB0OiByZXR1cm4gcmV0X3ZhbA0KDQpkZWYgZG9FdmFsRnVuY3Rpb24oZnVuX2NhbGwscGFnZV9kYXRhLENvb2tpZV9KYXIsbSk6DQojICAgIHByaW50ICdkb0V2YWxGdW5jdGlvbicNCiAgICB0cnk6DQogICAgICAgIGdsb2JhbCBnTFNQcm9EeW5hbWljQ29kZU51bWJlcg0KICAgICAgICBnTFNQcm9EeW5hbWljQ29kZU51bWJlcj1nTFNQcm9EeW5hbWljQ29kZU51bWJlcisxDQogICAgICAgIHJldF92YWw9JycNCiAgICAgICAgcHJpbnQgJ2Rvb29vZG9vJw0KICAgICAgICBpZiBmdW5jdGlvbnNfZGlyIG5vdCBpbiBzeXMucGF0aDoNCiAgICAgICAgICAgIHN5cy5wYXRoLmFwcGVuZChmdW5jdGlvbnNfZGlyKQ0KDQogICAgICAgIGZpbGVuYW1lPSdMU1Byb2R5bmFtaWNDb2RlJXMucHknJXN0cihnTFNQcm9EeW5hbWljQ29kZU51bWJlcikNCiAgICAgICAgZmlsZW5hbWV3aXRocGF0aD1vcy5wYXRoLmpvaW4oZnVuY3Rpb25zX2RpcixmaWxlbmFtZSkNCiAgICAgICAgZj1vcGVuKGZpbGVuYW1ld2l0aHBhdGgsIndiIikNCiAgICAgICAgZi53cml0ZSgiIyAtKi0gY29kaW5nOiB1dGYtOCAtKi1cbiIpDQogICAgICAgIGYud3JpdGUoZnVuX2NhbGwuZW5jb2RlKCJ1dGYtOCIpKTsNCiAgICAgICAgZi5jbG9zZSgpDQogICAgICAgIHByaW50ICdiZWZvcmUgZG8nDQogICAgICAgIExTUHJvZHluYW1pY0NvZGUgPSBpbXBvcnRfYnlfc3RyaW5nKGZpbGVuYW1lLnNwbGl0KCcuJylbMF0sZmlsZW5hbWV3aXRocGF0aCkNCiAgICAgICAgcHJpbnQgJ2FmdGVyJw0KICAgICAgICAgDQogICAgICAgIHJldF92YWw9TFNQcm9keW5hbWljQ29kZS5HZXRMU1Byb0RhdGEocGFnZV9kYXRhLENvb2tpZV9KYXIsbSkNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgcmV0dXJuIHN0cihyZXRfdmFsKQ0KICAgICAgICBleGNlcHQ6IHJldHVybiByZXRfdmFsDQogICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKCkNCiAgICByZXR1cm4gIiINCg0KZGVmIGltcG9ydF9ieV9zdHJpbmcoZnVsbF9uYW1lLGZpbGVuYW1ld2l0aHBhdGgpOg0KICAgIHRyeToNCiAgICAgICAgDQogICAgICAgIGltcG9ydCBpbXBvcnRsaWINCiAgICAgICAgcmV0dXJuIGltcG9ydGxpYi5pbXBvcnRfbW9kdWxlKGZ1bGxfbmFtZSwgcGFja2FnZT1Ob25lKQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgaW1wb3J0IGltcA0KICAgICAgICByZXR1cm4gaW1wLmxvYWRfc291cmNlKGZ1bGxfbmFtZSxmaWxlbmFtZXdpdGhwYXRoKQ0KDQoNCmRlZiBnZXRHb29nbGVSZWNhcHRjaGFSZXNwb25zZShjYXB0Y2hha2V5LCBjaix0eXBlPTEpOiAjMSBmb3IgZ2V0LCAyIGZvciBwb3N0LCAzIGZvciByYXdwb3N0DQojICAgICNoZWFkZXJzPVsoJ1VzZXItQWdlbnQnLCdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjE0LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTQuMC4xJyldDQojICAgIGh0bWxfdGV4dD1nZXRVcmwodXJsLG5vcmVkaXI9VHJ1ZSwgY29va2llSmFyPWNqLGhlYWRlcnM9aGVhZGVycykNCiAjICAgcHJpbnQgJ2h0bWxfdGV4dCcsaHRtbF90ZXh0DQogICAgcmVjYXBDaGFsbGVuZ2U9IiINCiAgICBzb2x1dGlvbj0iIg0KIyAgICBjYXBfcmVnPSJyZWNhcC4qP1w/az0oLio/KVwiIiAgICANCiMgICAgbWF0Y2ggPXJlLmZpbmRhbGwoY2FwX3JlZywgaHRtbF90ZXh0KQ0KICAgIA0KICAgICAgICANCiMgICAgcHJpbnQgJ21hdGNoJyxtYXRjaA0KICAgIGNhcHRjaGE9RmFsc2UNCiAgICBjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbD1Ob25lDQogICAgc29sdXRpb249Tm9uZQ0KICAgIGlmIGxlbihjYXB0Y2hha2V5KT4wOiAjbmV3IHNoaW55IGNhcHRjaGEhDQogICAgICAgIGNhcHRjaGFfdXJsPWNhcHRjaGFrZXkNCiAgICAgICAgaWYgbm90IGNhcHRjaGFfdXJsLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCiAgICAgICAgICAgIGNhcHRjaGFfdXJsPSdodHRwOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2FwaS9jaGFsbGVuZ2U/az0nK2NhcHRjaGFfdXJsKycmYWpheD0xJw0KIyAgICAgICAgcHJpbnQgJ2NhcHRjaGFfdXJsJyxjYXB0Y2hhX3VybA0KICAgICAgICBjYXB0Y2hhPVRydWUNCg0KICAgICAgICBjYXBfY2hhbGxfcmVnPSdjaGFsbGVuZ2UuKj9cJyguKj8pXCcnDQogICAgICAgIGNhcF9pbWFnZV9yZWc9J1wnKC4qPylcJycNCiAgICAgICAgY2FwdGNoYV9zY3JpcHQ9Z2V0VXJsKGNhcHRjaGFfdXJsLGNvb2tpZUphcj1jaikNCiAgICAgICAgcmVjYXBDaGFsbGVuZ2U9cmUuZmluZGFsbChjYXBfY2hhbGxfcmVnLCBjYXB0Y2hhX3NjcmlwdClbMF0NCiAgICAgICAgY2FwdGNoYV9yZWxvYWQ9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL3JlbG9hZD9jPSc7DQogICAgICAgIGNhcHRjaGFfaz1jYXB0Y2hhX3VybC5zcGxpdCgnaz0nKVsxXQ0KICAgICAgICBjYXB0Y2hhX3JlbG9hZCs9cmVjYXBDaGFsbGVuZ2UrJyZrPScrY2FwdGNoYV9rKycmcmVhc29uPWkmdHlwZT1pbWFnZSZsYW5nPWVuJw0KICAgICAgICBjYXB0Y2hhX3JlbG9hZF9qcz1nZXRVcmwoY2FwdGNoYV9yZWxvYWQsY29va2llSmFyPWNqKQ0KICAgICAgICBjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbD1yZS5maW5kYWxsKGNhcF9pbWFnZV9yZWcsIGNhcHRjaGFfcmVsb2FkX2pzKVswXQ0KICAgICAgICBjYXB0Y2hhX2ltYWdlX3VybD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvaW1hZ2U/Yz0nK2NhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsDQogICAgICAgIGlmIG5vdCBjYXB0Y2hhX2ltYWdlX3VybC5zdGFydHN3aXRoKCJodHRwIik6DQogICAgICAgICAgICBjYXB0Y2hhX2ltYWdlX3VybD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvJytjYXB0Y2hhX2ltYWdlX3VybA0KICAgICAgICBpbXBvcnQgcmFuZG9tDQogICAgICAgIG49cmFuZG9tLnJhbmRyYW5nZSgxMDAsMTAwMCw1KQ0KICAgICAgICBsb2NhbF9jYXB0Y2hhID0gb3MucGF0aC5qb2luKHByb2ZpbGUsc3RyKG4pICsiY2FwdGNoYS5pbWciICkNCiAgICAgICAgbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQ0KICAgICAgICBsb2NhbEZpbGUud3JpdGUoZ2V0VXJsKGNhcHRjaGFfaW1hZ2VfdXJsLGNvb2tpZUphcj1jaikpDQogICAgICAgIGxvY2FsRmlsZS5jbG9zZSgpDQogICAgICAgIHNvbHZlciA9IElucHV0V2luZG93KGNhcHRjaGE9bG9jYWxfY2FwdGNoYSkNCiAgICAgICAgc29sdXRpb24gPSBzb2x2ZXIuZ2V0KCkNCiAgICAgICAgb3MucmVtb3ZlKGxvY2FsX2NhcHRjaGEpDQoNCiAgICBpZiBjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbDoNCiAgICAgICAgaWYgdHlwZT09MToNCiAgICAgICAgICAgIHJldHVybiAncmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZD0nK3VybGxpYi5xdW90ZV9wbHVzKGNhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsKSsnJnJlY2FwdGNoYV9yZXNwb25zZV9maWVsZD0nK3VybGxpYi5xdW90ZV9wbHVzKHNvbHV0aW9uKQ0KICAgICAgICBlbGlmIHR5cGU9PTI6DQogICAgICAgICAgICByZXR1cm4gJ3JlY2FwdGNoYV9jaGFsbGVuZ2VfZmllbGQ6JytjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbCsnLHJlY2FwdGNoYV9yZXNwb25zZV9maWVsZDonK3NvbHV0aW9uDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gJ3JlY2FwdGNoYV9jaGFsbGVuZ2VfZmllbGQ9Jyt1cmxsaWIucXVvdGVfcGx1cyhjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbCkrJyZyZWNhcHRjaGFfcmVzcG9uc2VfZmllbGQ9Jyt1cmxsaWIucXVvdGVfcGx1cyhzb2x1dGlvbikNCiAgICBlbHNlOg0KICAgICAgICByZXR1cm4gJycNCiAgICAgICAgDQoNCmRlZiBnZXRVcmwodXJsLCBjb29raWVKYXI9Tm9uZSxwb3N0PU5vbmUsIHRpbWVvdXQ9MjAsIGhlYWRlcnM9Tm9uZSwgbm9yZWRpcj1GYWxzZSk6DQoNCg0KICAgIGNvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikNCg0KICAgIGlmIG5vcmVkaXI6DQogICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKE5vUmVkaXJlY3Rpb24sY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQ0KICAgIGVsc2U6DQogICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkNCiAgICAjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpDQogICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KHVybCkNCiAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgV09XNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8zMy4wLjE3NTAuMTU0IFNhZmFyaS81MzcuMzYnKQ0KICAgIGlmIGhlYWRlcnM6DQogICAgICAgIGZvciBoLGh2IGluIGhlYWRlcnM6DQogICAgICAgICAgICByZXEuYWRkX2hlYWRlcihoLGh2KQ0KDQogICAgcmVzcG9uc2UgPSBvcGVuZXIub3BlbihyZXEscG9zdCx0aW1lb3V0PXRpbWVvdXQpDQogICAgbGluaz1yZXNwb25zZS5yZWFkKCkNCiAgICByZXNwb25zZS5jbG9zZSgpDQogICAgcmV0dXJuIGxpbms7DQoNCmRlZiBnZXRfZGVjb2RlKHN0cixyZWc9Tm9uZSk6DQogICAgaWYgcmVnOg0KICAgICAgICBzdHI9cmUuZmluZGFsbChyZWcsIHN0cilbMF0NCiAgICBzMSA9IHVybGxpYi51bnF1b3RlKHN0clswOiBsZW4oc3RyKS0xXSk7DQogICAgdCA9ICcnOw0KICAgIGZvciBpIGluIHJhbmdlKCBsZW4oczEpKToNCiAgICAgICAgdCArPSBjaHIob3JkKHMxW2ldKSAtIHMxW2xlbihzMSktMV0pOw0KICAgIHQ9dXJsbGliLnVucXVvdGUodCkNCiMgICAgcHJpbnQgdA0KICAgIHJldHVybiB0DQoNCmRlZiBqYXZhc2NyaXB0VW5Fc2NhcGUoc3RyKToNCiAgICBqcz1yZS5maW5kYWxsKCd1bmVzY2FwZVwoXCcoLio/KVwnJyxzdHIpDQojICAgIHByaW50ICdqcycsanMNCiAgICBpZiAobm90IGpzPT1Ob25lKSBhbmQgbGVuKGpzKT4wOg0KICAgICAgICBmb3IgaiBpbiBqczoNCiAgICAgICAgICAgICNwcmludCB1cmxsaWIudW5xdW90ZShqKQ0KICAgICAgICAgICAgc3RyPXN0ci5yZXBsYWNlKGogLHVybGxpYi51bnF1b3RlKGopKQ0KICAgIHJldHVybiBzdHINCg0KaWlkPTANCmRlZiBhc2tDYXB0Y2hhKG0saHRtbF9wYWdlLCBjb29raWVKYXIpOg0KICAgIGdsb2JhbCBpaWQNCiAgICBpaWQrPTENCiAgICBleHByZT0gbVsnZXhwcmVzJ10NCiAgICBwYWdlX3VybCA9IG1bJ3BhZ2UnXQ0KICAgIGNhcHRjaGFfcmVnZXg9cmUuY29tcGlsZSgnXCRMaXZlU3RyZWFtQ2FwdGNoYVxbKFteXF1dKilcXScpLmZpbmRhbGwoZXhwcmUpWzBdDQoNCiAgICBjYXB0Y2hhX3VybD1yZS5jb21waWxlKGNhcHRjaGFfcmVnZXgpLmZpbmRhbGwoaHRtbF9wYWdlKVswXQ0KIyAgICBwcmludCBleHByZSxjYXB0Y2hhX3JlZ2V4LGNhcHRjaGFfdXJsDQogICAgaWYgbm90IGNhcHRjaGFfdXJsLnN0YXJ0c3dpdGgoImh0dHAiKToNCiAgICAgICAgcGFnZV89J2h0dHA6Ly8nKyIiLmpvaW4ocGFnZV91cmwuc3BsaXQoJy8nKVsyOjNdKQ0KICAgICAgICBpZiBjYXB0Y2hhX3VybC5zdGFydHN3aXRoKCIvIik6DQogICAgICAgICAgICBjYXB0Y2hhX3VybD1wYWdlXytjYXB0Y2hhX3VybA0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgY2FwdGNoYV91cmw9cGFnZV8rJy8nK2NhcHRjaGFfdXJsDQoNCiAgICBsb2NhbF9jYXB0Y2hhID0gb3MucGF0aC5qb2luKHByb2ZpbGUsIHN0cihpaWQpKyJjYXB0Y2hhLmpwZyIgKQ0KICAgIGxvY2FsRmlsZSA9IG9wZW4obG9jYWxfY2FwdGNoYSwgIndiIikNCiMgICAgcHJpbnQgJyBjIGNhcHVybCcsY2FwdGNoYV91cmwNCiAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QoY2FwdGNoYV91cmwpDQogICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjoxNC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE0LjAuMScpDQogICAgaWYgJ3JlZmVyZXInIGluIG06DQogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdSZWZlcmVyJywgbVsncmVmZXJlciddKQ0KICAgIGlmICdhZ2VudCcgaW4gbToNCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItYWdlbnQnLCBtWydhZ2VudCddKQ0KICAgIGlmICdzZXRjb29raWUnIGluIG06DQojICAgICAgICBwcmludCAnYWRkaW5nIGNvb2tpZScsbVsnc2V0Y29va2llJ10NCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0Nvb2tpZScsIG1bJ3NldGNvb2tpZSddKQ0KDQogICAgI2Nvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikNCiAgICAjb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQ0KICAgICNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikNCiAgICB1cmxsaWIyLnVybG9wZW4ocmVxKQ0KICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkNCg0KICAgIGxvY2FsRmlsZS53cml0ZShyZXNwb25zZS5yZWFkKCkpDQogICAgcmVzcG9uc2UuY2xvc2UoKQ0KICAgIGxvY2FsRmlsZS5jbG9zZSgpDQogICAgc29sdmVyID0gSW5wdXRXaW5kb3coY2FwdGNoYT1sb2NhbF9jYXB0Y2hhKQ0KICAgIHNvbHV0aW9uID0gc29sdmVyLmdldCgpDQogICAgcmV0dXJuIHNvbHV0aW9uDQoNCmRlZiBhc2tDYXB0Y2hhTmV3KGltYWdlcmVnZXgsaHRtbF9wYWdlLGNvb2tpZUphcixtKToNCiAgICBnbG9iYWwgaWlkDQogICAgaWlkKz0xDQoNCg0KICAgIGlmIG5vdCBpbWFnZXJlZ2V4PT0nJzoNCiAgICAgICAgaWYgaHRtbF9wYWdlLnN0YXJ0c3dpdGgoImh0dHAiKToNCiAgICAgICAgICAgIHBhZ2VfPWdldFVybChodG1sX3BhZ2UsY29va2llSmFyPWNvb2tpZUphcikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHBhZ2VfPWh0bWxfcGFnZQ0KICAgICAgICBjYXB0Y2hhX3VybD1yZS5jb21waWxlKGltYWdlcmVnZXgpLmZpbmRhbGwoaHRtbF9wYWdlKVswXQ0KICAgIGVsc2U6DQogICAgICAgIGNhcHRjaGFfdXJsPWh0bWxfcGFnZQ0KICAgICAgICBpZiAnb25lcGxheS50di9lbWJlZCcgaW4gaHRtbF9wYWdlOg0KICAgICAgICAgICAgaW1wb3J0IG9uZXBsYXkNCiAgICAgICAgICAgIHBhZ2VfPWdldFVybChodG1sX3BhZ2UsY29va2llSmFyPWNvb2tpZUphcikNCiAgICAgICAgICAgIGNhcHRjaGFfdXJsPW9uZXBsYXkuZ2V0Q2FwdGNoYVVybChwYWdlXykNCg0KICAgIGxvY2FsX2NhcHRjaGEgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgc3RyKGlpZCkrImNhcHRjaGEuanBnIiApDQogICAgbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQ0KIyAgICBwcmludCAnIGMgY2FwdXJsJyxjYXB0Y2hhX3VybA0KICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdChjYXB0Y2hhX3VybCkNCiAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjE0LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTQuMC4xJykNCiAgICBpZiAncmVmZXJlcicgaW4gbToNCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlcmVyJ10pDQogICAgaWYgJ2FnZW50JyBpbiBtOg0KICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1hZ2VudCcsIG1bJ2FnZW50J10pDQogICAgaWYgJ2FjY2VwdCcgaW4gbToNCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0FjY2VwdCcsIG1bJ2FjY2VwdCddKQ0KICAgIGlmICdzZXRjb29raWUnIGluIG06DQojICAgICAgICBwcmludCAnYWRkaW5nIGNvb2tpZScsbVsnc2V0Y29va2llJ10NCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0Nvb2tpZScsIG1bJ3NldGNvb2tpZSddKQ0KDQogICAgI2Nvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikNCiAgICAjb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQ0KICAgICNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikNCiAgICAjdXJsbGliMi51cmxvcGVuKHJlcSkNCiAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpDQoNCiAgICBsb2NhbEZpbGUud3JpdGUocmVzcG9uc2UucmVhZCgpKQ0KICAgIHJlc3BvbnNlLmNsb3NlKCkNCiAgICBsb2NhbEZpbGUuY2xvc2UoKQ0KICAgIHNvbHZlciA9IElucHV0V2luZG93KGNhcHRjaGE9bG9jYWxfY2FwdGNoYSkNCiAgICBzb2x1dGlvbiA9IHNvbHZlci5nZXQoKQ0KICAgIHJldHVybiBzb2x1dGlvbg0KDQojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMNCiMgRnVuY3Rpb24gIDogR1VJRWRpdEV4cG9ydE5hbWUgICAgICAgICAgICAgICAgICAgICAgICAgIw0KIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjDQojIFBhcmFtZXRlciA6ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIw0KIyBuYW1lICAgICAgICBzdWdlc3RlZCBuYW1lIGZvciBleHBvcnQgICAgICAgICAgICAgICAgICAjDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgDQojIFJldHVybnMgICA6ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIw0KIyBuYW1lICAgICAgICBuYW1lIG9mIGV4cG9ydCBleGNsdWRpbmcgYW55IGV4dGVuc2lvbiAgICAjDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMNCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KZGVmIFRha2VJbnB1dChuYW1lLCBoZWFkbmFtZSk6DQoNCg0KICAgIGtiID0geGJtYy5LZXlib2FyZCgnZGVmYXVsdCcsICdoZWFkaW5nJywgVHJ1ZSkNCiAgICBrYi5zZXREZWZhdWx0KG5hbWUpDQogICAga2Iuc2V0SGVhZGluZyhoZWFkbmFtZSkNCiAgICBrYi5zZXRIaWRkZW5JbnB1dChGYWxzZSkNCiAgICByZXR1cm4ga2IuZ2V0VGV4dCgpDQoNCiAgIA0KIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjDQoNCmNsYXNzIElucHV0V2luZG93KHhibWNndWkuV2luZG93RGlhbG9nKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToNCiAgICAgICAgc2VsZi5jcHRsb2MgPSBrd2FyZ3MuZ2V0KCdjYXB0Y2hhJykNCiAgICAgICAgc2VsZi5pbWcgPSB4Ym1jZ3VpLkNvbnRyb2xJbWFnZSgzMzUsMzAsNjI0LDYwLHNlbGYuY3B0bG9jKQ0KICAgICAgICBzZWxmLmFkZENvbnRyb2woc2VsZi5pbWcpDQogICAgICAgIHNlbGYua2JkID0geGJtYy5LZXlib2FyZCgpDQoNCiAgICBkZWYgZ2V0KHNlbGYpOg0KICAgICAgICBzZWxmLnNob3coKQ0KICAgICAgICB0aW1lLnNsZWVwKDIpDQogICAgICAgIHNlbGYua2JkLmRvTW9kYWwoKQ0KICAgICAgICBpZiAoc2VsZi5rYmQuaXNDb25maXJtZWQoKSk6DQogICAgICAgICAgICB0ZXh0ID0gc2VsZi5rYmQuZ2V0VGV4dCgpDQogICAgICAgICAgICBzZWxmLmNsb3NlKCkNCiAgICAgICAgICAgIHJldHVybiB0ZXh0DQogICAgICAgIHNlbGYuY2xvc2UoKQ0KICAgICAgICByZXR1cm4gRmFsc2UNCg0KZGVmIGdldEVwb2NUaW1lKCk6DQogICAgaW1wb3J0IHRpbWUNCiAgICByZXR1cm4gc3RyKGludCh0aW1lLnRpbWUoKSoxMDAwKSkNCg0KZGVmIGdldEVwb2NUaW1lMigpOg0KICAgIGltcG9ydCB0aW1lDQogICAgcmV0dXJuIHN0cihpbnQodGltZS50aW1lKCkpKQ0KDQpkZWYgZ2V0X3BhcmFtcygpOg0KICAgICAgICBwYXJhbT1bXQ0KICAgICAgICBwYXJhbXN0cmluZz1zeXMuYXJndlsyXQ0KICAgICAgICBpZiBsZW4ocGFyYW1zdHJpbmcpPj0yOg0KICAgICAgICAgICAgcGFyYW1zPXN5cy5hcmd2WzJdDQogICAgICAgICAgICBjbGVhbmVkcGFyYW1zPXBhcmFtcy5yZXBsYWNlKCc/JywnJykNCiAgICAgICAgICAgIGlmIChwYXJhbXNbbGVuKHBhcmFtcyktMV09PScvJyk6DQogICAgICAgICAgICAgICAgcGFyYW1zPXBhcmFtc1swOmxlbihwYXJhbXMpLTJdDQogICAgICAgICAgICBwYWlyc29mcGFyYW1zPWNsZWFuZWRwYXJhbXMuc3BsaXQoJyYnKQ0KICAgICAgICAgICAgcGFyYW09e30NCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihwYWlyc29mcGFyYW1zKSk6DQogICAgICAgICAgICAgICAgc3BsaXRwYXJhbXM9e30NCiAgICAgICAgICAgICAgICBzcGxpdHBhcmFtcz1wYWlyc29mcGFyYW1zW2ldLnNwbGl0KCc9JykNCiAgICAgICAgICAgICAgICBpZiAobGVuKHNwbGl0cGFyYW1zKSk9PTI6DQogICAgICAgICAgICAgICAgICAgIHBhcmFtW3NwbGl0cGFyYW1zWzBdXT1zcGxpdHBhcmFtc1sxXQ0KICAgICAgICByZXR1cm4gcGFyYW0NCg0KDQpkZWYgZ2V0RmF2b3JpdGVzKCk6DQogICAgICAgIGl0ZW1zID0ganNvbi5sb2FkcyhvcGVuKGZhdm9yaXRlcykucmVhZCgpKQ0KICAgICAgICB0b3RhbCA9IGxlbihpdGVtcykNCiAgICAgICAgZm9yIGkgaW4gaXRlbXM6DQogICAgICAgICAgICBuYW1lID0gaVswXQ0KICAgICAgICAgICAgdXJsID0gaVsxXQ0KICAgICAgICAgICAgaWNvbmltYWdlID0gaVsyXQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGZhbkFydCA9IGlbM10NCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGljb25pbWFnZQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydA0KICAgICAgICAgICAgdHJ5OiBwbGF5bGlzdCA9IGlbNV0NCiAgICAgICAgICAgIGV4Y2VwdDogcGxheWxpc3QgPSBOb25lDQogICAgICAgICAgICB0cnk6IHJlZ2V4cyA9IGlbNl0NCiAgICAgICAgICAgIGV4Y2VwdDogcmVnZXhzID0gTm9uZQ0KDQogICAgICAgICAgICBpZiBpWzRdID09IDA6DQogICAgICAgICAgICAgICAgYWRkTGluayh1cmwsbmFtZSxpY29uaW1hZ2UsZmFuQXJ0LCcnLCcnLCcnLCdmYXYnLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsLGlbNF0saWNvbmltYWdlLGZhbmFydCwnJywnJywnJywnJywnZmF2JykNCg0KDQpkZWYgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlLHBsYXlsaXN0PU5vbmUscmVnZXhzPU5vbmUpOg0KICAgICAgICBmYXZMaXN0ID0gW10NCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgIyBzZWVtcyB0aGF0IGFmdGVyDQogICAgICAgICAgICBuYW1lID0gbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHBhc3MNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzKT09RmFsc2U6DQogICAgICAgICAgICBhZGRvbl9sb2coJ01ha2luZyBGYXZvcml0ZXMgRmlsZScpDQogICAgICAgICAgICBmYXZMaXN0LmFwcGVuZCgobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlLHBsYXlsaXN0LHJlZ2V4cykpDQogICAgICAgICAgICBhID0gb3BlbihmYXZvcml0ZXMsICJ3IikNCiAgICAgICAgICAgIGEud3JpdGUoanNvbi5kdW1wcyhmYXZMaXN0KSkNCiAgICAgICAgICAgIGEuY2xvc2UoKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgYWRkb25fbG9nKCdBcHBlbmRpbmcgRmF2b3JpdGVzJykNCiAgICAgICAgICAgIGEgPSBvcGVuKGZhdm9yaXRlcykucmVhZCgpDQogICAgICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhhKQ0KICAgICAgICAgICAgZGF0YS5hcHBlbmQoKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsbW9kZSkpDQogICAgICAgICAgICBiID0gb3BlbihmYXZvcml0ZXMsICJ3IikNCiAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhkYXRhKSkNCiAgICAgICAgICAgIGIuY2xvc2UoKQ0KDQoNCmRlZiBybUZhdm9yaXRlKG5hbWUpOg0KICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhvcGVuKGZhdm9yaXRlcykucmVhZCgpKQ0KICAgICAgICBmb3IgaW5kZXggaW4gcmFuZ2UobGVuKGRhdGEpKToNCiAgICAgICAgICAgIGlmIGRhdGFbaW5kZXhdWzBdPT1uYW1lOg0KICAgICAgICAgICAgICAgIGRlbCBkYXRhW2luZGV4XQ0KICAgICAgICAgICAgICAgIGIgPSBvcGVuKGZhdm9yaXRlcywgInciKQ0KICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhkYXRhKSkNCiAgICAgICAgICAgICAgICBiLmNsb3NlKCkNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5SZWZyZXNoIikNCg0KZGVmIHVybHNvbHZlcih1cmwpOg0KICAgIGltcG9ydCB1cmxyZXNvbHZlcg0KICAgIGhvc3QgPSB1cmxyZXNvbHZlci5Ib3N0ZWRNZWRpYUZpbGUodXJsKQ0KICAgIGlmIGhvc3Q6DQogICAgICAgIHJlc29sdmVyID0gdXJscmVzb2x2ZXIucmVzb2x2ZSh1cmwpDQogICAgICAgIHJlc29sdmVkID0gcmVzb2x2ZXINCiAgICAgICAgaWYgaXNpbnN0YW5jZShyZXNvbHZlZCxsaXN0KToNCiAgICAgICAgICAgIGZvciBrIGluIHJlc29sdmVkOg0KICAgICAgICAgICAgICAgIHF1YWxpdHkgPSBhZGRvbi5nZXRTZXR0aW5nKCdxdWFsaXR5JykNCiAgICAgICAgICAgICAgICBpZiBrWydxdWFsaXR5J10gPT0gJ0hEJyAgOg0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgZWxpZiBrWydxdWFsaXR5J10gPT0gJ1NEJyA6DQogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0ga1sndXJsJ10NCiAgICAgICAgICAgICAgICBlbGlmIGtbJ3F1YWxpdHknXSA9PSAnMTA4MHAnIGFuZCBhZGRvbi5nZXRTZXR0aW5nKCcxMDgwcHF1YWxpdHknKSA9PSAndHJ1ZScgOg0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXNvbHZlciA9IHJlc29sdmVkDQogICAgZWxzZToNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oSU5TT01OSUEsVXJscmVzb2x2ZXIgZG9ub3Qgc3VwcG9ydCB0aGlzIGRvbWFpbi4gLSAsNTAwMCkiKQ0KICAgICAgICByZXNvbHZlcj11cmwNCiAgICByZXR1cm4gcmVzb2x2ZXINCmRlZiB0cnlwbGF5KHVybCxsaXN0aXRlbSxwZGlhbG9ndWU9Tm9uZSk6ICAgIA0KDQogICAgaWYgdXJsLmxvd2VyKCkuc3RhcnRzd2l0aCgncGx1Z2luJykgYW5kICd5b3V0dWJlJyBub3QgaW4gIHVybC5sb3dlcigpOg0KICAgICAgICBwcmludCAncGxheWluZyB2aWEgcnVucGx1Z2luJw0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdYQk1DLlJ1blBsdWdpbignK3VybCsnKScpIA0KICAgICAgICBmb3IgaSBpbiByYW5nZSg4KToNCiAgICAgICAgICAgIHhibWMuc2xlZXAoNTAwKSAjI3NsZWVwIGZvciAxMCBzZWNvbmRzLCBoYWxmIGVhY2ggdGltZQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICNwcmludCAnY29uZGknDQogICAgICAgICAgICAgICAgaWYgeGJtYy5nZXRDb25kVmlzaWJpbGl0eSgiUGxheWVyLkhhc01lZGlhIikgYW5kIHhibWMuUGxheWVyKCkuaXNQbGF5aW5nKCk6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgcHJpbnQgJ3JldHVybmluZyBub3cnDQogICAgICAgIHJldHVybiBGYWxzZQ0KICAgIGltcG9ydCAgQ3VzdG9tUGxheWVyLHRpbWUNCg0KICAgIHBsYXllciA9IEN1c3RvbVBsYXllci5NeVhCTUNQbGF5ZXIoKQ0KICAgIHBsYXllci5wZGlhbG9ndWU9cGRpYWxvZ3VlDQogICAgc3RhcnQgPSB0aW1lLnRpbWUoKSANCiAgICAjeGJtYy5QbGF5ZXIoKS5wbGF5KCBsaXZlTGluayxsaXN0aXRlbSkNCiAgICBwcmludCAnZ29pbmcgdG8gcGxheScNCiAgICBpbXBvcnQgdGltZQ0KICAgIGJlZm9yZXN0YXJ0PXRpbWUudGltZSgpDQogICAgcGxheWVyLnBsYXkoIHVybCwgbGlzdGl0ZW0pDQogICAgeGJtYy5zbGVlcCgxMDAwKQ0KICAgIA0KICAgIHRyeToNCiAgICAgICAgd2hpbGUgcGxheWVyLmlzX2FjdGl2ZToNCiAgICAgICAgICAgIHhibWMuc2xlZXAoNDAwKQ0KICAgICAgICAgICANCiAgICAgICAgICAgIGlmIHBsYXllci51cmxwbGF5ZWQ6DQogICAgICAgICAgICAgICAgcHJpbnQgJ3llcyBwbGF5ZWQnDQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgICAgIGlmIHRpbWUudGltZSgpLWJlZm9yZXN0YXJ0PjQ6IHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgI3hibWMuc2xlZXAoMTAwMCkNCiAgICBleGNlcHQ6IHBhc3MNCiAgICBwcmludCAnbm90IHBsYXllZCcsdXJsDQogICAgcmV0dXJuIEZhbHNlDQpkZWYgcGxheV9wbGF5bGlzdChuYW1lLCBtdV9wbGF5bGlzdCxxdWV1ZVZpZGVvPU5vbmUpOg0KICAgICAgICBwbGF5bGlzdCA9IHhibWMuUGxheUxpc3QoeGJtYy5QTEFZTElTVF9WSURFTykNCiAgICAgICAgI3ByaW50ICdtdV9wbGF5bGlzdCcsbXVfcGxheWxpc3QNCiAgICAgICAgaWYgJyQkTFNQbGF5T25seU9uZSQkJyBpbiBtdV9wbGF5bGlzdFswXToNCiAgICAgICAgICAgIG11X3BsYXlsaXN0WzBdPW11X3BsYXlsaXN0WzBdLnJlcGxhY2UoJyQkTFNQbGF5T25seU9uZSQkJywnJykNCiAgICAgICAgICAgIGltcG9ydCB1cmxwYXJzZQ0KICAgICAgICAgICAgbmFtZXMgPSBbXQ0KICAgICAgICAgICAgaWxvb3A9MA0KICAgICAgICAgICAgcHJvZ3Jlc3MgPSB4Ym1jZ3VpLkRpYWxvZ1Byb2dyZXNzKCkNCiAgICAgICAgICAgIHByb2dyZXNzLmNyZWF0ZSgnUHJvZ3Jlc3MnLCAnVHJ5aW5nIE11bHRpcGxlIExpbmtzJykNCiAgICAgICAgICAgIGZvciBpIGluIG11X3BsYXlsaXN0Og0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgaWYgJyQkbHNuYW1lPScgaW4gaToNCiAgICAgICAgICAgICAgICAgICAgZF9uYW1lPWkuc3BsaXQoJyQkbHNuYW1lPScpWzFdLnNwbGl0KCcmcmVnZXhzJylbMF0NCiAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKGRfbmFtZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbXVfcGxheWxpc3RbaWxvb3BdPWkuc3BsaXQoJyQkbHNuYW1lPScpWzBdKygnJnJlZ2V4cycraS5zcGxpdCgnJnJlZ2V4cycpWzFdIGlmICcmcmVnZXhzJyBpbiBpIGVsc2UgJycpICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBkX25hbWU9dXJscGFyc2UudXJscGFyc2UoaSkubmV0bG9jDQogICAgICAgICAgICAgICAgICAgIGlmIGRfbmFtZSA9PSAnJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChuYW1lKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKGRfbmFtZSkNCiAgICAgICAgICAgICAgICBpbmRleD1pbG9vcA0KICAgICAgICAgICAgICAgIGlsb29wKz0xDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcGxheW5hbWU9bmFtZXNbaW5kZXhdDQogICAgICAgICAgICAgICAgaWYgcHJvZ3Jlc3MuaXNjYW5jZWxlZCgpOiByZXR1cm4gDQogICAgICAgICAgICAgICAgcHJvZ3Jlc3MudXBkYXRlKCBpbG9vcC9sZW4obXVfcGxheWxpc3QpKjEwMCwiIiwgIkxpbmsjJWQiJShpbG9vcCkscGxheW5hbWUgICkNCiAgICAgICAgICAgICAgICBwcmludCAnYXV0byBwbGF5bmFtZXh4JyxwbGF5bmFtZQ0KICAgICAgICAgICAgICAgIGlmICImbW9kZT0xOSIgaW4gbXVfcGxheWxpc3RbaW5kZXhdOg0KICAgICAgICAgICAgICAgICAgICAgICAgI3BsYXlzZXRyZXNvbHZlZCAodXJsc29sdmVyKG11X3BsYXlsaXN0W2luZGV4XS5yZXBsYWNlKCcmbW9kZT0xOScsJycpKSxuYW1lLGljb25pbWFnZSxUcnVlKQ0KICAgICAgICAgICAgICAgICAgICBsaXogPSB4Ym1jZ3VpLkxpc3RJdGVtKHBsYXluYW1lLCBpY29uSW1hZ2U9aWNvbmltYWdlLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9J1ZpZGVvJywgaW5mb0xhYmVscz17J1RpdGxlJzpwbGF5bmFtZX0pDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiSXNQbGF5YWJsZSIsInRydWUiKQ0KICAgICAgICAgICAgICAgICAgICB1cmx0b3BsYXk9dXJsc29sdmVyKG11X3BsYXlsaXN0W2luZGV4XS5yZXBsYWNlKCcmbW9kZT0xOScsJycpLnJlcGxhY2UoJzsnLCcnKSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFBhdGgodXJsdG9wbGF5KQ0KICAgICAgICAgICAgICAgICAgICAjeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHRvcGxheSxsaXopDQogICAgICAgICAgICAgICAgICAgIHBsYXllZD10cnlwbGF5KHVybHRvcGxheSxsaXopDQogICAgICAgICAgICAgICAgZWxpZiAiJGRvcmVnZXgiIGluIG11X3BsYXlsaXN0W2luZGV4XSA6DQojICAgICAgICAgICAgICAgICAgICBwcmludCBtdV9wbGF5bGlzdFtpbmRleF0NCiAgICAgICAgICAgICAgICAgICAgc2VwYXRlID0gbXVfcGxheWxpc3RbaW5kZXhdLnNwbGl0KCcmcmVnZXhzPScpDQojICAgICAgICAgICAgICAgICAgICBwcmludCBzZXBhdGUNCiAgICAgICAgICAgICAgICAgICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQoc2VwYXRlWzFdLCBzZXBhdGVbMF0pDQogICAgICAgICAgICAgICAgICAgIHVybDIgPSB1cmwucmVwbGFjZSgnOycsJycpDQogICAgICAgICAgICAgICAgICAgIGxpeiA9IHhibWNndWkuTGlzdEl0ZW0ocGxheW5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0nVmlkZW8nLCBpbmZvTGFiZWxzPXsnVGl0bGUnOnBsYXluYW1lfSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCJJc1BsYXlhYmxlIiwidHJ1ZSIpDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQYXRoKHVybDIpDQogICAgICAgICAgICAgICAgICAgICN4Ym1jLlBsYXllcigpLnBsYXkodXJsMixsaXopDQogICAgICAgICAgICAgICAgICAgIHBsYXllZD10cnlwbGF5KHVybDIsbGl6KQ0KDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgdXJsID0gbXVfcGxheWxpc3RbaW5kZXhdDQogICAgICAgICAgICAgICAgICAgIHVybD11cmwuc3BsaXQoJyZyZWdleHM9JylbMF0NCiAgICAgICAgICAgICAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShwbGF5bmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSdWaWRlbycsIGluZm9MYWJlbHM9eydUaXRsZSc6cGxheW5hbWV9KQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoIklzUGxheWFibGUiLCJ0cnVlIikNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFBhdGgodXJsKQ0KICAgICAgICAgICAgICAgICAgICAjeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCxsaXopDQogICAgICAgICAgICAgICAgICAgIHBsYXllZD10cnlwbGF5KHVybCxsaXopDQogICAgICAgICAgICAgICAgICAgIHByaW50ICdwbGF5ZWQnLHBsYXllZA0KICAgICAgICAgICAgICAgIHByaW50ICdwbGF5ZWQnLHBsYXllZA0KICAgICAgICAgICAgICAgIGlmIHBsYXllZDogcmV0dXJuDQogICAgICAgICAgICByZXR1cm4gICAgIA0KICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhc2tfcGxheWxpc3RfaXRlbXMnKSA9PSAndHJ1ZScgYW5kIG5vdCBxdWV1ZVZpZGVvIDoNCiAgICAgICAgICAgIGltcG9ydCB1cmxwYXJzZQ0KICAgICAgICAgICAgbmFtZXMgPSBbXQ0KICAgICAgICAgICAgaWxvb3A9MA0KICAgICAgICAgICAgZm9yIGkgaW4gbXVfcGxheWxpc3Q6DQogICAgICAgICAgICAgICAgaWYgJyQkbHNuYW1lPScgaW4gaToNCiAgICAgICAgICAgICAgICAgICAgZF9uYW1lPWkuc3BsaXQoJyQkbHNuYW1lPScpWzFdLnNwbGl0KCcmcmVnZXhzJylbMF0NCiAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKGRfbmFtZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbXVfcGxheWxpc3RbaWxvb3BdPWkuc3BsaXQoJyQkbHNuYW1lPScpWzBdKygnJnJlZ2V4cycraS5zcGxpdCgnJnJlZ2V4cycpWzFdIGlmICcmcmVnZXhzJyBpbiBpIGVsc2UgJycpICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBkX25hbWU9dXJscGFyc2UudXJscGFyc2UoaSkubmV0bG9jDQogICAgICAgICAgICAgICAgICAgIGlmIGRfbmFtZSA9PSAnJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChuYW1lKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKGRfbmFtZSkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWxvb3ArPTENCiAgICAgICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkNCiAgICAgICAgICAgIGluZGV4ID0gZGlhbG9nLnNlbGVjdCgnQ2hvb3NlIGEgdmlkZW8gc291cmNlJywgbmFtZXMpDQogICAgICAgICAgICBpZiBpbmRleCA+PSAwOg0KICAgICAgICAgICAgICAgIHBsYXluYW1lPW5hbWVzW2luZGV4XQ0KICAgICAgICAgICAgICAgIHByaW50ICdwbGF5bmFtZXh4JyxwbGF5bmFtZQ0KICAgICAgICAgICAgICAgIGlmICImbW9kZT0xOSIgaW4gbXVfcGxheWxpc3RbaW5kZXhdOg0KICAgICAgICAgICAgICAgICAgICAgICAgI3BsYXlzZXRyZXNvbHZlZCAodXJsc29sdmVyKG11X3BsYXlsaXN0W2luZGV4XS5yZXBsYWNlKCcmbW9kZT0xOScsJycpKSxuYW1lLGljb25pbWFnZSxUcnVlKQ0KICAgICAgICAgICAgICAgICAgICBsaXogPSB4Ym1jZ3VpLkxpc3RJdGVtKHBsYXluYW1lLCBpY29uSW1hZ2U9aWNvbmltYWdlLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9J1ZpZGVvJywgaW5mb0xhYmVscz17J1RpdGxlJzpwbGF5bmFtZX0pDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiSXNQbGF5YWJsZSIsInRydWUiKQ0KICAgICAgICAgICAgICAgICAgICB1cmx0b3BsYXk9dXJsc29sdmVyKG11X3BsYXlsaXN0W2luZGV4XS5yZXBsYWNlKCcmbW9kZT0xOScsJycpLnJlcGxhY2UoJzsnLCcnKSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFBhdGgodXJsdG9wbGF5KQ0KICAgICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsdG9wbGF5LGxpeikNCiAgICAgICAgICAgICAgICBlbGlmICIkZG9yZWdleCIgaW4gbXVfcGxheWxpc3RbaW5kZXhdIDoNCiMgICAgICAgICAgICAgICAgICAgIHByaW50IG11X3BsYXlsaXN0W2luZGV4XQ0KICAgICAgICAgICAgICAgICAgICBzZXBhdGUgPSBtdV9wbGF5bGlzdFtpbmRleF0uc3BsaXQoJyZyZWdleHM9JykNCiMgICAgICAgICAgICAgICAgICAgIHByaW50IHNlcGF0ZQ0KICAgICAgICAgICAgICAgICAgICB1cmwsc2V0cmVzb2x2ZWQgPSBnZXRSZWdleFBhcnNlZChzZXBhdGVbMV0sIHNlcGF0ZVswXSkNCiAgICAgICAgICAgICAgICAgICAgdXJsMiA9IHVybC5yZXBsYWNlKCc7JywnJykNCiAgICAgICAgICAgICAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShwbGF5bmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSdWaWRlbycsIGluZm9MYWJlbHM9eydUaXRsZSc6cGxheW5hbWV9KQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoIklzUGxheWFibGUiLCJ0cnVlIikNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFBhdGgodXJsMikNCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybDIsbGl6KQ0KDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgdXJsID0gbXVfcGxheWxpc3RbaW5kZXhdDQogICAgICAgICAgICAgICAgICAgIHVybD11cmwuc3BsaXQoJyZyZWdleHM9JylbMF0NCiAgICAgICAgICAgICAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShwbGF5bmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSdWaWRlbycsIGluZm9MYWJlbHM9eydUaXRsZSc6cGxheW5hbWV9KQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoIklzUGxheWFibGUiLCJ0cnVlIikNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFBhdGgodXJsKQ0KICAgICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsLGxpeikNCiAgICAgICAgZWxpZiBub3QgcXVldWVWaWRlbzoNCiAgICAgICAgICAgICNwbGF5bGlzdCA9IHhibWMuUGxheUxpc3QoMSkgIyAxIG1lYW5zIHZpZGVvDQogICAgICAgICAgICBwbGF5bGlzdC5jbGVhcigpDQogICAgICAgICAgICBpdGVtID0gMA0KICAgICAgICAgICAgZm9yIGkgaW4gbXVfcGxheWxpc3Q6DQogICAgICAgICAgICAgICAgaXRlbSArPSAxDQogICAgICAgICAgICAgICAgaW5mbyA9IHhibWNndWkuTGlzdEl0ZW0oJyVzKSAlcycgJShzdHIoaXRlbSksbmFtZSkpDQogICAgICAgICAgICAgICAgIyBEb24ndCBkbyB0aGlzIGFzIHJlZ2V4IHBhcnNlZCBtaWdodCB0YWtlIGxvbmdlcg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgaWYgIiRkb3JlZ2V4IiBpbiBpOg0KICAgICAgICAgICAgICAgICAgICAgICAgc2VwYXRlID0gaS5zcGxpdCgnJnJlZ2V4cz0nKQ0KIyAgICAgICAgICAgICAgICAgICAgICAgIHByaW50IHNlcGF0ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQoc2VwYXRlWzFdLCBzZXBhdGVbMF0pDQogICAgICAgICAgICAgICAgICAgIGVsaWYgIiZtb2RlPTE5IiBpbiBpOg0KICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsc29sdmVyKGkucmVwbGFjZSgnJm1vZGU9MTknLCcnKS5yZXBsYWNlKCc7JywnJykpICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmIHVybDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFkZCh1cmwsIGluZm8pDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFkZChpLCBpbmZvKQ0KICAgICAgICAgICAgICAgICAgICBwYXNzICN4Ym1jLlBsYXllcigpLnBsYXkodXJsKQ0KDQogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdwbGF5bGlzdC5wbGF5b2Zmc2V0KHZpZGVvLDApJykNCiAgICAgICAgZWxzZToNCg0KICAgICAgICAgICAgICAgIGxpc3RpdGVtID0geGJtY2d1aS5MaXN0SXRlbShuYW1lKQ0KICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFkZChtdV9wbGF5bGlzdCwgbGlzdGl0ZW0pDQoNCg0KZGVmIGRvd25sb2FkX2ZpbGUobmFtZSwgdXJsKToNCiAgICAgICAgDQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKSA9PSAiIjoNCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKCdJTlNPTU5JQScsJ0Nob29zZSBhIGxvY2F0aW9uIHRvIHNhdmUgZmlsZXMuJywxNTAwMCwiK2ljb24rIikiKQ0KICAgICAgICAgICAgYWRkb24ub3BlblNldHRpbmdzKCkNCiAgICAgICAgcGFyYW1zID0geyd1cmwnOiB1cmwsICdkb3dubG9hZF9wYXRoJzogYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpfQ0KICAgICAgICBkb3dubG9hZGVyLmRvd25sb2FkKG5hbWUsIHBhcmFtcykNCiAgICAgICAgZGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQ0KICAgICAgICByZXQgPSBkaWFsb2cueWVzbm8oJ0lOU09NTklBJywgJ0RvIHlvdSB3YW50IHRvIGFkZCB0aGlzIGZpbGUgYXMgYSBzb3VyY2U/JykNCiAgICAgICAgaWYgcmV0Og0KICAgICAgICAgICAgYWRkU291cmNlKG9zLnBhdGguam9pbihhZGRvbi5nZXRTZXR0aW5nKCdzYXZlX2xvY2F0aW9uJyksIG5hbWUpKQ0KDQpkZWYgX3NlYXJjaCh1cmwsbmFtZSk6DQogICAjIHByaW50IHVybCxuYW1lDQogICAgcGx1Z2luc2VhcmNodXJscyA9IFsncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmdlbmVzaXMvP2FjdGlvbj1zaG93c19zZWFyY2gnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmdlbmVzaXMvP2FjdGlvbj1tb3ZpZXNfc2VhcmNoJyxcDQogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5zYWx0cy8/bW9kZT1zZWFyY2gmYW1wO3NlY3Rpb249TW92aWVzJyxcDQogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5zYWx0cy8/bW9kZT1zZWFyY2gmYW1wO3NlY3Rpb249VFYnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLm11Y2htb3ZpZXMuaGQvP2FjdGlvbj1tb3ZpZXNfc2VhcmNoJyxcDQogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby52aW9vei5jby8/YWN0aW9uPXJvb3Rfc2VhcmNoJyxcDQogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5vcm9yb3R2Lz9hY3Rpb249c2hvd3Nfc2VhcmNoJyxcDQogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby55aWZ5bW92aWVzLmhkLz9hY3Rpb249bW92aWVzX3NlYXJjaCcsXA0KICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uY2FydG9vbmhkdHdvLz9kZXNjcmlwdGlvbiZhbXA7ZmFuYXJ0JmFtcDtpY29uaW1hZ2UmYW1wO21vZGU9MyZhbXA7bmFtZT1TZWFyY2gmYW1wO3VybD11cmwnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUva29kaW9uL3NlYXJjaC9saXN0LycsXA0KICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZGFpbHltb3Rpb25fY29tLz9tb2RlPXNlYXJjaCZhbXA7dXJsJyxcDQogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby52aW1lby9rb2Rpb24vc2VhcmNoL2xpc3QvJ1wNCiAgICAgICAgICAgICBdDQogICAgbmFtZXMgPSBbJ0dlbnNpcyBUVicsJ0dlbmVzaXMgTW92aWUnLCdTYWx0IG1vdmllJywnc2FsdCBUVicsJ011Y2htb3ZpZXMnLCd2aW9veicsJ09Sb3JvVFYnLFwNCiAgICAgICAgICAgICAnWWlmeW1vdmllcycsJ2NhcnRvb25IRCcsJ1lvdXR1YmUnLCdEYWlseU1vdGlvbicsJ1ZpbWVvJ10NCiAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpDQogICAgaW5kZXggPSBkaWFsb2cuc2VsZWN0KCdDaG9vc2UgYSB2aWRlbyBzb3VyY2UnLCBuYW1lcykNCg0KICAgIGlmIGluZGV4ID49IDA6DQogICAgICAgIHVybCA9IHBsdWdpbnNlYXJjaHVybHNbaW5kZXhdDQojICAgICAgICBwcmludCAndXJsJyx1cmwNCiAgICAgICAgcGx1Z2lucXVlcnlieUpTT04odXJsKQ0KDQpkZWYgYWRkRGlyKG5hbWUsdXJsLG1vZGUsaWNvbmltYWdlLGZhbmFydCxkZXNjcmlwdGlvbixnZW5yZSxkYXRlLGNyZWRpdHMsc2hvd2NvbnRleHQ9RmFsc2UscmVnZXhzPU5vbmUscmVnX3VybD1Ob25lLGFsbGluZm89e30pOg0KDQoNCg0KICAgICAgICBpZiByZWdleHMgYW5kIGxlbihyZWdleHMpPjA6DQogICAgICAgICAgICB1PXN5cy5hcmd2WzBdKyI/dXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9IitzdHIobW9kZSkrIiZuYW1lPSIrdXJsbGliLnF1b3RlX3BsdXMobmFtZSkrIiZmYW5hcnQ9Iit1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpKyImcmVnZXhzPSIrcmVnZXhzDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICB1PXN5cy5hcmd2WzBdKyI/dXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9IitzdHIobW9kZSkrIiZuYW1lPSIrdXJsbGliLnF1b3RlX3BsdXMobmFtZSkrIiZmYW5hcnQ9Iit1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpDQogICAgICAgIA0KICAgICAgICBvaz1UcnVlDQogICAgICAgIGlmIGRhdGUgPT0gJyc6DQogICAgICAgICAgICBkYXRlID0gTm9uZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gJ1xuXG5EYXRlOiAlcycgJWRhdGUNCiAgICAgICAgbGl6PXhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPSJEZWZhdWx0Rm9sZGVyLnBuZyIsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkNCiAgICAgICAgaWYgbGVuKGFsbGluZm8pIDwxIDoNCiAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUsICJQbG90IjogZGVzY3JpcHRpb24sICJHZW5yZSI6IGdlbnJlLCAiZGF0ZWFkZGVkIjogZGF0ZSwgImNyZWRpdHMiOiBjcmVkaXRzIH0pDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9IGFsbGluZm8pDQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiRmFuYXJ0X0ltYWdlIiwgZmFuYXJ0KQ0KICAgICAgICBpZiBzaG93Y29udGV4dDoNCiAgICAgICAgICAgIGNvbnRleHRNZW51ID0gW10NCiAgICAgICAgICAgIHBhcmVudGFsYmxvY2sgPWFkZG9uLmdldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZCcpDQogICAgICAgICAgICBwYXJlbnRhbGJsb2NrPSBwYXJlbnRhbGJsb2NrPT0idHJ1ZSINCiAgICAgICAgICAgIHBhcmVudGFsYmxvY2tlZHBpbiA9YWRkb24uZ2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkcGluJykNCiMgICAgICAgICAgICBwcmludCAncGFyZW50YWxibG9ja2VkcGluJyxwYXJlbnRhbGJsb2NrZWRwaW4NCiAgICAgICAgICAgIGlmIGxlbihwYXJlbnRhbGJsb2NrZWRwaW4pPjA6DQogICAgICAgICAgICAgICAgaWYgcGFyZW50YWxibG9jazoNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnQWN0aXZhciB6b25hIFByZW1pdW0nLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTU1Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0Rlc2FjdGl2YXIgem9uYSBQcmVtaXVtJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT01NiZuYW1lPSVzKScgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICBpZiBzaG93Y29udGV4dCA9PSAnc291cmNlJzoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIG5hbWUgaW4gc3RyKFNPVVJDRVMpOg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdSZW1vdmUgZnJvbSBTb3VyY2VzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT04Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICBlbGlmIHNob3djb250ZXh0ID09ICdkb3dubG9hZCc6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnRG93bmxvYWQnLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT05Jm5hbWU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgICAgIGVsaWYgc2hvd2NvbnRleHQgPT0gJ2Zhdic6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnQm9ycmFyIGRlIEZhdm9yaXRvcyBJTlNPTU5JQScsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NiZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgICAgICBpZiBzaG93Y29udGV4dCA9PSAnISF1cGRhdGUnOg0KICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMyID0gKA0KICAgICAgICAgICAgICAgICAgICAnJXM/dXJsPSVzJm1vZGU9MTcmcmVnZXhzPSVzJw0KICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhyZWdfdXJsKSwgcmVnZXhzKQ0KICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIGdyZWVuXVNlIG1vZGlmaWNvIG1vZG8gcHJlbWl1bVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXMpJyAlZmF2X3BhcmFtczIpKQ0KICAgICAgICAgICAgaWYgbm90IG5hbWUgaW4gRkFWOg0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0FncmVnYXIgYSBGYXZvcml0b3MgZGUgSU5TT01OSUEnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTUmbmFtZT0lcyZ1cmw9JXMmaWNvbmltYWdlPSVzJmZhbmFydD0lcyZmYXZfbW9kZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZSksIHVybGxpYi5xdW90ZV9wbHVzKGZhbmFydCksIG1vZGUpKSkNCiAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51KQ0KICAgICAgICBvaz14Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksdXJsPXUsbGlzdGl0ZW09bGl6LGlzRm9sZGVyPVRydWUpDQogICAgICAgIHJldHVybiBvaw0KZGVmIHl0ZGxfZG93bmxvYWQodXJsLHRpdGxlLG1lZGlhX3R5cGU9J3ZpZGVvJyk6DQogICAgIyBwbGF5IGluIHhibWMgd2hpbGUgcGxheWluZyBnbyBiYWNrIHRvIGNvbnRleHRNZW51KGMpIHRvICIhIURvd25sb2FkISEiDQogICAgIyBUcmlhbCB5YXNjZWVuOiBzZXBlcmF0ZSB8VXNlci1BZ2VudD0NCiAgICBpbXBvcnQgeW91dHViZWRsDQogICAgDQogICAgaWYgbm90IHVybCA9PSAnJzoNCiAgICAgICAgaWYgbWVkaWFfdHlwZT09ICdhdWRpbyc6DQogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKHVybCxkb3dubG9hZD1UcnVlLGF1ZGlvPVRydWUpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKHVybCxkb3dubG9hZD1UcnVlKQ0KICAgIGVsaWYgeGJtYy5QbGF5ZXIoKS5pc1BsYXlpbmcoKSA9PSBUcnVlIDoNCiAgICAgICAgaW1wb3J0IFlEU3RyZWFtRXh0cmFjdG9yDQogICAgICAgIGlmIFlEU3RyZWFtRXh0cmFjdG9yLmlzRG93bmxvYWRpbmcoKSA9PSBUcnVlOg0KDQogICAgICAgICAgICBZRFN0cmVhbUV4dHJhY3Rvci5tYW5hZ2VEb3dubG9hZHMoKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgeGJtY191cmwgPSB4Ym1jLlBsYXllcigpLmdldFBsYXlpbmdGaWxlKCkNCg0KICAgICAgICAgICAgeGJtY191cmwgPSB4Ym1jX3VybC5zcGxpdCgnfFVzZXItQWdlbnQ9JylbMF0NCiAgICAgICAgICAgIGluZm8gPSB7J3VybCc6eGJtY191cmwsJ3RpdGxlJzp0aXRsZSwnbWVkaWFfdHlwZSc6bWVkaWFfdHlwZX0NCiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQoJycsZG93bmxvYWQ9VHJ1ZSxkbF9pbmZvPWluZm8pDQogICAgZWxzZToNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oRE9XTkxPQUQsRmlyc3QgUGxheSBbQ09MT1IgeWVsbG93XVdISUxFIHBsYXlpbmcgZG93bmxvYWRbL0NPTE9SXSAsMTAwMDApIikNCg0KIyMgTHVuYXRpeHogUHNldWRvVFYgZmVhdHVyZQ0KZGVmIGFzY2lpKHN0cmluZyk6DQogICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIGJhc2VzdHJpbmcpOg0KICAgICAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgdW5pY29kZSk6DQogICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5lbmNvZGUoJ2FzY2lpJywgJ2lnbm9yZScpDQogICAgcmV0dXJuIHN0cmluZw0KZGVmIHVuaShzdHJpbmcsIGVuY29kaW5nID0gJ3V0Zi04Jyk6DQogICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIGJhc2VzdHJpbmcpOg0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShzdHJpbmcsIHVuaWNvZGUpOg0KICAgICAgICAgICAgc3RyaW5nID0gdW5pY29kZShzdHJpbmcsIGVuY29kaW5nLCAnaWdub3JlJykNCiAgICByZXR1cm4gc3RyaW5nDQpkZWYgcmVtb3ZlTm9uQXNjaWkocyk6IHJldHVybiAiIi5qb2luKGZpbHRlcihsYW1iZGEgeDogb3JkKHgpPDEyOCwgcykpDQoNCmRlZiBzZW5kSlNPTiggY29tbWFuZCk6DQogICAgZGF0YSA9ICcnDQogICAgdHJ5Og0KICAgICAgICBkYXRhID0geGJtYy5leGVjdXRlSlNPTlJQQyh1bmkoY29tbWFuZCkpDQogICAgZXhjZXB0IFVuaWNvZGVFbmNvZGVFcnJvcjoNCiAgICAgICAgZGF0YSA9IHhibWMuZXhlY3V0ZUpTT05SUEMoYXNjaWkoY29tbWFuZCkpDQoNCiAgICByZXR1cm4gdW5pKGRhdGEpDQoNCmRlZiBwbHVnaW5xdWVyeWJ5SlNPTih1cmwsZ2l2ZV9tZV9yZXN1bHQ9Tm9uZSxwbGF5bGlzdD1GYWxzZSk6DQogICAgaWYgJ2F1ZGlvJyBpbiB1cmw6DQogICAgICAgIGpzb25fcXVlcnkgPSB1bmkoJ3sianNvbnJwYyI6IjIuMCIsIm1ldGhvZCI6IkZpbGVzLkdldERpcmVjdG9yeSIsInBhcmFtcyI6IHsiZGlyZWN0b3J5IjoiJXMiLCJtZWRpYSI6InZpZGVvIiwgInByb3BlcnRpZXMiOiBbInRpdGxlIiwgImFsYnVtIiwgImFydGlzdCIsICJkdXJhdGlvbiIsInRodW1ibmFpbCIsICJ5ZWFyIl19LCAiaWQiOiAxfScpICV1cmwNCiAgICBlbHNlOg0KICAgICAgICBqc29uX3F1ZXJ5ID0gdW5pKCd7Impzb25ycGMiOiIyLjAiLCJtZXRob2QiOiJGaWxlcy5HZXREaXJlY3RvcnkiLCJwYXJhbXMiOnsiZGlyZWN0b3J5IjoiJXMiLCJtZWRpYSI6InZpZGVvIiwicHJvcGVydGllcyI6WyAicGxvdCIsInBsYXljb3VudCIsImRpcmVjdG9yIiwgImdlbnJlIiwidm90ZXMiLCJkdXJhdGlvbiIsInRyYWlsZXIiLCJwcmVtaWVyZWQiLCJ0aHVtYm5haWwiLCJ0aXRsZSIsInllYXIiLCJkYXRlYWRkZWQiLCJmYW5hcnQiLCJyYXRpbmciLCJzZWFzb24iLCJlcGlzb2RlIiwic3R1ZGlvIiwibXBhYSJdfSwiaWQiOjF9JykgJXVybA0KICAgIGpzb25fZm9sZGVyX2RldGFpbCA9IGpzb24ubG9hZHMoc2VuZEpTT04oanNvbl9xdWVyeSkpDQogICAgI3ByaW50IGpzb25fZm9sZGVyX2RldGFpbA0KICAgIGlmIGdpdmVfbWVfcmVzdWx0Og0KICAgICAgICByZXR1cm4ganNvbl9mb2xkZXJfZGV0YWlsDQogICAgaWYganNvbl9mb2xkZXJfZGV0YWlsLmhhc19rZXkoJ2Vycm9yJyk6DQogICAgICAgIHJldHVybg0KICAgIGVsc2U6DQoNCiAgICAgICAgZm9yIGkgaW4ganNvbl9mb2xkZXJfZGV0YWlsWydyZXN1bHQnXVsnZmlsZXMnXSA6DQogICAgICAgICAgICBtZXRhID17fQ0KICAgICAgICAgICAgdXJsID0gaVsnZmlsZSddDQogICAgICAgICAgICBuYW1lID0gcmVtb3ZlTm9uQXNjaWkoaVsnbGFiZWwnXSkNCiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlbW92ZU5vbkFzY2lpKGlbJ3RodW1ibmFpbCddKQ0KICAgICAgICAgICAgZmFuYXJ0ID0gcmVtb3ZlTm9uQXNjaWkoaVsnZmFuYXJ0J10pDQogICAgICAgICAgICBtZXRhID0gZGljdCgoayx2KSBmb3IgaywgdiBpbiBpLml0ZXJpdGVtcygpIGlmIG5vdCB2ID09ICcwJyBvciBub3QgdiA9PSAtMSBvciB2ID09ICcnKQ0KICAgICAgICAgICAgbWV0YS5wb3AoImZpbGUiLCBOb25lKQ0KICAgICAgICAgICAgaWYgaVsnZmlsZXR5cGUnXSA9PSAnZmlsZSc6DQogICAgICAgICAgICAgICAgaWYgcGxheWxpc3Q6DQogICAgICAgICAgICAgICAgICAgIHBsYXlfcGxheWxpc3QobmFtZSx1cmwscXVldWVWaWRlbz0nMScpDQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgYWRkTGluayh1cmwsbmFtZSx0aHVtYm5haWwsZmFuYXJ0LCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWw9bGVuKGpzb25fZm9sZGVyX2RldGFpbFsncmVzdWx0J11bJ2ZpbGVzJ10pLGFsbGluZm89bWV0YSkNCiAgICAgICAgICAgICAgICAgICAgI3hibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MDApIikNCiAgICAgICAgICAgICAgICAgICAgaWYgaVsndHlwZSddIGFuZCBpWyd0eXBlJ10gPT0gJ3R2c2hvdycgOg0KICAgICAgICAgICAgICAgICAgICAgICAgeGJtY3BsdWdpbi5zZXRDb250ZW50KGludChzeXMuYXJndlsxXSksICd0dnNob3dzJykNCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpWydlcGlzb2RlJ10gPiAwIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHhibWNwbHVnaW4uc2V0Q29udGVudChpbnQoc3lzLmFyZ3ZbMV0pLCAnZXBpc29kZXMnKQ0KDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCw1Myx0aHVtYm5haWwsZmFuYXJ0LCcnLCcnLCcnLCcnLGFsbGluZm89bWV0YSkNCiAgICAgICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQpkZWYgYWRkTGluayh1cmwsbmFtZSxpY29uaW1hZ2UsZmFuYXJ0LGRlc2NyaXB0aW9uLGdlbnJlLGRhdGUsc2hvd2NvbnRleHQscGxheWxpc3QscmVnZXhzLHRvdGFsLHNldENvb2tpZT0iIixhbGxpbmZvPXt9KToNCiAgICAgICAgI3ByaW50ICd1cmwsbmFtZScsdXJsLG5hbWUsaWNvbmltYWdlDQogICAgICAgIGNvbnRleHRNZW51ID1bXQ0KICAgICAgICBwYXJlbnRhbGJsb2NrID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWQnKQ0KICAgICAgICBwYXJlbnRhbGJsb2NrPSBwYXJlbnRhbGJsb2NrPT0idHJ1ZSINCiAgICAgICAgcGFyZW50YWxibG9ja2VkcGluID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWRwaW4nKQ0KIyAgICAgICAgcHJpbnQgJ3BhcmVudGFsYmxvY2tlZHBpbicscGFyZW50YWxibG9ja2VkcGluDQogICAgICAgIGlmIGxlbihwYXJlbnRhbGJsb2NrZWRwaW4pPjA6DQogICAgICAgICAgICBpZiBwYXJlbnRhbGJsb2NrOg0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0FjdGl2YXIgbW9kbyBwcmVtaXVtJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT01NSZuYW1lPSVzKScgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnRGVzYWN0aXZhciBtb2RvIHByZW1pdW0nLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTU2Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgbmFtZSA9IG5hbWUuZW5jb2RlKCd1dGYtOCcpDQogICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICBvayA9IFRydWUNCiAgICAgICAgaXNGb2xkZXI9RmFsc2UNCiAgICAgICAgaWYgcmVnZXhzOg0KICAgICAgICAgICAgbW9kZSA9ICcxNycNCiAgICAgICAgICAgIGlmICdsaXN0cmVwZWF0JyBpbiByZWdleHM6DQogICAgICAgICAgICAgICAgaXNGb2xkZXI9VHJ1ZQ0KIyAgICAgICAgICAgICAgICBwcmludCAnc2V0dGluZyBhcyBmb2xkZXIgaW4gbGluaycNCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkIEN1cnJlbnRseSBQbGF5aW5nISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIxJm5hbWU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgZWxpZiAgKGFueSh4IGluIHVybCBmb3IgeCBpbiByZXNvbHZlX3VybCkgYW5kICB1cmwuc3RhcnRzd2l0aCgnaHR0cCcpKSBvciB1cmwuZW5kc3dpdGgoJyZtb2RlPTE5Jyk6DQogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyZtb2RlPTE5JywnJykNCiAgICAgICAgICAgIG1vZGUgPSAnMTknDQogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCBDdXJyZW50bHkgUGxheWluZyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgIGVsaWYgdXJsLmVuZHN3aXRoKCcmbW9kZT0xOCcpOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCcmbW9kZT0xOCcsJycpDQogICAgICAgICAgICBtb2RlID0gJzE4Jw0KICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQhIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjMmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnZGxhdWRpb29ubHknKSA9PSAndHJ1ZSc6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnISFEb3dubG9hZCBbQ09MT1Igc2VhYmx1ZV1BdWRpbyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yNCZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICBlbGlmIHVybC5zdGFydHN3aXRoKCdtYWduZXQ6P3h0PScpOg0KICAgICAgICAgICAgaWYgJyYnIGluIHVybCBhbmQgbm90ICcmYW1wOycgaW4gdXJsIDoNCiAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgnJicsJyZhbXA7JykNCiAgICAgICAgICAgIHVybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL3BsYXk/dXJpPScgKyB1cmwNCiAgICAgICAgICAgIG1vZGUgPSAnMTInDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBtb2RlID0gJzEyJw0KICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICBpZiAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/dmlkZW9faWQ9JyBpbiB1cmw6DQogICAgICAgICAgICAgIHl0X2F1ZGlvX3VybCA9IHVybC5yZXBsYWNlKCdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz92aWRlb19pZD0nLCdodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PScpDQogICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJyEhRG93bmxvYWQgW0NPTE9SIGJsdWVdQXVkaW8hIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjQmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHl0X2F1ZGlvX3VybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgIHU9c3lzLmFyZ3ZbMF0rIj8iDQogICAgICAgIHBsYXlfbGlzdCA9IEZhbHNlDQogICAgICAgIGlmIHBsYXlsaXN0Og0KICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYWRkX3BsYXlsaXN0JykgPT0gImZhbHNlIiBhbmQgJyQkTFNQbGF5T25seU9uZSQkJyBub3QgaW4gcGxheWxpc3RbMF0gOg0KICAgICAgICAgICAgICAgIHUgKz0gInVybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrbW9kZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICB1ICs9ICJtb2RlPTEzJm5hbWU9JXMmcGxheWxpc3Q9JXMiICUodXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpKQ0KICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICsgJ1tDT0xPUiBtYWdlbnRhXSAoJyArIHN0cihsZW4ocGxheWxpc3QpKSArICcgaXRlbXMgKVsvQ09MT1JdJw0KICAgICAgICAgICAgICAgIHBsYXlfbGlzdCA9IFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHUgKz0gInVybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrbW9kZQ0KICAgICAgICBpZiByZWdleHM6DQogICAgICAgICAgICB1ICs9ICImcmVnZXhzPSIrcmVnZXhzDQogICAgICAgIGlmIG5vdCBzZXRDb29raWUgPT0gJyc6DQogICAgICAgICAgICB1ICs9ICImc2V0Q29va2llPSIrdXJsbGliLnF1b3RlX3BsdXMoc2V0Q29va2llKQ0KICAgICAgICBpZiBpY29uaW1hZ2UgYW5kICBub3QgaWNvbmltYWdlID09ICcnOg0KICAgICAgICAgICAgdSArPSAiJmljb25pbWFnZT0iK3VybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZSkNCiAgICAgICAgICAgIA0KICAgICAgICBpZiBkYXRlID09ICcnOg0KICAgICAgICAgICAgZGF0ZSA9IE5vbmUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICdcblxuRGF0ZTogJXMnICVkYXRlDQogICAgICAgIGxpej14Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT0iRGVmYXVsdFZpZGVvLnBuZyIsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkNCiAgICAgICAgI2lmIGlzRm9sZGVyOg0KICAgICAgICBpZiBhbGxpbmZvPT1Ob25lIG9yIGxlbihhbGxpbmZvKSA8MToNCiAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUsICJQbG90IjogZGVzY3JpcHRpb24sICJHZW5yZSI6IGdlbnJlLCAiZGF0ZWFkZGVkIjogZGF0ZSB9KQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPWFsbGluZm8pDQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiRmFuYXJ0X0ltYWdlIiwgZmFuYXJ0KQ0KICAgICAgICANCiAgICAgICAgaWYgKG5vdCBwbGF5X2xpc3QpIGFuZCBub3QgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpIGFuZCBub3QgJyRQTEFZRVJQUk9YWSQ9JyBpbiB1cmw6IyAgKG5vdCB1cmwuc3RhcnRzd2l0aCgncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3RlcicpKToNCiAgICAgICAgICAgIGlmIHJlZ2V4czoNCiAgICAgICAgICAgICAgICAjcHJpbnQgdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpDQogICAgICAgICAgICAgICAgaWYgJyRweUZ1bmN0aW9uOnBsYXltZWRpYSgnIG5vdCBpbiB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cykgYW5kICdub3RwbGF5YWJsZScgbm90IGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSBhbmQgJ2xpc3RyZXBlYXQnIG5vdCBpbiAgdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpIDoNCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdzZXR0aW5nIGlzcGxheWFibGUnLHVybCwgdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpLHVybA0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoJ0lzUGxheWFibGUnLCAndHJ1ZScpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgnSXNQbGF5YWJsZScsICd0cnVlJykNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGFkZG9uX2xvZyggJ05PVCBzZXR0aW5nIGlzcGxheWFibGUnK3VybCkNCiAgICAgICAgaWYgc2hvd2NvbnRleHQ6DQogICAgICAgICAgICAjY29udGV4dE1lbnUgPSBbXQ0KICAgICAgICAgICAgaWYgc2hvd2NvbnRleHQgPT0gJ2Zhdic6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKA0KICAgICAgICAgICAgICAgICAgICAoJ0JvcnJhZG8gZGUgRmF2b3J0aXRvcyBkZSBJTlNPTU5JQScsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NiZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkNCiAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgIGVsaWYgbm90IG5hbWUgaW4gRkFWOg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgZmF2X3BhcmFtcyA9ICgNCiAgICAgICAgICAgICAgICAgICAgICAgICclcz9tb2RlPTUmbmFtZT0lcyZ1cmw9JXMmaWNvbmltYWdlPSVzJmZhbmFydD0lcyZmYXZfbW9kZT0wJw0KICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZSksIHVybGxpYi5xdW90ZV9wbHVzKGZhbmFydCkpDQogICAgICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBmYXZfcGFyYW1zID0gKA0KICAgICAgICAgICAgICAgICAgICAgICAgJyVzP21vZGU9NSZuYW1lPSVzJnVybD0lcyZpY29uaW1hZ2U9JXMmZmFuYXJ0PSVzJmZhdl9tb2RlPTAnDQogICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMoaWNvbmltYWdlLmVuY29kZSgidXRmLTgiKSksIHVybGxpYi5xdW90ZV9wbHVzKGZhbmFydC5lbmNvZGUoInV0Zi04IikpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIGlmIHBsYXlsaXN0Og0KICAgICAgICAgICAgICAgICAgICBmYXZfcGFyYW1zICs9ICdwbGF5bGlzdD0nK3VybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpDQogICAgICAgICAgICAgICAgaWYgcmVnZXhzOg0KICAgICAgICAgICAgICAgICAgICBmYXZfcGFyYW1zICs9ICImcmVnZXhzPSIrcmVnZXhzDQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnQWdyZWdhciBhIGZhdm9yaXRvcyBkZSBJTlNPTU5JQScsJ1hCTUMuUnVuUGx1Z2luKCVzKScgJWZhdl9wYXJhbXMpKQ0KICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnUpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIG5vdCBwbGF5bGlzdCBpcyBOb25lOg0KICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSI6DQogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0X25hbWUgPSBuYW1lLnNwbGl0KCcpICcpWzFdDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51XyA9IFsNCiAgICAgICAgICAgICAgICAgICAgICAgICgnUGxheSAnK3BsYXlsaXN0X25hbWUrJyBQbGF5TGlzdCcsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9MTMmbmFtZT0lcyZwbGF5bGlzdD0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMocGxheWxpc3RfbmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51XykNCiAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICNwcmludCAnYWRkaW5nJyxuYW1lDQogICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9dSxsaXN0aXRlbT1saXosdG90YWxJdGVtcz10b3RhbCxpc0ZvbGRlcj1pc0ZvbGRlcikNCg0KICAgICAgICAjcHJpbnQgJ2FkZGVkJyxuYW1lDQogICAgICAgIHJldHVybiBvaw0KDQogICAgICAgIA0KZGVmIHBsYXlzZXRyZXNvbHZlZCh1cmwsbmFtZSxpY29uaW1hZ2Usc2V0cmVzb2x2ZWQ9VHJ1ZSxyZWc9Tm9uZSk6DQogICAgcHJpbnQgJ3BsYXlzZXRyZXNvbHZlZCcsdXJsLHNldHJlc29sdmVkDQogICAgaWYgdXJsPT1Ob25lOiANCiAgICAgICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KICAgICAgICByZXR1cm4NCiAgICBpZiBzZXRyZXNvbHZlZDoNCiAgICAgICAgc2V0cmVzPVRydWUNCiAgICAgICAgaWYgJyQkTFNEaXJlY3QkJCcgaW4gdXJsOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckJExTRGlyZWN0JCQnLCcnKQ0KICAgICAgICAgICAgc2V0cmVzPUZhbHNlDQogICAgICAgIGlmIHJlZyBhbmQgJ25vdHBsYXlhYmxlJyBpbiByZWc6DQogICAgICAgICAgICBzZXRyZXM9RmFsc2UNCg0KICAgICAgICBsaXogPSB4Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkNCiAgICAgICAgbGl6LnNldEluZm8odHlwZT0nVmlkZW8nLCBpbmZvTGFiZWxzPXsnVGl0bGUnOm5hbWV9KQ0KICAgICAgICBsaXouc2V0UHJvcGVydHkoIklzUGxheWFibGUiLCJ0cnVlIikNCiAgICAgICAgbGl6LnNldFBhdGgodXJsKQ0KICAgICAgICBpZiBub3Qgc2V0cmVzOg0KICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHhibWNwbHVnaW4uc2V0UmVzb2x2ZWRVcmwoaW50KHN5cy5hcmd2WzFdKSwgVHJ1ZSwgbGl6KQ0KICAgICAgICAgICANCiAgICBlbHNlOg0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdYQk1DLlJ1blBsdWdpbignK3VybCsnKScpDQoNCg0KIyMgVGhhbmtzIHRvIGRhc2NoYWNrYSwgYW4gZXBnIHNjcmFwZXIgZm9yIGh0dHA6Ly9pLnRlbGVib3kuY2gvcHJvZ3JhbW0vc3RhdGlvbl9zZWxlY3QucGhwDQojIyAgaHR0cDovL2ZvcnVtLnhibWMub3JnL3Bvc3QucGhwP3A9OTM2MjI4JnBvc3Rjb3VudD0xMDc2DQpkZWYgZ2V0ZXBnKGxpbmspOg0KICAgICAgICB1cmw9dXJsbGliLnVybG9wZW4obGluaykNCiAgICAgICAgc291cmNlPXVybC5yZWFkKCkNCiAgICAgICAgdXJsLmNsb3NlKCkNCiAgICAgICAgc291cmNlMiA9IHNvdXJjZS5zcGxpdCgiSmV0enQiKQ0KICAgICAgICBzb3VyY2UzID0gc291cmNlMlsxXS5zcGxpdCgncHJvZ3JhbW0vZGV0YWlsLnBocD9jb25zdF9pZD0nKQ0KICAgICAgICBzb3VyY2V1aHJ6ZWl0ID0gc291cmNlM1sxXS5zcGxpdCgnPGJyIC8+PGEgaHJlZj0iLycpDQogICAgICAgIG5vd3RpbWUgPSBzb3VyY2V1aHJ6ZWl0WzBdWzQwOmxlbihzb3VyY2V1aHJ6ZWl0WzBdKV0NCiAgICAgICAgc291cmNldGl0bGUgPSBzb3VyY2UzWzJdLnNwbGl0KCI8L2E+PC9wPjwvZGl2PiIpDQogICAgICAgIG5vd3RpdGxlID0gc291cmNldGl0bGVbMF1bMTc6bGVuKHNvdXJjZXRpdGxlWzBdKV0NCiAgICAgICAgbm93dGl0bGUgPSBub3d0aXRsZS5lbmNvZGUoJ3V0Zi04JykNCiAgICAgICAgcmV0dXJuICIgIC0gIitub3d0aXRsZSsiIC0gIitub3d0aW1lDQoNCg0KZGVmIGdldF9lcGcodXJsLCByZWdleCk6DQogICAgICAgIGRhdGEgPSBtYWtlUmVxdWVzdCh1cmwpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGl0ZW0gPSByZS5maW5kYWxsKHJlZ2V4LCBkYXRhKVswXQ0KICAgICAgICAgICAgcmV0dXJuIGl0ZW0NCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgYWRkb25fbG9nKCdyZWdleCBmYWlsZWQnKQ0KICAgICAgICAgICAgYWRkb25fbG9nKHJlZ2V4KQ0KICAgICAgICAgICAgcmV0dXJuDQoNCiAgICANCiMjbm90IGEgZ2VuZXJpYyBpbXBsZW1lbmF0aW9uIGFzIGl0IG5lZWRzIHRvIGNvbnZlcnQgICAgICAgICAgICANCmRlZiBkMngoZCwgcm9vdD0icm9vdCIsbmVzdGVkPTApOg0KDQogICAgb3AgPSBsYW1iZGEgdGFnOiAnPCcgKyB0YWcgKyAnPicNCiAgICBjbCA9IGxhbWJkYSB0YWc6ICc8LycgKyB0YWcgKyAnPlxuJw0KDQogICAgbWwgPSBsYW1iZGEgdix4bWw6IHhtbCArIG9wKGtleSkgKyBzdHIodikgKyBjbChrZXkpDQogICAgeG1sID0gb3Aocm9vdCkgKyAnXG4nIGlmIHJvb3QgZWxzZSAiIg0KDQogICAgZm9yIGtleSx2bCBpbiBkLml0ZXJpdGVtcygpOg0KICAgICAgICB2dHlwZSA9IHR5cGUodmwpDQogICAgICAgIGlmIG5lc3RlZD09MDoga2V5PSdyZWdleCcgI2VuZm9yY2luZyBhbGwgdG9wIGxldmVsIHRhZ3MgdG8gYmUgbmFtZWQgYXMgcmVnZXgNCiAgICAgICAgaWYgdnR5cGUgaXMgbGlzdDogDQogICAgICAgICAgICBmb3IgdiBpbiB2bDoNCiAgICAgICAgICAgICAgICB2PWVzY2FwZSh2KQ0KICAgICAgICAgICAgICAgIHhtbCA9IG1sKHYseG1sKSAgICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgdnR5cGUgaXMgZGljdDogDQogICAgICAgICAgICB4bWwgPSBtbCgnXG4nICsgZDJ4KHZsLE5vbmUsbmVzdGVkKzEpLHhtbCkgICAgICAgICANCiAgICAgICAgaWYgdnR5cGUgaXMgbm90IGxpc3QgYW5kIHZ0eXBlIGlzIG5vdCBkaWN0OiANCiAgICAgICAgICAgIGlmIG5vdCB2bCBpcyBOb25lOiB2bD1lc2NhcGUodmwpDQogICAgICAgICAgICAjcHJpbnQgcmVwcih2bCkNCiAgICAgICAgICAgIGlmIHZsIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgeG1sID0gbWwodmwseG1sKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAjeG1sID0gbWwoZXNjYXBlKHZsLmVuY29kZSgidXRmLTgiKSkseG1sKQ0KICAgICAgICAgICAgICAgIHhtbCA9IG1sKHZsLmVuY29kZSgidXRmLTgiKSx4bWwpDQoNCiAgICB4bWwgKz0gY2wocm9vdCkgaWYgcm9vdCBlbHNlICIiDQoNCiAgICByZXR1cm4geG1sDQp4Ym1jcGx1Z2luLnNldENvbnRlbnQoaW50KHN5cy5hcmd2WzFdKSwgJ21vdmllcycpDQoNCnRyeToNCiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9VTlNPUlRFRCkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfTEFCRUwpDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0RBVEUpDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0dFTlJFKQ0KZXhjZXB0Og0KICAgIHBhc3MNCg0KcGFyYW1zPWdldF9wYXJhbXMoKQ0KDQp1cmw9Tm9uZQ0KbmFtZT1Ob25lDQptb2RlPU5vbmUNCnBsYXlsaXN0PU5vbmUNCmljb25pbWFnZT1Ob25lDQpmYW5hcnQ9RkFOQVJUDQpwbGF5bGlzdD1Ob25lDQpmYXZfbW9kZT1Ob25lDQpyZWdleHM9Tm9uZQ0KDQp0cnk6DQogICAgdXJsPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJ1cmwiXSkuZGVjb2RlKCd1dGYtOCcpDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIG5hbWU9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbIm5hbWUiXSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgaWNvbmltYWdlPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJpY29uaW1hZ2UiXSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgZmFuYXJ0PXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJmYW5hcnQiXSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgbW9kZT1pbnQocGFyYW1zWyJtb2RlIl0pDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIHBsYXlsaXN0PWV2YWwodXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbInBsYXlsaXN0Il0pLnJlcGxhY2UoJ3x8JywnLCcpKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICBmYXZfbW9kZT1pbnQocGFyYW1zWyJmYXZfbW9kZSJdKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICByZWdleHM9cGFyYW1zWyJyZWdleHMiXQ0KZXhjZXB0Og0KICAgIHBhc3MNCnBsYXlpdGVtPScnDQp0cnk6DQogICAgcGxheWl0ZW09dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbInBsYXlpdGVtIl0pDQpleGNlcHQ6DQogICAgcGFzcw0KICAgIA0KYWRkb25fbG9nKCJNb2RlOiAiK3N0cihtb2RlKSkNCg0KDQppZiBub3QgdXJsIGlzIE5vbmU6DQogICAgYWRkb25fbG9nKCJVUkw6ICIrc3RyKHVybC5lbmNvZGUoJ3V0Zi04JykpKQ0KYWRkb25fbG9nKCJOYW1lOiAiK3N0cihuYW1lKSkNCg0KaWYgbm90IHBsYXlpdGVtID09Jyc6DQogICAgcz1nZXRTb3VwKCcnLGRhdGE9cGxheWl0ZW0pDQogICAgbmFtZSx1cmwscmVnZXhzPWdldEl0ZW1zKHMsTm9uZSxkb250TGluaz1UcnVlKQ0KICAgIG1vZGU9MTE3IA0KaWYgbW9kZT09Tm9uZToNCg0KICAgIGltcG9ydCB4Ym1jDQogICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oSU5TT01OSUEsVWx0aW1hIFZlcnNpb246IDAuMC4zLCA3MDAwLCIraWNvbisiKSIpDQoNCg0KICAgIGFkZG9uX2xvZygiZ2V0U291cmNlcyIpDQogICAgZ2V0U291cmNlcygpDQogICAgI2ZpbGUgPSAnaHR0cHM6Ly9hcmNoaXZlLm9yZy9kb3dubG9hZC9hcGVydHVyYV8yMDE3MTAvYXBlcnR1cmEubXAzJw0KICAgICN4Ym1jLlBsYXllcigpLnBsYXkoZmlsZSkNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoJDQogICAgX19hZGRvbl9fID0geGJtY2FkZG9uLkFkZG9uKCkNCiAgICBfX2FkZG9ubmFtZV9fID0gX19hZGRvbl9fLmdldEFkZG9uSW5mbygnbmFtZScpDQoNCiANCiAgICBsaW5lMSA9ICJFc3RlIGFkZG9uIGVzIGdyYXR1aXRvLiBJTlNPTU5JQSBubyBjb250aWVuZSBuaW5nw7puIGFyY2hpdm8gY29uIGNvcHlyaWdodCBlbiBzdSBzZXJ2aWRvci4iDQogICAgbGluZTIgPSAiTG9zIGVubGFjZXMgc29uIHJlY29sZWN0YWRvcyBkZSBpbnRlcm5ldCwgSU5TT01OSUEgbm8gc2UgaGFjZW4gcmVzcG9uc2FibGVzIGRlIGRpY2hvIGNvbnRlbmlkby4gIg0KICAgIGxpbmUzID0gIk5pIGRlbCB1c28gbm8gcmVzcG9uc2FibGUgZGVsIG1pc21vLiBFbCBjb3B5cmlnaHQgZGUgbGFzIGltw6FnZW5lcyBwZXJ0ZW5lY2UgYSBzdXMgcmVzcGVjdGl2b3MgYXV0b3JlcyB5L28gcHJvZHVjdG9yYXMvZGlzdHJpYnVpZG9yYXMuIg0KICAgIHhibWNndWkuRGlhbG9nKCkub2soX19hZGRvbm5hbWVfXywgbGluZTEsIGxpbmUyLCBsaW5lMykNCgkNCg0KCQ0KZWxpZiBtb2RlPT0xOg0KICAgIGFkZG9uX2xvZygiZ2V0RGF0YSIpDQoJDQoNCiAgICANCiAgICBkYXRhPU5vbmUNCiAgICANCiAgICBpZiByZWdleHMgYW5kIGxlbihyZWdleHMpPjA6DQogICAgICAgIGRhdGEsc2V0cmVzb2x2ZWQ9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwpDQogICAgICAgICNwcmludCBkYXRhDQogICAgICAgICN1cmw9JycNCiAgICAgICAgaWYgZGF0YS5zdGFydHN3aXRoKCdodHRwJykgb3IgZGF0YS5zdGFydHN3aXRoKCdzbWInKSBvciBkYXRhLnN0YXJ0c3dpdGgoJ25mcycpIG9yIGRhdGEuc3RhcnRzd2l0aCgnLycpOg0KICAgICAgICAgICAgdXJsPWRhdGENCiAgICAgICAgICAgIGRhdGE9Tm9uZQ0KICAgICAgICAjY3JlYXRlIHhtbCBoZXJlDQogICAgDQogICAgZ2V0RGF0YSh1cmwsZmFuYXJ0LGRhdGEpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQoNCg0KZWxpZiBtb2RlPT0yOg0KICAgIGFkZG9uX2xvZygiZ2V0Q2hhbm5lbEl0ZW1zIikNCiAgICBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT0zOg0KICAgIGFkZG9uX2xvZygiZ2V0U3ViQ2hhbm5lbEl0ZW1zIikNCiAgICBnZXRTdWJDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT00Og0KICAgIGFkZG9uX2xvZygiZ2V0RmF2b3JpdGVzIikNCiAgICBnZXRGYXZvcml0ZXMoKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT01Og0KICAgIGFkZG9uX2xvZygiYWRkRmF2b3JpdGUiKQ0KICAgIHRyeToNCiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJ1xcICcpWzFdDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgdHJ5Og0KICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnICAtICcpWzBdDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxmYXZfbW9kZSkNCg0KZWxpZiBtb2RlPT02Og0KICAgIGFkZG9uX2xvZygicm1GYXZvcml0ZSIpDQogICAgdHJ5Og0KICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnXFwgJylbMV0NCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICB0cnk6DQogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCcgIC0gJylbMF0NCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICBybUZhdm9yaXRlKG5hbWUpDQoNCmVsaWYgbW9kZT09NzoNCiAgICBTcG9ydHNEZXZpbCgpDQogICAgRHV0Y2goKQ0KCQ0KZWxpZiBtb2RlPT04Og0KICAgIGFkZG9uX2xvZygicm1Tb3VyY2UiKQ0KICAgIHJtU291cmNlKG5hbWUpDQoNCmVsaWYgbW9kZT09OToNCiAgICBhZGRvbl9sb2coImRvd25sb2FkX2ZpbGUiKQ0KICAgIGRvd25sb2FkX2ZpbGUobmFtZSwgdXJsKQ0KDQplbGlmIG1vZGU9PTEwOg0KICAgIGFkZG9uX2xvZygiZ2V0Q29tbXVuaXR5U291cmNlcyIpDQogICAgZ2V0Q29tbXVuaXR5U291cmNlcygpDQoNCmVsaWYgbW9kZT09MTE6DQogICAgYWRkb25fbG9nKCJhZGRTb3VyY2UiKQ0KICAgIGFkZFNvdXJjZSh1cmwpDQoNCmVsaWYgbW9kZT09MTI6DQogICAgYWRkb25fbG9nKCJzZXRSZXNvbHZlZFVybCIpDQogICAgaWYgbm90IHVybC5zdGFydHN3aXRoKCJwbHVnaW46Ly9wbHVnaW4iKSBvciBub3QgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpOiNub3QgdXJsLnN0YXJ0c3dpdGgoInBsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIiKSA6DQogICAgICAgIHNldHJlcz1UcnVlDQogICAgICAgIGlmICckJExTRGlyZWN0JCQnIGluIHVybDoNCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJCRMU0RpcmVjdCQkJywnJykNCiAgICAgICAgICAgIHNldHJlcz1GYWxzZQ0KICAgICAgICBpdGVtID0geGJtY2d1aS5MaXN0SXRlbShwYXRoPXVybCkNCiAgICAgICAgaWYgbm90IHNldHJlczoNCiAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmwpDQogICAgICAgIGVsc2U6IA0KICAgICAgICAgICAgeGJtY3BsdWdpbi5zZXRSZXNvbHZlZFVybChpbnQoc3lzLmFyZ3ZbMV0pLCBUcnVlLCBpdGVtKQ0KICAgIGVsc2U6DQojICAgICAgICBwcmludCAnTm90IHNldHRpbmcgc2V0UmVzb2x2ZWRVcmwnDQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ1hCTUMuUnVuUGx1Z2luKCcrdXJsKycpJykNCg0KDQplbGlmIG1vZGU9PTEzOg0KICAgIGFkZG9uX2xvZygicGxheV9wbGF5bGlzdCIpDQogICAgcGxheV9wbGF5bGlzdChuYW1lLCBwbGF5bGlzdCkNCg0KZWxpZiBtb2RlPT0xNDoNCiAgICBhZGRvbl9sb2coImdldF94bWxfZGF0YWJhc2UiKQ0KICAgIGdldF94bWxfZGF0YWJhc2UodXJsKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT0xNToNCiAgICBhZGRvbl9sb2coImJyb3dzZV94bWxfZGF0YWJhc2UiKQ0KICAgIGdldF94bWxfZGF0YWJhc2UodXJsLCBUcnVlKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT0xNjoNCiAgICBhZGRvbl9sb2coImJyb3dzZV9jb21tdW5pdHkiKQ0KICAgIGdldENvbW11bml0eVNvdXJjZXModXJsLGJyb3dzZT1UcnVlKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT0xNyBvciBtb2RlPT0xMTc6DQogICAgYWRkb25fbG9nKCJnZXRSZWdleFBhcnNlZCIpDQoNCiAgICBkYXRhPU5vbmUNCiAgICBpZiByZWdleHMgYW5kICdsaXN0cmVwZWF0JyBpbiB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cyk6DQogICAgICAgIGxpc3RyZXBlYXQscmV0LG0scmVnZXhzLCBjb29raWVKYXIgPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgdXJsKQ0KICAgICAgICAjcHJpbnQgbGlzdHJlcGVhdCxyZXQsbSxyZWdleHMNCiAgICAgICAgZD0nJw0KIyAgICAgICAgcHJpbnQgJ20gaXMnICwgbQ0KIyAgICAgICAgcHJpbnQgJ3JlZ2V4cycscmVnZXhzDQogICAgICAgIHJlZ2V4bmFtZT1tWyduYW1lJ10NCiAgICAgICAgZXhpc3RpbmdfbGlzdD1yZWdleHMucG9wKHJlZ2V4bmFtZSkNCiAjICAgICAgIHByaW50ICdmaW5hbCByZWdleHMnLHJlZ2V4cyxyZWdleG5hbWUNCiAgICAgICAgdXJsPScnDQogICAgICAgIGltcG9ydCBjb3B5DQogICAgICAgIGxuPScnDQogICAgICAgIHJudW1iZXI9MA0KICAgICAgICBmb3Igb2JqIGluIHJldDoNCiAgICAgICAgICAgICNwcmludCAnb2JqJyxvYmoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBybnVtYmVyKz0xDQogICAgICAgICAgICAgICAgbmV3Y29weT1jb3B5LmRlZXBjb3B5KHJlZ2V4cykNCiAgICAjICAgICAgICAgICAgcHJpbnQgJ25ld2NvcHknLG5ld2NvcHksIGxlbihuZXdjb3B5KQ0KICAgICAgICAgICAgICAgIGxpc3RyZXBlYXRUPWxpc3RyZXBlYXQNCiAgICAgICAgICAgICAgICBpPTANCiAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4ob2JqKSk6DQogICAgIyAgICAgICAgICAgICAgICBwcmludCAnaSBpcyAnLGksIGxlbihvYmopLCBsZW4obmV3Y29weSkNCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKG5ld2NvcHkpPjA6DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgdGhlX2tleU8sIHRoZV92YWx1ZU8gaW4gbmV3Y29weS5pdGVyaXRlbXMoKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0aGVfdmFsdWVPIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgdGhlX2tleSwgdGhlX3ZhbHVlIGluIHRoZV92YWx1ZU8uaXRlcml0ZW1zKCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0aGVfdmFsdWUgaXMgbm90IE5vbmU6ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgICdrZXkgYW5kIHZhbCcsdGhlX2tleSwgdGhlX3ZhbHVlDQogICAgICAgICMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhYScNCiAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ10nDQogICAgICAgICMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50IHJlcHIob2JqW2ldKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHR5cGUodGhlX3ZhbHVlKSBpcyBkaWN0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgdGhlX2tleWwsIHRoZV92YWx1ZWwgaW4gdGhlX3ZhbHVlLml0ZXJpdGVtcygpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGhlX3ZhbHVlbCBpcyBub3QgTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9Tm9uZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLHR1cGxlKTogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPSBvYmpbaV0uZGVjb2RlKCd1dGYtOCcpIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPSBvYmpbaV0gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPSBvYmouZGVjb2RlKCd1dGYtOCcpIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9IG9iag0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddW0RFXScgaW4gdGhlX3ZhbHVlbDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlX3ZhbHVlbD10aGVfdmFsdWVsLnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ11bREVdJywgdW5lc2NhcGUodmFsKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVfdmFsdWVbdGhlX2tleWxdPXRoZV92YWx1ZWwucmVwbGFjZSgnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKGkrMSkgKyAnXScsIHZhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2ZpcnN0IHNlYycsdGhlX3ZhbHVlW3RoZV9rZXlsXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1Ob25lDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLHR1cGxlKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPW9ialtpXS5kZWNvZGUoJ3V0Zi04JykgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPW9ialtpXSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9IG9iai5kZWNvZGUoJ3V0Zi04JykgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPSBvYmoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ11bREVdJyBpbiB0aGVfdmFsdWU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2ZvdW5kIERFJyx0aGVfdmFsdWUucmVwbGFjZSgnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKGkrMSkgKyAnXVtERV0nLCB1bmVzY2FwZSh2YWwpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlX3ZhbHVlPXRoZV92YWx1ZS5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddW0RFXScsIHVuZXNjYXBlKHZhbCkpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlX3ZhbHVlT1t0aGVfa2V5XT10aGVfdmFsdWUucmVwbGFjZSgnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKGkrMSkgKyAnXScsIHZhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdzZWNvbmQgc2VjIHZhbCcsdGhlX3ZhbHVlT1t0aGVfa2V5XQ0KDQogICAgICAgICAgICAgICAgICAgIHZhbD1Ob25lDQogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLHR1cGxlKToNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9b2JqW2ldLmRlY29kZSgndXRmLTgnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1vYmpbaV0NCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9b2JqLmRlY29kZSgndXRmLTgnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9b2JqDQogICAgICAgICAgICAgICAgICAgIGlmICdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddW0RFXScgaW4gbGlzdHJlcGVhdFQ6DQogICAgICAgICAgICAgICAgICAgICAgICBsaXN0cmVwZWF0VD1saXN0cmVwZWF0VC5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddW0RFXScsdmFsKQ0KICAgICAgICAgICAgICAgICAgICBsaXN0cmVwZWF0VD1saXN0cmVwZWF0VC5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddJyxlc2NhcGUodmFsKSkNCiMgICAgICAgICAgICAgICAgICAgIHByaW50IGxpc3RyZXBlYXRUDQogICAgICAgICAgICAgICAgbGlzdHJlcGVhdFQ9bGlzdHJlcGVhdFQucmVwbGFjZSgnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKDApICsgJ10nLHN0cihybnVtYmVyKSkgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBpZiBjb29raWVKYXIgYW5kICdbJyArIHJlZ2V4bmFtZSsnLmNvb2tpZXNdJyBpbiBsaXN0cmVwZWF0VDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RyZXBlYXRUPWxpc3RyZXBlYXRULnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycuY29va2llc10nLGdldENvb2tpZXNTdHJpbmcoY29va2llSmFyKSkgDQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgI25ld2NvcHkgPSB1cmxsaWIucXVvdGUocmVwcihuZXdjb3B5KSkNCiAgICAjICAgICAgICAgICAgcHJpbnQgJ25ldyByZWdleCBsaXN0JywgcmVwcihuZXdjb3B5KSwgcmVwcihsaXN0cmVwZWF0VCkNCiAgICAjICAgICAgICAgICAgYWRkTGluayhsaXN0bGlua1QsbGlzdHRpdGxlVC5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLGxpc3R0aHVtYm5haWxULCcnLCcnLCcnLCcnLFRydWUsTm9uZSxuZXdjb3B5LCBsZW4ocmV0KSkNCiAgICAgICAgICAgICAgICByZWdleF94bWw9JycNCiMgICAgICAgICAgICAgICAgcHJpbnQgJ25ld2NvcHknLG5ld2NvcHkNCiAgICAgICAgICAgICAgICBpZiBsZW4obmV3Y29weSk+MDoNCiAgICAgICAgICAgICAgICAgICAgcmVnZXhfeG1sPWQyeChuZXdjb3B5LCdsc3Byb3Jvb3QnKQ0KICAgICAgICAgICAgICAgICAgICByZWdleF94bWw9cmVnZXhfeG1sLnNwbGl0KCc8bHNwcm9yb290PicpWzFdLnNwbGl0KCc8L2xzcHJvcm9vdCcpWzBdDQogICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICNsbis9J1xuPGl0ZW0+JXNcbiVzPC9pdGVtPiclKGxpc3RyZXBlYXRULmVuY29kZSgidXRmLTgiKSxyZWdleF94bWwpICAgDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBsbis9J1xuPGl0ZW0+JXNcbiVzPC9pdGVtPiclKGxpc3RyZXBlYXRULHJlZ2V4X3htbCkNCiAgICAgICAgICAgICAgICBleGNlcHQ6IGxuKz0nXG48aXRlbT4lc1xuJXM8L2l0ZW0+JyUobGlzdHJlcGVhdFQuZW5jb2RlKCJ1dGYtOCIpLHJlZ2V4X3htbCkNCiAgICAgICAgICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpDQojICAgICAgICAgICAgcHJpbnQgcmVwcihsbikNCiMgICAgICAgICAgICBwcmludCBuZXdjb3B5DQogICAgICAgICAgICAgICAgDQojICAgICAgICAgICAgbG4rPSc8L2l0ZW0+Jw0KICAgICAgICANCiAgICAgICAgYWRkb25fbG9nKHJlcHIobG4pKQ0KICAgICAgICBnZXREYXRhKCcnLCcnLGxuKQ0KICAgICAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQogICAgZWxzZToNCiAgICAgICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwpDQogICAgICAgIHByaW50IHJlcHIodXJsKSxzZXRyZXNvbHZlZCwnaW1oZXJlJw0KICAgICAgICBpZiBub3QgKHJlZ2V4cyBhbmQgJ25vdHBsYXlhYmxlJyBpbiByZWdleHMgYW5kIG5vdCB1cmwpOiAgICAgICAgDQogICAgICAgICAgICBpZiB1cmw6DQogICAgICAgICAgICAgICAgaWYgJyRQTEFZRVJQUk9YWSQ9JyBpbiB1cmw6DQogICAgICAgICAgICAgICAgICAgIHVybCxwcm94eT11cmwuc3BsaXQoJyRQTEFZRVJQUk9YWSQ9JykNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Byb3h5Jyxwcm94eQ0KICAgICAgICAgICAgICAgICAgICAjSmFpcm94IG1vZCBmb3IgcHJveHkgYXV0aA0KICAgICAgICAgICAgICAgICAgICBwcm94eXVzZXIgPSBOb25lDQogICAgICAgICAgICAgICAgICAgIHByb3h5cGFzcyA9IE5vbmUNCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHByb3h5KSA+IDAgYW5kICdAJyBpbiBwcm94eToNCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5ID0gcHJveHkuc3BsaXQoJzonKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJveHl1c2VyID0gcHJveHlbMF0NCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5cGFzcyA9IHByb3h5WzFdLnNwbGl0KCdAJylbMF0NCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5aXAgPSBwcm94eVsxXS5zcGxpdCgnQCcpWzFdDQogICAgICAgICAgICAgICAgICAgICAgICBwb3J0ID0gcHJveHlbMl0NCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5aXAscG9ydD1wcm94eS5zcGxpdCgnOicpDQoNCiAgICAgICAgICAgICAgICAgICAgcGxheW1lZGlhd2l0aHByb3h5KHVybCxuYW1lLGljb25pbWFnZSxwcm94eWlwLHBvcnQsIHByb3h5dXNlcixwcm94eXBhc3MpICNqYWlyb3gNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBwbGF5c2V0cmVzb2x2ZWQodXJsLG5hbWUsaWNvbmltYWdlLHNldHJlc29sdmVkLHJlZ2V4cykNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oSU5TT01OSUEsRmFpbGVkIHRvIGV4dHJhY3QgcmVnZXguIC0gIisidGhpcyIrIiw0MDAwLCIraWNvbisiKSIpDQplbGlmIG1vZGU9PTE4Og0KICAgIGFkZG9uX2xvZygieW91dHViZWRsIikNCiAgICB0cnk6DQogICAgICAgIGltcG9ydCB5b3V0dWJlZGwNCiAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihJTlNPTU5JQSxQbGVhc2UgW0NPTE9SIHllbGxvd11pbnN0YWxsIFlvdXR1YmUtZGxbL0NPTE9SXSBtb2R1bGUgLDEwMDAwLCIiKSIpDQogICAgc3RyZWFtX3VybD15b3V0dWJlZGwuc2luZ2xlX1lEKHVybCkNCiAgICBwbGF5c2V0cmVzb2x2ZWQoc3RyZWFtX3VybCxuYW1lLGljb25pbWFnZSkNCmVsaWYgbW9kZT09MTk6DQogICAgYWRkb25fbG9nKCJHZW5lc2lzY29tbW9ucmVzb2x2ZXJzIikNCiAgICBwbGF5c2V0cmVzb2x2ZWQgKHVybHNvbHZlcih1cmwpLG5hbWUsaWNvbmltYWdlLFRydWUpDQoNCmVsaWYgbW9kZT09MjE6DQogICAgYWRkb25fbG9nKCJkb3dubG9hZCBjdXJyZW50IGZpbGUgdXNpbmcgeW91dHViZS1kbCBzZXJ2aWNlIikNCiAgICBtdHlwZT0ndmlkZW8nDQogICAgaWYgJ1ttcDNdJyBpbiBuYW1lOg0KICAgICAgICBtdHlwZT0nYXVkaW8nDQogICAgICAgIG5hbWU9bmFtZS5yZXBsYWNlKCdbbXAzXScsJycpDQogICAgeXRkbF9kb3dubG9hZCgnJyxuYW1lLCBtdHlwZSkNCmVsaWYgbW9kZT09MjM6DQogICAgYWRkb25fbG9nKCJnZXQgaW5mbyB0aGVuIGRvd25sb2FkIikNCiAgICBtdHlwZT0ndmlkZW8nDQogICAgaWYgJ1ttcDNdJyBpbiBuYW1lOg0KICAgICAgICBtdHlwZT0nYXVkaW8nDQogICAgICAgIG5hbWU9bmFtZS5yZXBsYWNlKCdbbXAzXScsJycpDQogICAgeXRkbF9kb3dubG9hZCh1cmwsbmFtZSxtdHlwZSkNCmVsaWYgbW9kZT09MjQ6DQogICAgYWRkb25fbG9nKCJBdWRpbyBvbmx5IHlvdXR1YmUgZG93bmxvYWQiKQ0KICAgIHl0ZGxfZG93bmxvYWQodXJsLG5hbWUsJ2F1ZGlvJykNCmVsaWYgbW9kZT09MjU6DQogICAgYWRkb25fbG9nKCJTZWFyY2hpbiBPdGhlciBwbHVnaW5zIikNCiAgICBfc2VhcmNoKHVybCxuYW1lKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCmVsaWYgbW9kZT09NTU6DQogICAgYWRkb25fbG9nKCJlbmFibGVkIGxvY2siKQ0KICAgIHBhcmVudGFsYmxvY2tlZHBpbiA9YWRkb24uZ2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkcGluJykNCiAgICBrZXlib2FyZCA9IHhibWMuS2V5Ym9hcmQoJycsJ2ludHJvZHV6Y2EgbGEgY29udHJhc2XDsWEnKQ0KICAgIGtleWJvYXJkLmRvTW9kYWwoKQ0KICAgIGlmIG5vdCAoa2V5Ym9hcmQuaXNDb25maXJtZWQoKSA9PSBGYWxzZSk6DQogICAgICAgIG5ld1N0ciA9IGtleWJvYXJkLmdldFRleHQoKQ0KICAgICAgICBpZiBuZXdTdHI9PXBhcmVudGFsYmxvY2tlZHBpbjoNCiAgICAgICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZCcsICJmYWxzZSIpDQogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihJTlNPTU5JQSwgTW9kbyBwcmVtaXVtIE9uLDUwMDAsIitpY29uKyIpIikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKElOU09NTklBLCBvbHZpZG8gbGEgY2xhdmU/PyAsNTAwMCwiK2ljb24rIikiKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCmVsaWYgbW9kZT09NTY6DQogICAgYWRkb25fbG9nKCJkaXNhYmxlIGxvY2siKQ0KICAgIGFkZG9uLnNldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZCcsICJ0cnVlIikNCiAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihJTlNPTU5JQSwgTW9kbyBwcmVtaXVtIE9mZiw1MDAwLCIraWNvbisiKSIpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQplbGlmIG1vZGU9PTUzOg0KICAgIGFkZG9uX2xvZygiUmVxdWVzdGluZyBKU09OLVJQQyBJdGVtcyIpDQogICAgcGx1Z2lucXVlcnlieUpTT04odXJsKQ0KICAgICN4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQppZiBub3Qgdmlld21vZGU9PU5vbmU6DQogICBwcmludCAnc2V0dGluZyB2aWV3IG1vZGUnDQogICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoJXMpIiV2aWV3bW9kZSkNCiAgICA=')