import base64;exec base64.b64decode('IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0NCmltcG9ydCB1cmxsaWINCmltcG9ydCB1cmxsaWIyDQppbXBvcnQgcmUNCmltcG9ydCBvcw0KaW1wb3J0IHhibWNwbHVnaW4NCmltcG9ydCB4Ym1jZ3VpDQppbXBvcnQgeGJtY2FkZG9uDQppbXBvcnQgeGJtY3Zmcw0KaW1wb3J0IHRyYWNlYmFjaw0KaW1wb3J0IGNvb2tpZWxpYixiYXNlNjQNCg0KZnJvbSBCZWF1dGlmdWxTb3VwIGltcG9ydCBCZWF1dGlmdWxTdG9uZVNvdXAsIEJlYXV0aWZ1bFNvdXAsIEJlYXV0aWZ1bFNPQVANCnZpZXdtb2RlPU5vbmUNCnRyeToNCiAgICBmcm9tIHhtbC5zYXguc2F4dXRpbHMgaW1wb3J0IGVzY2FwZQ0KZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKCkNCnRyeToNCiAgICBpbXBvcnQganNvbg0KZXhjZXB0Og0KICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24NCmltcG9ydCBTaW1wbGVEb3dubG9hZGVyIGFzIGRvd25sb2FkZXINCmltcG9ydCB0aW1lDQoNCnRyeToNCiAgIGltcG9ydCBzc2wNCiAgIHNzbC5fY3JlYXRlX2RlZmF1bHRfaHR0cHNfY29udGV4dCA9IHNzbC5fY3JlYXRlX3VudmVyaWZpZWRfY29udGV4dA0KZXhjZXB0Og0KICAgcGFzcw0KICAgDQppbXBvcnQgemlwZmlsZQ0KDQpkZWYgRXh0cmFjdEFsbChfaW4sIF9vdXQpOg0KICAgIHRyeToNCiAgICAgICAgemluID0gemlwZmlsZS5aaXBGaWxlKF9pbiwgJ3InKQ0KICAgICAgICB6aW4uZXh0cmFjdGFsbChfb3V0KQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24sIGU6DQogICAgICAgIHByaW50IHN0cihlKQ0KICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIHJldHVybiBUcnVlDQoNCg0KDQpkZWYgUmVwbygpOg0KICAgIGlmIG9zLnBhdGguZXhpc3RzKG9zLnBhdGguam9pbih4Ym1jLnRyYW5zbGF0ZVBhdGgoInNwZWNpYWw6Ly9ob21lL2FkZG9ucy8iKS5kZWNvZGUoInV0Zi04IiksICdyZXBvc2l0b3J5Lk5ldGFpLWhvc3RpbmdlcicpKToNCiAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgIHVybCA9ICJodHRwOi8vd3d3LmdydXBvbmV0YWkuY29tL3JlcG9zaXRvcmlvL3JlcG9zaXRvcnkuTmV0YWktaG9zdGluZ2VyL3JlcG9zaXRvcnkuTmV0YWktaG9zdGluZ2VyLTEuMS4xLnppcCINCiAgICBhZGRvbnNEaXIgPSB4Ym1jLnRyYW5zbGF0ZVBhdGgob3MucGF0aC5qb2luKCdzcGVjaWFsOi8vaG9tZScsICdhZGRvbnMnKSkuZGVjb2RlKCJ1dGYtOCIpDQogICAgcGFja2FnZUZpbGUgPSBvcy5wYXRoLmpvaW4oYWRkb25zRGlyLCAncGFja2FnZXMnLCAnaXNyLnppcCcpDQogICAgDQogICAgdXJsbGliLnVybHJldHJpZXZlKHVybCwgcGFja2FnZUZpbGUpDQogICAgRXh0cmFjdEFsbChwYWNrYWdlRmlsZSwgYWRkb25zRGlyKQ0KICAgICAgICANCiAgICB0cnk6DQogICAgICAgIG9zLnJlbW92ZShwYWNrYWdlRmlsZSkNCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICAgICAgICAgIA0KICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlVwZGF0ZUxvY2FsQWRkb25zIikNCiAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJVcGRhdGVBZGRvblJlcG9zIikNCg0KDQpSZXBvKCkNCnRzZG93bmxvYWRlcj1GYWxzZQ0KaGxzcmV0cnk9RmFsc2UNCnJlc29sdmVfdXJsPVsnMTgwdXBsb2FkLmNvbScsICdhbGxteXZpZGVvcy5uZXQnLCAnYmVzdHJlYW1zLm5ldCcsICdjbGlja251cGxvYWQuY29tJywgJ2Nsb3VkemlsbGEudG8nLCAnbW92c2hhcmUubmV0JywgJ25vdmFtb3YuY29tJywgJ25vd3ZpZGVvLnN4JywgJ3ZpZGVvd2VlZC5lcycsICdkYWNsaXBzLmluJywgJ2RhdGVtdWxlLmNvbScsICdmYXN0dmlkZW8uaW4nLCAnZmFzdHN0cmVhbS5pbicsICdmaWxlaG9vdC5jb20nLCAnZmlsZW51a2UuY29tJywgJ3NoYXJlc2l4LmNvbScsICAncGx1cy5nb29nbGUuY29tJywgJ3BpY2FzYXdlYi5nb29nbGUuY29tJywgJ2dvcmlsbGF2aWQuY29tJywgJ2dvcmlsbGF2aWQuaW4nLCAnZ3JpZnRob3N0LmNvbScsICdodWdlZmlsZXMubmV0JywgJ2lwaXRob3MudG8nLCAnaXNoYXJlZC5ldScsICdraW5nZmlsZXMubmV0JywgJ21haWwucnUnLCAnbXkubWFpbC5ydScsICd2aWRlb2FwaS5teS5tYWlsLnJ1JywgJ21pZ2h0eXVwbG9hZC5jb20nLCAnbW9vc2hhcmUuYml6JywgJ21vdmRpdnguY29tJywgJ21vdnBvZC5uZXQnLCAnbW92cG9kLmluJywgJ21vdnJlZWwuY29tJywgJ21yZmlsZS5tZScsICdub3N2aWRlby5jb20nLCAnb3BlbmxvYWQuaW8nLCAncGxheWVkLnRvJywgJ2JpdHNoYXJlLmNvbScsICdmaWxlZmFjdG9yeS5jb20nLCAnazJzLmNjJywgJ29ib29tLmNvbScsICdyYXBpZGdhdG9yLm5ldCcsICdwcmltZXNoYXJlLnR2JywgJ2JpdHNoYXJlLmNvbScsICdmaWxlZmFjdG9yeS5jb20nLCAnazJzLmNjJywgJ29ib29tLmNvbScsICdyYXBpZGdhdG9yLm5ldCcsICdzaGFyZXJlcG8uY29tJywgJ3N0YWdldnUuY29tJywgJ3N0cmVhbWNsb3VkLmV1JywgJ3N0cmVhbWluLnRvJywgJ3RoZWZpbGUubWUnLCAndGhldmlkZW8ubWUnLCAndHVzZmlsZXMubmV0JywgJ3VwbG9hZGMuY29tJywgJ3phbGFhLmNvbScsICd1cGxvYWRyb2NrZXQubmV0JywgJ3VwdG9ib3guY29tJywgJ3Ytdmlkcy5jb20nLCAndmVlaGQuY29tJywgJ3ZpZGJ1bGwuY29tJywgJ3ZpZGVvbWVnYS50dicsICd2aWRwbGF5Lm5ldCcsICd2aWRzcG90Lm5ldCcsICd2aWR0by5tZScsICd2aWR6aS50dicsICd2aW1lby5jb20nLCAndmsuY29tJywgJ3ZvZGxvY2tlci5jb20nLCAneGZpbGVsb2FkLmNvbScsICd4dmlkc3RhZ2UuY29tJywgJ3pldHRhaG9zdC50diddDQpnX2lnbm9yZVNldFJlc29sdmVkPVsncGx1Z2luLnZpZGVvLmRyYW1hc29ubGluZScsJ3BsdWdpbi52aWRlby5mNG1UZXN0ZXInLCdwbHVnaW4udmlkZW8uc2hhaGlkbWJjbmV0JywncGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsJywncGx1Z2luLnN0cmVhbS52YXVnaG5saXZlLnR2JywncGx1Z2luLnZpZGVvLlplbVRWLXNoYW5pJ10NCmdsb2JhbCBnTFNQcm9EeW5hbWljQ29kZU51bWJlcg0KZ0xTUHJvRHluYW1pY0NvZGVOdW1iZXI9MA0KY2xhc3MgTm9SZWRpcmVjdGlvbih1cmxsaWIyLkhUVFBFcnJvclByb2Nlc3Nvcik6DQogICBkZWYgaHR0cF9yZXNwb25zZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6DQogICAgICAgcmV0dXJuIHJlc3BvbnNlDQogICBodHRwc19yZXNwb25zZSA9IGh0dHBfcmVzcG9uc2UNCg0KUkVNT1RFX0RCRz1GYWxzZTsNCmlmIFJFTU9URV9EQkc6DQogICAgIyBNYWtlIHB5ZGV2IGRlYnVnZ2VyIHdvcmtzIGZvciBhdXRvIHJlbG9hZC4NCiAgICAjIE5vdGUgcHlkZXZkIG1vZHVsZSBuZWVkIHRvIGJlIGNvcGllZCBpbiBYQk1DXHN5c3RlbVxweXRob25cTGliXHB5c3JjDQogICAgdHJ5Og0KICAgICAgICBpbXBvcnQgcHlzcmMucHlkZXZkIGFzIHB5ZGV2ZA0KICAgICMgc3Rkb3V0VG9TZXJ2ZXIgYW5kIHN0ZGVyclRvU2VydmVyIHJlZGlyZWN0IHN0ZG91dCBhbmQgc3RkZXJyIHRvIGVjbGlwc2UgY29uc29sZQ0KICAgICAgICBweWRldmQuc2V0dHJhY2UoJ2xvY2FsaG9zdCcsIHN0ZG91dFRvU2VydmVyPVRydWUsIHN0ZGVyclRvU2VydmVyPVRydWUpDQogICAgZXhjZXB0IEltcG9ydEVycm9yOg0KICAgICAgICBzeXMuc3RkZXJyLndyaXRlKCJFcnJvcjogIiArDQogICAgICAgICAgICAiWW91IG11c3QgYWRkIG9yZy5weXRob24ucHlkZXYuZGVidWcucHlzcmMgdG8geW91ciBQWVRIT05QQVRILiIpDQogICAgICAgIHN5cy5leGl0KDEpDQoNCmFkZG9uID0geGJtY2FkZG9uLkFkZG9uKCdwbHVnaW4udmlkZW8uSGVyY3VsZXMnKQ0KYWRkb25fdmVyc2lvbiA9IGFkZG9uLmdldEFkZG9uSW5mbygndmVyc2lvbicpDQpwcm9maWxlID0geGJtYy50cmFuc2xhdGVQYXRoKGFkZG9uLmdldEFkZG9uSW5mbygncHJvZmlsZScpLmRlY29kZSgndXRmLTgnKSkNCmhvbWUgPSB4Ym1jLnRyYW5zbGF0ZVBhdGgoYWRkb24uZ2V0QWRkb25JbmZvKCdwYXRoJykuZGVjb2RlKCd1dGYtOCcpKQ0KZmF2b3JpdGVzID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdmYXZvcml0ZXMnKQ0KaGlzdG9yeSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnaGlzdG9yeScpDQpSRVYgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2xpc3RfcmV2aXNpb24nKQ0KaWNvbiA9IG9zLnBhdGguam9pbihob21lLCAnaWNvbi5wbmcnKQ0KZmF2b3JpdG9zID0gImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9zb3luZXRhaS9oZXJjdWxlcy9tYXN0ZXIvaW1hZ2VuZXMvZmF2b3JpdG9zLnBuZyINCm5hdmVnYWRvciA9ICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQW5kb3J0aC9uZXRhaS9tYXN0ZXIvaW1hZ2VzL25hdmVnYWRvcmVzLmpwZWciDQpGQU5BUlQgPSBvcy5wYXRoLmpvaW4oaG9tZSwgJ2ZhbmFydC5naWYnKSAjRkFOQVJUID0gZmFuYXJ0LmpwZw0Kc291cmNlX2ZpbGUgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3NvdXJjZV9maWxlJykNCnVybHNlcnZlID0gJ2FIUjBjRG92TDJKcGRDNXNlUzh5Y2sxRFIzZ3onLmRlY29kZSgnYmFzZTY0JykNCiNhSFIwY0hNNkx5OXlZWGN1WjJsMGFIVmlkWE5sY21OdmJuUmxiblF1WTI5dEwwRnVaRzl5ZEdndmFHVnlZM1ZzWlhNdmJXRnpkR1Z5TDJsdVpHVjRMbmh0YkE9PQ0KY29tbXVuaXR5ZmlsZXMgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ0xpdmV3ZWJUVicpDQpmdW5jdGlvbnNfZGlyID0gcHJvZmlsZQ0KZG93bmxvYWRlciA9IGRvd25sb2FkZXIuU2ltcGxlRG93bmxvYWRlcigpDQpkZWJ1ZyA9IGFkZG9uLmdldFNldHRpbmcoJ2RlYnVnJykNCmlmIG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcyk9PVRydWU6DQogICAgRkFWID0gb3BlbihmYXZvcml0ZXMpLnJlYWQoKQ0KZWxzZTogRkFWID0gW10NCg0KU09VUkNFUyA9IFt7InVybCI6IHVybHNlcnZlLCAiZmFuYXJ0IjogImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9BbmRvcnRoL2hlcmN1bGVzL21hc3Rlci9pbWFnZW5lcy9mYW5hcnQuZ2lmIn1dDQoNCg0KZGVmIGFkZG9uX2xvZyhzdHJpbmcpOg0KICAgIGlmIGRlYnVnID09ICd0cnVlJzoNCiAgICAgICAgeGJtYy5sb2coIlthZGRvbi5IZXJjdWxlcy0lc106ICVzIiAlKGFkZG9uX3ZlcnNpb24sIHN0cmluZykpDQoNCgkNCgkJDQoNCmRlZiBtYWtlUmVxdWVzdCh1cmwsIGhlYWRlcnM9Tm9uZSk6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIGhlYWRlcnMgaXMgTm9uZToNCiAgICAgICAgICAgICAgICBoZWFkZXJzID0geydVc2VyLWFnZW50JyA6ICdORVRBSSd9DQoNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIGlmICd8JyBpbiB1cmw6DQogICAgICAgICAgICAgICAgdXJsLGhlYWRlcl9pbl9wYWdlPXVybC5zcGxpdCgnfCcpDQogICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9aGVhZGVyX2luX3BhZ2Uuc3BsaXQoJyYnKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGZvciBoIGluIGhlYWRlcl9pbl9wYWdlOg0KICAgICAgICAgICAgICAgICAgICBpZiBsZW4oaC5zcGxpdCgnPScpKT09MjoNCiAgICAgICAgICAgICAgICAgICAgICAgIG4sdj1oLnNwbGl0KCc9JykNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHM9aC5zcGxpdCgnPScpDQogICAgICAgICAgICAgICAgICAgICAgICBuPXZhbHNbMF0NCiAgICAgICAgICAgICAgICAgICAgICAgIHY9Jz0nLmpvaW4odmFsc1sxOl0pDQogICAgICAgICAgICAgICAgICAgICAgICAjbix2PWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICBwcmludCBuLHYNCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1tuXT12DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KHVybCxOb25lLGhlYWRlcnMpDQogICAgICAgICAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpDQogICAgICAgICAgICBkYXRhID0gcmVzcG9uc2UucmVhZCgpDQogICAgICAgICAgICByZXNwb25zZS5jbG9zZSgpDQogICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICBleGNlcHQgdXJsbGliMi5VUkxFcnJvciwgZToNCiAgICAgICAgICAgIGFkZG9uX2xvZygnVVJMOiAnK3VybCkNCiAgICAgICAgICAgIGlmIGhhc2F0dHIoZSwgJ2NvZGUnKToNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1dlIGZhaWxlZCB3aXRoIGVycm9yIGNvZGUgLSAlcy4nICUgZS5jb2RlKQ0KICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEhlcmN1bGVzLFdlIGZhaWxlZCB3aXRoIGVycm9yIGNvZGUgLSAiK3N0cihlLmNvZGUpKyIsMTAwMDAsIitpY29uKyIpIikNCgkJCQkNCiAgICAgICAgICAgIGVsaWYgaGFzYXR0cihlLCAncmVhc29uJyk6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdXZSBmYWlsZWQgdG8gcmVhY2ggYSBzZXJ2ZXIuJykNCiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1JlYXNvbjogJXMnICVlLnJlYXNvbikNCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihIZXJjdWxlcyxXZSBmYWlsZWQgdG8gcmVhY2ggYSBzZXJ2ZXIuIC0gIitzdHIoZS5yZWFzb24pKyIsMTAwMDAsIitpY29uKyIpIikNCg0KCQkJCQkJCQkNCgkJCQkNCgkJCQkNCmRlZiBnZXRTb3VyY2VzKCk6DQoJdHJ5Og0KCQlpZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpID09IFRydWU6DQoJCQlGQVYgPSBvcGVuKGZhdm9yaXRlcykucmVhZCgpDQoJCQlpZiBGQVYgPT0gIltdIjoNCgkJCQlvcy5yZW1vdmUoZmF2b3JpdGVzKQ0KCQkJZWxzZToNCgkJCQkjYWRkRGlyKCdbQ09MT1Igd2hpdGVdW0JdRkFWT1JJVE9TWy9DT0xPUl1bL0JdJywndXJsJyw0LG9zLnBhdGguam9pbihob21lLCAncmVzb3VyY2VzJywgJycpLEZBTkFSVCwnJywnJywnJywnJykNCgkJCQlhZGREaXIoJ1tDT0xPUiBvcmFuZ2VdRmF2b3JpdG9zWy9DT0xPUl0nLCd1cmwnLDQsZmF2b3JpdG9zLEZBTkFSVCwnJywnJywnJywnJykNCiAgICAgICAgICAgICAgIA0KCQlzb3VyY2VzID0gU09VUkNFUw0KICAgICAgICAgICAgICAgICNwcmludCAnc291cmNlcycsc291cmNlcw0KICAgICAgICAgICAgICAgIGlmIGxlbihzb3VyY2VzKSA+IDE6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHNvdXJjZXM6DQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyMgZm9yIHByZSAxLjAuOCBzb3VyY2VzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShpLCBsaXN0KToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKGlbMF0uZW5jb2RlKCd1dGYtOCcpLGlbMV0uZW5jb2RlKCd1dGYtOCcpLDEsaWNvbixGQU5BUlQsJycsJycsJycsJycsJ3NvdXJjZScpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBpY29uDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbmFydCA9IEZBTkFSVA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjID0gJycNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnTkVUQUknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlbnJlID0gJycNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCd0aHVtYm5haWwnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iID0gaVsndGh1bWJuYWlsJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdmYW5hcnQnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbmFydCA9IGlbJ2ZhbmFydCddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZGVzY3JpcHRpb24nKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2MgPSBpWydkZXNjcmlwdGlvbiddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZGF0ZScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGlbJ2RhdGUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2dlbnJlJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5yZSA9IGlbJ2dlbnJlJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdjcmVkaXRzJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gaVsnY3JlZGl0cyddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihpWyd0aXRsZSddLmVuY29kZSgndXRmLTgnKSxpWyd1cmwnXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYixmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLGNyZWRpdHMsJ3NvdXJjZScpDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGlmIGxlbihzb3VyY2VzKSA9PSAxOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzb3VyY2VzWzBdLCBsaXN0KToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXREYXRhKHNvdXJjZXNbMF1bMV0uZW5jb2RlKCd1dGYtOCcpLEZBTkFSVCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YShzb3VyY2VzWzBdWyd1cmwnXSwgc291cmNlc1swXVsnZmFuYXJ0J10pDQogICAgICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpDQoNCmRlZiBhZGRTb3VyY2UodXJsPU5vbmUpOg0KICAgICAgICBpZiB1cmwgaXMgTm9uZToNCiAgICAgICAgICAgIGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCJuZXdfZmlsZV9zb3VyY2UiKSA9PSAiIjoNCiAgICAgICAgICAgICAgIHNvdXJjZV91cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCduZXdfZmlsZV9zb3VyY2UnKS5kZWNvZGUoJ3V0Zi04JykNCiAgICAgICAgICAgIGVsaWYgbm90IGFkZG9uLmdldFNldHRpbmcoIm5ld191cmxfc291cmNlIikgPT0gIiI6DQogICAgICAgICAgICAgICBzb3VyY2VfdXJsID0gYWRkb24uZ2V0U2V0dGluZygnbmV3X3VybF9zb3VyY2UnKS5kZWNvZGUoJ3V0Zi04JykNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHNvdXJjZV91cmwgPSB1cmwNCiAgICAgICAgaWYgc291cmNlX3VybCA9PSAnJyBvciBzb3VyY2VfdXJsIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgYWRkb25fbG9nKCdBZGRpbmcgTmV3IFNvdXJjZTogJytzb3VyY2VfdXJsLmVuY29kZSgndXRmLTgnKSkNCg0KICAgICAgICBtZWRpYV9pbmZvID0gTm9uZQ0KICAgICAgICAjcHJpbnQgJ3NvdXJjZV91cmwnLHNvdXJjZV91cmwNCiAgICAgICAgZGF0YSA9IGdldFNvdXAoc291cmNlX3VybCkNCiAgICAgICAgICAgICAgICANCiAgICAgICAgaWYgaXNpbnN0YW5jZShkYXRhLEJlYXV0aWZ1bFNPQVApOg0KICAgICAgICAgICAgaWYgZGF0YS5maW5kKCdjaGFubmVsc19pbmZvJyk6DQogICAgICAgICAgICAgICAgbWVkaWFfaW5mbyA9IGRhdGEuY2hhbm5lbHNfaW5mbw0KICAgICAgICAgICAgZWxpZiBkYXRhLmZpbmQoJ2l0ZW1zX2luZm8nKToNCiAgICAgICAgICAgICAgICBtZWRpYV9pbmZvID0gZGF0YS5pdGVtc19pbmZvDQogICAgICAgIGlmIG1lZGlhX2luZm86DQogICAgICAgICAgICBzb3VyY2VfbWVkaWEgPSB7fQ0KICAgICAgICAgICAgc291cmNlX21lZGlhWyd1cmwnXSA9IHNvdXJjZV91cmwNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWyd0aXRsZSddID0gbWVkaWFfaW5mby50aXRsZS5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ3RodW1ibmFpbCddID0gbWVkaWFfaW5mby50aHVtYm5haWwuc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydmYW5hcnQnXSA9IG1lZGlhX2luZm8uZmFuYXJ0LnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZ2VucmUnXSA9IG1lZGlhX2luZm8uZ2VucmUuc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydkZXNjcmlwdGlvbiddID0gbWVkaWFfaW5mby5kZXNjcmlwdGlvbi5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2RhdGUnXSA9IG1lZGlhX2luZm8uZGF0ZS5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2NyZWRpdHMnXSA9IG1lZGlhX2luZm8uY3JlZGl0cy5zdHJpbmcNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgaWYgJy8nIGluIHNvdXJjZV91cmw6DQogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHNvdXJjZV91cmwuc3BsaXQoJy8nKVstMV0uc3BsaXQoJy4nKVswXQ0KICAgICAgICAgICAgaWYgJ1xcJyBpbiBzb3VyY2VfdXJsOg0KICAgICAgICAgICAgICAgIG5hbWVTdHIgPSBzb3VyY2VfdXJsLnNwbGl0KCdcXCcpWy0xXS5zcGxpdCgnLicpWzBdDQogICAgICAgICAgICBpZiAnJScgaW4gbmFtZVN0cjoNCiAgICAgICAgICAgICAgICBuYW1lU3RyID0gdXJsbGliLnVucXVvdGVfcGx1cyhuYW1lU3RyKQ0KICAgICAgICAgICAga2V5Ym9hcmQgPSB4Ym1jLktleWJvYXJkKG5hbWVTdHIsJ0Rpc3BsYXllZCBOYW1lLCBSZW5hbWU/JykNCiAgICAgICAgICAgIGtleWJvYXJkLmRvTW9kYWwoKQ0KICAgICAgICAgICAgaWYgKGtleWJvYXJkLmlzQ29uZmlybWVkKCkgPT0gRmFsc2UpOg0KICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgbmV3U3RyID0ga2V5Ym9hcmQuZ2V0VGV4dCgpDQogICAgICAgICAgICBpZiBsZW4obmV3U3RyKSA9PSAwOg0KICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgc291cmNlX21lZGlhID0ge30NCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndGl0bGUnXSA9IG5ld1N0cg0KICAgICAgICAgICAgc291cmNlX21lZGlhWyd1cmwnXSA9IHNvdXJjZV91cmwNCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsnZmFuYXJ0J10gPSBmYW5hcnQNCg0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PUZhbHNlOg0KICAgICAgICAgICAgc291cmNlX2xpc3QgPSBbXQ0KICAgICAgICAgICAgc291cmNlX2xpc3QuYXBwZW5kKHNvdXJjZV9tZWRpYSkNCiAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikNCiAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VfbGlzdCkpDQogICAgICAgICAgICBiLmNsb3NlKCkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHNvdXJjZXMgPSBqc29uLmxvYWRzKG9wZW4oc291cmNlX2ZpbGUsInIiKS5yZWFkKCkpDQogICAgICAgICAgICBzb3VyY2VzLmFwcGVuZChzb3VyY2VfbWVkaWEpDQogICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpDQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlcykpDQogICAgICAgICAgICBiLmNsb3NlKCkNCiAgICAgICAgYWRkb24uc2V0U2V0dGluZygnbmV3X3VybF9zb3VyY2UnLCAiIikNCiAgICAgICAgYWRkb24uc2V0U2V0dGluZygnbmV3X2ZpbGVfc291cmNlJywgIiIpDQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEhlcmN1bGVzLE5ldyBzb3VyY2UgYWRkZWQuLDUwMDAsIitpY29uKyIpIikNCiAgICAgICAgaWYgbm90IHVybCBpcyBOb25lOg0KICAgICAgICAgICAgaWYgJ3hibWNwbHVzLnhiLmZ1bnBpYy5kZScgaW4gdXJsOg0KICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlVwZGF0ZSglcz9tb2RlPTE0LHJlcGxhY2UpIiAlc3lzLmFyZ3ZbMF0pDQogICAgICAgICAgICBlbGlmICdjb21tdW5pdHktbGlua3MnIGluIHVybDoNCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5VcGRhdGUoJXM/bW9kZT0xMCxyZXBsYWNlKSIgJXN5cy5hcmd2WzBdKQ0KICAgICAgICBlbHNlOiBhZGRvbi5vcGVuU2V0dGluZ3MoKQ0KDQpkZWYgcm1Tb3VyY2UobmFtZSk6DQogICAgICAgIHNvdXJjZXMgPSBqc29uLmxvYWRzKG9wZW4oc291cmNlX2ZpbGUsInIiKS5yZWFkKCkpDQogICAgICAgIGZvciBpbmRleCBpbiByYW5nZShsZW4oc291cmNlcykpOg0KICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzb3VyY2VzW2luZGV4XSwgbGlzdCk6DQogICAgICAgICAgICAgICAgaWYgc291cmNlc1tpbmRleF1bMF0gPT0gbmFtZToNCiAgICAgICAgICAgICAgICAgICAgZGVsIHNvdXJjZXNbaW5kZXhdDQogICAgICAgICAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikNCiAgICAgICAgICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQ0KICAgICAgICAgICAgICAgICAgICBiLmNsb3NlKCkNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgaWYgc291cmNlc1tpbmRleF1bJ3RpdGxlJ10gPT0gbmFtZToNCiAgICAgICAgICAgICAgICAgICAgZGVsIHNvdXJjZXNbaW5kZXhdDQogICAgICAgICAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikNCiAgICAgICAgICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQ0KICAgICAgICAgICAgICAgICAgICBiLmNsb3NlKCkNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuUmVmcmVzaCIpDQoNCmRlZiBnZXRfeG1sX2RhdGFiYXNlKHVybCwgYnJvd3NlPUZhbHNlKToNCiAgICAgICAgaWYgdXJsIGlzIE5vbmU6DQogICAgICAgICAgICB1cmwgPSAnaHR0cDovL3hibWNwbHVzLnhiLmZ1bnBpYy5kZS93d3ctZGF0YS9maWxlc3lzdGVtLycNCiAgICAgICAgc291cCA9IEJlYXV0aWZ1bFNvdXAobWFrZVJlcXVlc3QodXJsKSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFNvdXAuSFRNTF9FTlRJVElFUykNCiAgICAgICAgZm9yIGkgaW4gc291cCgnYScpOg0KICAgICAgICAgICAgaHJlZiA9IGlbJ2hyZWYnXQ0KICAgICAgICAgICAgaWYgbm90IGhyZWYuc3RhcnRzd2l0aCgnPycpOg0KICAgICAgICAgICAgICAgIG5hbWUgPSBpLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIG5hbWUgbm90IGluIFsnUGFyZW50IERpcmVjdG9yeScsICdyZWN5Y2xlX2Jpbi8nXToNCiAgICAgICAgICAgICAgICAgICAgaWYgaHJlZi5lbmRzd2l0aCgnLycpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnJvd3NlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDE1LGljb24sZmFuYXJ0LCcnLCcnLCcnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxNCxpY29uLGZhbmFydCwnJywnJywnJykNCiAgICAgICAgICAgICAgICAgICAgZWxpZiBocmVmLmVuZHN3aXRoKCcueG1sJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBicm93c2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5hbWUgaW4gU09VUkNFUzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lKycgKGluIHVzZSknLHVybCtocmVmLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpDQoNCg0KZGVmIGdldENvbW11bml0eVNvdXJjZXMoYnJvd3NlPUZhbHNlKToNCiAgICAgICAgdXJsID0gJ2h0dHA6Ly9jb21tdW5pdHktbGlua3MuZ29vZ2xlY29kZS5jb20vc3ZuL3RydW5rLycNCiAgICAgICAgc291cCA9IEJlYXV0aWZ1bFNvdXAobWFrZVJlcXVlc3QodXJsKSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFNvdXAuSFRNTF9FTlRJVElFUykNCiAgICAgICAgZmlsZXMgPSBzb3VwKCd1bCcpWzBdKCdsaScpWzE6XQ0KICAgICAgICBmb3IgaSBpbiBmaWxlczoNCiAgICAgICAgICAgIG5hbWUgPSBpKCdhJylbMF1bJ2hyZWYnXQ0KICAgICAgICAgICAgaWYgYnJvd3NlOg0KICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtuYW1lLDEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK25hbWUsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykNCg0KZGVmIGdldFNvdXAodXJsLGRhdGE9Tm9uZSk6DQogICAgICAgIGdsb2JhbCB2aWV3bW9kZSx0c2Rvd25sb2FkZXIsIGhsc3JldHJ5DQogICAgICAgIHRzZG93bmxvYWRlcj1GYWxzZQ0KICAgICAgICBobHNyZXRyeT1GYWxzZQ0KICAgICAgICBpZiB1cmwuc3RhcnRzd2l0aCgnaHR0cDovLycpIG9yIHVybC5zdGFydHN3aXRoKCdodHRwczovLycpOg0KICAgICAgICAgICAgZW5ja2V5PUZhbHNlDQogICAgICAgICAgICBpZiAnJCRUU0RPV05MT0FERVIkJCcgaW4gdXJsOg0KICAgICAgICAgICAgICAgIHRzZG93bmxvYWRlcj1UcnVlDQogICAgICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCIkJFRTRE9XTkxPQURFUiQkIiwiIikNCiAgICAgICAgICAgIGlmICckJEhMU1JFVFJZJCQnIGluIHVybDoNCiAgICAgICAgICAgICAgICBobHNyZXRyeT1UcnVlDQogICAgICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCIkJEhMU1JFVFJZJCQiLCIiKQ0KICAgICAgICAgICAgaWYgJyQkTFNQcm9FbmNLZXk9JyBpbiB1cmw6DQogICAgICAgICAgICAgICAgZW5ja2V5PXVybC5zcGxpdCgnJCRMU1Byb0VuY0tleT0nKVsxXS5zcGxpdCgnJCQnKVswXQ0KICAgICAgICAgICAgICAgIHJwPSckJExTUHJvRW5jS2V5PSVzJCQnJWVuY2tleQ0KICAgICAgICAgICAgICAgIHVybD11cmwucmVwbGFjZShycCwiIikNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIGRhdGEgPW1ha2VSZXF1ZXN0KHVybCkNCiAgICAgICAgICAgIGlmIGVuY2tleToNCiAgICAgICAgICAgICAgICAgICAgaW1wb3J0IHB5YWVzDQogICAgICAgICAgICAgICAgICAgIGVuY2tleT1lbmNrZXkuZW5jb2RlKCJhc2NpaSIpDQogICAgICAgICAgICAgICAgICAgIHByaW50IGVuY2tleQ0KICAgICAgICAgICAgICAgICAgICBtaXNzaW5nYnl0ZXM9MTYtbGVuKGVuY2tleSkNCiAgICAgICAgICAgICAgICAgICAgZW5ja2V5PWVuY2tleSsoY2hyKDApKihtaXNzaW5nYnl0ZXMpKQ0KICAgICAgICAgICAgICAgICAgICBwcmludCByZXByKGVuY2tleSkNCiAgICAgICAgICAgICAgICAgICAgZGF0YT1iYXNlNjQuYjY0ZGVjb2RlKGRhdGEpDQogICAgICAgICAgICAgICAgICAgIGRlY3J5cHRvciA9IHB5YWVzLm5ldyhlbmNrZXkgLCBweWFlcy5NT0RFX0VDQiwgSVY9Tm9uZSkNCiAgICAgICAgICAgICAgICAgICAgZGF0YT1kZWNyeXB0b3IuZGVjcnlwdChkYXRhKS5zcGxpdCgnXDAnKVswXQ0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgcmVwcihkYXRhKQ0KICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCIjRVhUTTNVIixkYXRhKSBvciAnbTN1JyBpbiB1cmw6DQojICAgICAgICAgICAgICAgIHByaW50ICdmb3VuZCBtM3UgZGF0YScNCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQ0KICAgICAgICBlbGlmIGRhdGEgPT0gTm9uZToNCiAgICAgICAgICAgIGlmIG5vdCAnLycgIGluIHVybCBvciBub3QgJ1xcJyBpbiB1cmw6DQojICAgICAgICAgICAgICAgIHByaW50ICdObyBkaXJlY3RvcnkgZm91bmQuIExldHMgbWFrZSB0aGUgdXJsIHRvIGNhY2hlIGRpcicNCiAgICAgICAgICAgICAgICB1cmwgPSBvcy5wYXRoLmpvaW4oY29tbXVuaXR5ZmlsZXMsdXJsKQ0KICAgICAgICAgICAgaWYgeGJtY3Zmcy5leGlzdHModXJsKToNCiAgICAgICAgICAgICAgICBpZiB1cmwuc3RhcnRzd2l0aCgic21iOi8vIikgb3IgdXJsLnN0YXJ0c3dpdGgoIm5mczovLyIpOg0KICAgICAgICAgICAgICAgICAgICBjb3B5ID0geGJtY3Zmcy5jb3B5KHVybCwgb3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JykpDQogICAgICAgICAgICAgICAgICAgIGlmIGNvcHk6DQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gb3Blbihvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSwgInIiKS5yZWFkKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHhibWN2ZnMuZGVsZXRlKG9zLnBhdGguam9pbihwcm9maWxlLCAndGVtcCcsICdzb3JjZV90ZW1wLnR4dCcpKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJmYWlsZWQgdG8gY29weSBmcm9tIHNtYjoiKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBvcGVuKHVybCwgJ3InKS5yZWFkKCkNCiAgICAgICAgICAgICAgICAgICAgaWYgcmUubWF0Y2goIiNFWFRNM1UiLGRhdGEpb3IgJ20zdScgaW4gdXJsOg0KIyAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdmb3VuZCBtM3UgZGF0YScNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiU291cCBEYXRhIG5vdCBmb3VuZCEiKQ0KICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICBpZiAnPFNldFZpZXdNb2RlPicgaW4gZGF0YToNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICB2aWV3bW9kZT1yZS5maW5kYWxsKCc8U2V0Vmlld01vZGU+KC4qPyk8JyxkYXRhKVswXQ0KICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSglcykiJXZpZXdtb2RlKQ0KICAgICAgICAgICAgICAgIHByaW50ICdkb25lIHNldHZpZXcnLHZpZXdtb2RlDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgcmV0dXJuIEJlYXV0aWZ1bFNPQVAoZGF0YSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFN0b25lU291cC5YTUxfRU5USVRJRVMpDQoNCmRlZiBwcm9jZXNzUHlGdW5jdGlvbihkYXRhKToNCiAgICB0cnk6DQogICAgICAgIGlmIGRhdGEgYW5kIGxlbihkYXRhKT4wIGFuZCBkYXRhLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOg0KICAgICAgICAgICAgZGF0YT1kb0V2YWwoZGF0YS5zcGxpdCgnJHB5RnVuY3Rpb246JylbMV0sJycsTm9uZSxOb25lICkNCiAgICBleGNlcHQ6IHBhc3MNCg0KICAgIHJldHVybiBkYXRhDQoNCmRlZiBnZXREYXRhKHVybCxmYW5hcnQsIGRhdGE9Tm9uZSk6DQogICAgaW1wb3J0IGNoZWNrYmFkDQogICAgY2hlY2tiYWQuZG9fYmxvY2tfY2hlY2soRmFsc2UpDQogICAgc291cCA9IGdldFNvdXAodXJsLGRhdGEpDQogICAgI3ByaW50IHR5cGUoc291cCkNCiAgICBpZiBpc2luc3RhbmNlKHNvdXAsQmVhdXRpZnVsU09BUCk6DQogICAgI3ByaW50ICd4eHh4eHh4eHh4c291cCcsc291cA0KICAgICAgICBpZiBsZW4oc291cCgnY2hhbm5lbHMnKSkgPiAwIGFuZCBhZGRvbi5nZXRTZXR0aW5nKCdkb25vdHNob3dieWNoYW5uZWxzJykgPT0gJ2ZhbHNlJzoNCiAgICAgICAgICAgIGNoYW5uZWxzID0gc291cCgnY2hhbm5lbCcpDQogICAgICAgICAgICBmb3IgY2hhbm5lbCBpbiBjaGFubmVsczoNCiMgICAgICAgICAgICAgICAgcHJpbnQgY2hhbm5lbA0KDQogICAgICAgICAgICAgICAgbGlua2VkVXJsPScnDQogICAgICAgICAgICAgICAgbGNvdW50PTANCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGxpbmtlZFVybCA9ICBjaGFubmVsKCdleHRlcm5hbGxpbmsnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgbGNvdW50PWxlbihjaGFubmVsKCdleHRlcm5hbGxpbmsnKSkNCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgICAgICAjcHJpbnQgJ2xpbmtlZFVybCcsbGlua2VkVXJsLGxjb3VudA0KICAgICAgICAgICAgICAgIGlmIGxjb3VudD4xOiBsaW5rZWRVcmw9JycNCg0KICAgICAgICAgICAgICAgIG5hbWUgPSBjaGFubmVsKCduYW1lJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBuYW1lPXByb2Nlc3NQeUZ1bmN0aW9uKG5hbWUpDQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGNoYW5uZWwoJ3RodW1ibmFpbCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJw0KICAgICAgICAgICAgICAgIHRodW1ibmFpbD1wcm9jZXNzUHlGdW5jdGlvbih0aHVtYm5haWwpDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBpZiBub3QgY2hhbm5lbCgnZmFuYXJ0Jyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gdGh1bWJuYWlsDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydA0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbCgnZmFuYXJ0JylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydA0KDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBkZXNjID0gY2hhbm5lbCgnaW5mbycpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgZGVzYyA9ICcnDQoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGdlbnJlID0gY2hhbm5lbCgnZ2VucmUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBnZW5yZSA9ICcnDQoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGRhdGUgPSBjaGFubmVsKCdkYXRlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgIGlmIGRhdGUgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBkYXRlID0gJycNCg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9IGNoYW5uZWwoJ2NyZWRpdHMnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgaWYgY3JlZGl0cyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJw0KDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBpZiBsaW5rZWRVcmw9PScnOg0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx1cmwuZW5jb2RlKCd1dGYtOCcpLDIsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsY3JlZGl0cyxUcnVlKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmtlZFVybA0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLGxpbmtlZFVybC5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBkaXJlY3RvcnkgZnJvbSBnZXREYXRhKCk6ICcrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgYWRkb25fbG9nKCdObyBDaGFubmVsczogZ2V0SXRlbXMnKQ0KICAgICAgICAgICAgZ2V0SXRlbXMoc291cCgnaXRlbScpLGZhbmFydCkNCiAgICBlbHNlOg0KICAgICAgICBwYXJzZV9tM3Uoc291cCkNCiMgYm9ycm93IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2VuZW45Mi9QMlAtU3RyZWFtcy1YQk1DL2Jsb2IvbWFzdGVyL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy9yZXNvdXJjZXMvY29yZS9saXZlc3RyZWFtcy5weQ0KIyBUaGlzIHdpbGwgbm90IGdvIHRocm91Z2ggdGhlIGdldEl0ZW1zIGZ1bmN0aW9ucyAoIG1lYW5zIHlvdSBtdXN0IGhhdmUgcmVhZHkgdG8gcGxheSB1cmwsIG5vIHJlZ2V4KQ0KZGVmIHBhcnNlX20zdShkYXRhKToNCiAgICBjb250ZW50ID0gZGF0YS5yc3RyaXAoKQ0KICAgIG1hdGNoID0gcmUuY29tcGlsZShyJyNFWFRJTkY6KC4rPyksKC4qPylbXG5ccl0rKFteXHJcbl0rKScpLmZpbmRhbGwoY29udGVudCkNCiAgICB0b3RhbCA9IGxlbihtYXRjaCkNCiAgICBwcmludCAndHNkb3dubG9hZGVyJyx0c2Rvd25sb2FkZXINCiMgICAgcHJpbnQgJ3RvdGFsIG0zdSBsaW5rcycsdG90YWwNCiAgICBmb3Igb3RoZXIsY2hhbm5lbF9uYW1lLHN0cmVhbV91cmwgaW4gbWF0Y2g6DQogICAgICAgIA0KICAgICAgICBpZiAndHZnLWxvZ28nIGluIG90aGVyOg0KICAgICAgICAgICAgdGh1bWJuYWlsID0gcmVfbWUob3RoZXIsJ3R2Zy1sb2dvPVtcJyJdKC4qPylbXCciXScpDQogICAgICAgICAgICBpZiB0aHVtYm5haWw6DQogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gdGh1bWJuYWlsDQoNCiAgICAgICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKSA9PSAiIjoNCiAgICAgICAgICAgICAgICAgICAgbG9nb191cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKQ0KICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBsb2dvX3VybCArIHRodW1ibmFpbA0KDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gdGh1bWJuYWlsDQogICAgICAgICAgICAjZWxzZToNCg0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgdGh1bWJuYWlsID0gJycNCiAgICAgICAgDQogICAgICAgIGlmICd0eXBlJyBpbiBvdGhlcjoNCiAgICAgICAgICAgIG1vZGVfdHlwZSA9IHJlX21lKG90aGVyLCd0eXBlPVtcJyJdKC4qPylbXCciXScpDQogICAgICAgICAgICBpZiBtb2RlX3R5cGUgPT0gJ3l0LWRsJzoNCiAgICAgICAgICAgICAgICBzdHJlYW1fdXJsID0gc3RyZWFtX3VybCArIiZtb2RlPTE4Ig0KICAgICAgICAgICAgZWxpZiBtb2RlX3R5cGUgPT0gJ3JlZ2V4JzoNCiAgICAgICAgICAgICAgICB1cmwgPSBzdHJlYW1fdXJsLnNwbGl0KCcmcmVnZXhzPScpDQogICAgICAgICAgICAgICAgI3ByaW50IHVybFswXSBnZXRTb3VwKHVybCxkYXRhPU5vbmUpDQogICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgoZ2V0U291cCgnJyxkYXRhPXVybFsxXSkpDQoNCiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybFswXSwgY2hhbm5lbF9uYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLHJlZ2V4cyx0b3RhbCkNCiAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgZWxpZiBtb2RlX3R5cGUgPT0gJ2Z0dic6DQogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uRi5ULlYvP25hbWU9Jyt1cmxsaWIucXVvdGUoY2hhbm5lbF9uYW1lKSArJyZ1cmw9JyArc3RyZWFtX3VybCArJyZtb2RlPTEyNSZjaF9mYW5hcnQ9bmEnDQogICAgICAgIGVsaWYgdHNkb3dubG9hZGVyIGFuZCAnLnRzJyBpbiBzdHJlYW1fdXJsOg0KICAgICAgICAgICAgc3RyZWFtX3VybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhzdHJlYW1fdXJsKSsnJmFtcDtzdHJlYW10eXBlPVRTRE9XTkxPQURFUiZuYW1lPScrdXJsbGliLnF1b3RlKGNoYW5uZWxfbmFtZSkNCiAgICAgICAgZWxpZiBobHNyZXRyeSBhbmQgJy5tM3U4JyBpbiBzdHJlYW1fdXJsOg0KICAgICAgICAgICAgc3RyZWFtX3VybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhzdHJlYW1fdXJsKSsnJmFtcDtzdHJlYW10eXBlPUhMU1JFVFJZJm5hbWU9Jyt1cmxsaWIucXVvdGUoY2hhbm5lbF9uYW1lKQ0KICAgICAgICBhZGRMaW5rKHN0cmVhbV91cmwsIGNoYW5uZWxfbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSwnJyx0b3RhbCkNCmRlZiBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KToNCiAgICAgICAgc291cCA9IGdldFNvdXAodXJsKQ0KICAgICAgICBjaGFubmVsX2xpc3QgPSBzb3VwLmZpbmQoJ2NoYW5uZWwnLCBhdHRycz17J25hbWUnIDogbmFtZS5kZWNvZGUoJ3V0Zi04Jyl9KQ0KICAgICAgICBpdGVtcyA9IGNoYW5uZWxfbGlzdCgnaXRlbScpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWxfbGlzdCgnZmFuYXJ0JylbMF0uc3RyaW5nDQogICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQNCiAgICAgICAgZm9yIGNoYW5uZWwgaW4gY2hhbm5lbF9saXN0KCdzdWJjaGFubmVsJyk6DQogICAgICAgICAgICBuYW1lID0gY2hhbm5lbCgnbmFtZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIG5hbWU9cHJvY2Vzc1B5RnVuY3Rpb24obmFtZSkNCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGNoYW5uZWwoJ3RodW1ibmFpbCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgICAgIHRodW1ibmFpbD1wcm9jZXNzUHlGdW5jdGlvbih0aHVtYm5haWwpDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gJycNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpZiBub3QgY2hhbm5lbCgnZmFuYXJ0Jyk6DQogICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IHRodW1ibmFpbA0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWwoJ2ZhbmFydCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBkZXNjID0gY2hhbm5lbCgnaW5mbycpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGRlc2MgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBkZXNjID0gJycNCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGdlbnJlID0gY2hhbm5lbCgnZ2VucmUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGdlbnJlID0gJycNCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGRhdGUgPSBjaGFubmVsKCdkYXRlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgZGF0ZSA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGRhdGUgPSAnJw0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgY3JlZGl0cyA9IGNoYW5uZWwoJ2NyZWRpdHMnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBjcmVkaXRzID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgY3JlZGl0cyA9ICcnDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHVybC5lbmNvZGUoJ3V0Zi04JyksMyx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsY3JlZGl0cyxkYXRlKQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnVGhlcmUgd2FzIGEgcHJvYmxlbSBhZGRpbmcgZGlyZWN0b3J5IC0gJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQogICAgICAgIGdldEl0ZW1zKGl0ZW1zLGZhbkFydCkNCg0KDQpkZWYgZ2V0U3ViQ2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCk6DQogICAgICAgIHNvdXAgPSBnZXRTb3VwKHVybCkNCiAgICAgICAgY2hhbm5lbF9saXN0ID0gc291cC5maW5kKCdzdWJjaGFubmVsJywgYXR0cnM9eyduYW1lJyA6IG5hbWUuZGVjb2RlKCd1dGYtOCcpfSkNCiAgICAgICAgaXRlbXMgPSBjaGFubmVsX2xpc3QoJ3N1Yml0ZW0nKQ0KICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5hcnQpDQoNCmRlZiBnZXRJdGVtcyhpdGVtcyxmYW5hcnQsZG9udExpbms9RmFsc2UpOg0KICAgICAgICB0b3RhbCA9IGxlbihpdGVtcykNCiAgICAgICAgYWRkb25fbG9nKCdUb3RhbCBJdGVtczogJXMnICV0b3RhbCkNCiAgICAgICAgYWRkX3BsYXlsaXN0ID0gYWRkb24uZ2V0U2V0dGluZygnYWRkX3BsYXlsaXN0JykNCiAgICAgICAgYXNrX3BsYXlsaXN0X2l0ZW1zID1hZGRvbi5nZXRTZXR0aW5nKCdhc2tfcGxheWxpc3RfaXRlbXMnKQ0KICAgICAgICB1c2VfdGh1bWIgPSBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKQ0KICAgICAgICBwYXJlbnRhbGJsb2NrID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWQnKQ0KICAgICAgICBwYXJlbnRhbGJsb2NrPSBwYXJlbnRhbGJsb2NrPT0idHJ1ZSINCg0KICAgICAgICBmb3IgaXRlbSBpbiBpdGVtczoNCiAgICAgICAgICAgIGlzWE1MU291cmNlPUZhbHNlDQogICAgICAgICAgICBpc0pzb25ycGMgPSBGYWxzZQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBhcHBseWJsb2NrPSdmYWxzZScNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBhcHBseWJsb2NrID0gaXRlbSgncGFyZW50YWxibG9jaycpWzBdLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGFkZG9uX2xvZygncGFyZW50YWxibG9jayBFcnJvcicpDQogICAgICAgICAgICAgICAgYXBwbHlibG9jayA9ICcnDQogICAgICAgICAgICBpZiBhcHBseWJsb2NrPT0ndHJ1ZScgYW5kIHBhcmVudGFsYmxvY2s6IGNvbnRpbnVlDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBuYW1lID0gaXRlbSgndGl0bGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBuYW1lIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgICAgIG5hbWUgPSAndW5rbm93bj8nDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBuYW1lPXByb2Nlc3NQeUZ1bmN0aW9uKG5hbWUpDQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdOYW1lIEVycm9yJykNCiAgICAgICAgICAgICAgICBuYW1lID0gJycNCg0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgaXRlbSgnZXBnJyk6DQogICAgICAgICAgICAgICAgICAgIGlmIGl0ZW0uZXBnX3VybDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnR2V0IEVQRyBSZWdleCcpDQogICAgICAgICAgICAgICAgICAgICAgICBlcGdfdXJsID0gaXRlbS5lcGdfdXJsLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXBnX3JlZ2V4ID0gaXRlbS5lcGdfcmVnZXguc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBlcGdfbmFtZSA9IGdldF9lcGcoZXBnX3VybCwgZXBnX3JlZ2V4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZXBnX25hbWU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSAnIC0gJyArIGVwZ19uYW1lDQogICAgICAgICAgICAgICAgICAgIGVsaWYgaXRlbSgnZXBnJylbMF0uc3RyaW5nID4gMToNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgKz0gZ2V0ZXBnKGl0ZW0oJ2VwZycpWzBdLnN0cmluZykNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdFUEcgRXJyb3InKQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHVybCA9IFtdDQogICAgICAgICAgICAgICAgaWYgbGVuKGl0ZW0oJ2xpbmsnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgICNwcmludCAnaXRlbSBsaW5rJywgaXRlbSgnbGluaycpDQoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnbGluaycpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChpLnN0cmluZykNCg0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3Nwb3J0c2RldmlsJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdzcG9ydHNkZXZpbCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvcnRzZGV2aWwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsLz9tb2RlPTEmYW1wO2l0ZW09Y2F0Y2hlciUzZHN0cmVhbXMlMjZ1cmw9JyAraS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVyID0gaXRlbSgncmVmZXJlcicpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlZmVyZXI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAncmVmZXJlciBmb3VuZCcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvcnRzZGV2aWwgPSBzcG9ydHNkZXZpbCArICclMjZyZWZlcmVyPScgK3JlZmVyZXINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHNwb3J0c2RldmlsKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3AycCcpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgncDJwJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnc29wOi8vJyBpbiBpLnN0cmluZzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29wID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy8/bW9kZT0ydXJsPScraS5zdHJpbmcgKycmJyArICduYW1lPScrbmFtZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHNvcCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwMnA9J3BsdWdpbjovL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy8/bW9kZT0xJnVybD0nK2kuc3RyaW5nICsnJicgKyAnbmFtZT0nK25hbWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChwMnApDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgndmF1Z2huJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd2YXVnaG4nKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhdWdobiA9ICdwbHVnaW46Ly9wbHVnaW4uc3RyZWFtLnZhdWdobmxpdmUudHYvP21vZGU9UGxheUxpdmVTdHJlYW0mYW1wO2NoYW5uZWw9JytpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQodmF1Z2huKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2lsaXZlJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdpbGl2ZScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90ICdodHRwJyBpbiBpLnN0cmluZzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWxpdmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnRiaC5pbGl2ZS8/dXJsPWh0dHA6Ly93d3cuc3RyZWFtbGl2ZS50by92aWV3LycraS5zdHJpbmcrJyZhbXA7bGluaz05OSZhbXA7bW9kZT1pTGl2ZVBsYXknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWxpdmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnRiaC5pbGl2ZS8/dXJsPScraS5zdHJpbmcrJyZhbXA7bGluaz05OSZhbXA7bW9kZT1pTGl2ZVBsYXknDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgneXQtZGwnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3l0LWRsJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dGRsID0gaS5zdHJpbmcgKyAnJm1vZGU9MTgnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh5dGRsKQ0KICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2RtJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdkbScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG0gPSAicGx1Z2luOi8vcGx1Z2luLnZpZGVvLmRhaWx5bW90aW9uX2NvbS8/bW9kZT1wbGF5VmlkZW8mdXJsPSIgKyBpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoZG0pDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnZG1saXZlJykpID4wOg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdkbWxpdmUnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtID0gInBsdWdpbjovL3BsdWdpbi52aWRlby5kYWlseW1vdGlvbl9jb20vP21vZGU9cGxheUxpdmVWaWRlbyZ1cmw9IiArIGkuc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChkbSkNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd1dHViZScpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgndXR1YmUnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICcgJyBpbiBpLnN0cmluZyA6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3NlYXJjaC8/cT0nKyB1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNKc29ucnBjPXV0dWJlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBsZW4oaS5zdHJpbmcpID09IDExOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz92aWRlb19pZD0nKyBpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgKGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1BMJykgYW5kIG5vdCAnJm9yZGVyPScgaW4gaS5zdHJpbmcpIG9yIGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1VVJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvPyZvcmRlcj1kZWZhdWx0JnBsYXlsaXN0X2lkPScgKyBpLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgaS5zdHJpbmcuc3RhcnRzd2l0aCgnUEwnKSBvciBpLnN0cmluZy5zdGFydHN3aXRoKCdVVScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz9wbGF5bGlzdF9pZD0nICsgaS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1VDJykgYW5kIGxlbihpLnN0cmluZykgPiAxMjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvY2hhbm5lbC8nICsgaS5zdHJpbmcgKyAnLycNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNKc29ucnBjPXV0dWJlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBub3QgaS5zdHJpbmcuc3RhcnRzd2l0aCgnVUMnKSBhbmQgbm90IChpLnN0cmluZy5zdGFydHN3aXRoKCdQTCcpKSAgOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS91c2VyLycgKyBpLnN0cmluZyArICcvJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0pzb25ycGM9dXR1YmUNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQodXR1YmUpDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnaW1kYicpKSA+MDoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnaW1kYicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnZ2VuZXNpc29ycHVsc2FyJykgPT0gJzAnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWRiID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5nZW5lc2lzLz9hY3Rpb249cGxheSZpbWRiPScraS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWRiID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5wdWxzYXIvbW92aWUvdHQnK2kuc3RyaW5nKycvcGxheScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGltZGIpDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnZjRtJykpID4wOg0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnZjRtJyk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICcuZjRtJyBpbiBpLnN0cmluZzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGY0bSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAnLm0zdTgnIGluIGkuc3RyaW5nOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKSsnJmFtcDtzdHJlYW10eXBlPUhMUycNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKSsnJmFtcDtzdHJlYW10eXBlPVNJTVBMRScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGY0bSkNCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdmdHYnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2Z0dicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnR2ID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5GLlQuVi8/bmFtZT0nK3VybGxpYi5xdW90ZShuYW1lKSArJyZ1cmw9JyAraS5zdHJpbmcgKycmbW9kZT0xMjUmY2hfZmFuYXJ0PW5hJw0KICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChmdHYpDQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgndXJsc29sdmUnKSkgPjA6DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd1cmxzb2x2ZScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBpLnN0cmluZyArJyZtb2RlPTE5Jw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQocmVzb2x2ZXIpDQogICAgICAgICAgICAgICAgaWYgbGVuKHVybCkgPCAxOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnRXJyb3IgPGxpbms+IGVsZW1lbnQsIFBhc3Npbmc6JytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQogICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpc1hNTFNvdXJjZSA9IGl0ZW0oJ2V4dGVybmFsbGluaycpWzBdLnN0cmluZw0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQoNCiAgICAgICAgICAgIGlmIGlzWE1MU291cmNlOg0KICAgICAgICAgICAgICAgIGV4dF91cmw9W2lzWE1MU291cmNlXQ0KICAgICAgICAgICAgICAgIGlzWE1MU291cmNlPVRydWUNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2U9RmFsc2UNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpc0pzb25ycGMgPSBpdGVtKCdqc29ucnBjJylbMF0uc3RyaW5nDQogICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgIGlmIGlzSnNvbnJwYzoNCg0KICAgICAgICAgICAgICAgIGV4dF91cmw9W2lzSnNvbnJwY10NCiAgICAgICAgICAgICAgICAjcHJpbnQgJ0pTT04tUlBDIGV4dF91cmwnLGV4dF91cmwNCiAgICAgICAgICAgICAgICBpc0pzb25ycGM9VHJ1ZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBpc0pzb25ycGM9RmFsc2UNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBpdGVtKCd0aHVtYm5haWwnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgICAgICB0aHVtYm5haWw9cHJvY2Vzc1B5RnVuY3Rpb24odGh1bWJuYWlsKQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgbm90IGl0ZW0oJ2ZhbmFydCcpOg0KICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydA0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGl0ZW0oJ2ZhbmFydCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGRlc2MgPSBpdGVtKCdpbmZvJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByYWlzZQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGRlc2MgPSAnJw0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZ2VucmUgPSBpdGVtKCdnZW5yZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZ2VucmUgPSAnJw0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZGF0ZSA9IGl0ZW0oJ2RhdGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJhaXNlDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgZGF0ZSA9ICcnDQoNCiAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUNCiAgICAgICAgICAgIGlmIGl0ZW0oJ3JlZ2V4Jyk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICByZWdfaXRlbSA9IGl0ZW0oJ3JlZ2V4JykNCiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgocmVnX2l0ZW0pDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgbGVuKHVybCkgPiAxOg0KICAgICAgICAgICAgICAgICAgICBhbHQgPSAwDQogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0ID0gW10NCiAgICAgICAgICAgICAgICAgICAgaWdub3JlbGlzdHNldHRpbmc9VHJ1ZSBpZiAnJCRMU1BsYXlPbmx5T25lJCQnIGluIHVybFswXSBlbHNlIEZhbHNlDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiB1cmw6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIGFkZF9wbGF5bGlzdCA9PSAiZmFsc2UiIGFuZCBub3QgaWdub3JlbGlzdHNldHRpbmc6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdCArPSAxDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsoaSwnJXMpICVzJyAlKGFsdCwgbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICAoYWRkX3BsYXlsaXN0ID09ICJ0cnVlIiBhbmQgIGFza19wbGF5bGlzdF9pdGVtcyA9PSAndHJ1ZScpIG9yIGlnbm9yZWxpc3RzZXR0aW5nOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZWdleHM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSsnJnJlZ2V4cz0nK3JlZ2V4cykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAgYW55KHggaW4gaSBmb3IgeCBpbiByZXNvbHZlX3VybCkgYW5kICBpLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKycmbW9kZT0xOScpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmIGxlbihwbGF5bGlzdCkgPiAxOg0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKCcnLCBuYW1lLmVuY29kZSgndXRmLTgnKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgZG9udExpbms6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmFtZSx1cmxbMF0scmVnZXhzDQogICAgICAgICAgICAgICAgICAgIGlmIGlzWE1MU291cmNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZWdleHMgPT0gTm9uZTogIzxleHRlcm5hbGxpbms+IGFuZCA8cmVnZXg+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJyEhdXBkYXRlJyxyZWdleHMsdXJsWzBdLmVuY29kZSgndXRmLTgnKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI2FkZExpbmsodXJsWzBdLG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSsgICdbQ09MT1IgeWVsbG93XWJ1aWxkIFhNTFsvQ09MT1JdJyx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScsTm9uZSxOb25lKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLHVybFswXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQ0KICAgICAgICAgICAgICAgICAgICBlbGlmIGlzSnNvbnJwYzoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLDUzLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpDQogICAgICAgICAgICAgICAgICAgICAgICAjeGJtYy5leGVjdXRlYnVpbHRpbigiQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCkiKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZG9yZWdleCcgaW4gbmFtZSBhbmQgbm90IGdldFJlZ2V4UGFyc2VkPT1Ob25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG5hbWUsc2V0cmVzPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbmFtZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0bmFtZT09Tm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9dG5hbWUNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZG9yZWdleCcgaW4gdGh1bWJuYWlsIGFuZCBub3QgZ2V0UmVnZXhQYXJzZWQ9PU5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRuYW1lLHNldHJlcz1nZXRSZWdleFBhcnNlZChyZWdleHMsIHRodW1ibmFpbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHRuYW1lPT1Ob25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsPXRuYW1lDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQ0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3N1Y2Nlc3MnDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBpdGVtIC0gJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQoNCmRlZiBwYXJzZV9yZWdleChyZWdfaXRlbSk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICByZWdleHMgPSB7fQ0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByZWdfaXRlbToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXSA9IHt9DQogICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25hbWUnXT1pKCduYW1lJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAjcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXSA9IGkoJ2V4cHJlcycpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmVzJ10gPSBpKCdleHByZXMnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXT0nJw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFJlZmVyZXIgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwYWdlJ10gPSBpKCdwYWdlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydyZWZlcmVyJ10gPSBpKCdyZWZlcmVyJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gUmVmZXJlciAtLSIpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb25uZWN0aW9uJ10gPSBpKCdjb25uZWN0aW9uJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gY29ubmVjdGlvbiAtLSIpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vdHBsYXlhYmxlJ10gPSBpKCdub3RwbGF5YWJsZScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG5vdHBsYXlhYmxlIC0tIikNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnbm9yZWRpcmVjdCddID0gaSgnbm9yZWRpcmVjdCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG5vcmVkaXJlY3QgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnb3JpZ2luJ10gPSBpKCdvcmlnaW4nKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBvcmlnaW4gLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnYWNjZXB0J10gPSBpKCdhY2NlcHQnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBhY2NlcHQgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaW5jbHVkZWhlYWRlcnMnXSA9IGkoJ2luY2x1ZGVoZWFkZXJzJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gaW5jbHVkZWhlYWRlcnMgLS0iKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydsaXN0cmVwZWF0J10gPSBpKCdsaXN0cmVwZWF0JylbMF0uc3RyaW5nDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdsaXN0cmVwZWF0JyxyZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2xpc3RyZXBlYXQnXSxpKCdsaXN0cmVwZWF0JylbMF0uc3RyaW5nLCBpDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gbGlzdHJlcGVhdCAtLSIpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwcm94eSddID0gaSgncHJveHknKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBwcm94eSAtLSIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LXJlcSddID0gaSgneC1yZXEnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyB4LXJlcSAtLSIpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3gtYWRkciddID0gaSgneC1hZGRyJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8geC1hZGRyIC0tIikgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LWZvcndhcmQnXSA9IGkoJ3gtZm9yd2FyZCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIHgtZm9yd2FyZCAtLSIpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FnZW50J10gPSBpKCdhZ2VudCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFVzZXIgQWdlbnQgLS0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncG9zdCddID0gaSgncG9zdCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHBvc3QiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmF3cG9zdCddID0gaSgncmF3cG9zdCcpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJhd3Bvc3QiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaHRtbHVuZXNjYXBlJ10gPSBpKCdodG1sdW5lc2NhcGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBodG1sdW5lc2NhcGUiKQ0KDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3JlYWRjb29raWVvbmx5J10gPSBpKCdyZWFkY29va2llb25seScpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJlYWRDb29raWVPbmx5IikNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXSA9IGkoJ2Nvb2tpZWphcicpWzBdLnN0cmluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddPScnDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgY29va2llSmFyIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3NldGNvb2tpZSddID0gaSgnc2V0Y29va2llJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgc2V0Y29va2llIikNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FwcGVuZGNvb2tpZSddID0gaSgnYXBwZW5kY29va2llJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgYXBwZW5kY29va2llIikNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaWdub3JlY2FjaGUnXSA9IGkoJ2lnbm9yZWNhY2hlJylbMF0uc3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gbm8gaWdub3JlY2FjaGUiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgI3RyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpZ25vcmVjYWNoZSddID0gaSgnaWdub3JlY2FjaGUnKVswXS5zdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICNleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAjICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIG5vIGlnbm9yZWNhY2hlIikNCg0KICAgICAgICAgICAgICAgICAgICByZWdleHMgPSB1cmxsaWIucXVvdGUocmVwcihyZWdleHMpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZXhzDQogICAgICAgICAgICAgICAgICAgICNwcmludCByZWdleHMNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUNCiAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdyZWdleCBFcnJvcjogJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpDQojY29waWVzIGZyb20gbGFtZGEncyBpbXBsZW1lbnRhdGlvbg0KZGVmIGdldF91c3RyZWFtKHVybCk6DQogICAgdHJ5Og0KICAgICAgICBmb3IgaSBpbiByYW5nZSgxLCA1MSk6DQogICAgICAgICAgICByZXN1bHQgPSBnZXRVcmwodXJsKQ0KICAgICAgICAgICAgaWYgIkVYVC1YLVNUUkVBTS1JTkYiIGluIHJlc3VsdDogcmV0dXJuIHVybA0KICAgICAgICAgICAgaWYgbm90ICJFWFRNM1UiIGluIHJlc3VsdDogcmV0dXJuDQogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMDApDQogICAgICAgIHJldHVybg0KICAgIGV4Y2VwdDoNCiAgICAgICAgcmV0dXJuDQoNCmRlZiBnZXRSZWdleFBhcnNlZChyZWdleHMsIHVybCxjb29raWVKYXI9Tm9uZSxmb3JDb29raWVKYXJPbmx5PUZhbHNlLHJlY3Vyc2l2ZUNhbGw9RmFsc2UsY2FjaGVkUGFnZXM9e30sIHJhd1Bvc3Q9RmFsc2UsIGNvb2tpZV9qYXJfZmlsZT1Ob25lKTojMCwxLDIgPSBVUkwsIHJlZ2V4T25seSwgQ29va2llSmFyT25seQ0KICAgICAgICBpZiBub3QgcmVjdXJzaXZlQ2FsbDoNCiAgICAgICAgICAgIHJlZ2V4cyA9IGV2YWwodXJsbGliLnVucXVvdGUocmVnZXhzKSkNCiAgICAgICAgI2NhY2hlZFBhZ2VzID0ge30NCiAgICAgICAgI3ByaW50ICd1cmwnLHVybA0KICAgICAgICBkb1JlZ2V4cyA9IHJlLmNvbXBpbGUoJ1wkZG9yZWdleFxbKFteXF1dKilcXScpLmZpbmRhbGwodXJsKQ0KIyAgICAgICAgcHJpbnQgJ2RvUmVnZXhzJyxkb1JlZ2V4cyxyZWdleHMNCiAgICAgICAgc2V0cmVzb2x2ZWQ9VHJ1ZQ0KICAgICAgICBmb3IgayBpbiBkb1JlZ2V4czoNCiAgICAgICAgICAgIGlmIGsgaW4gcmVnZXhzOg0KICAgICAgICAgICAgICAgICNwcmludCAncHJvY2Vzc2luZyAnICxrDQogICAgICAgICAgICAgICAgbSA9IHJlZ2V4c1trXQ0KICAgICAgICAgICAgICAgICNwcmludCBtDQogICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09RmFsc2UNCiAgICAgICAgICAgICAgICBpZiAgJ2Nvb2tpZWphcicgaW4gbTogIyBzbyBlaXRoZXIgY3JlYXRlIG9yIHJldXNlIGV4aXN0aW5nIGphcg0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2Nvb2tpZWphciBleGlzdHMnLG1bJ2Nvb2tpZWphciddDQogICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPW1bJ2Nvb2tpZWphciddDQogICAgICAgICAgICAgICAgICAgIGlmICAnJGRvcmVnZXgnIGluIGNvb2tpZUphclBhcmFtOg0KICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnY29va2llamFyJ10sY29va2llSmFyLFRydWUsIFRydWUsY2FjaGVkUGFnZXMpDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPVRydWUNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPVRydWUNCiAgICAgICAgICAgICAgICAjcHJpbnQgJ21bY29va2llamFyXScsbVsnY29va2llamFyJ10sY29va2llSmFyDQogICAgICAgICAgICAgICAgaWYgY29va2llSmFyUGFyYW06DQogICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZUphcj09Tm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnY3JlYXRlIGNvb2tpZSBqYXInDQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9Tm9uZQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ29wZW5bJyBpbiBtWydjb29raWVqYXInXToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9bVsnY29va2llamFyJ10uc3BsaXQoJ29wZW5bJylbMV0uc3BsaXQoJ10nKVswXQ0KIyAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnY29va2llSmFyIGZyb20gZmlsZSBuYW1lJyxjb29raWVfamFyX2ZpbGUNCg0KICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyPWdldENvb2tpZUphcihjb29raWVfamFyX2ZpbGUpDQojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2Nvb2tpZUphciBmcm9tIGZpbGUnLGNvb2tpZUphcg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29va2llX2phcl9maWxlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDb29raWVKYXIoY29va2llSmFyLGNvb2tpZV9qYXJfZmlsZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICNpbXBvcnQgY29va2llbGliDQogICAgICAgICAgICAgICAgICAgICAgICAjY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpDQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2Nvb2tpZUphciBuZXcnLGNvb2tpZUphcg0KICAgICAgICAgICAgICAgICAgICBlbGlmICdzYXZlWycgaW4gbVsnY29va2llamFyJ106DQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9bVsnY29va2llamFyJ10uc3BsaXQoJ3NhdmVbJylbMV0uc3BsaXQoJ10nKVswXQ0KICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVfcGF0aD1vcy5wYXRoLmpvaW4ocHJvZmlsZSxjb29raWVfamFyX2ZpbGUpDQojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2NvbXBsZXRlX3BhdGgnLGNvbXBsZXRlX3BhdGgNCiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDb29raWVKYXIoY29va2llSmFyLGNvb2tpZV9qYXJfZmlsZSkNCiAgICAgICAgICAgICAgICBpZiAgbVsncGFnZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3BhZ2UnXToNCiAgICAgICAgICAgICAgICAgICAgcGc9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydwYWdlJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykNCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBnKT09MDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHBnPSdodHRwOi8vcmVnZXhmYWlsZWQnDQogICAgICAgICAgICAgICAgICAgIG1bJ3BhZ2UnXT1wZw0KDQogICAgICAgICAgICAgICAgaWYgJ3NldGNvb2tpZScgaW4gbSBhbmQgbVsnc2V0Y29va2llJ10gYW5kICckZG9yZWdleCcgaW4gbVsnc2V0Y29va2llJ106DQogICAgICAgICAgICAgICAgICAgIG1bJ3NldGNvb2tpZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnc2V0Y29va2llJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykNCiAgICAgICAgICAgICAgICBpZiAnYXBwZW5kY29va2llJyBpbiBtIGFuZCBtWydhcHBlbmRjb29raWUnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydhcHBlbmRjb29raWUnXToNCiAgICAgICAgICAgICAgICAgICAgbVsnYXBwZW5kY29va2llJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydhcHBlbmRjb29raWUnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQ0KDQoNCiAgICAgICAgICAgICAgICBpZiAgJ3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncG9zdCddOg0KICAgICAgICAgICAgICAgICAgICBtWydwb3N0J109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydwb3N0J10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykNCiMgICAgICAgICAgICAgICAgICAgIHByaW50ICdwb3N0IGlzIG5vdycsbVsncG9zdCddDQoNCiAgICAgICAgICAgICAgICBpZiAgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncmF3cG9zdCddOg0KICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydyYXdwb3N0J10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcyxyYXdQb3N0PVRydWUpDQogICAgICAgICAgICAgICAgICAgICNwcmludCAncmF3cG9zdCBpcyBub3cnLG1bJ3Jhd3Bvc3QnXQ0KDQogICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZXBvY3RpbWUkJyBpbiBtWydyYXdwb3N0J106DQogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1tWydyYXdwb3N0J10ucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkNCg0KICAgICAgICAgICAgICAgIGlmICdyYXdwb3N0JyBpbiBtIGFuZCAnJGVwb2N0aW1lMiQnIGluIG1bJ3Jhd3Bvc3QnXToNCiAgICAgICAgICAgICAgICAgICAgbVsncmF3cG9zdCddPW1bJ3Jhd3Bvc3QnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpDQoNCg0KICAgICAgICAgICAgICAgIGxpbms9JycNCiAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10gYW5kIG1bJ3BhZ2UnXSBpbiBjYWNoZWRQYWdlcyBhbmQgbm90ICdpZ25vcmVjYWNoZScgaW4gbSBhbmQgZm9yQ29va2llSmFyT25seT09RmFsc2UgOg0KICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3VzaW5nIGNhY2hlIHBhZ2UnLG1bJ3BhZ2UnXQ0KICAgICAgICAgICAgICAgICAgICBsaW5rID0gY2FjaGVkUGFnZXNbbVsncGFnZSddXQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ109PScnIGFuZCAgbVsncGFnZSddLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiBtWydwYWdlJ106DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPW1bJ3BhZ2UnXS5yZXBsYWNlKCckZXBvY3RpbWUkJyxnZXRFcG9jVGltZSgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZTIkJyBpbiBtWydwYWdlJ106DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPW1bJ3BhZ2UnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnSW5nb3JpbmcgQ2FjaGUnLG1bJ3BhZ2UnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFnZV9zcGxpdD1tWydwYWdlJ10uc3BsaXQoJ3wnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVVybD1wYWdlX3NwbGl0WzBdDQogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1Ob25lDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGFnZV9zcGxpdCk+MToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1wYWdlX3NwbGl0WzFdDQoNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5ID0gdXJsbGliMi5Qcm94eUhhbmRsZXIoeyAoJ2h0dHBzJyA/IHByb3h5dG91c2VbOjVdPT0iaHR0cHMiOiJodHRwIikgOiBwcm94eXRvdXNlfSkNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIocHJveHkpDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICANCiMgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgdXJsbGliMg0KIyAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICd1cmxsaWIyLmdldHByb3hpZXMnLHVybGxpYjIuZ2V0cHJveGllcygpDQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Byb3hpZXM9dXJsbGliMi5Qcm94eUhhbmRsZXIodXJsbGliMi5nZXRwcm94aWVzKCkpDQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnZ2V0dGluZyBwYWdlVXJsJyxwYWdlVXJsDQogICAgICAgICAgICAgICAgICAgICAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QocGFnZVVybCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdwcm94eScgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eXRvdXNlPSBtWydwcm94eSddDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdwcm94eXRvdXNlJyxwcm94eXRvdXNlDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuZ2V0cHJveGllcz0gbGFtYmRhOiB7fQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhZ2VVcmxbOjVdPT0iaHR0cHMiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eSA9IHVybGxpYjIuUHJveHlIYW5kbGVyKHsgJ2h0dHBzJyA6IHByb3h5dG91c2V9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcmVxLnNldF9wcm94eShwcm94eXRvdXNlLCAnaHR0cHMnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5ID0gdXJsbGliMi5Qcm94eUhhbmRsZXIoeyAnaHR0cCcgIDogcHJveHl0b3VzZX0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNyZXEuc2V0X3Byb3h5KHByb3h5dG91c2UsICdodHRwJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihwcm94eSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjoxNC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE0LjAuMScpDQogICAgICAgICAgICAgICAgICAgICAgICBwcm94eXRvdXNlPU5vbmUNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3JlZmVyZXInIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlcmVyJ10pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnYWNjZXB0JyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdBY2NlcHQnLCBtWydhY2NlcHQnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhZ2VudCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1hZ2VudCcsIG1bJ2FnZW50J10pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1yZXEnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCBtWyd4LXJlcSddKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3gtYWRkcicgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcigneC1hZGRyJywgbVsneC1hZGRyJ10pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1mb3J3YXJkJyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdYLUZvcndhcmRlZC1Gb3InLCBtWyd4LWZvcndhcmQnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdzZXRjb29raWUnIGluIG06DQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCBtWydzZXRjb29raWUnXSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhcHBlbmRjb29raWUnIGluIG06DQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhcHBlbmRpbmcgY29va2llIHRvIGNvb2tpZWphcicsbVsnYXBwZW5kY29va2llJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzdG9BcGVuZD1tWydhcHBlbmRjb29raWUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZXN0b0FwZW5kPWNvb2tpZXN0b0FwZW5kLnNwbGl0KCc7JykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaCBpbiBjb29raWVzdG9BcGVuZDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbix2PWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3LG49IG4uc3BsaXQoJzonKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjayA9IGNvb2tpZWxpYi5Db29raWUodmVyc2lvbj0wLCBuYW1lPW4sIHZhbHVlPXYsIHBvcnQ9Tm9uZSwgcG9ydF9zcGVjaWZpZWQ9RmFsc2UsIGRvbWFpbj13LCBkb21haW5fc3BlY2lmaWVkPUZhbHNlLCBkb21haW5faW5pdGlhbF9kb3Q9RmFsc2UsIHBhdGg9Jy8nLCBwYXRoX3NwZWNpZmllZD1UcnVlLCBzZWN1cmU9RmFsc2UsIGV4cGlyZXM9Tm9uZSwgZGlzY2FyZD1UcnVlLCBjb21tZW50PU5vbmUsIGNvbW1lbnRfdXJsPU5vbmUsIHJlc3Q9eydIdHRwT25seSc6IE5vbmV9LCByZmMyMTA5PUZhbHNlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXIuc2V0X2Nvb2tpZShjaykNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdvcmlnaW4nIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ09yaWdpbicsIG1bJ29yaWdpbiddKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGVhZGVyX2luX3BhZ2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9aGVhZGVyX2luX3BhZ2Uuc3BsaXQoJyYnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBoIGluIGhlYWRlcl9pbl9wYWdlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBoLnNwbGl0KCc9Jyk9PTI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxzPWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbj12YWxzWzBdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2PSc9Jy5qb2luKHZhbHNbMTpdKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjbix2PWguc3BsaXQoJz0nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcihuLHYpDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjb29raWVKYXI9PU5vbmU6DQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdjb29raWVKYXJWYWwnLGNvb2tpZUphcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdub3JlZGlyZWN0Jywnbm9yZWRpcmVjdCcgaW4gbQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdub3JlZGlyZWN0JyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlcixOb1JlZGlyZWN0aW9uLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpDQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmICdub3JlZGlyZWN0JyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKE5vUmVkaXJlY3Rpb24sIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnY29ubmVjdGlvbicgaW4gbToNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uY29ubmVjdGlvbi8vLy8vLy4nLG1bJ2Nvbm5lY3Rpb24nXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20ga2VlcGFsaXZlIGltcG9ydCBIVFRQSGFuZGxlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlZXBhbGl2ZV9oYW5kbGVyID0gSFRUUEhhbmRsZXIoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGtlZXBhbGl2ZV9oYW5kbGVyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQ0KDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnYWZ0ZXIgY29va2llIGphcicNCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9Tm9uZQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAncG9zdCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YT1tWydwb3N0J10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjaWYgJyRMaXZlU3RyZWFtUmVjYXB0Y2hhJyBpbiBwb3N0RGF0YToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgIChjYXB0Y2hhX2NoYWxsZW5nZSxjYXRwY2hhX3dvcmQsaWRmaWVsZCk9cHJvY2Vzc1JlY2FwdGNoYShtWydwYWdlJ10sY29va2llSmFyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAgICAgICAgcG9zdERhdGE9cG9zdERhdGEucmVwbGFjZSgnJExpdmVTdHJlYW1SZWNhcHRjaGEnLCdtYW51YWxfcmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZDonK2NhcHRjaGFfY2hhbGxlbmdlKycscmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkOicrY2F0cGNoYV93b3JkKycsaWQ6JytpZGZpZWxkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0cG9zdD1wb3N0RGF0YS5zcGxpdCgnLCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9e30NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgcCBpbiBzcGxpdHBvc3Q6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG49cC5zcGxpdCgnOicpWzBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2PXAuc3BsaXQoJzonKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdFtuXT12DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCA9IHVybGxpYi51cmxlbmNvZGUocG9zdCkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdD1tWydyYXdwb3N0J10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjaWYgJyRMaXZlU3RyZWFtUmVjYXB0Y2hhJyBpbiBwb3N0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICAgKGNhcHRjaGFfY2hhbGxlbmdlLGNhdHBjaGFfd29yZCxpZGZpZWxkKT1wcm9jZXNzUmVjYXB0Y2hhKG1bJ3BhZ2UnXSxjb29raWVKYXIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAgICBpZiBjYXB0Y2hhX2NoYWxsZW5nZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgICAgIHBvc3Q9cG9zdC5yZXBsYWNlKCckTGl2ZVN0cmVhbVJlY2FwdGNoYScsJyZtYW51YWxfcmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZD0nK2NhcHRjaGFfY2hhbGxlbmdlKycmcmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkPScrY2F0cGNoYV93b3JkKycmaWQ9JytpZGZpZWxkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbGluaz0nJw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBvc3Q6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSxwb3N0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZXNwb25zZS5pbmZvKCkuZ2V0KCdDb250ZW50LUVuY29kaW5nJykgPT0gJ2d6aXAnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIFN0cmluZ0lPIGltcG9ydCBTdHJpbmdJTw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgZ3ppcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWYgPSBTdHJpbmdJTyggcmVzcG9uc2UucmVhZCgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gZ3ppcC5HemlwRmlsZShmaWxlb2JqPWJ1ZikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluayA9IGYucmVhZCgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1yZXNwb25zZS5yZWFkKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Byb3h5JyBpbiBtIGFuZCBub3QgY3VycmVudF9wcm94aWVzIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuaW5zdGFsbF9vcGVuZXIodXJsbGliMi5idWlsZF9vcGVuZXIoY3VycmVudF9wcm94aWVzKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rPWphdmFzY3JpcHRVbkVzY2FwZShsaW5rKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCByZXByKGxpbmspDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsgVGhpcyBqdXN0IHByaW50IHdob2xlIHdlYnBhZ2UgaW4gTE9HDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2luY2x1ZGVoZWFkZXJzJyBpbiBtOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjbGluays9c3RyKHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdTZXQtQ29va2llJykpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsrPSckJEhFQURFUlNfU1RBUlQkJDonDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBiIGluIHJlc3BvbnNlLmhlYWRlcnM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rKz0gYisnOicrcmVzcG9uc2UuaGVhZGVycy5nZXQoYikrJ1xuJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rKz0nJCRIRUFERVJTX0VORCQkOicNCiAgICAjICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgbGluaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZyhsaW5rKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZyhjb29raWVKYXIgKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRQYWdlc1ttWydwYWdlJ11dID0gbGluaw0KICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnc3RvcmUgbGluayBmb3InLG1bJ3BhZ2UnXSxmb3JDb29raWVKYXJPbmx5DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvckNvb2tpZUphck9ubHk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZw0KICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ10uc3RhcnRzd2l0aCgnaHR0cCcpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbVsncGFnZSddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsncGFnZSddLnNwbGl0KCckcHlGdW5jdGlvbjonKVsxXSwnJyxjb29raWVKYXIsbSApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZm9yQ29va2llSmFyT25seToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms9dmFsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1qYXZhc2NyaXB0VW5Fc2NhcGUobGluaykNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1tWydwYWdlJ10NCiAgICAgICAgICAgICAgICBpZiAnJHB5RnVuY3Rpb246cGxheW1lZGlhKCcgaW4gbVsnZXhwcmVzJ10gb3IgJ0FjdGl2YXRlV2luZG93JyAgaW4gbVsnZXhwcmVzJ10gb3IgJ1J1blBsdWdpbicgIGluIG1bJ2V4cHJlcyddICBvciAnJFBMQVlFUlBST1hZJD0nIGluIHVybCAgb3IgIGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKToNCiAgICAgICAgICAgICAgICAgICAgc2V0cmVzb2x2ZWQ9RmFsc2UNCiAgICAgICAgICAgICAgICBpZiAgJyRkb3JlZ2V4JyBpbiBtWydleHByZXMnXToNCiAgICAgICAgICAgICAgICAgICAgbVsnZXhwcmVzJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydleHByZXMnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQ0KICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgbm90IG1bJ2V4cHJlcyddPT0nJzoNCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdkb2luZyBpdCAnLG1bJ2V4cHJlcyddDQogICAgICAgICAgICAgICAgICAgIGlmICckTGl2ZVN0cmVhbUNhcHRjaGEnIGluIG1bJ2V4cHJlcyddOg0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWFza0NhcHRjaGEobSxsaW5rLGNvb2tpZUphcikNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAndXJsIGFuZCB2YWwnLHVybCx2YWwNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQ0KDQogICAgICAgICAgICAgICAgICAgIGVsaWYgbVsnZXhwcmVzJ10uc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jykgb3IgJyMkcHlGdW5jdGlvbicgaW4gbVsnZXhwcmVzJ106DQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2V4cGVlZWVlZWVlZWVlZWVlZWVlZWUnLG1bJ2V4cHJlcyddDQogICAgICAgICAgICAgICAgICAgICAgICB2YWw9JycNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1bJ2V4cHJlcyddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsnZXhwcmVzJ10uc3BsaXQoJyRweUZ1bmN0aW9uOicpWzFdLGxpbmssY29va2llSmFyLG0pDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWxGdW5jdGlvbihtWydleHByZXMnXSxsaW5rLGNvb2tpZUphcixtKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ0FjdGl2YXRlV2luZG93JyBpbiBtWydleHByZXMnXSBvciAnUnVuUGx1Z2luJyBpbiBtWydleHByZXMnXSAgOiByZXR1cm4gJycsRmFsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvckNvb2tpZUphck9ubHk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2xpc3RyZXBlYXQnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdHJlcGVhdD1tWydsaXN0cmVwZWF0J10gICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3JldD1yZS5maW5kYWxsKG1bJ2V4cHJlcyddLGxpbmspDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdyZXQnLHZhbA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsaXN0cmVwZWF0LGV2YWwodmFsKSwgbSxyZWdleHMsY29va2llSmFyDQojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3VybCBrIHZhbCcsdXJsLGssdmFsDQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3JlcHInLHJlcHIodmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UodSIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OiB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbC5kZWNvZGUoInV0Zi04IikpDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnbGlzdHJlcGVhdCcgaW4gbToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0cmVwZWF0PW1bJ2xpc3RyZXBlYXQnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnbGlzdHJlcGVhdCcsbVsnZXhwcmVzJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgbVsnZXhwcmVzJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2FhYWEnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQ9cmUuZmluZGFsbChtWydleHByZXMnXSxsaW5rKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAncmV0JyxyZXQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGlzdHJlcGVhdCxyZXQsIG0scmVnZXhzLGNvb2tpZUphcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD0nJw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGxpbms9PScnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnbGluaycsbGluaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZyA9IHJlLmNvbXBpbGUobVsnZXhwcmVzJ10pLnNlYXJjaChsaW5rKSAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1yZWcuZ3JvdXAoMSkuc3RyaXAoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpDQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ3BhZ2UnXT09Jycgb3IgbVsncGFnZSddPT1Ob25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1tWydleHByZXMnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmF3UG9zdDoNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Jhd3Bvc3QnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXVybGxpYi5xdW90ZV9wbHVzKHZhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdodG1sdW5lc2NhcGUnIGluIG06DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ZhbD11cmxsaWIudW5xdW90ZV9wbHVzKHZhbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgSFRNTFBhcnNlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1IVE1MUGFyc2VyLkhUTUxQYXJzZXIoKS51bmVzY2FwZSh2YWwpDQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCB2YWwpDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsLmRlY29kZSgidXRmLTgiKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAndXInLHVybA0KICAgICAgICAgICAgICAgICAgICAgICAgI3JldHVybiB2YWwNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsJycpDQogICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiB1cmw6DQogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpDQogICAgICAgIGlmICckZXBvY3RpbWUyJCcgaW4gdXJsOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpDQoNCiAgICAgICAgaWYgJyRHVUlEJCcgaW4gdXJsOg0KICAgICAgICAgICAgaW1wb3J0IHV1aWQNCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJEdVSUQkJyxzdHIodXVpZC51dWlkMSgpKS51cHBlcigpKQ0KICAgICAgICBpZiAnJGdldF9jb29raWVzJCcgaW4gdXJsOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZ2V0X2Nvb2tpZXMkJyxnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcikpDQoNCiAgICAgICAgaWYgcmVjdXJzaXZlQ2FsbDogcmV0dXJuIHVybA0KICAgICAgICAjcHJpbnQgJ2ZpbmFsIHVybCcscmVwcih1cmwpDQogICAgICAgIGlmIHVybD09IiI6DQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiB1cmwsc2V0cmVzb2x2ZWQNCmRlZiBnZXRtZDUodCk6DQogICAgaW1wb3J0IGhhc2hsaWINCiAgICBoPWhhc2hsaWIubWQ1KCkNCiAgICBoLnVwZGF0ZSh0KQ0KICAgIHJldHVybiBoLmhleGRpZ2VzdCgpDQoNCmRlZiBkZWNyeXB0X3ZhdWdobmxpdmUoZW5jcnlwdGVkKToNCiAgICByZXRWYWw9IiINCiMgICAgcHJpbnQgJ2VuYycsZW5jcnlwdGVkDQogICAgI2ZvciB2YWwgaW4gZW5jcnlwdGVkLnNwbGl0KCc6Jyk6DQogICAgIyAgICByZXRWYWwrPWNocihpbnQodmFsLnJlcGxhY2UoIjBtMCIsIiIpKSkNCiAgICAjcmV0dXJuIHJldFZhbA0KDQpkZWYgcGxheW1lZGlhKG1lZGlhX3VybCk6DQogICAgdHJ5Og0KICAgICAgICBpbXBvcnQgIEN1c3RvbVBsYXllcg0KICAgICAgICBwbGF5ZXIgPSBDdXN0b21QbGF5ZXIuTXlYQk1DUGxheWVyKCkNCiAgICAgICAgbGlzdGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKCBsYWJlbCA9IHN0cihuYW1lKSwgaWNvbkltYWdlID0gIkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZSA9IHhibWMuZ2V0SW5mb0ltYWdlKCAiTGlzdEl0ZW0uVGh1bWIiICksIHBhdGg9bWVkaWFfdXJsICkNCiAgICAgICAgcGxheWVyLnBsYXkoIG1lZGlhX3VybCxsaXN0aXRlbSkNCiAgICAgICAgeGJtYy5zbGVlcCgxMDAwKQ0KICAgICAgICB3aGlsZSBwbGF5ZXIuaXNfYWN0aXZlOg0KICAgICAgICAgICAgeGJtYy5zbGVlcCgyMDApDQogICAgZXhjZXB0Og0KICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKCkNCiAgICByZXR1cm4gJycNCg0KZGVmIGtvZGlKc29uUmVxdWVzdChwYXJhbXMpOg0KICAgIGRhdGEgPSBqc29uLmR1bXBzKHBhcmFtcykNCiAgICByZXF1ZXN0ID0geGJtYy5leGVjdXRlSlNPTlJQQyhkYXRhKQ0KDQogICAgdHJ5Og0KICAgICAgICByZXNwb25zZSA9IGpzb24ubG9hZHMocmVxdWVzdCkNCiAgICBleGNlcHQgVW5pY29kZURlY29kZUVycm9yOg0KICAgICAgICByZXNwb25zZSA9IGpzb24ubG9hZHMocmVxdWVzdC5kZWNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQ0KDQogICAgdHJ5Og0KICAgICAgICBpZiAncmVzdWx0JyBpbiByZXNwb25zZToNCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVsncmVzdWx0J10NCiAgICAgICAgcmV0dXJuIE5vbmUNCiAgICBleGNlcHQgS2V5RXJyb3I6DQogICAgICAgIGxvZ2dlci53YXJuKCJbJXNdICVzIiAlIChwYXJhbXNbJ21ldGhvZCddLCByZXNwb25zZVsnZXJyb3InXVsnbWVzc2FnZSddKSkNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KDQpkZWYgc2V0S29kaVByb3h5KHByb3h5c2V0dGluZ3M9Tm9uZSk6DQoNCiAgICBpZiBwcm94eXNldHRpbmdzPT1Ob25lOg0KIyAgICAgICAgcHJpbnQgJ3Byb3h5IHNldCB0byBub3RoaW5nJw0KICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay51c2VodHRwcHJveHkiLCAidmFsdWUiOmZhbHNlfSwgImlkIjoxfScpDQogICAgZWxzZToNCiAgICAgICAgDQogICAgICAgIHBzPXByb3h5c2V0dGluZ3Muc3BsaXQoJzonKQ0KICAgICAgICBwcm94eVVSTD1wc1swXQ0KICAgICAgICBwcm94eVBvcnQ9cHNbMV0NCiAgICAgICAgcHJveHlUeXBlPXBzWzJdDQogICAgICAgIHByb3h5VXNlcm5hbWU9Tm9uZQ0KICAgICAgICBwcm94eVBhc3N3b3JkPU5vbmUNCiAgICAgICAgDQogICAgICAgIGlmIGxlbihwcyk+MyBhbmQgJ0AnIGluIHBzWzNdOiAjamFpcm94ICMjI3Byb3h5c2V0dGluZ3MNCiAgICAgICAgICAgIHByb3h5VXNlcm5hbWU9cHNbM10uc3BsaXQoJ0AnKVswXSAjamFpcm94ICMjI3BzWzNdDQogICAgICAgICAgICBwcm94eVBhc3N3b3JkPXBzWzNdLnNwbGl0KCdAJylbMV0gI2phaXJveCAjIyNwcm94eXNldHRpbmdzLnNwbGl0KCdAJylbLTFdDQoNCiMgICAgICAgIHByaW50ICdwcm94eSBzZXQgdG8nLCBwcm94eVR5cGUsIHByb3h5VVJMLHByb3h5UG9ydA0KICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay51c2VodHRwcHJveHkiLCAidmFsdWUiOnRydWV9LCAiaWQiOjF9JykNCiAgICAgICAgeGJtYy5leGVjdXRlSlNPTlJQQygneyJqc29ucnBjIjoiMi4wIiwgIm1ldGhvZCI6IlNldHRpbmdzLlNldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5dHlwZSIsICJ2YWx1ZSI6JyArIHN0cihwcm94eVR5cGUpICsnfSwgImlkIjoxfScpDQogICAgICAgIHhibWMuZXhlY3V0ZUpTT05SUEMoJ3sianNvbnJwYyI6IjIuMCIsICJtZXRob2QiOiJTZXR0aW5ncy5TZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXNlcnZlciIsICJ2YWx1ZSI6IicgKyBzdHIocHJveHlVUkwpICsnIn0sICJpZCI6MX0nKQ0KICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwb3J0IiwgInZhbHVlIjonICsgc3RyKHByb3h5UG9ydCkgKyd9LCAiaWQiOjF9JykNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICBpZiBub3QgcHJveHlVc2VybmFtZT09Tm9uZToNCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZUpTT05SUEMoJ3sianNvbnJwYyI6IjIuMCIsICJtZXRob2QiOiJTZXR0aW5ncy5TZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXVzZXJuYW1lIiwgInZhbHVlIjoiJyArIHN0cihwcm94eVVzZXJuYW1lKSArJyJ9LCAiaWQiOjF9JykNCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZUpTT05SUEMoJ3sianNvbnJwYyI6IjIuMCIsICJtZXRob2QiOiJTZXR0aW5ncy5TZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXBhc3N3b3JkIiwgInZhbHVlIjoiJyArIHN0cihwcm94eVBhc3N3b3JkKSArJyJ9LCAiaWQiOjF9JykNCg0KICAgICAgICANCmRlZiBnZXRDb25maWd1cmVkUHJveHkoKToNCiAgICBwcm94eUFjdGl2ZSA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsudXNlaHR0cHByb3h5In0sICdpZCc6IDF9KVsndmFsdWUnXQ0KIyAgICBwcmludCAncHJveHlBY3RpdmUnLHByb3h5QWN0aXZlDQogICAgcHJveHlUeXBlID0ga29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHl0eXBlIn0sICdpZCc6IDF9KVsndmFsdWUnXQ0KDQogICAgaWYgcHJveHlBY3RpdmU6ICMgUFJPWFlfSFRUUA0KICAgICAgICBwcm94eVVSTCA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5c2VydmVyIn0sICdpZCc6IDF9KVsndmFsdWUnXQ0KICAgICAgICBwcm94eVBvcnQgPSB1bmljb2RlKGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5cG9ydCJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10pDQogICAgICAgIHByb3h5VXNlcm5hbWUgPSBrb2RpSnNvblJlcXVlc3Qoeydqc29ucnBjJzogJzIuMCcsICJtZXRob2QiOiJTZXR0aW5ncy5HZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXVzZXJuYW1lIn0sICdpZCc6IDF9KVsndmFsdWUnXQ0KICAgICAgICBwcm94eVBhc3N3b3JkID0ga29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwYXNzd29yZCJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10NCg0KICAgICAgICBpZiBwcm94eVVzZXJuYW1lIGFuZCBwcm94eVBhc3N3b3JkIGFuZCBwcm94eVVSTCBhbmQgcHJveHlQb3J0Og0KICAgICAgICAgICAgcmV0dXJuIHByb3h5VVJMICsgJzonICsgc3RyKHByb3h5UG9ydCkrJzonK3N0cihwcm94eVR5cGUpICsgJzonICsgcHJveHlVc2VybmFtZSArICdAJyArIHByb3h5UGFzc3dvcmQNCiAgICAgICAgZWxpZiBwcm94eVVSTCBhbmQgcHJveHlQb3J0Og0KICAgICAgICAgICAgcmV0dXJuIHByb3h5VVJMICsgJzonICsgc3RyKHByb3h5UG9ydCkrJzonK3N0cihwcm94eVR5cGUpDQogICAgZWxzZToNCiAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgDQpkZWYgcGxheW1lZGlhd2l0aHByb3h5KG1lZGlhX3VybCwgbmFtZSwgaWNvbkltYWdlLHByb3h5aXAscG9ydCwgcHJveHl1c2VyPU5vbmUsIHByb3h5cGFzcz1Ob25lKTogI2phaXJveA0KDQogICAgaWYgbWVkaWFfdXJsPT1Ob25lIG9yIG1lZGlhX3VybD09Jyc6DQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEhlcmN1bGVzLFVuYWJsZSB0byBwbGF5IGVtcHR5IFVybCw1MDAwLCIraWNvbisiKSIpDQogICAgICAgIHJldHVybg0KICAgIHByb2dyZXNzID0geGJtY2d1aS5EaWFsb2dQcm9ncmVzcygpDQogICAgcHJvZ3Jlc3MuY3JlYXRlKCdQcm9ncmVzcycsICdQbGF5aW5nIHdpdGggY3VzdG9tIHByb3h5JykNCiAgICBwcm9ncmVzcy51cGRhdGUoIDEwLCAiIiwgInNldHRpbmcgcHJveHkuLiIsICIiICkNCiAgICBwcm94eXNldD1GYWxzZQ0KICAgIGV4aXN0aW5nX3Byb3h5PScnDQogICAgI3ByaW50ICdwbGF5bWVkaWF3aXRocHJveHknDQogICAgdHJ5Og0KICAgICAgICANCiAgICAgICAgZXhpc3RpbmdfcHJveHk9Z2V0Q29uZmlndXJlZFByb3h5KCkNCiAgICAgICAgcHJpbnQgJ2V4aXN0aW5nX3Byb3h5JyxleGlzdGluZ19wcm94eQ0KICAgICAgICAjcmVhZCBhbmQgc2V0IGhlcmUNCiAgICAgICAgI2phaXJveA0KICAgICAgICBpZiBub3QgcHJveHl1c2VyID09IE5vbmU6DQogICAgICAgICAgICBzZXRLb2RpUHJveHkoIHByb3h5aXAgKyAnOicgKyBwb3J0ICsgJzowOicgKyBwcm94eXVzZXIgKyAnQCcgKyBwcm94eXBhc3MpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBzZXRLb2RpUHJveHkoIHByb3h5aXAgKyAnOicgKyBwb3J0ICsgJzowJykNCg0KICAgICAgICBwcmludCAncHJveHkgc2V0dGluZyBjb21wbGV0ZSBwbGF5aW5nJyxtZWRpYV91cmwNCiAgICAgICAgcHJveHlzZXQ9VHJ1ZQ0KICAgICAgICBwcm9ncmVzcy51cGRhdGUoIDgwLCAiIiwgInNldHRpbmcgcHJveHkgY29tcGxldGUsIG5vdyBwbGF5aW5nIiwgIiIgKQ0KICAgICAgICANCg0KICAgICAgICBpbXBvcnQgIEN1c3RvbVBsYXllcg0KICAgICAgICBwbGF5ZXIgPSBDdXN0b21QbGF5ZXIuTXlYQk1DUGxheWVyKCkNCiAgICAgICAgcGxheWVyLnBkaWFsb2d1ZT09cHJvZ3Jlc3MNCiAgICAgICAgbGlzdGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKCBsYWJlbCA9IHN0cihuYW1lKSwgaWNvbkltYWdlID0gaWNvbkltYWdlLCB0aHVtYm5haWxJbWFnZSA9IHhibWMuZ2V0SW5mb0ltYWdlKCAiTGlzdEl0ZW0uVGh1bWIiICksIHBhdGg9bWVkaWFfdXJsICkNCiAgICAgICAgcGxheWVyLnBsYXkoIG1lZGlhX3VybCxsaXN0aXRlbSkNCiAgICAgICAgeGJtYy5zbGVlcCgxMDAwKQ0KICAgICAgICAjd2hpbGUgcGxheWVyLmlzX2FjdGl2ZToNCiAgICAgICAgIyAgICB4Ym1jLnNsZWVwKDIwMCkNCiAgICAgICAgaW1wb3J0IHRpbWUNCiAgICAgICAgYmVmb3Jlc3RhcnQ9dGltZS50aW1lKCkNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgd2hpbGUgcGxheWVyLmlzX2FjdGl2ZToNCiAgICAgICAgICAgICAgICB4Ym1jLnNsZWVwKDEwMDApICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIHBsYXllci51cmxwbGF5ZWQ9PUZhbHNlIGFuZCB0aW1lLnRpbWUoKS1iZWZvcmVzdGFydD4xMjoNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2ZhaWxlZCEhIScNCiAgICAgICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oSGVyY3VsZXMsVW5hYmxlIHRvIHBsYXkgY2hlY2sgcHJveHksNTAwMCwiK2ljb24rIikiKQ0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgICN4Ym1jLnNsZWVwKDEwMDApDQogICAgICAgIGV4Y2VwdDogcGFzcw0KDQogICAgICAgIHByb2dyZXNzLmNsb3NlKCkNCiAgICAgICAgcHJvZ3Jlc3M9Tm9uZQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpDQogICAgaWYgcHJvZ3Jlc3M6DQogICAgICAgIHByb2dyZXNzLmNsb3NlKCkNCiAgICBpZiBwcm94eXNldDoNCiAgICAgICAgcHJpbnQgJ25vdyByZXNldHRpbmcgdGhlIHByb3h5IGJhY2snDQogICAgICAgIHNldEtvZGlQcm94eShleGlzdGluZ19wcm94eSkNCiAgICAgICAgcHJpbnQgJ3Jlc2V0IGhlcmUnDQogICAgcmV0dXJuICcnDQoNCg0KZGVmIGdldF9zYXdfcnRtcChwYWdlX3ZhbHVlLCByZWZlcmVyPU5vbmUpOg0KICAgIGlmIHJlZmVyZXI6DQogICAgICAgIHJlZmVyZXI9WygnUmVmZXJlcicscmVmZXJlcildDQogICAgaWYgcGFnZV92YWx1ZS5zdGFydHN3aXRoKCJodHRwIik6DQogICAgICAgIHBhZ2VfdXJsPXBhZ2VfdmFsdWUNCiAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdmFsdWUsaGVhZGVycz1yZWZlcmVyKQ0KDQogICAgc3RyX3BhdHRlcm49IihldmFsXChmdW5jdGlvblwocCxhLGMsayxlLCg/OnJ8ZCkuKikiDQoNCiAgICByZWdfcmVzPXJlLmNvbXBpbGUoc3RyX3BhdHRlcm4pLmZpbmRhbGwocGFnZV92YWx1ZSkNCiAgICByPSIiDQogICAgaWYgcmVnX3JlcyBhbmQgbGVuKHJlZ19yZXMpPjA6DQogICAgICAgIGZvciB2IGluIHJlZ19yZXM6DQogICAgICAgICAgICByMT1nZXRfdW5wYWNrZWQodikNCiAgICAgICAgICAgIHIyPXJlX21lKHIxLCdcJyguKj8pXCcnKQ0KICAgICAgICAgICAgaWYgJ3VuZXNjYXBlJyBpbiByMToNCiAgICAgICAgICAgICAgICByMT11cmxsaWIudW5xdW90ZShyMikNCiAgICAgICAgICAgIHIrPXIxKydcbicNCiMgICAgICAgIHByaW50ICdmaW5hbCB2YWx1ZSBpcyAnLHINCg0KICAgICAgICBwYWdlX3VybD1yZV9tZShyLCdzcmM9IiguKj8pIicpDQoNCiAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdXJsLGhlYWRlcnM9cmVmZXJlcikNCg0KICAgICNwcmludCBwYWdlX3ZhbHVlDQoNCiAgICBydG1wPXJlX21lKHBhZ2VfdmFsdWUsJ3N0cmVhbWVyXCcuKj9cJyguKj8pXCdcKScpDQogICAgcGxheXBhdGg9cmVfbWUocGFnZV92YWx1ZSwnZmlsZVwnLFxzXCcoLio/KVwnJykNCg0KDQogICAgcmV0dXJuIHJ0bXArJyBwbGF5cGF0aD0nK3BsYXlwYXRoICsnIHBhZ2VVcmw9JytwYWdlX3VybA0KDQpkZWYgZ2V0X2xldG9uX3J0bXAocGFnZV92YWx1ZSwgcmVmZXJlcj1Ob25lKToNCiAgICBpZiByZWZlcmVyOg0KICAgICAgICByZWZlcmVyPVsoJ1JlZmVyZXInLHJlZmVyZXIpXQ0KICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOg0KICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSxoZWFkZXJzPXJlZmVyZXIpDQogICAgc3RyX3BhdHRlcm49InZhciBhID0gKC4qPyk7XHMqdmFyIGIgPSAoLio/KTtccyp2YXIgYyA9ICguKj8pO1xzKnZhciBkID0gKC4qPyk7XHMqdmFyIGYgPSAoLio/KTtccyp2YXIgdl9wYXJ0ID0gJyguKj8pJzsiDQogICAgcmVnX3Jlcz1yZS5jb21waWxlKHN0cl9wYXR0ZXJuKS5maW5kYWxsKHBhZ2VfdmFsdWUpWzBdDQoNCiAgICBhLGIsYyxkLGYsdj0ocmVnX3JlcykNCiAgICBmPWludChmKQ0KICAgIGE9aW50KGEpL2YNCiAgICBiPWludChiKS9mDQogICAgYz1pbnQoYykvZg0KICAgIGQ9aW50KGQpL2YNCg0KICAgIHJldD0gJ3J0bXA6Ly8nICsgc3RyKGEpICsgJy4nICsgc3RyKGIpICsgJy4nICsgc3RyKGMpICsgJy4nICsgc3RyKGQpICsgdjsNCiAgICByZXR1cm4gcmV0DQoNCmRlZiBjcmVhdGVNM3VGb3JEYXNoKHVybCx1c2VyYWdlbnQ9Tm9uZSk6DQogICAgc3RyPScjRVhUTTNVJw0KICAgIHN0cis9J1xuI0VYVC1YLVNUUkVBTS1JTkY6UFJPR1JBTS1JRD0xLEJBTkRXSURUSD0zNjE4MTYnDQogICAgc3RyKz0nXG4nK3VybCsnJmJ5dGVzPTAtMjAwMDAwJyMrJ3xVc2VyLUFnZW50PScrdXNlcmFnZW50DQogICAgc291cmNlX2ZpbGUgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3Rlc3RmaWxlLm0zdScpDQogICAgc3RyKz0nXG4nDQogICAgU2F2ZVRvRmlsZShzb3VyY2VfZmlsZSxzdHIpDQogICAgI3JldHVybiAnQzovVXNlcnMvc2hhbmkvRG93bmxvYWRzL3Rlc3QubTN1OCcNCiAgICByZXR1cm4gc291cmNlX2ZpbGUNCg0KZGVmIFNhdmVUb0ZpbGUoZmlsZV9uYW1lLHBhZ2VfZGF0YSxhcHBlbmQ9RmFsc2UpOg0KICAgIGlmIGFwcGVuZDoNCiAgICAgICAgZiA9IG9wZW4oZmlsZV9uYW1lLCAnYScpDQogICAgICAgIGYud3JpdGUocGFnZV9kYXRhKQ0KICAgICAgICBmLmNsb3NlKCkNCiAgICBlbHNlOg0KICAgICAgICBmPW9wZW4oZmlsZV9uYW1lLCd3YicpDQogICAgICAgIGYud3JpdGUocGFnZV9kYXRhKQ0KICAgICAgICBmLmNsb3NlKCkNCiAgICAgICAgcmV0dXJuICcnDQoNCmRlZiBMb2FkRmlsZShmaWxlX25hbWUpOg0KICAgIGY9b3BlbihmaWxlX25hbWUsJ3JiJykNCiAgICBkPWYucmVhZCgpDQogICAgZi5jbG9zZSgpDQogICAgcmV0dXJuIGQNCg0KZGVmIGdldF9wYWNrZWRfaXBob25ldHZfdXJsKHBhZ2VfZGF0YSk6DQogICAgaW1wb3J0IHJlLGJhc2U2NCx1cmxsaWI7DQogICAgcz1wYWdlX2RhdGENCiAgICB3aGlsZSAnZ2VoKCcgaW4gczoNCiAgICAgICAgaWYgcy5zdGFydHN3aXRoKCdsb2woJyk6IHM9c1s1Oi0xXQ0KIyAgICAgICBwcmludCAncyBpcyAnLHMNCiAgICAgICAgcz1yZS5jb21waWxlKCciKC4qPykiJykuZmluZGFsbChzKVswXTsNCiAgICAgICAgcz0gIGJhc2U2NC5iNjRkZWNvZGUocyk7DQogICAgICAgIHM9dXJsbGliLnVucXVvdGUocyk7DQogICAgcHJpbnQgcw0KICAgIHJldHVybiBzDQoNCmRlZiBnZXRfZmVycmFyaV91cmwocGFnZV9kYXRhKToNCiMgICAgcHJpbnQgJ2dldF9kYWdfdXJsMicscGFnZV9kYXRhDQogICAgcGFnZV9kYXRhMj1nZXRVcmwocGFnZV9kYXRhKTsNCiAgICBwYXR0PScoaHR0cC4qKScNCiAgICBpbXBvcnQgdXVpZA0KICAgIHBsYXliYWNrPXN0cih1dWlkLnV1aWQxKCkpLnVwcGVyKCkNCiAgICBsaW5rcz1yZS5jb21waWxlKHBhdHQpLmZpbmRhbGwocGFnZV9kYXRhMikNCiAgICBoZWFkZXJzPVsoJ1gtUGxheWJhY2stU2Vzc2lvbi1JZCcscGxheWJhY2spXQ0KICAgIGZvciBsIGluIGxpbmtzOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgcGFnZV9kYXRhdGVtcD1nZXRVcmwobCxoZWFkZXJzPWhlYWRlcnMpOw0KDQogICAgICAgIGV4Y2VwdDogcGFzcw0KDQogICAgcmV0dXJuIHBhZ2VfZGF0YSsnfCZYLVBsYXliYWNrLVNlc3Npb24tSWQ9JytwbGF5YmFjaw0KDQoNCmRlZiBnZXRfZGFnX3VybChwYWdlX2RhdGEpOg0KIyAgICBwcmludCAnZ2V0X2RhZ191cmwnLHBhZ2VfZGF0YQ0KICAgIGlmIHBhZ2VfZGF0YS5zdGFydHN3aXRoKCdodHRwOi8vZGFnLnRvdGFsLXN0cmVhbS5uZXQnKToNCiAgICAgICAgaGVhZGVycz1bKCdVc2VyLUFnZW50JywnVmVyaXNtby1CbGFja1VJXygyLjQuNy41LjguMC4zNCknKV0NCiAgICAgICAgcGFnZV9kYXRhPWdldFVybChwYWdlX2RhdGEsaGVhZGVycz1oZWFkZXJzKTsNCg0KICAgIGlmICcxMjcuMC4wLjEnIGluIHBhZ2VfZGF0YToNCiAgICAgICAgcmV0dXJuIHJldmlzdF9kYWcocGFnZV9kYXRhKQ0KICAgIGVsaWYgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICE9ICcnOg0KICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICcmdmVyX3Q9KFteJl0rKSYnKSArICc/d21zQXV0aFNpZ249JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSArICc9PS9tcDQ6JyArIHJlX21lKHBhZ2VfZGF0YSwgJ1xcP3k9KFteJl0rKSYnKQ0KICAgIGVsc2U6DQogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJ2hyZWY9IihbXiJdKykiW14iXSskJykNCiAgICAgICAgaWYgbGVuKGZpbmFsX3VybCk9PTA6DQogICAgICAgICAgICBmaW5hbF91cmw9cGFnZV9kYXRhDQogICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJyAnLCAnJTIwJykNCiAgICByZXR1cm4gZmluYWxfdXJsDQoNCmRlZiByZV9tZShkYXRhLCByZV9wYXR0ZW4pOg0KICAgIG1hdGNoID0gJycNCiAgICBtID0gcmUuc2VhcmNoKHJlX3BhdHRlbiwgZGF0YSkNCiAgICBpZiBtICE9IE5vbmU6DQogICAgICAgIG1hdGNoID0gbS5ncm91cCgxKQ0KICAgIGVsc2U6DQogICAgICAgIG1hdGNoID0gJycNCiAgICByZXR1cm4gbWF0Y2gNCg0KZGVmIHJldmlzdF9kYWcocGFnZV9kYXRhKToNCiAgICBmaW5hbF91cmwgPSAnJw0KICAgIGlmICcxMjcuMC4wLjEnIGluIHBhZ2VfZGF0YToNCiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnIGxpdmU9dHJ1ZSB0aW1lb3V0PTE1IHBsYXlwYXRoPScgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbYS16QS1aMC05LV9cXC5AXSspJykNCg0KICAgIGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3Rva2VuPShbXiZdKykmJykgIT0gJyc6DQogICAgICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybCArICc/dG9rZW49JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3Rva2VuPShbXiZdKykmJykNCiAgICBlbGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSAhPSAnJzoNCiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnP3dtc0F1dGhTaWduPScgKyByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgKyAnPT0vbXA0OicgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbXiZdKykmJykNCiAgICBlbHNlOg0KICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICdIUkVGPSIoW14iXSspIicpDQoNCiAgICBpZiAnZGFnMS5hc3gnIGluIGZpbmFsX3VybDoNCiAgICAgICAgcmV0dXJuIGdldF9kYWdfdXJsKGZpbmFsX3VybCkNCg0KICAgIGlmICdkZXZpbmxpdmVmcy5mcGxpdmUubmV0JyBub3QgaW4gZmluYWxfdXJsOg0KICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgnZGV2aW5saXZlJywgJ2ZsaXZlJykNCiAgICBpZiAncGVybWxpdmVmcy5mcGxpdmUubmV0JyBub3QgaW4gZmluYWxfdXJsOg0KICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgncGVybWxpdmUnLCAnZmxpdmUnKQ0KICAgIHJldHVybiBmaW5hbF91cmwNCg0KDQpkZWYgZ2V0X3Vud2lzZSggc3RyX2V2YWwpOg0KICAgIHBhZ2VfdmFsdWU9IiINCiAgICB0cnk6DQogICAgICAgIHNzPSJ3LGkscyxlPSgiK3N0cl9ldmFsKycpJw0KICAgICAgICBleGVjIChzcykNCiAgICAgICAgcGFnZV92YWx1ZT11bndpc2VfZnVuYyh3LGkscyxlKQ0KICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpDQogICAgI3ByaW50ICd1bnBhY2tlZCcscGFnZV92YWx1ZQ0KICAgIHJldHVybiBwYWdlX3ZhbHVlDQoNCmRlZiB1bndpc2VfZnVuYyggdywgaSwgcywgZSk6DQogICAgbElsbCA9IDA7DQogICAgbGwxSSA9IDA7DQogICAgSWwxbCA9IDA7DQogICAgbGwxbCA9IFtdOw0KICAgIGwxbEkgPSBbXTsNCiAgICB3aGlsZSBUcnVlOg0KICAgICAgICBpZiAobElsbCA8IDUpOg0KICAgICAgICAgICAgbDFsSS5hcHBlbmQod1tsSWxsXSkNCiAgICAgICAgZWxpZiAobElsbCA8IGxlbih3KSk6DQogICAgICAgICAgICBsbDFsLmFwcGVuZCh3W2xJbGxdKTsNCiAgICAgICAgbElsbCs9MTsNCiAgICAgICAgaWYgKGxsMUkgPCA1KToNCiAgICAgICAgICAgIGwxbEkuYXBwZW5kKGlbbGwxSV0pDQogICAgICAgIGVsaWYgKGxsMUkgPCBsZW4oaSkpOg0KICAgICAgICAgICAgbGwxbC5hcHBlbmQoaVtsbDFJXSkNCiAgICAgICAgbGwxSSs9MTsNCiAgICAgICAgaWYgKElsMWwgPCA1KToNCiAgICAgICAgICAgIGwxbEkuYXBwZW5kKHNbSWwxbF0pDQogICAgICAgIGVsaWYgKElsMWwgPCBsZW4ocykpOg0KICAgICAgICAgICAgbGwxbC5hcHBlbmQoc1tJbDFsXSk7DQogICAgICAgIElsMWwrPTE7DQogICAgICAgIGlmIChsZW4odykgKyBsZW4oaSkgKyBsZW4ocykgKyBsZW4oZSkgPT0gbGVuKGxsMWwpICsgbGVuKGwxbEkpICsgbGVuKGUpKToNCiAgICAgICAgICAgIGJyZWFrOw0KDQogICAgbEkxbCA9ICcnLmpvaW4obGwxbCkjLmpvaW4oJycpOw0KICAgIEkxbEkgPSAnJy5qb2luKGwxbEkpIy5qb2luKCcnKTsNCiAgICBsbDFJID0gMDsNCiAgICBsMWxsID0gW107DQogICAgZm9yIGxJbGwgaW4gcmFuZ2UoMCxsZW4obGwxbCksMik6DQogICAgICAgICNwcmludCAnYXJyYXkgaScsbElsbCxsZW4obGwxbCkNCiAgICAgICAgbGwxMSA9IC0xOw0KICAgICAgICBpZiAoIG9yZChJMWxJW2xsMUldKSAlIDIpOg0KICAgICAgICAgICAgbGwxMSA9IDE7DQogICAgICAgICNwcmludCAndmFsIGlzICcsIGxJMWxbbElsbDogbElsbCsyXQ0KICAgICAgICBsMWxsLmFwcGVuZChjaHIoICAgIGludChsSTFsW2xJbGw6IGxJbGwrMl0sIDM2KSAtIGxsMTEpKTsNCiAgICAgICAgbGwxSSs9MTsNCiAgICAgICAgaWYgKGxsMUkgPj0gbGVuKGwxbEkpKToNCiAgICAgICAgICAgIGxsMUkgPSAwOw0KICAgIHJldD0nJy5qb2luKGwxbGwpDQogICAgaWYgJ2V2YWwoZnVuY3Rpb24odyxpLHMsZSknIGluIHJldDoNCiMgICAgICAgIHByaW50ICdTVElMTCBHT2luZycNCiAgICAgICAgcmV0PXJlLmNvbXBpbGUoJ2V2YWxcKGZ1bmN0aW9uXCh3LGkscyxlXCkuKn1cKCguKj8pXCknKS5maW5kYWxsKHJldClbMF0NCiAgICAgICAgcmV0dXJuIGdldF91bndpc2UocmV0KQ0KICAgIGVsc2U6DQojICAgICAgICBwcmludCAnRklOSVNIRUQnDQogICAgICAgIHJldHVybiByZXQNCg0KZGVmIGdldF91bnBhY2tlZCggcGFnZV92YWx1ZSwgcmVnZXhfZm9yX3RleHQ9JycsIGl0ZXJhdGlvbnM9MSwgdG90YWxfaXRlcmF0aW9uPTEpOg0KICAgIHRyeToNCiAgICAgICAgcmVnX2RhdGE9Tm9uZQ0KICAgICAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToNCiAgICAgICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlKQ0KIyAgICAgICAgcHJpbnQgJ3BhZ2VfdmFsdWUnLHBhZ2VfdmFsdWUNCiAgICAgICAgaWYgcmVnZXhfZm9yX3RleHQgYW5kIGxlbihyZWdleF9mb3JfdGV4dCk+MDoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBwYWdlX3ZhbHVlPXJlLmNvbXBpbGUocmVnZXhfZm9yX3RleHQpLmZpbmRhbGwocGFnZV92YWx1ZSlbMF0gI2dldCB0aGUganMgdmFyaWFibGUNCiAgICAgICAgICAgIGV4Y2VwdDogcmV0dXJuICdOT1RQQUNLRUQnDQoNCiAgICAgICAgcGFnZV92YWx1ZT11bnBhY2socGFnZV92YWx1ZSxpdGVyYXRpb25zLHRvdGFsX2l0ZXJhdGlvbikNCiAgICBleGNlcHQ6DQogICAgICAgIHBhZ2VfdmFsdWU9J1VOUEFDS0VERkFJTEVEJw0KICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkNCiMgICAgcHJpbnQgJ3VucGFja2VkJyxwYWdlX3ZhbHVlDQogICAgaWYgJ3NhdjFsaXZlLnR2JyBpbiBwYWdlX3ZhbHVlOg0KICAgICAgICBwYWdlX3ZhbHVlPXBhZ2VfdmFsdWUucmVwbGFjZSgnc2F2MWxpdmUudHYnLCdzYXdsaXZlLnR2JykgI3F1aWNrIGZpeCBzb21lIGJ1ZyBzb21ld2hlcmUNCiMgICAgICAgIHByaW50ICdzYXYxIHVucGFja2VkJyxwYWdlX3ZhbHVlDQogICAgcmV0dXJuIHBhZ2VfdmFsdWUNCg0KZGVmIHVucGFjayhzSmF2YXNjcmlwdCxpdGVyYXRpb249MSwgdG90YWxpdGVyYXRpb25zPTIgICk6DQojICAgIHByaW50ICdpdGVyYXRpb24nLGl0ZXJhdGlvbg0KICAgIGlmIHNKYXZhc2NyaXB0LnN0YXJ0c3dpdGgoJ3ZhciBfMHhjYjhhPScpOg0KICAgICAgICBhU3BsaXQ9c0phdmFzY3JpcHQuc3BsaXQoJ3ZhciBfMHhjYjhhPScpDQogICAgICAgIHNzPSJteWFycmF5PSIrYVNwbGl0WzFdLnNwbGl0KCJldmFsKCIpWzBdDQogICAgICAgIGV4ZWMoc3MpDQogICAgICAgIGExPTYyDQogICAgICAgIGMxPWludChhU3BsaXRbMV0uc3BsaXQoIiw2MiwiKVsxXS5zcGxpdCgnLCcpWzBdKQ0KICAgICAgICBwMT1teWFycmF5WzBdDQogICAgICAgIGsxPW15YXJyYXlbM10NCiAgICAgICAgd2l0aCBvcGVuKCd0ZW1wIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOg0KICAgICAgICAgICAgZmlsZXdyaXRlci53cml0ZShzdHIoazEpKQ0KICAgICAgICAjYWE9MS8wDQogICAgZWxzZToNCg0KICAgICAgICBpZiAicm4gcH0oJyIgaW4gc0phdmFzY3JpcHQ6DQogICAgICAgICAgICBhU3BsaXQgPSBzSmF2YXNjcmlwdC5zcGxpdCgicm4gcH0oJyIpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBhU3BsaXQgPSBzSmF2YXNjcmlwdC5zcGxpdCgicm4gQX0oJyIpDQojICAgICAgICBwcmludCBhU3BsaXQNCg0KICAgICAgICBwMSxhMSxjMSxrMT0oJycsJzAnLCcwJywnJykNCg0KICAgICAgICBzcz0icDEsYTEsYzEsazE9KCciK2FTcGxpdFsxXS5zcGxpdCgiLnNwbGkiKVswXSsnKScNCiAgICAgICAgZXhlYyhzcykNCiAgICBrMT1rMS5zcGxpdCgnfCcpDQogICAgYVNwbGl0ID0gYVNwbGl0WzFdLnNwbGl0KCIpKSciKQ0KIyAgICBwcmludCAnIHAgYXJyYXkgaXMgJyxsZW4oYVNwbGl0KQ0KIyAgIHByaW50IGxlbihhU3BsaXQgKQ0KDQogICAgI3A9c3RyKGFTcGxpdFswXSsnKSknKSMucmVwbGFjZSgiXFwiLCIiKSMucmVwbGFjZSgnXFxcXCcsJ1xcJykNCg0KICAgICNwcmludCBhU3BsaXRbMV0NCiAgICAjYVNwbGl0ID0gYVNwbGl0WzFdLnNwbGl0KCIsIikNCiAgICAjcHJpbnQgYVNwbGl0WzBdDQogICAgI2EgPSBpbnQoYVNwbGl0WzFdKQ0KICAgICNjID0gaW50KGFTcGxpdFsyXSkNCiAgICAjayA9IGFTcGxpdFszXS5zcGxpdCgiLiIpWzBdLnJlcGxhY2UoIiciLCAnJykuc3BsaXQoJ3wnKQ0KICAgICNhPWludChhKQ0KICAgICNjPWludChjKQ0KDQogICAgI3A9cC5yZXBsYWNlKCdcXCcsICcnKQ0KIyAgICBwcmludCAncCB2YWwgaXMgJyxwWzA6MTAwXSwnLi4uLi4uLi4uLi4uJyxwWy0xMDA6XSxsZW4ocCkNCiMgICAgcHJpbnQgJ3AxIHZhbCBpcyAnLHAxWzA6MTAwXSwnLi4uLi4uLi4uLi4uJyxwMVstMTAwOl0sbGVuKHAxKQ0KDQogICAgI3ByaW50IGEsYTENCiAgICAjcHJpbnQgYyxhMQ0KICAgICNwcmludCAnayB2YWwgaXMgJyxrWy0xMDpdLGxlbihrKQ0KIyAgICBwcmludCAnazEgdmFsIGlzICcsazFbLTEwOl0sbGVuKGsxKQ0KICAgIGUgPSAnJw0KICAgIGQgPSAnJyMzMjgyMw0KDQogICAgI3NVbnBhY2tlZCA9IHN0cihfX3VucGFjayhwLCBhLCBjLCBrLCBlLCBkKSkNCiAgICBzVW5wYWNrZWQxID0gc3RyKF9fdW5wYWNrKHAxLCBhMSwgYzEsIGsxLCBlLCBkLGl0ZXJhdGlvbikpDQoNCiAgICAjcHJpbnQgc1VucGFja2VkWzoyMDBdKycuLi4uJytzVW5wYWNrZWRbLTEwMDpdLCBsZW4oc1VucGFja2VkKQ0KIyAgICBwcmludCBzVW5wYWNrZWQxWzoyMDBdKycuLi4uJytzVW5wYWNrZWQxWy0xMDA6XSwgbGVuKHNVbnBhY2tlZDEpDQoNCiAgICAjZXhlYygnc1VucGFja2VkMT0iJytzVW5wYWNrZWQxKyciJykNCiAgICBpZiBpdGVyYXRpb24+PXRvdGFsaXRlcmF0aW9uczoNCiMgICAgICAgIHByaW50ICdmaW5hbCByZXMnLHNVbnBhY2tlZDFbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZDFbLTEwMDpdLCBsZW4oc1VucGFja2VkMSkNCiAgICAgICAgcmV0dXJuIHNVbnBhY2tlZDEjLnJlcGxhY2UoJ1xcXFwnLCAnXFwnKQ0KICAgIGVsc2U6DQojICAgICAgICBwcmludCAnZmluYWwgcmVzIGZvciB0aGlzIGl0ZXJhdGlvbiBpcycsaXRlcmF0aW9uDQogICAgICAgIHJldHVybiB1bnBhY2soc1VucGFja2VkMSxpdGVyYXRpb24rMSkjLnJlcGxhY2UoJ1xcJywgJycpLGl0ZXJhdGlvbikjLnJlcGxhY2UoJ1xcJywgJycpOyN1bnBhY2soc1VucGFja2VkLnJlcGxhY2UoJ1xcJywgJycpKQ0KDQpkZWYgX191bnBhY2socCwgYSwgYywgaywgZSwgZCwgaXRlcmF0aW9uLHY9MSk6DQoNCiAgICAjd2l0aCBvcGVuKCdiZWZvcmUgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6DQogICAgIyAgICBmaWxld3JpdGVyLndyaXRlKHN0cihwKSkNCiAgICB3aGlsZSAoYyA+PSAxKToNCiAgICAgICAgYyA9IGMgLTENCiAgICAgICAgaWYgKGtbY10pOg0KICAgICAgICAgICAgYWE9c3RyKF9faXRvYU5ldyhjLCBhKSkNCiAgICAgICAgICAgIGlmIHY9PTE6DQogICAgICAgICAgICAgICAgcD1yZS5zdWIoJ1xcYicgKyBhYSArJ1xcYicsIGtbY10sIHApIyBUSElTIElTIEJsb29keSBzbG93IQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwPWZpbmRBbmRSZXBsYWNlV29yZChwLGFhLGtbY10pDQoNCiAgICAgICAgICAgICNwPWZpbmRBbmRSZXBsYWNlV29yZChwLGFhLGtbY10pDQoNCg0KICAgICN3aXRoIG9wZW4oJ2FmdGVyIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOg0KICAgICMgICAgZmlsZXdyaXRlci53cml0ZShzdHIocCkpDQogICAgcmV0dXJuIHANCg0KIw0KI2Z1bmN0aW9uIGVxdWFsYXZlbnQgdG8gcmUuc3ViKCdcXGInICsgYWEgKydcXGInLCBrW2NdLCBwKQ0KZGVmIGZpbmRBbmRSZXBsYWNlV29yZChzb3VyY2Vfc3RyLCB3b3JkX3RvX2ZpbmQscmVwbGFjZV93aXRoKToNCiAgICBzcGxpdHM9Tm9uZQ0KICAgIHNwbGl0cz1zb3VyY2Vfc3RyLnNwbGl0KHdvcmRfdG9fZmluZCkNCiAgICBpZiBsZW4oc3BsaXRzKT4xOg0KICAgICAgICBuZXdfc3RyaW5nPVtdDQogICAgICAgIGN1cnJlbnRfaW5kZXg9MA0KICAgICAgICBmb3IgY3VycmVudF9zcGxpdCBpbiBzcGxpdHM6DQogICAgICAgICAgICAjcHJpbnQgJ2hlcmUnLGkNCiAgICAgICAgICAgIG5ld19zdHJpbmcuYXBwZW5kKGN1cnJlbnRfc3BsaXQpDQogICAgICAgICAgICB2YWw9d29yZF90b19maW5kI2J5IGRlZmF1bHQgYXNzdW1lIGl0IHdhcyB3cm9uZyB0byBzcGxpdA0KDQogICAgICAgICAgICAjaWYgaXRzIGZpcnN0IG9uZSBhbmQgaXRlbSBpcyBibGFuayB0aGVuIGNoZWNrIG5leHQgaXRlbSBpcyB2YWxpZCBvciBub3QNCiAgICAgICAgICAgIGlmIGN1cnJlbnRfaW5kZXg9PWxlbihzcGxpdHMpLTE6DQogICAgICAgICAgICAgICAgdmFsPScnICMgbGFzdCBvbmUgbm90aGluZyB0byBhcHBlbmQgbm9ybWFsbHkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgaWYgbGVuKGN1cnJlbnRfc3BsaXQpPT0wOiAjaWYgYmxhbmsgY2hlY2sgbmV4dCBvbmUgd2l0aCBjdXJyZW50IHNwbGl0IHZhbHVlDQogICAgICAgICAgICAgICAgICAgIGlmICggbGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT09MCBhbmQgd29yZF90b19maW5kWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgb3IgKGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk+MCAgYW5kIHNwbGl0c1tjdXJyZW50X2luZGV4KzFdWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJyk6IyBmaXJzdCBqdXN0IGp1c3QgY2hlY2sgbmV4dA0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlcGxhY2Vfd2l0aA0KICAgICAgICAgICAgICAgICNub3QgYmxhbmssIHRoZW4gY2hlY2sgY3VycmVudCBlbmR2YWx1ZSBhbmQgbmV4dCBmaXJzdCB2YWx1ZQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGlmIChzcGxpdHNbY3VycmVudF9pbmRleF1bLTFdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgYW5kICgoIGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk9PTAgYW5kIHdvcmRfdG9fZmluZFswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpIG9yIChsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPjAgIGFuZCBzcGxpdHNbY3VycmVudF9pbmRleCsxXVswXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpKTojIGZpcnN0IGp1c3QganVzdCBjaGVjayBuZXh0DQogICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVwbGFjZV93aXRoDQoNCiAgICAgICAgICAgIG5ld19zdHJpbmcuYXBwZW5kKHZhbCkNCiAgICAgICAgICAgIGN1cnJlbnRfaW5kZXgrPTENCiAgICAgICAgI2FhYWE9MS8wDQogICAgICAgIHNvdXJjZV9zdHI9Jycuam9pbihuZXdfc3RyaW5nKQ0KICAgIHJldHVybiBzb3VyY2Vfc3RyDQoNCmRlZiBfX2l0b2EobnVtLCByYWRpeCk6DQojICAgIHByaW50ICdudW0gcmVkJyxudW0sIHJhZGl4DQogICAgcmVzdWx0ID0gIiINCiAgICBpZiBudW09PTA6IHJldHVybiAnMCcNCiAgICB3aGlsZSBudW0gPiAwOg0KICAgICAgICByZXN1bHQgPSAiMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6IltudW0gJSByYWRpeF0gKyByZXN1bHQNCiAgICAgICAgbnVtIC89IHJhZGl4DQogICAgcmV0dXJuIHJlc3VsdA0KDQpkZWYgX19pdG9hTmV3KGNjLCBhKToNCiAgICBhYT0iIiBpZiBjYyA8IGEgZWxzZSBfX2l0b2FOZXcoaW50KGNjIC8gYSksYSkNCiAgICBjYyA9IChjYyAlIGEpDQogICAgYmI9Y2hyKGNjICsgMjkpIGlmIGNjPiAzNSBlbHNlIHN0cihfX2l0b2EoY2MsMzYpKQ0KICAgIHJldHVybiBhYStiYg0KDQoNCmRlZiBnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcik6DQogICAgdHJ5Og0KICAgICAgICBjb29raWVTdHJpbmc9IiINCiAgICAgICAgZm9yIGluZGV4LCBjb29raWUgaW4gZW51bWVyYXRlKGNvb2tpZUphcik6DQogICAgICAgICAgICBjb29raWVTdHJpbmcrPWNvb2tpZS5uYW1lICsgIj0iICsgY29va2llLnZhbHVlICsiOyINCiAgICBleGNlcHQ6IHBhc3MNCiAgICAjcHJpbnQgJ2Nvb2tpZVN0cmluZycsY29va2llU3RyaW5nDQogICAgcmV0dXJuIGNvb2tpZVN0cmluZw0KDQoNCmRlZiBzYXZlQ29va2llSmFyKGNvb2tpZUphcixDT09LSUVGSUxFKToNCiAgICB0cnk6DQogICAgICAgIGNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsQ09PS0lFRklMRSkNCiAgICAgICAgY29va2llSmFyLnNhdmUoY29tcGxldGVfcGF0aCxpZ25vcmVfZGlzY2FyZD1UcnVlKQ0KICAgIGV4Y2VwdDogcGFzcw0KDQpkZWYgZ2V0Q29va2llSmFyKENPT0tJRUZJTEUpOg0KDQogICAgY29va2llSmFyPU5vbmUNCiAgICBpZiBDT09LSUVGSUxFOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLENPT0tJRUZJTEUpDQogICAgICAgICAgICBjb29raWVKYXIgPSBjb29raWVsaWIuTFdQQ29va2llSmFyKCkNCiAgICAgICAgICAgIGNvb2tpZUphci5sb2FkKGNvbXBsZXRlX3BhdGgsaWdub3JlX2Rpc2NhcmQ9VHJ1ZSkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgY29va2llSmFyPU5vbmUNCg0KICAgIGlmIG5vdCBjb29raWVKYXI6DQogICAgICAgIGNvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQ0KDQogICAgcmV0dXJuIGNvb2tpZUphcg0KDQpkZWYgZG9FdmFsKGZ1bl9jYWxsLHBhZ2VfZGF0YSxDb29raWVfSmFyLG0pOg0KICAgIHJldF92YWw9JycNCiAgICAjcHJpbnQgZnVuX2NhbGwNCiAgICBpZiBmdW5jdGlvbnNfZGlyIG5vdCBpbiBzeXMucGF0aDoNCiAgICAgICAgc3lzLnBhdGguYXBwZW5kKGZ1bmN0aW9uc19kaXIpDQoNCiMgICAgcHJpbnQgZnVuX2NhbGwNCiAgICB0cnk6DQogICAgICAgIHB5X2ZpbGU9J2ltcG9ydCAnK2Z1bl9jYWxsLnNwbGl0KCcuJylbMF0NCiMgICAgICAgIHByaW50IHB5X2ZpbGUsc3lzLnBhdGgNCiAgICAgICAgZXhlYyggcHlfZmlsZSkNCiMgICAgICAgIHByaW50ICdkb25lJw0KICAgIGV4Y2VwdDoNCiAgICAgICAgI3ByaW50ICdlcnJvciBpbiBpbXBvcnQnDQogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3Rkb3V0KQ0KIyAgICBwcmludCAncmV0X3ZhbD0nK2Z1bl9jYWxsDQogICAgZXhlYyAoJ3JldF92YWw9JytmdW5fY2FsbCkNCiMgICAgcHJpbnQgcmV0X3ZhbA0KICAgICNleGVjKCdyZXRfdmFsPTErMScpDQogICAgdHJ5Og0KICAgICAgICByZXR1cm4gc3RyKHJldF92YWwpDQogICAgZXhjZXB0OiByZXR1cm4gcmV0X3ZhbA0KDQpkZWYgZG9FdmFsRnVuY3Rpb24oZnVuX2NhbGwscGFnZV9kYXRhLENvb2tpZV9KYXIsbSk6DQojICAgIHByaW50ICdkb0V2YWxGdW5jdGlvbicNCiAgICB0cnk6DQogICAgICAgIGdsb2JhbCBnTFNQcm9EeW5hbWljQ29kZU51bWJlcg0KICAgICAgICBnTFNQcm9EeW5hbWljQ29kZU51bWJlcj1nTFNQcm9EeW5hbWljQ29kZU51bWJlcisxDQogICAgICAgIHJldF92YWw9JycNCiAgICAgICAgcHJpbnQgJ2Rvb29vZG9vJw0KICAgICAgICBpZiBmdW5jdGlvbnNfZGlyIG5vdCBpbiBzeXMucGF0aDoNCiAgICAgICAgICAgIHN5cy5wYXRoLmFwcGVuZChmdW5jdGlvbnNfZGlyKQ0KDQogICAgICAgIGZpbGVuYW1lPSdMU1Byb2R5bmFtaWNDb2RlJXMucHknJXN0cihnTFNQcm9EeW5hbWljQ29kZU51bWJlcikNCiAgICAgICAgZmlsZW5hbWV3aXRocGF0aD1vcy5wYXRoLmpvaW4oZnVuY3Rpb25zX2RpcixmaWxlbmFtZSkNCiAgICAgICAgZj1vcGVuKGZpbGVuYW1ld2l0aHBhdGgsIndiIikNCiAgICAgICAgZi53cml0ZSgiIyAtKi0gY29kaW5nOiB1dGYtOCAtKi1cbiIpDQogICAgICAgIGYud3JpdGUoZnVuX2NhbGwuZW5jb2RlKCJ1dGYtOCIpKTsNCiAgICAgICAgZi5jbG9zZSgpDQogICAgICAgIHByaW50ICdiZWZvcmUgZG8nDQogICAgICAgIExTUHJvZHluYW1pY0NvZGUgPSBpbXBvcnRfYnlfc3RyaW5nKGZpbGVuYW1lLnNwbGl0KCcuJylbMF0sZmlsZW5hbWV3aXRocGF0aCkNCiAgICAgICAgcHJpbnQgJ2FmdGVyJw0KICAgICAgICAgDQogICAgICAgIHJldF92YWw9TFNQcm9keW5hbWljQ29kZS5HZXRMU1Byb0RhdGEocGFnZV9kYXRhLENvb2tpZV9KYXIsbSkNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgcmV0dXJuIHN0cihyZXRfdmFsKQ0KICAgICAgICBleGNlcHQ6IHJldHVybiByZXRfdmFsDQogICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKCkNCiAgICByZXR1cm4gIiINCg0KZGVmIGltcG9ydF9ieV9zdHJpbmcoZnVsbF9uYW1lLGZpbGVuYW1ld2l0aHBhdGgpOg0KICAgIHRyeToNCiAgICAgICAgDQogICAgICAgIGltcG9ydCBpbXBvcnRsaWINCiAgICAgICAgcmV0dXJuIGltcG9ydGxpYi5pbXBvcnRfbW9kdWxlKGZ1bGxfbmFtZSwgcGFja2FnZT1Ob25lKQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgaW1wb3J0IGltcA0KICAgICAgICByZXR1cm4gaW1wLmxvYWRfc291cmNlKGZ1bGxfbmFtZSxmaWxlbmFtZXdpdGhwYXRoKQ0KDQoNCmRlZiBnZXRHb29nbGVSZWNhcHRjaGFSZXNwb25zZShjYXB0Y2hha2V5LCBjaix0eXBlPTEpOiAjMSBmb3IgZ2V0LCAyIGZvciBwb3N0LCAzIGZvciByYXdwb3N0DQojICAgICNoZWFkZXJzPVsoJ1VzZXItQWdlbnQnLCdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjE0LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTQuMC4xJyldDQojICAgIGh0bWxfdGV4dD1nZXRVcmwodXJsLG5vcmVkaXI9VHJ1ZSwgY29va2llSmFyPWNqLGhlYWRlcnM9aGVhZGVycykNCiAjICAgcHJpbnQgJ2h0bWxfdGV4dCcsaHRtbF90ZXh0DQogICAgcmVjYXBDaGFsbGVuZ2U9IiINCiAgICBzb2x1dGlvbj0iIg0KIyAgICBjYXBfcmVnPSJyZWNhcC4qP1w/az0oLio/KVwiIiAgICANCiMgICAgbWF0Y2ggPXJlLmZpbmRhbGwoY2FwX3JlZywgaHRtbF90ZXh0KQ0KICAgIA0KICAgICAgICANCiMgICAgcHJpbnQgJ21hdGNoJyxtYXRjaA0KICAgIGNhcHRjaGE9RmFsc2UNCiAgICBjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbD1Ob25lDQogICAgc29sdXRpb249Tm9uZQ0KICAgIGlmIGxlbihjYXB0Y2hha2V5KT4wOiAjbmV3IHNoaW55IGNhcHRjaGEhDQogICAgICAgIGNhcHRjaGFfdXJsPWNhcHRjaGFrZXkNCiAgICAgICAgaWYgbm90IGNhcHRjaGFfdXJsLnN0YXJ0c3dpdGgoJ2h0dHAnKToNCiAgICAgICAgICAgIGNhcHRjaGFfdXJsPSdodHRwOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2FwaS9jaGFsbGVuZ2U/az0nK2NhcHRjaGFfdXJsKycmYWpheD0xJw0KIyAgICAgICAgcHJpbnQgJ2NhcHRjaGFfdXJsJyxjYXB0Y2hhX3VybA0KICAgICAgICBjYXB0Y2hhPVRydWUNCg0KICAgICAgICBjYXBfY2hhbGxfcmVnPSdjaGFsbGVuZ2UuKj9cJyguKj8pXCcnDQogICAgICAgIGNhcF9pbWFnZV9yZWc9J1wnKC4qPylcJycNCiAgICAgICAgY2FwdGNoYV9zY3JpcHQ9Z2V0VXJsKGNhcHRjaGFfdXJsLGNvb2tpZUphcj1jaikNCiAgICAgICAgcmVjYXBDaGFsbGVuZ2U9cmUuZmluZGFsbChjYXBfY2hhbGxfcmVnLCBjYXB0Y2hhX3NjcmlwdClbMF0NCiAgICAgICAgY2FwdGNoYV9yZWxvYWQ9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL3JlbG9hZD9jPSc7DQogICAgICAgIGNhcHRjaGFfaz1jYXB0Y2hhX3VybC5zcGxpdCgnaz0nKVsxXQ0KICAgICAgICBjYXB0Y2hhX3JlbG9hZCs9cmVjYXBDaGFsbGVuZ2UrJyZrPScrY2FwdGNoYV9rKycmcmVhc29uPWkmdHlwZT1pbWFnZSZsYW5nPWVuJw0KICAgICAgICBjYXB0Y2hhX3JlbG9hZF9qcz1nZXRVcmwoY2FwdGNoYV9yZWxvYWQsY29va2llSmFyPWNqKQ0KICAgICAgICBjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbD1yZS5maW5kYWxsKGNhcF9pbWFnZV9yZWcsIGNhcHRjaGFfcmVsb2FkX2pzKVswXQ0KICAgICAgICBjYXB0Y2hhX2ltYWdlX3VybD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvaW1hZ2U/Yz0nK2NhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsDQogICAgICAgIGlmIG5vdCBjYXB0Y2hhX2ltYWdlX3VybC5zdGFydHN3aXRoKCJodHRwIik6DQogICAgICAgICAgICBjYXB0Y2hhX2ltYWdlX3VybD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvJytjYXB0Y2hhX2ltYWdlX3VybA0KICAgICAgICBpbXBvcnQgcmFuZG9tDQogICAgICAgIG49cmFuZG9tLnJhbmRyYW5nZSgxMDAsMTAwMCw1KQ0KICAgICAgICBsb2NhbF9jYXB0Y2hhID0gb3MucGF0aC5qb2luKHByb2ZpbGUsc3RyKG4pICsiY2FwdGNoYS5pbWciICkNCiAgICAgICAgbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQ0KICAgICAgICBsb2NhbEZpbGUud3JpdGUoZ2V0VXJsKGNhcHRjaGFfaW1hZ2VfdXJsLGNvb2tpZUphcj1jaikpDQogICAgICAgIGxvY2FsRmlsZS5jbG9zZSgpDQogICAgICAgIHNvbHZlciA9IElucHV0V2luZG93KGNhcHRjaGE9bG9jYWxfY2FwdGNoYSkNCiAgICAgICAgc29sdXRpb24gPSBzb2x2ZXIuZ2V0KCkNCiAgICAgICAgb3MucmVtb3ZlKGxvY2FsX2NhcHRjaGEpDQoNCiAgICBpZiBjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbDoNCiAgICAgICAgaWYgdHlwZT09MToNCiAgICAgICAgICAgIHJldHVybiAncmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZD0nK3VybGxpYi5xdW90ZV9wbHVzKGNhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsKSsnJnJlY2FwdGNoYV9yZXNwb25zZV9maWVsZD0nK3VybGxpYi5xdW90ZV9wbHVzKHNvbHV0aW9uKQ0KICAgICAgICBlbGlmIHR5cGU9PTI6DQogICAgICAgICAgICByZXR1cm4gJ3JlY2FwdGNoYV9jaGFsbGVuZ2VfZmllbGQ6JytjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbCsnLHJlY2FwdGNoYV9yZXNwb25zZV9maWVsZDonK3NvbHV0aW9uDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gJ3JlY2FwdGNoYV9jaGFsbGVuZ2VfZmllbGQ9Jyt1cmxsaWIucXVvdGVfcGx1cyhjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbCkrJyZyZWNhcHRjaGFfcmVzcG9uc2VfZmllbGQ9Jyt1cmxsaWIucXVvdGVfcGx1cyhzb2x1dGlvbikNCiAgICBlbHNlOg0KICAgICAgICByZXR1cm4gJycNCiAgICAgICAgDQoNCmRlZiBnZXRVcmwodXJsLCBjb29raWVKYXI9Tm9uZSxwb3N0PU5vbmUsIHRpbWVvdXQ9MjAsIGhlYWRlcnM9Tm9uZSwgbm9yZWRpcj1GYWxzZSk6DQoNCg0KICAgIGNvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikNCg0KICAgIGlmIG5vcmVkaXI6DQogICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKE5vUmVkaXJlY3Rpb24sY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQ0KICAgIGVsc2U6DQogICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkNCiAgICAjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpDQogICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KHVybCkNCiAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgV09XNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8zMy4wLjE3NTAuMTU0IFNhZmFyaS81MzcuMzYnKQ0KICAgIGlmIGhlYWRlcnM6DQogICAgICAgIGZvciBoLGh2IGluIGhlYWRlcnM6DQogICAgICAgICAgICByZXEuYWRkX2hlYWRlcihoLGh2KQ0KDQogICAgcmVzcG9uc2UgPSBvcGVuZXIub3BlbihyZXEscG9zdCx0aW1lb3V0PXRpbWVvdXQpDQogICAgbGluaz1yZXNwb25zZS5yZWFkKCkNCiAgICByZXNwb25zZS5jbG9zZSgpDQogICAgcmV0dXJuIGxpbms7DQoNCmRlZiBnZXRfZGVjb2RlKHN0cixyZWc9Tm9uZSk6DQogICAgaWYgcmVnOg0KICAgICAgICBzdHI9cmUuZmluZGFsbChyZWcsIHN0cilbMF0NCiAgICBzMSA9IHVybGxpYi51bnF1b3RlKHN0clswOiBsZW4oc3RyKS0xXSk7DQogICAgdCA9ICcnOw0KICAgIGZvciBpIGluIHJhbmdlKCBsZW4oczEpKToNCiAgICAgICAgdCArPSBjaHIob3JkKHMxW2ldKSAtIHMxW2xlbihzMSktMV0pOw0KICAgIHQ9dXJsbGliLnVucXVvdGUodCkNCiMgICAgcHJpbnQgdA0KICAgIHJldHVybiB0DQoNCmRlZiBqYXZhc2NyaXB0VW5Fc2NhcGUoc3RyKToNCiAgICBqcz1yZS5maW5kYWxsKCd1bmVzY2FwZVwoXCcoLio/KVwnJyxzdHIpDQojICAgIHByaW50ICdqcycsanMNCiAgICBpZiAobm90IGpzPT1Ob25lKSBhbmQgbGVuKGpzKT4wOg0KICAgICAgICBmb3IgaiBpbiBqczoNCiAgICAgICAgICAgICNwcmludCB1cmxsaWIudW5xdW90ZShqKQ0KICAgICAgICAgICAgc3RyPXN0ci5yZXBsYWNlKGogLHVybGxpYi51bnF1b3RlKGopKQ0KICAgIHJldHVybiBzdHINCg0KaWlkPTANCmRlZiBhc2tDYXB0Y2hhKG0saHRtbF9wYWdlLCBjb29raWVKYXIpOg0KICAgIGdsb2JhbCBpaWQNCiAgICBpaWQrPTENCiAgICBleHByZT0gbVsnZXhwcmVzJ10NCiAgICBwYWdlX3VybCA9IG1bJ3BhZ2UnXQ0KICAgIGNhcHRjaGFfcmVnZXg9cmUuY29tcGlsZSgnXCRMaXZlU3RyZWFtQ2FwdGNoYVxbKFteXF1dKilcXScpLmZpbmRhbGwoZXhwcmUpWzBdDQoNCiAgICBjYXB0Y2hhX3VybD1yZS5jb21waWxlKGNhcHRjaGFfcmVnZXgpLmZpbmRhbGwoaHRtbF9wYWdlKVswXQ0KIyAgICBwcmludCBleHByZSxjYXB0Y2hhX3JlZ2V4LGNhcHRjaGFfdXJsDQogICAgaWYgbm90IGNhcHRjaGFfdXJsLnN0YXJ0c3dpdGgoImh0dHAiKToNCiAgICAgICAgcGFnZV89J2h0dHA6Ly8nKyIiLmpvaW4ocGFnZV91cmwuc3BsaXQoJy8nKVsyOjNdKQ0KICAgICAgICBpZiBjYXB0Y2hhX3VybC5zdGFydHN3aXRoKCIvIik6DQogICAgICAgICAgICBjYXB0Y2hhX3VybD1wYWdlXytjYXB0Y2hhX3VybA0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgY2FwdGNoYV91cmw9cGFnZV8rJy8nK2NhcHRjaGFfdXJsDQoNCiAgICBsb2NhbF9jYXB0Y2hhID0gb3MucGF0aC5qb2luKHByb2ZpbGUsIHN0cihpaWQpKyJjYXB0Y2hhLmpwZyIgKQ0KICAgIGxvY2FsRmlsZSA9IG9wZW4obG9jYWxfY2FwdGNoYSwgIndiIikNCiMgICAgcHJpbnQgJyBjIGNhcHVybCcsY2FwdGNoYV91cmwNCiAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QoY2FwdGNoYV91cmwpDQogICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjoxNC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE0LjAuMScpDQogICAgaWYgJ3JlZmVyZXInIGluIG06DQogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdSZWZlcmVyJywgbVsncmVmZXJlciddKQ0KICAgIGlmICdhZ2VudCcgaW4gbToNCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItYWdlbnQnLCBtWydhZ2VudCddKQ0KICAgIGlmICdzZXRjb29raWUnIGluIG06DQojICAgICAgICBwcmludCAnYWRkaW5nIGNvb2tpZScsbVsnc2V0Y29va2llJ10NCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0Nvb2tpZScsIG1bJ3NldGNvb2tpZSddKQ0KDQogICAgI2Nvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikNCiAgICAjb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQ0KICAgICNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikNCiAgICB1cmxsaWIyLnVybG9wZW4ocmVxKQ0KICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkNCg0KICAgIGxvY2FsRmlsZS53cml0ZShyZXNwb25zZS5yZWFkKCkpDQogICAgcmVzcG9uc2UuY2xvc2UoKQ0KICAgIGxvY2FsRmlsZS5jbG9zZSgpDQogICAgc29sdmVyID0gSW5wdXRXaW5kb3coY2FwdGNoYT1sb2NhbF9jYXB0Y2hhKQ0KICAgIHNvbHV0aW9uID0gc29sdmVyLmdldCgpDQogICAgcmV0dXJuIHNvbHV0aW9uDQoNCmRlZiBhc2tDYXB0Y2hhTmV3KGltYWdlcmVnZXgsaHRtbF9wYWdlLGNvb2tpZUphcixtKToNCiAgICBnbG9iYWwgaWlkDQogICAgaWlkKz0xDQoNCg0KICAgIGlmIG5vdCBpbWFnZXJlZ2V4PT0nJzoNCiAgICAgICAgaWYgaHRtbF9wYWdlLnN0YXJ0c3dpdGgoImh0dHAiKToNCiAgICAgICAgICAgIHBhZ2VfPWdldFVybChodG1sX3BhZ2UsY29va2llSmFyPWNvb2tpZUphcikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHBhZ2VfPWh0bWxfcGFnZQ0KICAgICAgICBjYXB0Y2hhX3VybD1yZS5jb21waWxlKGltYWdlcmVnZXgpLmZpbmRhbGwoaHRtbF9wYWdlKVswXQ0KICAgIGVsc2U6DQogICAgICAgIGNhcHRjaGFfdXJsPWh0bWxfcGFnZQ0KICAgICAgICBpZiAnb25lcGxheS50di9lbWJlZCcgaW4gaHRtbF9wYWdlOg0KICAgICAgICAgICAgaW1wb3J0IG9uZXBsYXkNCiAgICAgICAgICAgIHBhZ2VfPWdldFVybChodG1sX3BhZ2UsY29va2llSmFyPWNvb2tpZUphcikNCiAgICAgICAgICAgIGNhcHRjaGFfdXJsPW9uZXBsYXkuZ2V0Q2FwdGNoYVVybChwYWdlXykNCg0KICAgIGxvY2FsX2NhcHRjaGEgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgc3RyKGlpZCkrImNhcHRjaGEuanBnIiApDQogICAgbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQ0KIyAgICBwcmludCAnIGMgY2FwdXJsJyxjYXB0Y2hhX3VybA0KICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdChjYXB0Y2hhX3VybCkNCiAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjE0LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTQuMC4xJykNCiAgICBpZiAncmVmZXJlcicgaW4gbToNCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlcmVyJ10pDQogICAgaWYgJ2FnZW50JyBpbiBtOg0KICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1hZ2VudCcsIG1bJ2FnZW50J10pDQogICAgaWYgJ2FjY2VwdCcgaW4gbToNCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0FjY2VwdCcsIG1bJ2FjY2VwdCddKQ0KICAgIGlmICdzZXRjb29raWUnIGluIG06DQojICAgICAgICBwcmludCAnYWRkaW5nIGNvb2tpZScsbVsnc2V0Y29va2llJ10NCiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0Nvb2tpZScsIG1bJ3NldGNvb2tpZSddKQ0KDQogICAgI2Nvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikNCiAgICAjb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQ0KICAgICNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikNCiAgICAjdXJsbGliMi51cmxvcGVuKHJlcSkNCiAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpDQoNCiAgICBsb2NhbEZpbGUud3JpdGUocmVzcG9uc2UucmVhZCgpKQ0KICAgIHJlc3BvbnNlLmNsb3NlKCkNCiAgICBsb2NhbEZpbGUuY2xvc2UoKQ0KICAgIHNvbHZlciA9IElucHV0V2luZG93KGNhcHRjaGE9bG9jYWxfY2FwdGNoYSkNCiAgICBzb2x1dGlvbiA9IHNvbHZlci5nZXQoKQ0KICAgIHJldHVybiBzb2x1dGlvbg0KDQojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMNCiMgRnVuY3Rpb24gIDogR1VJRWRpdEV4cG9ydE5hbWUgICAgICAgICAgICAgICAgICAgICAgICAgIw0KIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjDQojIFBhcmFtZXRlciA6ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIw0KIyBuYW1lICAgICAgICBzdWdlc3RlZCBuYW1lIGZvciBleHBvcnQgICAgICAgICAgICAgICAgICAjDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgDQojIFJldHVybnMgICA6ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMNCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIw0KIyBuYW1lICAgICAgICBuYW1lIG9mIGV4cG9ydCBleGNsdWRpbmcgYW55IGV4dGVuc2lvbiAgICAjDQojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMNCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KZGVmIFRha2VJbnB1dChuYW1lLCBoZWFkbmFtZSk6DQoNCg0KICAgIGtiID0geGJtYy5LZXlib2FyZCgnZGVmYXVsdCcsICdoZWFkaW5nJywgVHJ1ZSkNCiAgICBrYi5zZXREZWZhdWx0KG5hbWUpDQogICAga2Iuc2V0SGVhZGluZyhoZWFkbmFtZSkNCiAgICBrYi5zZXRIaWRkZW5JbnB1dChGYWxzZSkNCiAgICByZXR1cm4ga2IuZ2V0VGV4dCgpDQoNCiAgIA0KIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjDQoNCmNsYXNzIElucHV0V2luZG93KHhibWNndWkuV2luZG93RGlhbG9nKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToNCiAgICAgICAgc2VsZi5jcHRsb2MgPSBrd2FyZ3MuZ2V0KCdjYXB0Y2hhJykNCiAgICAgICAgc2VsZi5pbWcgPSB4Ym1jZ3VpLkNvbnRyb2xJbWFnZSgzMzUsMzAsNjI0LDYwLHNlbGYuY3B0bG9jKQ0KICAgICAgICBzZWxmLmFkZENvbnRyb2woc2VsZi5pbWcpDQogICAgICAgIHNlbGYua2JkID0geGJtYy5LZXlib2FyZCgpDQoNCiAgICBkZWYgZ2V0KHNlbGYpOg0KICAgICAgICBzZWxmLnNob3coKQ0KICAgICAgICB0aW1lLnNsZWVwKDIpDQogICAgICAgIHNlbGYua2JkLmRvTW9kYWwoKQ0KICAgICAgICBpZiAoc2VsZi5rYmQuaXNDb25maXJtZWQoKSk6DQogICAgICAgICAgICB0ZXh0ID0gc2VsZi5rYmQuZ2V0VGV4dCgpDQogICAgICAgICAgICBzZWxmLmNsb3NlKCkNCiAgICAgICAgICAgIHJldHVybiB0ZXh0DQogICAgICAgIHNlbGYuY2xvc2UoKQ0KICAgICAgICByZXR1cm4gRmFsc2UNCg0KZGVmIGdldEVwb2NUaW1lKCk6DQogICAgaW1wb3J0IHRpbWUNCiAgICByZXR1cm4gc3RyKGludCh0aW1lLnRpbWUoKSoxMDAwKSkNCg0KZGVmIGdldEVwb2NUaW1lMigpOg0KICAgIGltcG9ydCB0aW1lDQogICAgcmV0dXJuIHN0cihpbnQodGltZS50aW1lKCkpKQ0KDQpkZWYgZ2V0X3BhcmFtcygpOg0KICAgICAgICBwYXJhbT1bXQ0KICAgICAgICBwYXJhbXN0cmluZz1zeXMuYXJndlsyXQ0KICAgICAgICBpZiBsZW4ocGFyYW1zdHJpbmcpPj0yOg0KICAgICAgICAgICAgcGFyYW1zPXN5cy5hcmd2WzJdDQogICAgICAgICAgICBjbGVhbmVkcGFyYW1zPXBhcmFtcy5yZXBsYWNlKCc/JywnJykNCiAgICAgICAgICAgIGlmIChwYXJhbXNbbGVuKHBhcmFtcyktMV09PScvJyk6DQogICAgICAgICAgICAgICAgcGFyYW1zPXBhcmFtc1swOmxlbihwYXJhbXMpLTJdDQogICAgICAgICAgICBwYWlyc29mcGFyYW1zPWNsZWFuZWRwYXJhbXMuc3BsaXQoJyYnKQ0KICAgICAgICAgICAgcGFyYW09e30NCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihwYWlyc29mcGFyYW1zKSk6DQogICAgICAgICAgICAgICAgc3BsaXRwYXJhbXM9e30NCiAgICAgICAgICAgICAgICBzcGxpdHBhcmFtcz1wYWlyc29mcGFyYW1zW2ldLnNwbGl0KCc9JykNCiAgICAgICAgICAgICAgICBpZiAobGVuKHNwbGl0cGFyYW1zKSk9PTI6DQogICAgICAgICAgICAgICAgICAgIHBhcmFtW3NwbGl0cGFyYW1zWzBdXT1zcGxpdHBhcmFtc1sxXQ0KICAgICAgICByZXR1cm4gcGFyYW0NCg0KDQpkZWYgZ2V0RmF2b3JpdGVzKCk6DQogICAgICAgIGl0ZW1zID0ganNvbi5sb2FkcyhvcGVuKGZhdm9yaXRlcykucmVhZCgpKQ0KICAgICAgICB0b3RhbCA9IGxlbihpdGVtcykNCiAgICAgICAgZm9yIGkgaW4gaXRlbXM6DQogICAgICAgICAgICBuYW1lID0gaVswXQ0KICAgICAgICAgICAgdXJsID0gaVsxXQ0KICAgICAgICAgICAgaWNvbmltYWdlID0gaVsyXQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGZhbkFydCA9IGlbM10NCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6DQogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGljb25pbWFnZQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydA0KICAgICAgICAgICAgdHJ5OiBwbGF5bGlzdCA9IGlbNV0NCiAgICAgICAgICAgIGV4Y2VwdDogcGxheWxpc3QgPSBOb25lDQogICAgICAgICAgICB0cnk6IHJlZ2V4cyA9IGlbNl0NCiAgICAgICAgICAgIGV4Y2VwdDogcmVnZXhzID0gTm9uZQ0KDQogICAgICAgICAgICBpZiBpWzRdID09IDA6DQogICAgICAgICAgICAgICAgYWRkTGluayh1cmwsbmFtZSxpY29uaW1hZ2UsZmFuQXJ0LCcnLCcnLCcnLCdmYXYnLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsLGlbNF0saWNvbmltYWdlLGZhbmFydCwnJywnJywnJywnJywnZmF2JykNCg0KDQpkZWYgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlLHBsYXlsaXN0PU5vbmUscmVnZXhzPU5vbmUpOg0KICAgICAgICBmYXZMaXN0ID0gW10NCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgIyBzZWVtcyB0aGF0IGFmdGVyDQogICAgICAgICAgICBuYW1lID0gbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHBhc3MNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzKT09RmFsc2U6DQogICAgICAgICAgICBhZGRvbl9sb2coJ01ha2luZyBGYXZvcml0ZXMgRmlsZScpDQogICAgICAgICAgICBmYXZMaXN0LmFwcGVuZCgobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlLHBsYXlsaXN0LHJlZ2V4cykpDQogICAgICAgICAgICBhID0gb3BlbihmYXZvcml0ZXMsICJ3IikNCiAgICAgICAgICAgIGEud3JpdGUoanNvbi5kdW1wcyhmYXZMaXN0KSkNCiAgICAgICAgICAgIGEuY2xvc2UoKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgYWRkb25fbG9nKCdBcHBlbmRpbmcgRmF2b3JpdGVzJykNCiAgICAgICAgICAgIGEgPSBvcGVuKGZhdm9yaXRlcykucmVhZCgpDQogICAgICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhhKQ0KICAgICAgICAgICAgZGF0YS5hcHBlbmQoKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsbW9kZSkpDQogICAgICAgICAgICBiID0gb3BlbihmYXZvcml0ZXMsICJ3IikNCiAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhkYXRhKSkNCiAgICAgICAgICAgIGIuY2xvc2UoKQ0KDQoNCmRlZiBybUZhdm9yaXRlKG5hbWUpOg0KICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhvcGVuKGZhdm9yaXRlcykucmVhZCgpKQ0KICAgICAgICBmb3IgaW5kZXggaW4gcmFuZ2UobGVuKGRhdGEpKToNCiAgICAgICAgICAgIGlmIGRhdGFbaW5kZXhdWzBdPT1uYW1lOg0KICAgICAgICAgICAgICAgIGRlbCBkYXRhW2luZGV4XQ0KICAgICAgICAgICAgICAgIGIgPSBvcGVuKGZhdm9yaXRlcywgInciKQ0KICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhkYXRhKSkNCiAgICAgICAgICAgICAgICBiLmNsb3NlKCkNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5SZWZyZXNoIikNCg0KZGVmIHVybHNvbHZlcih1cmwpOg0KICAgIGltcG9ydCB1cmxyZXNvbHZlcg0KICAgIGhvc3QgPSB1cmxyZXNvbHZlci5Ib3N0ZWRNZWRpYUZpbGUodXJsKQ0KICAgIGlmIGhvc3Q6DQogICAgICAgIHJlc29sdmVyID0gdXJscmVzb2x2ZXIucmVzb2x2ZSh1cmwpDQogICAgICAgIHJlc29sdmVkID0gcmVzb2x2ZXINCiAgICAgICAgaWYgaXNpbnN0YW5jZShyZXNvbHZlZCxsaXN0KToNCiAgICAgICAgICAgIGZvciBrIGluIHJlc29sdmVkOg0KICAgICAgICAgICAgICAgIHF1YWxpdHkgPSBhZGRvbi5nZXRTZXR0aW5nKCdxdWFsaXR5JykNCiAgICAgICAgICAgICAgICBpZiBrWydxdWFsaXR5J10gPT0gJ0hEJyAgOg0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgZWxpZiBrWydxdWFsaXR5J10gPT0gJ1NEJyA6DQogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0ga1sndXJsJ10NCiAgICAgICAgICAgICAgICBlbGlmIGtbJ3F1YWxpdHknXSA9PSAnMTA4MHAnIGFuZCBhZGRvbi5nZXRTZXR0aW5nKCcxMDgwcHF1YWxpdHknKSA9PSAndHJ1ZScgOg0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXNvbHZlciA9IHJlc29sdmVkDQogICAgZWxzZToNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oSGVyY3VsZXMsVXJscmVzb2x2ZXIgbm8gc29wb3J0YSBlc3RlIGRvbWluaW8uIC0gLDUwMDApIikNCiAgICAgICAgcmVzb2x2ZXI9dXJsDQogICAgcmV0dXJuIHJlc29sdmVyDQpkZWYgdHJ5cGxheSh1cmwsbGlzdGl0ZW0scGRpYWxvZ3VlPU5vbmUpOiAgICANCg0KICAgIGlmIHVybC5sb3dlcigpLnN0YXJ0c3dpdGgoJ3BsdWdpbicpIGFuZCAneW91dHViZScgbm90IGluICB1cmwubG93ZXIoKToNCiAgICAgICAgcHJpbnQgJ3BsYXlpbmcgdmlhIHJ1bnBsdWdpbicNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignWEJNQy5SdW5QbHVnaW4oJyt1cmwrJyknKSANCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoOCk6DQogICAgICAgICAgICB4Ym1jLnNsZWVwKDUwMCkgIyNzbGVlcCBmb3IgMTAgc2Vjb25kcywgaGFsZiBlYWNoIHRpbWUNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAjcHJpbnQgJ2NvbmRpJw0KICAgICAgICAgICAgICAgIGlmIHhibWMuZ2V0Q29uZFZpc2liaWxpdHkoIlBsYXllci5IYXNNZWRpYSIpIGFuZCB4Ym1jLlBsYXllcigpLmlzUGxheWluZygpOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgZXhjZXB0OiBwYXNzDQogICAgICAgIHByaW50ICdyZXR1cm5pbmcgbm93Jw0KICAgICAgICByZXR1cm4gRmFsc2UNCiAgICBpbXBvcnQgIEN1c3RvbVBsYXllcix0aW1lDQoNCiAgICBwbGF5ZXIgPSBDdXN0b21QbGF5ZXIuTXlYQk1DUGxheWVyKCkNCiAgICBwbGF5ZXIucGRpYWxvZ3VlPXBkaWFsb2d1ZQ0KICAgIHN0YXJ0ID0gdGltZS50aW1lKCkgDQogICAgI3hibWMuUGxheWVyKCkucGxheSggbGl2ZUxpbmssbGlzdGl0ZW0pDQogICAgcHJpbnQgJ2dvaW5nIHRvIHBsYXknDQogICAgaW1wb3J0IHRpbWUNCiAgICBiZWZvcmVzdGFydD10aW1lLnRpbWUoKQ0KICAgIHBsYXllci5wbGF5KCB1cmwsIGxpc3RpdGVtKQ0KICAgIHhibWMuc2xlZXAoMTAwMCkNCiAgICANCiAgICB0cnk6DQogICAgICAgIHdoaWxlIHBsYXllci5pc19hY3RpdmU6DQogICAgICAgICAgICB4Ym1jLnNsZWVwKDQwMCkNCiAgICAgICAgICAgDQogICAgICAgICAgICBpZiBwbGF5ZXIudXJscGxheWVkOg0KICAgICAgICAgICAgICAgIHByaW50ICd5ZXMgcGxheWVkJw0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgICAgICBpZiB0aW1lLnRpbWUoKS1iZWZvcmVzdGFydD40OiByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgICN4Ym1jLnNsZWVwKDEwMDApDQogICAgZXhjZXB0OiBwYXNzDQogICAgcHJpbnQgJ25vdCBwbGF5ZWQnLHVybA0KICAgIHJldHVybiBGYWxzZQ0KZGVmIHBsYXlfcGxheWxpc3QobmFtZSwgbXVfcGxheWxpc3QscXVldWVWaWRlbz1Ob25lKToNCiAgICAgICAgcGxheWxpc3QgPSB4Ym1jLlBsYXlMaXN0KHhibWMuUExBWUxJU1RfVklERU8pDQogICAgICAgICNwcmludCAnbXVfcGxheWxpc3QnLG11X3BsYXlsaXN0DQogICAgICAgIGlmICckJExTUGxheU9ubHlPbmUkJCcgaW4gbXVfcGxheWxpc3RbMF06DQogICAgICAgICAgICBtdV9wbGF5bGlzdFswXT1tdV9wbGF5bGlzdFswXS5yZXBsYWNlKCckJExTUGxheU9ubHlPbmUkJCcsJycpDQogICAgICAgICAgICBpbXBvcnQgdXJscGFyc2UNCiAgICAgICAgICAgIG5hbWVzID0gW10NCiAgICAgICAgICAgIGlsb29wPTANCiAgICAgICAgICAgIHByb2dyZXNzID0geGJtY2d1aS5EaWFsb2dQcm9ncmVzcygpDQogICAgICAgICAgICBwcm9ncmVzcy5jcmVhdGUoJ1Byb2dyZXNzJywgJ1RyeWluZyBNdWx0aXBsZSBMaW5rcycpDQogICAgICAgICAgICBmb3IgaSBpbiBtdV9wbGF5bGlzdDoNCiAgICAgICAgICAgICAgICANCg0KICAgICAgICAgICAgICAgIGlmICckJGxzbmFtZT0nIGluIGk6DQogICAgICAgICAgICAgICAgICAgIGRfbmFtZT1pLnNwbGl0KCckJGxzbmFtZT0nKVsxXS5zcGxpdCgnJnJlZ2V4cycpWzBdDQogICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChkX25hbWUpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG11X3BsYXlsaXN0W2lsb29wXT1pLnNwbGl0KCckJGxzbmFtZT0nKVswXSsoJyZyZWdleHMnK2kuc3BsaXQoJyZyZWdleHMnKVsxXSBpZiAnJnJlZ2V4cycgaW4gaSBlbHNlICcnKSAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZF9uYW1lPXVybHBhcnNlLnVybHBhcnNlKGkpLm5ldGxvYw0KICAgICAgICAgICAgICAgICAgICBpZiBkX25hbWUgPT0gJyc6DQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lcy5hcHBlbmQobmFtZSkNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChkX25hbWUpDQogICAgICAgICAgICAgICAgaW5kZXg9aWxvb3ANCiAgICAgICAgICAgICAgICBpbG9vcCs9MQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHBsYXluYW1lPW5hbWVzW2luZGV4XQ0KICAgICAgICAgICAgICAgIGlmIHByb2dyZXNzLmlzY2FuY2VsZWQoKTogcmV0dXJuIA0KICAgICAgICAgICAgICAgIHByb2dyZXNzLnVwZGF0ZSggaWxvb3AvbGVuKG11X3BsYXlsaXN0KSoxMDAsIiIsICJMaW5rIyVkIiUoaWxvb3ApLHBsYXluYW1lICApDQogICAgICAgICAgICAgICAgcHJpbnQgJ2F1dG8gcGxheW5hbWV4eCcscGxheW5hbWUNCiAgICAgICAgICAgICAgICBpZiAiJm1vZGU9MTkiIGluIG11X3BsYXlsaXN0W2luZGV4XToNCiAgICAgICAgICAgICAgICAgICAgICAgICNwbGF5c2V0cmVzb2x2ZWQgKHVybHNvbHZlcihtdV9wbGF5bGlzdFtpbmRleF0ucmVwbGFjZSgnJm1vZGU9MTknLCcnKSksbmFtZSxpY29uaW1hZ2UsVHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShwbGF5bmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSdWaWRlbycsIGluZm9MYWJlbHM9eydUaXRsZSc6cGxheW5hbWV9KQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoIklzUGxheWFibGUiLCJ0cnVlIikNCiAgICAgICAgICAgICAgICAgICAgdXJsdG9wbGF5PXVybHNvbHZlcihtdV9wbGF5bGlzdFtpbmRleF0ucmVwbGFjZSgnJm1vZGU9MTknLCcnKS5yZXBsYWNlKCc7JywnJykpDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQYXRoKHVybHRvcGxheSkNCiAgICAgICAgICAgICAgICAgICAgI3hibWMuUGxheWVyKCkucGxheSh1cmx0b3BsYXksbGl6KQ0KICAgICAgICAgICAgICAgICAgICBwbGF5ZWQ9dHJ5cGxheSh1cmx0b3BsYXksbGl6KQ0KICAgICAgICAgICAgICAgIGVsaWYgIiRkb3JlZ2V4IiBpbiBtdV9wbGF5bGlzdFtpbmRleF0gOg0KIyAgICAgICAgICAgICAgICAgICAgcHJpbnQgbXVfcGxheWxpc3RbaW5kZXhdDQogICAgICAgICAgICAgICAgICAgIHNlcGF0ZSA9IG11X3BsYXlsaXN0W2luZGV4XS5zcGxpdCgnJnJlZ2V4cz0nKQ0KIyAgICAgICAgICAgICAgICAgICAgcHJpbnQgc2VwYXRlDQogICAgICAgICAgICAgICAgICAgIHVybCxzZXRyZXNvbHZlZCA9IGdldFJlZ2V4UGFyc2VkKHNlcGF0ZVsxXSwgc2VwYXRlWzBdKQ0KICAgICAgICAgICAgICAgICAgICB1cmwyID0gdXJsLnJlcGxhY2UoJzsnLCcnKQ0KICAgICAgICAgICAgICAgICAgICBsaXogPSB4Ym1jZ3VpLkxpc3RJdGVtKHBsYXluYW1lLCBpY29uSW1hZ2U9aWNvbmltYWdlLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9J1ZpZGVvJywgaW5mb0xhYmVscz17J1RpdGxlJzpwbGF5bmFtZX0pDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiSXNQbGF5YWJsZSIsInRydWUiKQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0UGF0aCh1cmwyKQ0KICAgICAgICAgICAgICAgICAgICAjeGJtYy5QbGF5ZXIoKS5wbGF5KHVybDIsbGl6KQ0KICAgICAgICAgICAgICAgICAgICBwbGF5ZWQ9dHJ5cGxheSh1cmwyLGxpeikNCg0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIHVybCA9IG11X3BsYXlsaXN0W2luZGV4XQ0KICAgICAgICAgICAgICAgICAgICB1cmw9dXJsLnNwbGl0KCcmcmVnZXhzPScpWzBdDQogICAgICAgICAgICAgICAgICAgIGxpeiA9IHhibWNndWkuTGlzdEl0ZW0ocGxheW5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0nVmlkZW8nLCBpbmZvTGFiZWxzPXsnVGl0bGUnOnBsYXluYW1lfSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCJJc1BsYXlhYmxlIiwidHJ1ZSIpDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQYXRoKHVybCkNCiAgICAgICAgICAgICAgICAgICAgI3hibWMuUGxheWVyKCkucGxheSh1cmwsbGl6KQ0KICAgICAgICAgICAgICAgICAgICBwbGF5ZWQ9dHJ5cGxheSh1cmwsbGl6KQ0KICAgICAgICAgICAgICAgICAgICBwcmludCAncGxheWVkJyxwbGF5ZWQNCiAgICAgICAgICAgICAgICBwcmludCAncGxheWVkJyxwbGF5ZWQNCiAgICAgICAgICAgICAgICBpZiBwbGF5ZWQ6IHJldHVybg0KICAgICAgICAgICAgcmV0dXJuICAgICANCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYXNrX3BsYXlsaXN0X2l0ZW1zJykgPT0gJ3RydWUnIGFuZCBub3QgcXVldWVWaWRlbyA6DQogICAgICAgICAgICBpbXBvcnQgdXJscGFyc2UNCiAgICAgICAgICAgIG5hbWVzID0gW10NCiAgICAgICAgICAgIGlsb29wPTANCiAgICAgICAgICAgIGZvciBpIGluIG11X3BsYXlsaXN0Og0KICAgICAgICAgICAgICAgIGlmICckJGxzbmFtZT0nIGluIGk6DQogICAgICAgICAgICAgICAgICAgIGRfbmFtZT1pLnNwbGl0KCckJGxzbmFtZT0nKVsxXS5zcGxpdCgnJnJlZ2V4cycpWzBdDQogICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChkX25hbWUpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG11X3BsYXlsaXN0W2lsb29wXT1pLnNwbGl0KCckJGxzbmFtZT0nKVswXSsoJyZyZWdleHMnK2kuc3BsaXQoJyZyZWdleHMnKVsxXSBpZiAnJnJlZ2V4cycgaW4gaSBlbHNlICcnKSAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZF9uYW1lPXVybHBhcnNlLnVybHBhcnNlKGkpLm5ldGxvYw0KICAgICAgICAgICAgICAgICAgICBpZiBkX25hbWUgPT0gJyc6DQogICAgICAgICAgICAgICAgICAgICAgICBuYW1lcy5hcHBlbmQobmFtZSkNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChkX25hbWUpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlsb29wKz0xDQogICAgICAgICAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpDQogICAgICAgICAgICBpbmRleCA9IGRpYWxvZy5zZWxlY3QoJ0Nob29zZSBhIHZpZGVvIHNvdXJjZScsIG5hbWVzKQ0KICAgICAgICAgICAgaWYgaW5kZXggPj0gMDoNCiAgICAgICAgICAgICAgICBwbGF5bmFtZT1uYW1lc1tpbmRleF0NCiAgICAgICAgICAgICAgICBwcmludCAncGxheW5hbWV4eCcscGxheW5hbWUNCiAgICAgICAgICAgICAgICBpZiAiJm1vZGU9MTkiIGluIG11X3BsYXlsaXN0W2luZGV4XToNCiAgICAgICAgICAgICAgICAgICAgICAgICNwbGF5c2V0cmVzb2x2ZWQgKHVybHNvbHZlcihtdV9wbGF5bGlzdFtpbmRleF0ucmVwbGFjZSgnJm1vZGU9MTknLCcnKSksbmFtZSxpY29uaW1hZ2UsVHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShwbGF5bmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSdWaWRlbycsIGluZm9MYWJlbHM9eydUaXRsZSc6cGxheW5hbWV9KQ0KICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoIklzUGxheWFibGUiLCJ0cnVlIikNCiAgICAgICAgICAgICAgICAgICAgdXJsdG9wbGF5PXVybHNvbHZlcihtdV9wbGF5bGlzdFtpbmRleF0ucmVwbGFjZSgnJm1vZGU9MTknLCcnKS5yZXBsYWNlKCc7JywnJykpDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQYXRoKHVybHRvcGxheSkNCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHRvcGxheSxsaXopDQogICAgICAgICAgICAgICAgZWxpZiAiJGRvcmVnZXgiIGluIG11X3BsYXlsaXN0W2luZGV4XSA6DQojICAgICAgICAgICAgICAgICAgICBwcmludCBtdV9wbGF5bGlzdFtpbmRleF0NCiAgICAgICAgICAgICAgICAgICAgc2VwYXRlID0gbXVfcGxheWxpc3RbaW5kZXhdLnNwbGl0KCcmcmVnZXhzPScpDQojICAgICAgICAgICAgICAgICAgICBwcmludCBzZXBhdGUNCiAgICAgICAgICAgICAgICAgICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQoc2VwYXRlWzFdLCBzZXBhdGVbMF0pDQogICAgICAgICAgICAgICAgICAgIHVybDIgPSB1cmwucmVwbGFjZSgnOycsJycpDQogICAgICAgICAgICAgICAgICAgIGxpeiA9IHhibWNndWkuTGlzdEl0ZW0ocGxheW5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0nVmlkZW8nLCBpbmZvTGFiZWxzPXsnVGl0bGUnOnBsYXluYW1lfSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCJJc1BsYXlhYmxlIiwidHJ1ZSIpDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQYXRoKHVybDIpDQogICAgICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmwyLGxpeikNCg0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIHVybCA9IG11X3BsYXlsaXN0W2luZGV4XQ0KICAgICAgICAgICAgICAgICAgICB1cmw9dXJsLnNwbGl0KCcmcmVnZXhzPScpWzBdDQogICAgICAgICAgICAgICAgICAgIGxpeiA9IHhibWNndWkuTGlzdEl0ZW0ocGxheW5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0nVmlkZW8nLCBpbmZvTGFiZWxzPXsnVGl0bGUnOnBsYXluYW1lfSkNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCJJc1BsYXlhYmxlIiwidHJ1ZSIpDQogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQYXRoKHVybCkNCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCxsaXopDQogICAgICAgIGVsaWYgbm90IHF1ZXVlVmlkZW86DQogICAgICAgICAgICAjcGxheWxpc3QgPSB4Ym1jLlBsYXlMaXN0KDEpICMgMSBtZWFucyB2aWRlbw0KICAgICAgICAgICAgcGxheWxpc3QuY2xlYXIoKQ0KICAgICAgICAgICAgaXRlbSA9IDANCiAgICAgICAgICAgIGZvciBpIGluIG11X3BsYXlsaXN0Og0KICAgICAgICAgICAgICAgIGl0ZW0gKz0gMQ0KICAgICAgICAgICAgICAgIGluZm8gPSB4Ym1jZ3VpLkxpc3RJdGVtKCclcykgJXMnICUoc3RyKGl0ZW0pLG5hbWUpKQ0KICAgICAgICAgICAgICAgICMgRG9uJ3QgZG8gdGhpcyBhcyByZWdleCBwYXJzZWQgbWlnaHQgdGFrZSBsb25nZXINCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmICIkZG9yZWdleCIgaW4gaToNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlcGF0ZSA9IGkuc3BsaXQoJyZyZWdleHM9JykNCiMgICAgICAgICAgICAgICAgICAgICAgICBwcmludCBzZXBhdGUNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCxzZXRyZXNvbHZlZCA9IGdldFJlZ2V4UGFyc2VkKHNlcGF0ZVsxXSwgc2VwYXRlWzBdKQ0KICAgICAgICAgICAgICAgICAgICBlbGlmICImbW9kZT0xOSIgaW4gaToNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybHNvbHZlcihpLnJlcGxhY2UoJyZtb2RlPTE5JywnJykucmVwbGFjZSgnOycsJycpKSAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiB1cmw6DQogICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hZGQodXJsLCBpbmZvKQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UNCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hZGQoaSwgaW5mbykNCiAgICAgICAgICAgICAgICAgICAgcGFzcyAjeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCkNCg0KICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigncGxheWxpc3QucGxheW9mZnNldCh2aWRlbywwKScpDQogICAgICAgIGVsc2U6DQoNCiAgICAgICAgICAgICAgICBsaXN0aXRlbSA9IHhibWNndWkuTGlzdEl0ZW0obmFtZSkNCiAgICAgICAgICAgICAgICBwbGF5bGlzdC5hZGQobXVfcGxheWxpc3QsIGxpc3RpdGVtKQ0KDQoNCmRlZiBkb3dubG9hZF9maWxlKG5hbWUsIHVybCk6DQogICAgICAgIA0KICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdzYXZlX2xvY2F0aW9uJykgPT0gIiI6DQogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbignSGVyY3VsZXMnLCdFbGlqZSB1bmEgcnV0YSBwYXJhIGxhIGRlc2NhcmdhICcsMTUwMDAsIitpY29uKyIpIikNCiAgICAgICAgICAgIGFkZG9uLm9wZW5TZXR0aW5ncygpDQogICAgICAgIHBhcmFtcyA9IHsndXJsJzogdXJsLCAnZG93bmxvYWRfcGF0aCc6IGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKX0NCiAgICAgICAgZG93bmxvYWRlci5kb3dubG9hZChuYW1lLCBwYXJhbXMpDQogICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkNCiAgICAgICAgcmV0ID0gZGlhbG9nLnllc25vKCdIZXJjdWxlcycsICdRdWllcmUgYcOxYWRpciBlc3RlIGFyY2hpdm8gYSB0dSBkaXNwb3NpdGl2bz8nKQ0KICAgICAgICBpZiByZXQ6DQogICAgICAgICAgICBhZGRTb3VyY2Uob3MucGF0aC5qb2luKGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKSwgbmFtZSkpDQoNCmRlZiBfc2VhcmNoKHVybCxuYW1lKToNCiAgICMgcHJpbnQgdXJsLG5hbWUNCiAgICBwbHVnaW5zZWFyY2h1cmxzID0gWydwbHVnaW46Ly9wbHVnaW4udmlkZW8uZ2VuZXNpcy8/YWN0aW9uPXNob3dzX3NlYXJjaCcsXA0KICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZ2VuZXNpcy8/YWN0aW9uPW1vdmllc19zZWFyY2gnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnNhbHRzLz9tb2RlPXNlYXJjaCZhbXA7c2VjdGlvbj1Nb3ZpZXMnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnNhbHRzLz9tb2RlPXNlYXJjaCZhbXA7c2VjdGlvbj1UVicsXA0KICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ubXVjaG1vdmllcy5oZC8/YWN0aW9uPW1vdmllc19zZWFyY2gnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnZpb296LmNvLz9hY3Rpb249cm9vdF9zZWFyY2gnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLm9yb3JvdHYvP2FjdGlvbj1zaG93c19zZWFyY2gnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlpZnltb3ZpZXMuaGQvP2FjdGlvbj1tb3ZpZXNfc2VhcmNoJyxcDQogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5jYXJ0b29uaGR0d28vP2Rlc2NyaXB0aW9uJmFtcDtmYW5hcnQmYW1wO2ljb25pbWFnZSZhbXA7bW9kZT0zJmFtcDtuYW1lPVNlYXJjaCZhbXA7dXJsPXVybCcsXA0KICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9rb2Rpb24vc2VhcmNoL2xpc3QvJyxcDQogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5kYWlseW1vdGlvbl9jb20vP21vZGU9c2VhcmNoJmFtcDt1cmwnLFwNCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnZpbWVvL2tvZGlvbi9zZWFyY2gvbGlzdC8nXA0KICAgICAgICAgICAgIF0NCiAgICBuYW1lcyA9IFsnR2Vuc2lzIFRWJywnR2VuZXNpcyBNb3ZpZScsJ1NhbHQgbW92aWUnLCdzYWx0IFRWJywnTXVjaG1vdmllcycsJ3Zpb296JywnT1Jvcm9UVicsXA0KICAgICAgICAgICAgICdZaWZ5bW92aWVzJywnY2FydG9vbkhEJywnWW91dHViZScsJ0RhaWx5TW90aW9uJywnVmltZW8nXQ0KICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkNCiAgICBpbmRleCA9IGRpYWxvZy5zZWxlY3QoJ0Nob29zZSBhIHZpZGVvIHNvdXJjZScsIG5hbWVzKQ0KDQogICAgaWYgaW5kZXggPj0gMDoNCiAgICAgICAgdXJsID0gcGx1Z2luc2VhcmNodXJsc1tpbmRleF0NCiMgICAgICAgIHByaW50ICd1cmwnLHVybA0KICAgICAgICBwbHVnaW5xdWVyeWJ5SlNPTih1cmwpDQoNCmRlZiBhZGREaXIobmFtZSx1cmwsbW9kZSxpY29uaW1hZ2UsZmFuYXJ0LGRlc2NyaXB0aW9uLGdlbnJlLGRhdGUsY3JlZGl0cyxzaG93Y29udGV4dD1GYWxzZSxyZWdleHM9Tm9uZSxyZWdfdXJsPU5vbmUsYWxsaW5mbz17fSk6DQoNCg0KDQogICAgICAgIGlmIHJlZ2V4cyBhbmQgbGVuKHJlZ2V4cyk+MDoNCiAgICAgICAgICAgIHU9c3lzLmFyZ3ZbMF0rIj91cmw9Iit1cmxsaWIucXVvdGVfcGx1cyh1cmwpKyImbW9kZT0iK3N0cihtb2RlKSsiJm5hbWU9Iit1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSsiJmZhbmFydD0iK3VybGxpYi5xdW90ZV9wbHVzKGZhbmFydCkrIiZyZWdleHM9IityZWdleHMNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHU9c3lzLmFyZ3ZbMF0rIj91cmw9Iit1cmxsaWIucXVvdGVfcGx1cyh1cmwpKyImbW9kZT0iK3N0cihtb2RlKSsiJm5hbWU9Iit1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSsiJmZhbmFydD0iK3VybGxpYi5xdW90ZV9wbHVzKGZhbmFydCkNCiAgICAgICAgDQogICAgICAgIG9rPVRydWUNCiAgICAgICAgaWYgZGF0ZSA9PSAnJzoNCiAgICAgICAgICAgIGRhdGUgPSBOb25lDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBkZXNjcmlwdGlvbiArPSAnXG5cbkRhdGU6ICVzJyAlZGF0ZQ0KICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9IkRlZmF1bHRGb2xkZXIucG5nIiwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQ0KICAgICAgICBpZiBsZW4oYWxsaW5mbykgPDEgOg0KICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPXsgIlRpdGxlIjogbmFtZSwgIlBsb3QiOiBkZXNjcmlwdGlvbiwgIkdlbnJlIjogZ2VucmUsICJkYXRlYWRkZWQiOiBkYXRlLCAiY3JlZGl0cyI6IGNyZWRpdHMgfSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz0gYWxsaW5mbykNCiAgICAgICAgbGl6LnNldFByb3BlcnR5KCJGYW5hcnRfSW1hZ2UiLCBmYW5hcnQpDQogICAgICAgIGlmIHNob3djb250ZXh0Og0KICAgICAgICAgICAgY29udGV4dE1lbnUgPSBbXQ0KICAgICAgICAgICAgcGFyZW50YWxibG9jayA9YWRkb24uZ2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkJykNCiAgICAgICAgICAgIHBhcmVudGFsYmxvY2s9IHBhcmVudGFsYmxvY2s9PSJ0cnVlIg0KICAgICAgICAgICAgcGFyZW50YWxibG9ja2VkcGluID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWRwaW4nKQ0KIyAgICAgICAgICAgIHByaW50ICdwYXJlbnRhbGJsb2NrZWRwaW4nLHBhcmVudGFsYmxvY2tlZHBpbg0KICAgICAgICAgICAgaWYgbGVuKHBhcmVudGFsYmxvY2tlZHBpbik+MDoNCiAgICAgICAgICAgICAgICBpZiBwYXJlbnRhbGJsb2NrOg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdBY3RpdmFyIGxpY2VuY2lhIEhlcmN1bGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT01NSZuYW1lPSVzKScgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdyZXNldGVhciAgSGVyY3VsZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTU2Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIGlmIHNob3djb250ZXh0ID09ICdzb3VyY2UnOg0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgbmFtZSBpbiBzdHIoU09VUkNFUyk6DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1JlbW92ZSBmcm9tIFNvdXJjZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTgmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIGVsaWYgc2hvd2NvbnRleHQgPT0gJ2Rvd25sb2FkJzoNCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdEb3dubG9hZCcsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTkmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICAgICAgZWxpZiBzaG93Y29udGV4dCA9PSAnZmF2JzoNCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdCb3JyYXIgZGUgRmF2b3JpdG9zIEhlcmN1bGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT02Jm5hbWU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgICAgIGlmIHNob3djb250ZXh0ID09ICchIXVwZGF0ZSc6DQogICAgICAgICAgICAgICAgZmF2X3BhcmFtczIgPSAoDQogICAgICAgICAgICAgICAgICAgICclcz91cmw9JXMmbW9kZT0xNyZyZWdleHM9JXMnDQogICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHJlZ191cmwpLCByZWdleHMpDQogICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1IgZ3JlZW5dRWwgQWRkb24gZXN0YSBBY3RpdmFkbyAhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcyknICVmYXZfcGFyYW1zMikpDQogICAgICAgICAgICBpZiBub3QgbmFtZSBpbiBGQVY6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnQWdyZWdhciBhIEZhdm9yaXRvcyBkZSBIZXJjdWxlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NSZuYW1lPSVzJnVybD0lcyZpY29uaW1hZ2U9JXMmZmFuYXJ0PSVzJmZhdl9tb2RlPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMoaWNvbmltYWdlKSwgdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KSwgbW9kZSkpKQ0KICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnUpDQogICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9dSxsaXN0aXRlbT1saXosaXNGb2xkZXI9VHJ1ZSkNCiAgICAgICAgcmV0dXJuIG9rDQpkZWYgeXRkbF9kb3dubG9hZCh1cmwsdGl0bGUsbWVkaWFfdHlwZT0ndmlkZW8nKToNCiAgICAjIHBsYXkgaW4geGJtYyB3aGlsZSBwbGF5aW5nIGdvIGJhY2sgdG8gY29udGV4dE1lbnUoYykgdG8gIiEhRG93bmxvYWQhISINCiAgICAjIFRyaWFsIHlhc2NlZW46IHNlcGVyYXRlIHxVc2VyLUFnZW50PQ0KICAgIGltcG9ydCB5b3V0dWJlZGwNCiAgICANCiAgICBpZiBub3QgdXJsID09ICcnOg0KICAgICAgICBpZiBtZWRpYV90eXBlPT0gJ2F1ZGlvJzoNCiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQodXJsLGRvd25sb2FkPVRydWUsYXVkaW89VHJ1ZSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQodXJsLGRvd25sb2FkPVRydWUpDQogICAgZWxpZiB4Ym1jLlBsYXllcigpLmlzUGxheWluZygpID09IFRydWUgOg0KICAgICAgICBpbXBvcnQgWURTdHJlYW1FeHRyYWN0b3INCiAgICAgICAgaWYgWURTdHJlYW1FeHRyYWN0b3IuaXNEb3dubG9hZGluZygpID09IFRydWU6DQoNCiAgICAgICAgICAgIFlEU3RyZWFtRXh0cmFjdG9yLm1hbmFnZURvd25sb2FkcygpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICB4Ym1jX3VybCA9IHhibWMuUGxheWVyKCkuZ2V0UGxheWluZ0ZpbGUoKQ0KDQogICAgICAgICAgICB4Ym1jX3VybCA9IHhibWNfdXJsLnNwbGl0KCd8VXNlci1BZ2VudD0nKVswXQ0KICAgICAgICAgICAgaW5mbyA9IHsndXJsJzp4Ym1jX3VybCwndGl0bGUnOnRpdGxlLCdtZWRpYV90eXBlJzptZWRpYV90eXBlfQ0KICAgICAgICAgICAgeW91dHViZWRsLnNpbmdsZV9ZRCgnJyxkb3dubG9hZD1UcnVlLGRsX2luZm89aW5mbykNCiAgICBlbHNlOg0KICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihQYXJhIGRlc2NhcmdhciwgUHJpbWVybyBkYWxlIGEgcmVwcm9kdWNpciBbQ09MT1IgeWVsbG93XW1pZW50cmFzIHJlcHJvZHVjZSBsYSBkZXNjYXJnYS4gTm8gY29uc2VydmVzIGxvcyBhcmNoaXZvcyBlbiB0dSBvcmRlbmFkb3IgbWFzIGRlIDI0IEhvcmFzIG8gZXN0YXJhcyBpbmZyaW5naWVuZG8gbGEgbGV5IEVzcGHDsW9sYS5bL0NPTE9SXSAsMTAwMDApIikNCg0KIyMgTHVuYXRpeHogUHNldWRvVFYgZmVhdHVyZQ0KZGVmIGFzY2lpKHN0cmluZyk6DQogICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIGJhc2VzdHJpbmcpOg0KICAgICAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgdW5pY29kZSk6DQogICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5lbmNvZGUoJ2FzY2lpJywgJ2lnbm9yZScpDQogICAgcmV0dXJuIHN0cmluZw0KZGVmIHVuaShzdHJpbmcsIGVuY29kaW5nID0gJ3V0Zi04Jyk6DQogICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIGJhc2VzdHJpbmcpOg0KICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShzdHJpbmcsIHVuaWNvZGUpOg0KICAgICAgICAgICAgc3RyaW5nID0gdW5pY29kZShzdHJpbmcsIGVuY29kaW5nLCAnaWdub3JlJykNCiAgICByZXR1cm4gc3RyaW5nDQpkZWYgcmVtb3ZlTm9uQXNjaWkocyk6IHJldHVybiAiIi5qb2luKGZpbHRlcihsYW1iZGEgeDogb3JkKHgpPDEyOCwgcykpDQoNCmRlZiBzZW5kSlNPTiggY29tbWFuZCk6DQogICAgZGF0YSA9ICcnDQogICAgdHJ5Og0KICAgICAgICBkYXRhID0geGJtYy5leGVjdXRlSlNPTlJQQyh1bmkoY29tbWFuZCkpDQogICAgZXhjZXB0IFVuaWNvZGVFbmNvZGVFcnJvcjoNCiAgICAgICAgZGF0YSA9IHhibWMuZXhlY3V0ZUpTT05SUEMoYXNjaWkoY29tbWFuZCkpDQoNCiAgICByZXR1cm4gdW5pKGRhdGEpDQoNCmRlZiBwbHVnaW5xdWVyeWJ5SlNPTih1cmwsZ2l2ZV9tZV9yZXN1bHQ9Tm9uZSxwbGF5bGlzdD1GYWxzZSk6DQogICAgaWYgJ2F1ZGlvJyBpbiB1cmw6DQogICAgICAgIGpzb25fcXVlcnkgPSB1bmkoJ3sianNvbnJwYyI6IjIuMCIsIm1ldGhvZCI6IkZpbGVzLkdldERpcmVjdG9yeSIsInBhcmFtcyI6IHsiZGlyZWN0b3J5IjoiJXMiLCJtZWRpYSI6InZpZGVvIiwgInByb3BlcnRpZXMiOiBbInRpdGxlIiwgImFsYnVtIiwgImFydGlzdCIsICJkdXJhdGlvbiIsInRodW1ibmFpbCIsICJ5ZWFyIl19LCAiaWQiOiAxfScpICV1cmwNCiAgICBlbHNlOg0KICAgICAgICBqc29uX3F1ZXJ5ID0gdW5pKCd7Impzb25ycGMiOiIyLjAiLCJtZXRob2QiOiJGaWxlcy5HZXREaXJlY3RvcnkiLCJwYXJhbXMiOnsiZGlyZWN0b3J5IjoiJXMiLCJtZWRpYSI6InZpZGVvIiwicHJvcGVydGllcyI6WyAicGxvdCIsInBsYXljb3VudCIsImRpcmVjdG9yIiwgImdlbnJlIiwidm90ZXMiLCJkdXJhdGlvbiIsInRyYWlsZXIiLCJwcmVtaWVyZWQiLCJ0aHVtYm5haWwiLCJ0aXRsZSIsInllYXIiLCJkYXRlYWRkZWQiLCJmYW5hcnQiLCJyYXRpbmciLCJzZWFzb24iLCJlcGlzb2RlIiwic3R1ZGlvIiwibXBhYSJdfSwiaWQiOjF9JykgJXVybA0KICAgIGpzb25fZm9sZGVyX2RldGFpbCA9IGpzb24ubG9hZHMoc2VuZEpTT04oanNvbl9xdWVyeSkpDQogICAgI3ByaW50IGpzb25fZm9sZGVyX2RldGFpbA0KICAgIGlmIGdpdmVfbWVfcmVzdWx0Og0KICAgICAgICByZXR1cm4ganNvbl9mb2xkZXJfZGV0YWlsDQogICAgaWYganNvbl9mb2xkZXJfZGV0YWlsLmhhc19rZXkoJ2Vycm9yJyk6DQogICAgICAgIHJldHVybg0KICAgIGVsc2U6DQoNCiAgICAgICAgZm9yIGkgaW4ganNvbl9mb2xkZXJfZGV0YWlsWydyZXN1bHQnXVsnZmlsZXMnXSA6DQogICAgICAgICAgICBtZXRhID17fQ0KICAgICAgICAgICAgdXJsID0gaVsnZmlsZSddDQogICAgICAgICAgICBuYW1lID0gcmVtb3ZlTm9uQXNjaWkoaVsnbGFiZWwnXSkNCiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlbW92ZU5vbkFzY2lpKGlbJ3RodW1ibmFpbCddKQ0KICAgICAgICAgICAgZmFuYXJ0ID0gcmVtb3ZlTm9uQXNjaWkoaVsnZmFuYXJ0J10pDQogICAgICAgICAgICBtZXRhID0gZGljdCgoayx2KSBmb3IgaywgdiBpbiBpLml0ZXJpdGVtcygpIGlmIG5vdCB2ID09ICcwJyBvciBub3QgdiA9PSAtMSBvciB2ID09ICcnKQ0KICAgICAgICAgICAgbWV0YS5wb3AoImZpbGUiLCBOb25lKQ0KICAgICAgICAgICAgaWYgaVsnZmlsZXR5cGUnXSA9PSAnZmlsZSc6DQogICAgICAgICAgICAgICAgaWYgcGxheWxpc3Q6DQogICAgICAgICAgICAgICAgICAgIHBsYXlfcGxheWxpc3QobmFtZSx1cmwscXVldWVWaWRlbz0nMScpDQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgYWRkTGluayh1cmwsbmFtZSx0aHVtYm5haWwsZmFuYXJ0LCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWw9bGVuKGpzb25fZm9sZGVyX2RldGFpbFsncmVzdWx0J11bJ2ZpbGVzJ10pLGFsbGluZm89bWV0YSkNCiAgICAgICAgICAgICAgICAgICAgI3hibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MDApIikNCiAgICAgICAgICAgICAgICAgICAgaWYgaVsndHlwZSddIGFuZCBpWyd0eXBlJ10gPT0gJ3R2c2hvdycgOg0KICAgICAgICAgICAgICAgICAgICAgICAgeGJtY3BsdWdpbi5zZXRDb250ZW50KGludChzeXMuYXJndlsxXSksICd0dnNob3dzJykNCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpWydlcGlzb2RlJ10gPiAwIDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHhibWNwbHVnaW4uc2V0Q29udGVudChpbnQoc3lzLmFyZ3ZbMV0pLCAnZXBpc29kZXMnKQ0KDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCw1Myx0aHVtYm5haWwsZmFuYXJ0LCcnLCcnLCcnLCcnLGFsbGluZm89bWV0YSkNCiAgICAgICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQpkZWYgYWRkTGluayh1cmwsbmFtZSxpY29uaW1hZ2UsZmFuYXJ0LGRlc2NyaXB0aW9uLGdlbnJlLGRhdGUsc2hvd2NvbnRleHQscGxheWxpc3QscmVnZXhzLHRvdGFsLHNldENvb2tpZT0iIixhbGxpbmZvPXt9KToNCiAgICAgICAgI3ByaW50ICd1cmwsbmFtZScsdXJsLG5hbWUsaWNvbmltYWdlDQogICAgICAgIGNvbnRleHRNZW51ID1bXQ0KICAgICAgICBwYXJlbnRhbGJsb2NrID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWQnKQ0KICAgICAgICBwYXJlbnRhbGJsb2NrPSBwYXJlbnRhbGJsb2NrPT0idHJ1ZSINCiAgICAgICAgcGFyZW50YWxibG9ja2VkcGluID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWRwaW4nKQ0KIyAgICAgICAgcHJpbnQgJ3BhcmVudGFsYmxvY2tlZHBpbicscGFyZW50YWxibG9ja2VkcGluDQogICAgICAgIGlmIGxlbihwYXJlbnRhbGJsb2NrZWRwaW4pPjA6DQogICAgICAgICAgICBpZiBwYXJlbnRhbGJsb2NrOg0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0FjdGl2YXIgTGljZW5jaWEgSGVyY3VsZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTU1Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdEZXNhY3RpdmFyIEhlcmN1bGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT01NiZuYW1lPSVzKScgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLmVuY29kZSgndXRmLTgnKQ0KICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgb2sgPSBUcnVlDQogICAgICAgIGlzRm9sZGVyPUZhbHNlDQogICAgICAgIGlmIHJlZ2V4czoNCiAgICAgICAgICAgIG1vZGUgPSAnMTcnDQogICAgICAgICAgICBpZiAnbGlzdHJlcGVhdCcgaW4gcmVnZXhzOg0KICAgICAgICAgICAgICAgIGlzRm9sZGVyPVRydWUNCiMgICAgICAgICAgICAgICAgcHJpbnQgJ3NldHRpbmcgYXMgZm9sZGVyIGluIGxpbmsnDQogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdRGVzY2FyZ2FyIG1pZW50cmFzIHJlcHJvZHVjZSAhIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICBlbGlmICAoYW55KHggaW4gdXJsIGZvciB4IGluIHJlc29sdmVfdXJsKSBhbmQgIHVybC5zdGFydHN3aXRoKCdodHRwJykpIG9yIHVybC5lbmRzd2l0aCgnJm1vZGU9MTknKToNCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJm1vZGU9MTknLCcnKQ0KICAgICAgICAgICAgbW9kZSA9ICcxOScNCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV1EZXNjYXJnYXIgbWllbnRyYXMgcmVwcm9kdWNlICEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpDQogICAgICAgIGVsaWYgdXJsLmVuZHN3aXRoKCcmbW9kZT0xOCcpOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCcmbW9kZT0xOCcsJycpDQogICAgICAgICAgICBtb2RlID0gJzE4Jw0KICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQhIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjMmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnZGxhdWRpb29ubHknKSA9PSAndHJ1ZSc6DQogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnISFEb3dubG9hZCBbQ09MT1Igc2VhYmx1ZV1BdWRpbyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yNCZuYW1lPSVzKScNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICBlbGlmIHVybC5zdGFydHN3aXRoKCdtYWduZXQ6P3h0PScpOg0KICAgICAgICAgICAgaWYgJyYnIGluIHVybCBhbmQgbm90ICcmYW1wOycgaW4gdXJsIDoNCiAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgnJicsJyZhbXA7JykNCiAgICAgICAgICAgIHVybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucXVhc2FyL3BsYXk/dXJpPScgKyB1cmwNCiAgICAgICAgICAgIG1vZGUgPSAnMTInDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBtb2RlID0gJzEyJw0KICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXURlc2NhcmdhciBtaWVudHJhcyByZXByb2R1Y2UgISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIxJm5hbWU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkNCiAgICAgICAgaWYgJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3ZpZGVvX2lkPScgaW4gdXJsOg0KICAgICAgICAgICAgICB5dF9hdWRpb191cmwgPSB1cmwucmVwbGFjZSgncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/dmlkZW9faWQ9JywnaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj0nKQ0KICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCchIURvd25sb2FkIFtDT0xPUiBibHVlXUF1ZGlvISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTI0Jm5hbWU9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh5dF9hdWRpb191cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQ0KICAgICAgICB1PXN5cy5hcmd2WzBdKyI/Ig0KICAgICAgICBwbGF5X2xpc3QgPSBGYWxzZQ0KICAgICAgICBpZiBwbGF5bGlzdDoNCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSIgYW5kICckJExTUGxheU9ubHlPbmUkJCcgbm90IGluIHBsYXlsaXN0WzBdIDoNCiAgICAgICAgICAgICAgICB1ICs9ICJ1cmw9Iit1cmxsaWIucXVvdGVfcGx1cyh1cmwpKyImbW9kZT0iK21vZGUNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgdSArPSAibW9kZT0xMyZuYW1lPSVzJnBsYXlsaXN0PSVzIiAlKHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKSkNCiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZSArICdbQ09MT1IgbWFnZW50YV0gKCcgKyBzdHIobGVuKHBsYXlsaXN0KSkgKyAnIGl0ZW1zIClbL0NPTE9SXScNCiAgICAgICAgICAgICAgICBwbGF5X2xpc3QgPSBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICB1ICs9ICJ1cmw9Iit1cmxsaWIucXVvdGVfcGx1cyh1cmwpKyImbW9kZT0iK21vZGUNCiAgICAgICAgaWYgcmVnZXhzOg0KICAgICAgICAgICAgdSArPSAiJnJlZ2V4cz0iK3JlZ2V4cw0KICAgICAgICBpZiBub3Qgc2V0Q29va2llID09ICcnOg0KICAgICAgICAgICAgdSArPSAiJnNldENvb2tpZT0iK3VybGxpYi5xdW90ZV9wbHVzKHNldENvb2tpZSkNCiAgICAgICAgaWYgaWNvbmltYWdlIGFuZCAgbm90IGljb25pbWFnZSA9PSAnJzoNCiAgICAgICAgICAgIHUgKz0gIiZpY29uaW1hZ2U9Iit1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpDQogICAgICAgICAgICANCiAgICAgICAgaWYgZGF0ZSA9PSAnJzoNCiAgICAgICAgICAgIGRhdGUgPSBOb25lDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBkZXNjcmlwdGlvbiArPSAnXG5cbkRhdGU6ICVzJyAlZGF0ZQ0KICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9IkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpDQogICAgICAgICNpZiBpc0ZvbGRlcjoNCiAgICAgICAgaWYgYWxsaW5mbz09Tm9uZSBvciBsZW4oYWxsaW5mbykgPDE6DQogICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9eyAiVGl0bGUiOiBuYW1lLCAiUGxvdCI6IGRlc2NyaXB0aW9uLCAiR2VucmUiOiBnZW5yZSwgImRhdGVhZGRlZCI6IGRhdGUgfSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz1hbGxpbmZvKQ0KICAgICAgICBsaXouc2V0UHJvcGVydHkoIkZhbmFydF9JbWFnZSIsIGZhbmFydCkNCiAgICAgICAgDQogICAgICAgIGlmIChub3QgcGxheV9saXN0KSBhbmQgbm90IGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKSBhbmQgbm90ICckUExBWUVSUFJPWFkkPScgaW4gdXJsOiMgIChub3QgdXJsLnN0YXJ0c3dpdGgoJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXInKSk6DQogICAgICAgICAgICBpZiByZWdleHM6DQogICAgICAgICAgICAgICAgI3ByaW50IHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKQ0KICAgICAgICAgICAgICAgIGlmICckcHlGdW5jdGlvbjpwbGF5bWVkaWEoJyBub3QgaW4gdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpIGFuZCAnbm90cGxheWFibGUnIG5vdCBpbiB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cykgYW5kICdsaXN0cmVwZWF0JyBub3QgaW4gIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSA6DQogICAgICAgICAgICAgICAgICAgICNwcmludCAnc2V0dGluZyBpc3BsYXlhYmxlJyx1cmwsIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSx1cmwNCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCdJc1BsYXlhYmxlJywgJ3RydWUnKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoJ0lzUGxheWFibGUnLCAndHJ1ZScpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBhZGRvbl9sb2coICdOT1Qgc2V0dGluZyBpc3BsYXlhYmxlJyt1cmwpDQogICAgICAgIGlmIHNob3djb250ZXh0Og0KICAgICAgICAgICAgI2NvbnRleHRNZW51ID0gW10NCiAgICAgICAgICAgIGlmIHNob3djb250ZXh0ID09ICdmYXYnOg0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgNCiAgICAgICAgICAgICAgICAgICAgKCdCb3JyYWRvIGRlIEZhdm9ydGl0b3MgZGUgSGVyY3VsZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTYmbmFtZT0lcyknDQogICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpDQogICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICBlbGlmIG5vdCBuYW1lIGluIEZBVjoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgPSAoDQogICAgICAgICAgICAgICAgICAgICAgICAnJXM/bW9kZT01Jm5hbWU9JXMmdXJsPSVzJmljb25pbWFnZT0lcyZmYW5hcnQ9JXMmZmF2X21vZGU9MCcNCiAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpLCB1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgZmF2X3BhcmFtcyA9ICgNCiAgICAgICAgICAgICAgICAgICAgICAgICclcz9tb2RlPTUmbmFtZT0lcyZ1cmw9JXMmaWNvbmltYWdlPSVzJmZhbmFydD0lcyZmYXZfbW9kZT0wJw0KICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZS5lbmNvZGUoInV0Zi04IikpLCB1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQuZW5jb2RlKCJ1dGYtOCIpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICBpZiBwbGF5bGlzdDoNCiAgICAgICAgICAgICAgICAgICAgZmF2X3BhcmFtcyArPSAncGxheWxpc3Q9Jyt1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKQ0KICAgICAgICAgICAgICAgIGlmIHJlZ2V4czoNCiAgICAgICAgICAgICAgICAgICAgZmF2X3BhcmFtcyArPSAiJnJlZ2V4cz0iK3JlZ2V4cw0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0FncmVnYXIgYSBmYXZvcml0b3MgZGUgSGVyY3VsZXMnLCdYQk1DLlJ1blBsdWdpbiglcyknICVmYXZfcGFyYW1zKSkNCiAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51KQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBub3QgcGxheWxpc3QgaXMgTm9uZToNCiAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKSA9PSAiZmFsc2UiOg0KICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdF9uYW1lID0gbmFtZS5zcGxpdCgnKSAnKVsxXQ0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0TWVudV8gPSBbDQogICAgICAgICAgICAgICAgICAgICAgICAoJ1BsYXkgJytwbGF5bGlzdF9uYW1lKycgUGxheUxpc3QnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTEzJm5hbWU9JXMmcGxheWxpc3Q9JXMpJw0KICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHBsYXlsaXN0X25hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgICAgICAgICBsaXouYWRkQ29udGV4dE1lbnVJdGVtcyhjb250ZXh0TWVudV8pDQogICAgICAgIGV4Y2VwdDogcGFzcw0KICAgICAgICAjcHJpbnQgJ2FkZGluZycsbmFtZQ0KICAgICAgICBvaz14Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksdXJsPXUsbGlzdGl0ZW09bGl6LHRvdGFsSXRlbXM9dG90YWwsaXNGb2xkZXI9aXNGb2xkZXIpDQoNCiAgICAgICAgI3ByaW50ICdhZGRlZCcsbmFtZQ0KICAgICAgICByZXR1cm4gb2sNCg0KICAgICAgICANCmRlZiBwbGF5c2V0cmVzb2x2ZWQodXJsLG5hbWUsaWNvbmltYWdlLHNldHJlc29sdmVkPVRydWUscmVnPU5vbmUpOg0KICAgIHByaW50ICdwbGF5c2V0cmVzb2x2ZWQnLHVybCxzZXRyZXNvbHZlZA0KICAgIGlmIHVybD09Tm9uZTogDQogICAgICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCiAgICAgICAgcmV0dXJuDQogICAgaWYgc2V0cmVzb2x2ZWQ6DQogICAgICAgIHNldHJlcz1UcnVlDQogICAgICAgIGlmICckJExTRGlyZWN0JCQnIGluIHVybDoNCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJCRMU0RpcmVjdCQkJywnJykNCiAgICAgICAgICAgIHNldHJlcz1GYWxzZQ0KICAgICAgICBpZiByZWcgYW5kICdub3RwbGF5YWJsZScgaW4gcmVnOg0KICAgICAgICAgICAgc2V0cmVzPUZhbHNlDQoNCiAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9aWNvbmltYWdlLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpDQogICAgICAgIGxpei5zZXRJbmZvKHR5cGU9J1ZpZGVvJywgaW5mb0xhYmVscz17J1RpdGxlJzpuYW1lfSkNCiAgICAgICAgbGl6LnNldFByb3BlcnR5KCJJc1BsYXlhYmxlIiwidHJ1ZSIpDQogICAgICAgIGxpei5zZXRQYXRoKHVybCkNCiAgICAgICAgaWYgbm90IHNldHJlczoNCiAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmwpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICB4Ym1jcGx1Z2luLnNldFJlc29sdmVkVXJsKGludChzeXMuYXJndlsxXSksIFRydWUsIGxpeikNCiAgICAgICAgICAgDQogICAgZWxzZToNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignWEJNQy5SdW5QbHVnaW4oJyt1cmwrJyknKQ0KDQoNCiMjIFRoYW5rcyB0byBkYXNjaGFja2EsIGFuIGVwZyBzY3JhcGVyIGZvciBodHRwOi8vaS50ZWxlYm95LmNoL3Byb2dyYW1tL3N0YXRpb25fc2VsZWN0LnBocA0KIyMgIGh0dHA6Ly9mb3J1bS54Ym1jLm9yZy9wb3N0LnBocD9wPTkzNjIyOCZwb3N0Y291bnQ9MTA3Ng0KZGVmIGdldGVwZyhsaW5rKToNCiAgICAgICAgdXJsPXVybGxpYi51cmxvcGVuKGxpbmspDQogICAgICAgIHNvdXJjZT11cmwucmVhZCgpDQogICAgICAgIHVybC5jbG9zZSgpDQogICAgICAgIHNvdXJjZTIgPSBzb3VyY2Uuc3BsaXQoIkpldHp0IikNCiAgICAgICAgc291cmNlMyA9IHNvdXJjZTJbMV0uc3BsaXQoJ3Byb2dyYW1tL2RldGFpbC5waHA/Y29uc3RfaWQ9JykNCiAgICAgICAgc291cmNldWhyemVpdCA9IHNvdXJjZTNbMV0uc3BsaXQoJzxiciAvPjxhIGhyZWY9Ii8nKQ0KICAgICAgICBub3d0aW1lID0gc291cmNldWhyemVpdFswXVs0MDpsZW4oc291cmNldWhyemVpdFswXSldDQogICAgICAgIHNvdXJjZXRpdGxlID0gc291cmNlM1syXS5zcGxpdCgiPC9hPjwvcD48L2Rpdj4iKQ0KICAgICAgICBub3d0aXRsZSA9IHNvdXJjZXRpdGxlWzBdWzE3Omxlbihzb3VyY2V0aXRsZVswXSldDQogICAgICAgIG5vd3RpdGxlID0gbm93dGl0bGUuZW5jb2RlKCd1dGYtOCcpDQogICAgICAgIHJldHVybiAiICAtICIrbm93dGl0bGUrIiAtICIrbm93dGltZQ0KDQoNCmRlZiBnZXRfZXBnKHVybCwgcmVnZXgpOg0KICAgICAgICBkYXRhID0gbWFrZVJlcXVlc3QodXJsKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpdGVtID0gcmUuZmluZGFsbChyZWdleCwgZGF0YSlbMF0NCiAgICAgICAgICAgIHJldHVybiBpdGVtDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIGFkZG9uX2xvZygncmVnZXggZmFpbGVkJykNCiAgICAgICAgICAgIGFkZG9uX2xvZyhyZWdleCkNCiAgICAgICAgICAgIHJldHVybg0KDQogICAgDQojI25vdCBhIGdlbmVyaWMgaW1wbGVtZW5hdGlvbiBhcyBpdCBuZWVkcyB0byBjb252ZXJ0ICAgICAgICAgICAgDQpkZWYgZDJ4KGQsIHJvb3Q9InJvb3QiLG5lc3RlZD0wKToNCg0KICAgIG9wID0gbGFtYmRhIHRhZzogJzwnICsgdGFnICsgJz4nDQogICAgY2wgPSBsYW1iZGEgdGFnOiAnPC8nICsgdGFnICsgJz5cbicNCg0KICAgIG1sID0gbGFtYmRhIHYseG1sOiB4bWwgKyBvcChrZXkpICsgc3RyKHYpICsgY2woa2V5KQ0KICAgIHhtbCA9IG9wKHJvb3QpICsgJ1xuJyBpZiByb290IGVsc2UgIiINCg0KICAgIGZvciBrZXksdmwgaW4gZC5pdGVyaXRlbXMoKToNCiAgICAgICAgdnR5cGUgPSB0eXBlKHZsKQ0KICAgICAgICBpZiBuZXN0ZWQ9PTA6IGtleT0ncmVnZXgnICNlbmZvcmNpbmcgYWxsIHRvcCBsZXZlbCB0YWdzIHRvIGJlIG5hbWVkIGFzIHJlZ2V4DQogICAgICAgIGlmIHZ0eXBlIGlzIGxpc3Q6IA0KICAgICAgICAgICAgZm9yIHYgaW4gdmw6DQogICAgICAgICAgICAgICAgdj1lc2NhcGUodikNCiAgICAgICAgICAgICAgICB4bWwgPSBtbCh2LHhtbCkgICAgICAgICANCiAgICAgICAgDQogICAgICAgIGlmIHZ0eXBlIGlzIGRpY3Q6IA0KICAgICAgICAgICAgeG1sID0gbWwoJ1xuJyArIGQyeCh2bCxOb25lLG5lc3RlZCsxKSx4bWwpICAgICAgICAgDQogICAgICAgIGlmIHZ0eXBlIGlzIG5vdCBsaXN0IGFuZCB2dHlwZSBpcyBub3QgZGljdDogDQogICAgICAgICAgICBpZiBub3QgdmwgaXMgTm9uZTogdmw9ZXNjYXBlKHZsKQ0KICAgICAgICAgICAgI3ByaW50IHJlcHIodmwpDQogICAgICAgICAgICBpZiB2bCBpcyBOb25lOg0KICAgICAgICAgICAgICAgIHhtbCA9IG1sKHZsLHhtbCkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgI3htbCA9IG1sKGVzY2FwZSh2bC5lbmNvZGUoInV0Zi04IikpLHhtbCkNCiAgICAgICAgICAgICAgICB4bWwgPSBtbCh2bC5lbmNvZGUoInV0Zi04IikseG1sKQ0KDQogICAgeG1sICs9IGNsKHJvb3QpIGlmIHJvb3QgZWxzZSAiIg0KDQogICAgcmV0dXJuIHhtbA0KeGJtY3BsdWdpbi5zZXRDb250ZW50KGludChzeXMuYXJndlsxXSksICdtb3ZpZXMnKQ0KDQoNCg0KdHJ5Og0KICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX1VOU09SVEVEKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9MQUJFTCkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfREFURSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfR0VOUkUpDQpleGNlcHQ6DQogICAgcGFzcw0KDQpwYXJhbXM9Z2V0X3BhcmFtcygpDQoNCnVybD1Ob25lDQpuYW1lPU5vbmUNCm1vZGU9Tm9uZQ0KcGxheWxpc3Q9Tm9uZQ0KaWNvbmltYWdlPU5vbmUNCmZhbmFydD1GQU5BUlQNCnBsYXlsaXN0PU5vbmUNCmZhdl9tb2RlPU5vbmUNCnJlZ2V4cz1Ob25lDQoNCnRyeToNCiAgICB1cmw9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbInVybCJdKS5kZWNvZGUoJ3V0Zi04JykNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgbmFtZT11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sibmFtZSJdKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICBpY29uaW1hZ2U9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbImljb25pbWFnZSJdKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICBmYW5hcnQ9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbImZhbmFydCJdKQ0KZXhjZXB0Og0KICAgIHBhc3MNCnRyeToNCiAgICBtb2RlPWludChwYXJhbXNbIm1vZGUiXSkNCmV4Y2VwdDoNCiAgICBwYXNzDQp0cnk6DQogICAgcGxheWxpc3Q9ZXZhbCh1cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sicGxheWxpc3QiXSkucmVwbGFjZSgnfHwnLCcsJykpDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIGZhdl9tb2RlPWludChwYXJhbXNbImZhdl9tb2RlIl0pDQpleGNlcHQ6DQogICAgcGFzcw0KdHJ5Og0KICAgIHJlZ2V4cz1wYXJhbXNbInJlZ2V4cyJdDQpleGNlcHQ6DQogICAgcGFzcw0KcGxheWl0ZW09JycNCnRyeToNCiAgICBwbGF5aXRlbT11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sicGxheWl0ZW0iXSkNCmV4Y2VwdDoNCiAgICBwYXNzDQogICAgDQphZGRvbl9sb2coIk1vZGU6ICIrc3RyKG1vZGUpKQ0KDQoNCmlmIG5vdCB1cmwgaXMgTm9uZToNCiAgICBhZGRvbl9sb2coIlVSTDogIitzdHIodXJsLmVuY29kZSgndXRmLTgnKSkpDQphZGRvbl9sb2coIk5hbWU6ICIrc3RyKG5hbWUpKQ0KDQppZiBub3QgcGxheWl0ZW0gPT0nJzoNCiAgICBzPWdldFNvdXAoJycsZGF0YT1wbGF5aXRlbSkNCiAgICBuYW1lLHVybCxyZWdleHM9Z2V0SXRlbXMocyxOb25lLGRvbnRMaW5rPVRydWUpDQogICAgbW9kZT0xMTcgDQoNCgkNCmlmIG1vZGU9PU5vbmU6CQ0KDQogICAgaW1wb3J0IHhibWMNCiAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihIZXJjdWxlcywgVmVyc2lvbjogMS4zLjUgLDUwMDAsIitpY29uKyIpIikNCg0KICAgIGFkZG9uX2xvZygiZ2V0U291cmNlcyIpDQogICAgZ2V0U291cmNlcygpDQoNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQoJDQogICAgX19hZGRvbl9fID0geGJtY2FkZG9uLkFkZG9uKCkNCiAgICBfX2FkZG9ubmFtZV9fID0gX19hZGRvbl9fLmdldEFkZG9uSW5mbygnbmFtZScpDQoNCiANCiAgICBsaW5lMSA9ICJHcnVwbyBOZXRhaTogTm8gZmF2b3JlY2UgbGEgcGlyYXRlcmlhLiBBdGVuY2lvbiEhIE5vdGEgaW1wb3J0YW50ZSwgZXN0ZSBhZGRvbiBlcyBwcml2YWRvLiBIZXJjdWxlcyBubyBjb250aWVuZSBhcmNoaXZvcyBlbiBzdSBpbnRlcmlvci4gTG9zIGNhcHR1cmEgZGUgaW50ZXJuZXQuIg0KICAgIGxpbmUyID0gIlV0aWxpemEgZXN0ZSBhZGRvbiBjb24gcmVzcG9uc2FiaWxpZGFkLiBUb2RvIGVsIGNvbnRlbmlkbyBkZSBlc3RlIGFkZG9uIGVzIGdyYXR1aXRvIHkgcHJvY2VkZSBkZSBzZXJ2aWRvcmVzIHB1YmxpY29zIGZ1ZXJhIGRlIGVzcGHDsWEuIg0KICAgIGxpbmUzID0gIkNsYXZlIHBhcmEgem9uYSBwcml2YWRhIGVuIG51ZXN0cm8gdGVsZWdyYW0sIG8gZ2VuZXJlbGEgZW4gbnVlc3RyYSB3ZWIgaHR0cDovL2dydXBvbmV0YWkuY29tIg0KICAgIHhibWNndWkuRGlhbG9nKCkub2soX19hZGRvbm5hbWVfXywgbGluZTEsIGxpbmUyLCBsaW5lMykNCgkNCg0KCQ0KZWxpZiBtb2RlPT0xOg0KICAgIGFkZG9uX2xvZygiZ2V0RGF0YSIpDQoJDQoNCiAgICANCiAgICBkYXRhPU5vbmUNCiAgICANCiAgICBpZiByZWdleHMgYW5kIGxlbihyZWdleHMpPjA6DQogICAgICAgIGRhdGEsc2V0cmVzb2x2ZWQ9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwpDQogICAgICAgICNwcmludCBkYXRhDQogICAgICAgICN1cmw9JycNCiAgICAgICAgaWYgZGF0YS5zdGFydHN3aXRoKCdodHRwJykgb3IgZGF0YS5zdGFydHN3aXRoKCdzbWInKSBvciBkYXRhLnN0YXJ0c3dpdGgoJ25mcycpIG9yIGRhdGEuc3RhcnRzd2l0aCgnLycpOg0KICAgICAgICAgICAgdXJsPWRhdGENCiAgICAgICAgICAgIGRhdGE9Tm9uZQ0KICAgICAgICAjY3JlYXRlIHhtbCBoZXJlDQogICAgDQogICAgZ2V0RGF0YSh1cmwsZmFuYXJ0LGRhdGEpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQoNCg0KZWxpZiBtb2RlPT0yOg0KICAgIGFkZG9uX2xvZygiZ2V0Q2hhbm5lbEl0ZW1zIikNCiAgICBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT0zOg0KICAgIGFkZG9uX2xvZygiZ2V0U3ViQ2hhbm5lbEl0ZW1zIikNCiAgICBnZXRTdWJDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT00Og0KICAgIGFkZG9uX2xvZygiZ2V0RmF2b3JpdGVzIikNCiAgICBnZXRGYXZvcml0ZXMoKQ0KICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCg0KZWxpZiBtb2RlPT01Og0KICAgIGFkZG9uX2xvZygiYWRkRmF2b3JpdGUiKQ0KICAgIHRyeToNCiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJ1xcICcpWzFdDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgdHJ5Og0KICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnICAtICcpWzBdDQogICAgZXhjZXB0Og0KICAgICAgICBwYXNzDQogICAgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxmYXZfbW9kZSkNCg0KZWxpZiBtb2RlPT02Og0KICAgIGFkZG9uX2xvZygicm1GYXZvcml0ZSIpDQogICAgdHJ5Og0KICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnXFwgJylbMV0NCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICB0cnk6DQogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCcgIC0gJylbMF0NCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICBybUZhdm9yaXRlKG5hbWUpDQoNCmVsaWYgbW9kZT09NzoNCiAgICANCiAgICBEdXRjaCgpDQoJDQplbGlmIG1vZGU9PTg6DQogICAgYWRkb25fbG9nKCJybVNvdXJjZSIpDQogICAgcm1Tb3VyY2UobmFtZSkNCg0KZWxpZiBtb2RlPT05Og0KICAgIGFkZG9uX2xvZygiZG93bmxvYWRfZmlsZSIpDQogICAgZG93bmxvYWRfZmlsZShuYW1lLCB1cmwpDQoNCmVsaWYgbW9kZT09MTA6DQogICAgYWRkb25fbG9nKCJnZXRDb21tdW5pdHlTb3VyY2VzIikNCiAgICBnZXRDb21tdW5pdHlTb3VyY2VzKCkNCg0KZWxpZiBtb2RlPT0xMToNCiAgICBhZGRvbl9sb2coImFkZFNvdXJjZSIpDQogICAgYWRkU291cmNlKHVybCkNCg0KZWxpZiBtb2RlPT0xMjoNCiAgICBhZGRvbl9sb2coInNldFJlc29sdmVkVXJsIikNCiAgICBpZiBub3QgdXJsLnN0YXJ0c3dpdGgoInBsdWdpbjovL3BsdWdpbiIpIG9yIG5vdCBhbnkoeCBpbiB1cmwgZm9yIHggaW4gZ19pZ25vcmVTZXRSZXNvbHZlZCk6I25vdCB1cmwuc3RhcnRzd2l0aCgicGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3RlciIpIDoNCiAgICAgICAgc2V0cmVzPVRydWUNCiAgICAgICAgaWYgJyQkTFNEaXJlY3QkJCcgaW4gdXJsOg0KICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckJExTRGlyZWN0JCQnLCcnKQ0KICAgICAgICAgICAgc2V0cmVzPUZhbHNlDQogICAgICAgIGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKHBhdGg9dXJsKQ0KICAgICAgICBpZiBub3Qgc2V0cmVzOg0KICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCkNCiAgICAgICAgZWxzZTogDQogICAgICAgICAgICB4Ym1jcGx1Z2luLnNldFJlc29sdmVkVXJsKGludChzeXMuYXJndlsxXSksIFRydWUsIGl0ZW0pDQogICAgZWxzZToNCiMgICAgICAgIHByaW50ICdOb3Qgc2V0dGluZyBzZXRSZXNvbHZlZFVybCcNCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignWEJNQy5SdW5QbHVnaW4oJyt1cmwrJyknKQ0KDQoNCmVsaWYgbW9kZT09MTM6DQogICAgYWRkb25fbG9nKCJwbGF5X3BsYXlsaXN0IikNCiAgICBwbGF5X3BsYXlsaXN0KG5hbWUsIHBsYXlsaXN0KQ0KDQplbGlmIG1vZGU9PTE0Og0KICAgIGFkZG9uX2xvZygiZ2V0X3htbF9kYXRhYmFzZSIpDQogICAgZ2V0X3htbF9kYXRhYmFzZSh1cmwpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQplbGlmIG1vZGU9PTE1Og0KICAgIGFkZG9uX2xvZygiYnJvd3NlX3htbF9kYXRhYmFzZSIpDQogICAgZ2V0X3htbF9kYXRhYmFzZSh1cmwsIFRydWUpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQplbGlmIG1vZGU9PTE2Og0KICAgIGFkZG9uX2xvZygiYnJvd3NlX2NvbW11bml0eSIpDQogICAgZ2V0Q29tbXVuaXR5U291cmNlcyh1cmwsYnJvd3NlPVRydWUpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQplbGlmIG1vZGU9PTE3IG9yIG1vZGU9PTExNzoNCiAgICBhZGRvbl9sb2coImdldFJlZ2V4UGFyc2VkIikNCg0KICAgIGRhdGE9Tm9uZQ0KICAgIGlmIHJlZ2V4cyBhbmQgJ2xpc3RyZXBlYXQnIGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKToNCiAgICAgICAgbGlzdHJlcGVhdCxyZXQsbSxyZWdleHMsIGNvb2tpZUphciA9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwpDQogICAgICAgICNwcmludCBsaXN0cmVwZWF0LHJldCxtLHJlZ2V4cw0KICAgICAgICBkPScnDQojICAgICAgICBwcmludCAnbSBpcycgLCBtDQojICAgICAgICBwcmludCAncmVnZXhzJyxyZWdleHMNCiAgICAgICAgcmVnZXhuYW1lPW1bJ25hbWUnXQ0KICAgICAgICBleGlzdGluZ19saXN0PXJlZ2V4cy5wb3AocmVnZXhuYW1lKQ0KICMgICAgICAgcHJpbnQgJ2ZpbmFsIHJlZ2V4cycscmVnZXhzLHJlZ2V4bmFtZQ0KICAgICAgICB1cmw9JycNCiAgICAgICAgaW1wb3J0IGNvcHkNCiAgICAgICAgbG49JycNCiAgICAgICAgcm51bWJlcj0wDQogICAgICAgIGZvciBvYmogaW4gcmV0Og0KICAgICAgICAgICAgI3ByaW50ICdvYmonLG9iag0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHJudW1iZXIrPTENCiAgICAgICAgICAgICAgICBuZXdjb3B5PWNvcHkuZGVlcGNvcHkocmVnZXhzKQ0KICAgICMgICAgICAgICAgICBwcmludCAnbmV3Y29weScsbmV3Y29weSwgbGVuKG5ld2NvcHkpDQogICAgICAgICAgICAgICAgbGlzdHJlcGVhdFQ9bGlzdHJlcGVhdA0KICAgICAgICAgICAgICAgIGk9MA0KICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihvYmopKToNCiAgICAjICAgICAgICAgICAgICAgIHByaW50ICdpIGlzICcsaSwgbGVuKG9iaiksIGxlbihuZXdjb3B5KQ0KICAgICAgICAgICAgICAgICAgICBpZiBsZW4obmV3Y29weSk+MDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0aGVfa2V5TywgdGhlX3ZhbHVlTyBpbiBuZXdjb3B5Lml0ZXJpdGVtcygpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRoZV92YWx1ZU8gaXMgbm90IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0aGVfa2V5LCB0aGVfdmFsdWUgaW4gdGhlX3ZhbHVlTy5pdGVyaXRlbXMoKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRoZV92YWx1ZSBpcyBub3QgTm9uZTogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAgJ2tleSBhbmQgdmFsJyx0aGVfa2V5LCB0aGVfdmFsdWUNCiAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2FhJw0KICAgICAgICAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKGkrMSkgKyAnXScNCiAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgcmVwcihvYmpbaV0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHlwZSh0aGVfdmFsdWUpIGlzIGRpY3Q6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0aGVfa2V5bCwgdGhlX3ZhbHVlbCBpbiB0aGVfdmFsdWUuaXRlcml0ZW1zKCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0aGVfdmFsdWVsIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1Ob25lDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosdHVwbGUpOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9IG9ialtpXS5kZWNvZGUoJ3V0Zi04JykgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9IG9ialtpXSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9IG9iai5kZWNvZGUoJ3V0Zi04JykgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD0gb2JqDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ11bREVdJyBpbiB0aGVfdmFsdWVsOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVfdmFsdWVsPXRoZV92YWx1ZWwucmVwbGFjZSgnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKGkrMSkgKyAnXVtERV0nLCB1bmVzY2FwZSh2YWwpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZV92YWx1ZVt0aGVfa2V5bF09dGhlX3ZhbHVlbC5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddJywgdmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnZmlyc3Qgc2VjJyx0aGVfdmFsdWVbdGhlX2tleWxdDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPU5vbmUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosdHVwbGUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9b2JqW2ldLmRlY29kZSgndXRmLTgnKSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9b2JqW2ldIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD0gb2JqLmRlY29kZSgndXRmLTgnKSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9IG9iag0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKGkrMSkgKyAnXVtERV0nIGluIHRoZV92YWx1ZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnZm91bmQgREUnLHRoZV92YWx1ZS5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddW0RFXScsIHVuZXNjYXBlKHZhbCkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVfdmFsdWU9dGhlX3ZhbHVlLnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ11bREVdJywgdW5lc2NhcGUodmFsKSkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVfdmFsdWVPW3RoZV9rZXldPXRoZV92YWx1ZS5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddJywgdmFsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3NlY29uZCBzZWMgdmFsJyx0aGVfdmFsdWVPW3RoZV9rZXldDQoNCiAgICAgICAgICAgICAgICAgICAgdmFsPU5vbmUNCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosdHVwbGUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1vYmpbaV0uZGVjb2RlKCd1dGYtOCcpDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPW9ialtpXQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1vYmouZGVjb2RlKCd1dGYtOCcpDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1vYmoNCiAgICAgICAgICAgICAgICAgICAgaWYgJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ11bREVdJyBpbiBsaXN0cmVwZWF0VDoNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RyZXBlYXRUPWxpc3RyZXBlYXRULnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ11bREVdJyx2YWwpDQogICAgICAgICAgICAgICAgICAgIGxpc3RyZXBlYXRUPWxpc3RyZXBlYXRULnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ10nLGVzY2FwZSh2YWwpKQ0KIyAgICAgICAgICAgICAgICAgICAgcHJpbnQgbGlzdHJlcGVhdFQNCiAgICAgICAgICAgICAgICBsaXN0cmVwZWF0VD1saXN0cmVwZWF0VC5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoMCkgKyAnXScsc3RyKHJudW1iZXIpKSANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZUphciBhbmQgJ1snICsgcmVnZXhuYW1lKycuY29va2llc10nIGluIGxpc3RyZXBlYXRUOg0KICAgICAgICAgICAgICAgICAgICAgICAgbGlzdHJlcGVhdFQ9bGlzdHJlcGVhdFQucmVwbGFjZSgnWycgKyByZWdleG5hbWUrJy5jb29raWVzXScsZ2V0Q29va2llc1N0cmluZyhjb29raWVKYXIpKSANCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAjbmV3Y29weSA9IHVybGxpYi5xdW90ZShyZXByKG5ld2NvcHkpKQ0KICAgICMgICAgICAgICAgICBwcmludCAnbmV3IHJlZ2V4IGxpc3QnLCByZXByKG5ld2NvcHkpLCByZXByKGxpc3RyZXBlYXRUKQ0KICAgICMgICAgICAgICAgICBhZGRMaW5rKGxpc3RsaW5rVCxsaXN0dGl0bGVULmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksbGlzdHRodW1ibmFpbFQsJycsJycsJycsJycsVHJ1ZSxOb25lLG5ld2NvcHksIGxlbihyZXQpKQ0KICAgICAgICAgICAgICAgIHJlZ2V4X3htbD0nJw0KIyAgICAgICAgICAgICAgICBwcmludCAnbmV3Y29weScsbmV3Y29weQ0KICAgICAgICAgICAgICAgIGlmIGxlbihuZXdjb3B5KT4wOg0KICAgICAgICAgICAgICAgICAgICByZWdleF94bWw9ZDJ4KG5ld2NvcHksJ2xzcHJvcm9vdCcpDQogICAgICAgICAgICAgICAgICAgIHJlZ2V4X3htbD1yZWdleF94bWwuc3BsaXQoJzxsc3Byb3Jvb3Q+JylbMV0uc3BsaXQoJzwvbHNwcm9yb290JylbMF0NCiAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgI2xuKz0nXG48aXRlbT4lc1xuJXM8L2l0ZW0+JyUobGlzdHJlcGVhdFQuZW5jb2RlKCJ1dGYtOCIpLHJlZ2V4X3htbCkgICANCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGxuKz0nXG48aXRlbT4lc1xuJXM8L2l0ZW0+JyUobGlzdHJlcGVhdFQscmVnZXhfeG1sKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDogbG4rPSdcbjxpdGVtPiVzXG4lczwvaXRlbT4nJShsaXN0cmVwZWF0VC5lbmNvZGUoInV0Zi04IikscmVnZXhfeG1sKQ0KICAgICAgICAgICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkNCiMgICAgICAgICAgICBwcmludCByZXByKGxuKQ0KIyAgICAgICAgICAgIHByaW50IG5ld2NvcHkNCiAgICAgICAgICAgICAgICANCiMgICAgICAgICAgICBsbis9JzwvaXRlbT4nDQogICAgICAgIA0KICAgICAgICBhZGRvbl9sb2cocmVwcihsbikpDQogICAgICAgIGdldERhdGEoJycsJycsbG4pDQogICAgICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkNCiAgICBlbHNlOg0KICAgICAgICB1cmwsc2V0cmVzb2x2ZWQgPSBnZXRSZWdleFBhcnNlZChyZWdleHMsIHVybCkNCiAgICAgICAgcHJpbnQgcmVwcih1cmwpLHNldHJlc29sdmVkLCdpbWhlcmUnDQogICAgICAgIGlmIG5vdCAocmVnZXhzIGFuZCAnbm90cGxheWFibGUnIGluIHJlZ2V4cyBhbmQgbm90IHVybCk6ICAgICAgICANCiAgICAgICAgICAgIGlmIHVybDoNCiAgICAgICAgICAgICAgICBpZiAnJFBMQVlFUlBST1hZJD0nIGluIHVybDoNCiAgICAgICAgICAgICAgICAgICAgdXJsLHByb3h5PXVybC5zcGxpdCgnJFBMQVlFUlBST1hZJD0nKQ0KICAgICAgICAgICAgICAgICAgICBwcmludCAncHJveHknLHByb3h5DQogICAgICAgICAgICAgICAgICAgICNKYWlyb3ggbW9kIGZvciBwcm94eSBhdXRoDQogICAgICAgICAgICAgICAgICAgIHByb3h5dXNlciA9IE5vbmUNCiAgICAgICAgICAgICAgICAgICAgcHJveHlwYXNzID0gTm9uZQ0KICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocHJveHkpID4gMCBhbmQgJ0AnIGluIHByb3h5Og0KICAgICAgICAgICAgICAgICAgICAgICAgcHJveHkgPSBwcm94eS5zcGxpdCgnOicpDQogICAgICAgICAgICAgICAgICAgICAgICBwcm94eXVzZXIgPSBwcm94eVswXQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJveHlwYXNzID0gcHJveHlbMV0uc3BsaXQoJ0AnKVswXQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHJveHlpcCA9IHByb3h5WzFdLnNwbGl0KCdAJylbMV0NCiAgICAgICAgICAgICAgICAgICAgICAgIHBvcnQgPSBwcm94eVsyXQ0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHJveHlpcCxwb3J0PXByb3h5LnNwbGl0KCc6JykNCg0KICAgICAgICAgICAgICAgICAgICBwbGF5bWVkaWF3aXRocHJveHkodXJsLG5hbWUsaWNvbmltYWdlLHByb3h5aXAscG9ydCwgcHJveHl1c2VyLHByb3h5cGFzcykgI2phaXJveA0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIHBsYXlzZXRyZXNvbHZlZCh1cmwsbmFtZSxpY29uaW1hZ2Usc2V0cmVzb2x2ZWQscmVnZXhzKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihIZXJjdWxlcyxGYWlsZWQgdG8gZXh0cmFjdCByZWdleC4gLSAiKyJ0aGlzIisiLDQwMDAsIitpY29uKyIpIikNCmVsaWYgbW9kZT09MTg6DQogICAgYWRkb25fbG9nKCJ5b3V0dWJlZGwiKQ0KICAgIHRyeToNCiAgICAgICAgaW1wb3J0IHlvdXR1YmVkbA0KICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEhlcmN1bGVzLFBsZWFzZSBbQ09MT1IgeWVsbG93XWluc3RhbGwgWW91dHViZS1kbFsvQ09MT1JdIG1vZHVsZSAsMTAwMDAsIiIpIikNCiAgICBzdHJlYW1fdXJsPXlvdXR1YmVkbC5zaW5nbGVfWUQodXJsKQ0KICAgIHBsYXlzZXRyZXNvbHZlZChzdHJlYW1fdXJsLG5hbWUsaWNvbmltYWdlKQ0KZWxpZiBtb2RlPT0xOToNCiAgICBhZGRvbl9sb2coIkdlbmVzaXNjb21tb25yZXNvbHZlcnMiKQ0KICAgIHBsYXlzZXRyZXNvbHZlZCAodXJsc29sdmVyKHVybCksbmFtZSxpY29uaW1hZ2UsVHJ1ZSkNCg0KZWxpZiBtb2RlPT0yMToNCiAgICBhZGRvbl9sb2coImRvd25sb2FkIGN1cnJlbnQgZmlsZSB1c2luZyB5b3V0dWJlLWRsIHNlcnZpY2UiKQ0KICAgIG10eXBlPSd2aWRlbycNCiAgICBpZiAnW21wM10nIGluIG5hbWU6DQogICAgICAgIG10eXBlPSdhdWRpbycNCiAgICAgICAgbmFtZT1uYW1lLnJlcGxhY2UoJ1ttcDNdJywnJykNCiAgICB5dGRsX2Rvd25sb2FkKCcnLG5hbWUsIG10eXBlKQ0KZWxpZiBtb2RlPT0yMzoNCiAgICBhZGRvbl9sb2coImdldCBpbmZvIHRoZW4gZG93bmxvYWQiKQ0KICAgIG10eXBlPSd2aWRlbycNCiAgICBpZiAnW21wM10nIGluIG5hbWU6DQogICAgICAgIG10eXBlPSdhdWRpbycNCiAgICAgICAgbmFtZT1uYW1lLnJlcGxhY2UoJ1ttcDNdJywnJykNCiAgICB5dGRsX2Rvd25sb2FkKHVybCxuYW1lLG10eXBlKQ0KZWxpZiBtb2RlPT0yNDoNCiAgICBhZGRvbl9sb2coIkF1ZGlvIG9ubHkgeW91dHViZSBkb3dubG9hZCIpDQogICAgeXRkbF9kb3dubG9hZCh1cmwsbmFtZSwnYXVkaW8nKQ0KZWxpZiBtb2RlPT0yNToNCiAgICBhZGRvbl9sb2coIlNlYXJjaGluIE90aGVyIHBsdWdpbnMiKQ0KICAgIF9zZWFyY2godXJsLG5hbWUpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KZWxpZiBtb2RlPT0yNjoNCiAgICBuYXZlZ2FyKCJbQ09MT1IgbGltZV1WZXJzacOzbiBhY3R1YWw6ICIgKyBhZGRvbl92ZXJzaW9uLCJbQ09MT1IgbGltZV0gXG5bQ09MT1IgeWVsbG93XcK/RGVzZWEgdmlzaXRhciBudWVzdHJhIHdlYj9bL0NPTE9SXSIpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KZWxpZiBtb2RlPT01NToNCiAgICBhZGRvbl9sb2coImVuYWJsZWQgbG9jayIpDQogICAgcGFyZW50YWxibG9ja2VkcGluID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWRwaW4nKQ0KICAgIGtleWJvYXJkID0geGJtYy5LZXlib2FyZCgnJywnaW50cm9kdXpjYSBzdSBsaWNlbmNpYScpDQogICAga2V5Ym9hcmQuZG9Nb2RhbCgpDQogICAgaWYgbm90IChrZXlib2FyZC5pc0NvbmZpcm1lZCgpID09IEZhbHNlKToNCiAgICAgICAgbmV3U3RyID0ga2V5Ym9hcmQuZ2V0VGV4dCgpDQogICAgICAgIGlmIG5ld1N0cj09cGFyZW50YWxibG9ja2VkcGluOg0KICAgICAgICAgICAgYWRkb24uc2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkJywgImZhbHNlIikNCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEhlcmN1bGVzLCBsaWNlbmNpYSBhY3RpdmEsNTAwMCwiK2ljb24rIikiKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oSGVyY3VsZXMsIExpY2VuY2lhIG5vIGFjdGl2YSEgLDUwMDAsIitpY29uKyIpIikNCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQplbGlmIG1vZGU9PTU2Og0KICAgIGFkZG9uX2xvZygiZGlzYWJsZSBsb2NrIikNCiAgICBhZGRvbi5zZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWQnLCAidHJ1ZSIpDQogICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oSGVyY3VsZXMsIG5vIGFjdGl2byw1MDAwLCIraWNvbisiKSIpDQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ0KDQplbGlmIG1vZGU9PTUzOg0KICAgIGFkZG9uX2xvZygiUmVxdWVzdGluZyBKU09OLVJQQyBJdGVtcyIpDQogICAgcGx1Z2lucXVlcnlieUpTT04odXJsKQ0KICAgICN4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpDQppZiBub3Qgdmlld21vZGU9PU5vbmU6DQogICBwcmludCAnc2V0dGluZyB2aWV3IG1vZGUnDQogICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoJXMpIiV2aWV3bW9kZSk=') 